function DI(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const c=Object.getOwnPropertyDescriptor(i,s);c&&Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();var OI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Om(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var IT={exports:{}},Kt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ed=Symbol.for("react.element"),FI=Symbol.for("react.portal"),BI=Symbol.for("react.fragment"),NI=Symbol.for("react.strict_mode"),UI=Symbol.for("react.profiler"),VI=Symbol.for("react.provider"),jI=Symbol.for("react.context"),GI=Symbol.for("react.forward_ref"),WI=Symbol.for("react.suspense"),HI=Symbol.for("react.memo"),$I=Symbol.for("react.lazy"),K1=Symbol.iterator;function qI(t){return t===null||typeof t!="object"?null:(t=K1&&t[K1]||t["@@iterator"],typeof t=="function"?t:null)}var MT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},LT=Object.assign,kT={};function vu(t,e,n){this.props=t,this.context=e,this.refs=kT,this.updater=n||MT}vu.prototype.isReactComponent={};vu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};vu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function RT(){}RT.prototype=vu.prototype;function X0(t,e,n){this.props=t,this.context=e,this.refs=kT,this.updater=n||MT}var Y0=X0.prototype=new RT;Y0.constructor=X0;LT(Y0,vu.prototype);Y0.isPureReactComponent=!0;var J1=Array.isArray,zT=Object.prototype.hasOwnProperty,K0={current:null},DT={key:!0,ref:!0,__self:!0,__source:!0};function OT(t,e,n){var i,s={},c=null,d=null;if(e!=null)for(i in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(c=""+e.key),e)zT.call(e,i)&&!DT.hasOwnProperty(i)&&(s[i]=e[i]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var y=Array(l),w=0;w<l;w++)y[w]=arguments[w+2];s.children=y}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)s[i]===void 0&&(s[i]=l[i]);return{$$typeof:Ed,type:t,key:c,ref:d,props:s,_owner:K0.current}}function ZI(t,e){return{$$typeof:Ed,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function J0(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ed}function XI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Q1=/\/+/g;function f_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?XI(""+t.key):e.toString(36)}function Tp(t,e,n,i,s){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case Ed:case FI:d=!0}}if(d)return d=t,s=s(d),t=i===""?"."+f_(d,0):i,J1(s)?(n="",t!=null&&(n=t.replace(Q1,"$&/")+"/"),Tp(s,e,n,"",function(w){return w})):s!=null&&(J0(s)&&(s=ZI(s,n+(!s.key||d&&d.key===s.key?"":(""+s.key).replace(Q1,"$&/")+"/")+t)),e.push(s)),1;if(d=0,i=i===""?".":i+":",J1(t))for(var l=0;l<t.length;l++){c=t[l];var y=i+f_(c,l);d+=Tp(c,e,n,y,s)}else if(y=qI(t),typeof y=="function")for(t=y.call(t),l=0;!(c=t.next()).done;)c=c.value,y=i+f_(c,l++),d+=Tp(c,e,n,y,s);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function Wf(t,e,n){if(t==null)return t;var i=[],s=0;return Tp(t,i,"","",function(c){return e.call(n,c,s++)}),i}function YI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var _r={current:null},Sp={transition:null},KI={ReactCurrentDispatcher:_r,ReactCurrentBatchConfig:Sp,ReactCurrentOwner:K0};Kt.Children={map:Wf,forEach:function(t,e,n){Wf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Wf(t,function(){e++}),e},toArray:function(t){return Wf(t,function(e){return e})||[]},only:function(t){if(!J0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Kt.Component=vu;Kt.Fragment=BI;Kt.Profiler=UI;Kt.PureComponent=X0;Kt.StrictMode=NI;Kt.Suspense=WI;Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KI;Kt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=LT({},t.props),s=t.key,c=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,d=K0.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(y in e)zT.call(e,y)&&!DT.hasOwnProperty(y)&&(i[y]=e[y]===void 0&&l!==void 0?l[y]:e[y])}var y=arguments.length-2;if(y===1)i.children=n;else if(1<y){l=Array(y);for(var w=0;w<y;w++)l[w]=arguments[w+2];i.children=l}return{$$typeof:Ed,type:t.type,key:s,ref:c,props:i,_owner:d}};Kt.createContext=function(t){return t={$$typeof:jI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:VI,_context:t},t.Consumer=t};Kt.createElement=OT;Kt.createFactory=function(t){var e=OT.bind(null,t);return e.type=t,e};Kt.createRef=function(){return{current:null}};Kt.forwardRef=function(t){return{$$typeof:GI,render:t}};Kt.isValidElement=J0;Kt.lazy=function(t){return{$$typeof:$I,_payload:{_status:-1,_result:t},_init:YI}};Kt.memo=function(t,e){return{$$typeof:HI,type:t,compare:e===void 0?null:e}};Kt.startTransition=function(t){var e=Sp.transition;Sp.transition={};try{t()}finally{Sp.transition=e}};Kt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Kt.useCallback=function(t,e){return _r.current.useCallback(t,e)};Kt.useContext=function(t){return _r.current.useContext(t)};Kt.useDebugValue=function(){};Kt.useDeferredValue=function(t){return _r.current.useDeferredValue(t)};Kt.useEffect=function(t,e){return _r.current.useEffect(t,e)};Kt.useId=function(){return _r.current.useId()};Kt.useImperativeHandle=function(t,e,n){return _r.current.useImperativeHandle(t,e,n)};Kt.useInsertionEffect=function(t,e){return _r.current.useInsertionEffect(t,e)};Kt.useLayoutEffect=function(t,e){return _r.current.useLayoutEffect(t,e)};Kt.useMemo=function(t,e){return _r.current.useMemo(t,e)};Kt.useReducer=function(t,e,n){return _r.current.useReducer(t,e,n)};Kt.useRef=function(t){return _r.current.useRef(t)};Kt.useState=function(t){return _r.current.useState(t)};Kt.useSyncExternalStore=function(t,e,n){return _r.current.useSyncExternalStore(t,e,n)};Kt.useTransition=function(){return _r.current.useTransition()};Kt.version="18.2.0";IT.exports=Kt;var at=IT.exports;const by=Om(at);var FT={exports:{}},ts={},BT={exports:{}},NT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(tt,Et){var Pt=tt.length;tt.push(Et);e:for(;0<Pt;){var nn=Pt-1>>>1,rn=tt[nn];if(0<s(rn,Et))tt[nn]=Et,tt[Pt]=rn,Pt=nn;else break e}}function n(tt){return tt.length===0?null:tt[0]}function i(tt){if(tt.length===0)return null;var Et=tt[0],Pt=tt.pop();if(Pt!==Et){tt[0]=Pt;e:for(var nn=0,rn=tt.length,ir=rn>>>1;nn<ir;){var ii=2*(nn+1)-1,bi=tt[ii],ri=ii+1,un=tt[ri];if(0>s(bi,Pt))ri<rn&&0>s(un,bi)?(tt[nn]=un,tt[ri]=Pt,nn=ri):(tt[nn]=bi,tt[ii]=Pt,nn=ii);else if(ri<rn&&0>s(un,Pt))tt[nn]=un,tt[ri]=Pt,nn=ri;else break e}}return Et}function s(tt,Et){var Pt=tt.sortIndex-Et.sortIndex;return Pt!==0?Pt:tt.id-Et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var d=Date,l=d.now();t.unstable_now=function(){return d.now()-l}}var y=[],w=[],S=1,I=null,P=3,B=!1,G=!1,K=!1,de=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(tt){for(var Et=n(w);Et!==null;){if(Et.callback===null)i(w);else if(Et.startTime<=tt)i(w),Et.sortIndex=Et.expirationTime,e(y,Et);else break;Et=n(w)}}function se(tt){if(K=!1,q(tt),!G)if(n(y)!==null)G=!0,xt(pe);else{var Et=n(w);Et!==null&&xi(se,Et.startTime-tt)}}function pe(tt,Et){G=!1,K&&(K=!1,Z(Fe),Fe=-1),B=!0;var Pt=P;try{for(q(Et),I=n(y);I!==null&&(!(I.expirationTime>Et)||tt&&!pt());){var nn=I.callback;if(typeof nn=="function"){I.callback=null,P=I.priorityLevel;var rn=nn(I.expirationTime<=Et);Et=t.unstable_now(),typeof rn=="function"?I.callback=rn:I===n(y)&&i(y),q(Et)}else i(y);I=n(y)}if(I!==null)var ir=!0;else{var ii=n(w);ii!==null&&xi(se,ii.startTime-Et),ir=!1}return ir}finally{I=null,P=Pt,B=!1}}var be=!1,Re=null,Fe=-1,Ve=5,je=-1;function pt(){return!(t.unstable_now()-je<Ve)}function bt(){if(Re!==null){var tt=t.unstable_now();je=tt;var Et=!0;try{Et=Re(!0,tt)}finally{Et?St():(be=!1,Re=null)}}else be=!1}var St;if(typeof j=="function")St=function(){j(bt)};else if(typeof MessageChannel<"u"){var kt=new MessageChannel,Gn=kt.port2;kt.port1.onmessage=bt,St=function(){Gn.postMessage(null)}}else St=function(){de(bt,0)};function xt(tt){Re=tt,be||(be=!0,St())}function xi(tt,Et){Fe=de(function(){tt(t.unstable_now())},Et)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(tt){tt.callback=null},t.unstable_continueExecution=function(){G||B||(G=!0,xt(pe))},t.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ve=0<tt?Math.floor(1e3/tt):5},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return n(y)},t.unstable_next=function(tt){switch(P){case 1:case 2:case 3:var Et=3;break;default:Et=P}var Pt=P;P=Et;try{return tt()}finally{P=Pt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(tt,Et){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var Pt=P;P=tt;try{return Et()}finally{P=Pt}},t.unstable_scheduleCallback=function(tt,Et,Pt){var nn=t.unstable_now();switch(typeof Pt=="object"&&Pt!==null?(Pt=Pt.delay,Pt=typeof Pt=="number"&&0<Pt?nn+Pt:nn):Pt=nn,tt){case 1:var rn=-1;break;case 2:rn=250;break;case 5:rn=1073741823;break;case 4:rn=1e4;break;default:rn=5e3}return rn=Pt+rn,tt={id:S++,callback:Et,priorityLevel:tt,startTime:Pt,expirationTime:rn,sortIndex:-1},Pt>nn?(tt.sortIndex=Pt,e(w,tt),n(y)===null&&tt===n(w)&&(K?(Z(Fe),Fe=-1):K=!0,xi(se,Pt-nn))):(tt.sortIndex=rn,e(y,tt),G||B||(G=!0,xt(pe))),tt},t.unstable_shouldYield=pt,t.unstable_wrapCallback=function(tt){var Et=P;return function(){var Pt=P;P=Et;try{return tt.apply(this,arguments)}finally{P=Pt}}}})(NT);BT.exports=NT;var JI=BT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UT=at,Qr=JI;function Ge(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VT=new Set,Yh={};function Wl(t,e){tu(t,e),tu(t+"Capture",e)}function tu(t,e){for(Yh[t]=e,t=0;t<e.length;t++)VT.add(e[t])}var Uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wy=Object.prototype.hasOwnProperty,QI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,eb={},tb={};function eM(t){return wy.call(tb,t)?!0:wy.call(eb,t)?!1:QI.test(t)?tb[t]=!0:(eb[t]=!0,!1)}function tM(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function nM(t,e,n,i){if(e===null||typeof e>"u"||tM(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yr(t,e,n,i,s,c,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=d}var Vi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Vi[t]=new yr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Vi[e]=new yr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Vi[t]=new yr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Vi[t]=new yr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Vi[t]=new yr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Vi[t]=new yr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Vi[t]=new yr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Vi[t]=new yr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Vi[t]=new yr(t,5,!1,t.toLowerCase(),null,!1,!1)});var Q0=/[\-:]([a-z])/g;function ev(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Q0,ev);Vi[e]=new yr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Q0,ev);Vi[e]=new yr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Q0,ev);Vi[e]=new yr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Vi[t]=new yr(t,1,!1,t.toLowerCase(),null,!1,!1)});Vi.xlinkHref=new yr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Vi[t]=new yr(t,1,!1,t.toLowerCase(),null,!0,!0)});function tv(t,e,n,i){var s=Vi.hasOwnProperty(e)?Vi[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nM(e,n,s,i)&&(n=null),i||s===null?eM(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,i=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var qo=UT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hf=Symbol.for("react.element"),Lc=Symbol.for("react.portal"),kc=Symbol.for("react.fragment"),nv=Symbol.for("react.strict_mode"),Ey=Symbol.for("react.profiler"),jT=Symbol.for("react.provider"),GT=Symbol.for("react.context"),iv=Symbol.for("react.forward_ref"),Ty=Symbol.for("react.suspense"),Sy=Symbol.for("react.suspense_list"),rv=Symbol.for("react.memo"),Ea=Symbol.for("react.lazy"),WT=Symbol.for("react.offscreen"),nb=Symbol.iterator;function mh(t){return t===null||typeof t!="object"?null:(t=nb&&t[nb]||t["@@iterator"],typeof t=="function"?t:null)}var jn=Object.assign,p_;function Mh(t){if(p_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);p_=e&&e[1]||""}return`
`+p_+t}var m_=!1;function g_(t,e){if(!t||m_)return"";m_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){i=w}t.call(e.prototype)}else{try{throw Error()}catch(w){i=w}t()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var s=w.stack.split(`
`),c=i.stack.split(`
`),d=s.length-1,l=c.length-1;1<=d&&0<=l&&s[d]!==c[l];)l--;for(;1<=d&&0<=l;d--,l--)if(s[d]!==c[l]){if(d!==1||l!==1)do if(d--,l--,0>l||s[d]!==c[l]){var y=`
`+s[d].replace(" at new "," at ");return t.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",t.displayName)),y}while(1<=d&&0<=l);break}}}finally{m_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Mh(t):""}function iM(t){switch(t.tag){case 5:return Mh(t.type);case 16:return Mh("Lazy");case 13:return Mh("Suspense");case 19:return Mh("SuspenseList");case 0:case 2:case 15:return t=g_(t.type,!1),t;case 11:return t=g_(t.type.render,!1),t;case 1:return t=g_(t.type,!0),t;default:return""}}function Ay(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case kc:return"Fragment";case Lc:return"Portal";case Ey:return"Profiler";case nv:return"StrictMode";case Ty:return"Suspense";case Sy:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case GT:return(t.displayName||"Context")+".Consumer";case jT:return(t._context.displayName||"Context")+".Provider";case iv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case rv:return e=t.displayName||null,e!==null?e:Ay(t.type)||"Memo";case Ea:e=t._payload,t=t._init;try{return Ay(t(e))}catch{}}return null}function rM(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ay(e);case 8:return e===nv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ja(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function HT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sM(t){var e=HT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,c=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(d){i=""+d,c.call(this,d)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $f(t){t._valueTracker||(t._valueTracker=sM(t))}function $T(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=HT(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function qp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Py(t,e){var n=e.checked;return jn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ib(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ja(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qT(t,e){e=e.checked,e!=null&&tv(t,"checked",e,!1)}function Cy(t,e){qT(t,e);var n=ja(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Iy(t,e.type,n):e.hasOwnProperty("defaultValue")&&Iy(t,e.type,ja(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function rb(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Iy(t,e,n){(e!=="number"||qp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Lh=Array.isArray;function $c(t,e,n,i){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ja(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,i&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function My(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ge(91));return jn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function sb(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ge(92));if(Lh(n)){if(1<n.length)throw Error(Ge(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ja(n)}}function ZT(t,e){var n=ja(e.value),i=ja(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function ob(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function XT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ly(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?XT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qf,YT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(qf=qf||document.createElement("div"),qf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Kh(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Fh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},oM=["Webkit","ms","Moz","O"];Object.keys(Fh).forEach(function(t){oM.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Fh[e]=Fh[t]})});function KT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Fh.hasOwnProperty(t)&&Fh[t]?(""+e).trim():e+"px"}function JT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,s=KT(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,s):t[n]=s}}var aM=jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ky(t,e){if(e){if(aM[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ge(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ge(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ge(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ge(62))}}function Ry(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zy=null;function sv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Dy=null,qc=null,Zc=null;function ab(t){if(t=Ad(t)){if(typeof Dy!="function")throw Error(Ge(280));var e=t.stateNode;e&&(e=Vm(e),Dy(t.stateNode,t.type,e))}}function QT(t){qc?Zc?Zc.push(t):Zc=[t]:qc=t}function e2(){if(qc){var t=qc,e=Zc;if(Zc=qc=null,ab(t),e)for(t=0;t<e.length;t++)ab(e[t])}}function t2(t,e){return t(e)}function n2(){}var __=!1;function i2(t,e,n){if(__)return t(e,n);__=!0;try{return t2(t,e,n)}finally{__=!1,(qc!==null||Zc!==null)&&(n2(),e2())}}function Jh(t,e){var n=t.stateNode;if(n===null)return null;var i=Vm(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ge(231,e,typeof n));return n}var Oy=!1;if(Uo)try{var gh={};Object.defineProperty(gh,"passive",{get:function(){Oy=!0}}),window.addEventListener("test",gh,gh),window.removeEventListener("test",gh,gh)}catch{Oy=!1}function lM(t,e,n,i,s,c,d,l,y){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(S){this.onError(S)}}var Bh=!1,Zp=null,Xp=!1,Fy=null,cM={onError:function(t){Bh=!0,Zp=t}};function uM(t,e,n,i,s,c,d,l,y){Bh=!1,Zp=null,lM.apply(cM,arguments)}function hM(t,e,n,i,s,c,d,l,y){if(uM.apply(this,arguments),Bh){if(Bh){var w=Zp;Bh=!1,Zp=null}else throw Error(Ge(198));Xp||(Xp=!0,Fy=w)}}function Hl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function r2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function lb(t){if(Hl(t)!==t)throw Error(Ge(188))}function dM(t){var e=t.alternate;if(!e){if(e=Hl(t),e===null)throw Error(Ge(188));return e!==t?null:t}for(var n=t,i=e;;){var s=n.return;if(s===null)break;var c=s.alternate;if(c===null){if(i=s.return,i!==null){n=i;continue}break}if(s.child===c.child){for(c=s.child;c;){if(c===n)return lb(s),t;if(c===i)return lb(s),e;c=c.sibling}throw Error(Ge(188))}if(n.return!==i.return)n=s,i=c;else{for(var d=!1,l=s.child;l;){if(l===n){d=!0,n=s,i=c;break}if(l===i){d=!0,i=s,n=c;break}l=l.sibling}if(!d){for(l=c.child;l;){if(l===n){d=!0,n=c,i=s;break}if(l===i){d=!0,i=c,n=s;break}l=l.sibling}if(!d)throw Error(Ge(189))}}if(n.alternate!==i)throw Error(Ge(190))}if(n.tag!==3)throw Error(Ge(188));return n.stateNode.current===n?t:e}function s2(t){return t=dM(t),t!==null?o2(t):null}function o2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=o2(t);if(e!==null)return e;t=t.sibling}return null}var a2=Qr.unstable_scheduleCallback,cb=Qr.unstable_cancelCallback,fM=Qr.unstable_shouldYield,pM=Qr.unstable_requestPaint,ni=Qr.unstable_now,mM=Qr.unstable_getCurrentPriorityLevel,ov=Qr.unstable_ImmediatePriority,l2=Qr.unstable_UserBlockingPriority,Yp=Qr.unstable_NormalPriority,gM=Qr.unstable_LowPriority,c2=Qr.unstable_IdlePriority,Fm=null,ho=null;function _M(t){if(ho&&typeof ho.onCommitFiberRoot=="function")try{ho.onCommitFiberRoot(Fm,t,void 0,(t.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:xM,yM=Math.log,vM=Math.LN2;function xM(t){return t>>>=0,t===0?32:31-(yM(t)/vM|0)|0}var Zf=64,Xf=4194304;function kh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Kp(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,s=t.suspendedLanes,c=t.pingedLanes,d=n&268435455;if(d!==0){var l=d&~s;l!==0?i=kh(l):(c&=d,c!==0&&(i=kh(c)))}else d=n&~s,d!==0?i=kh(d):c!==0&&(i=kh(c));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,c=e&-e,s>=c||s===16&&(c&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Fs(e),s=1<<n,i|=t[n],e&=~s;return i}function bM(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wM(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,c=t.pendingLanes;0<c;){var d=31-Fs(c),l=1<<d,y=s[d];y===-1?(!(l&n)||l&i)&&(s[d]=bM(l,e)):y<=e&&(t.expiredLanes|=l),c&=~l}}function By(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function u2(){var t=Zf;return Zf<<=1,!(Zf&4194240)&&(Zf=64),t}function y_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Td(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fs(e),t[e]=n}function EM(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Fs(n),c=1<<s;e[s]=0,i[s]=-1,t[s]=-1,n&=~c}}function av(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Fs(n),s=1<<i;s&e|t[i]&e&&(t[i]|=e),n&=~s}}var mn=0;function h2(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var d2,lv,f2,p2,m2,Ny=!1,Yf=[],ka=null,Ra=null,za=null,Qh=new Map,ed=new Map,Sa=[],TM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ub(t,e){switch(t){case"focusin":case"focusout":ka=null;break;case"dragenter":case"dragleave":Ra=null;break;case"mouseover":case"mouseout":za=null;break;case"pointerover":case"pointerout":Qh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ed.delete(e.pointerId)}}function _h(t,e,n,i,s,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:c,targetContainers:[s]},e!==null&&(e=Ad(e),e!==null&&lv(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function SM(t,e,n,i,s){switch(e){case"focusin":return ka=_h(ka,t,e,n,i,s),!0;case"dragenter":return Ra=_h(Ra,t,e,n,i,s),!0;case"mouseover":return za=_h(za,t,e,n,i,s),!0;case"pointerover":var c=s.pointerId;return Qh.set(c,_h(Qh.get(c)||null,t,e,n,i,s)),!0;case"gotpointercapture":return c=s.pointerId,ed.set(c,_h(ed.get(c)||null,t,e,n,i,s)),!0}return!1}function g2(t){var e=Al(t.target);if(e!==null){var n=Hl(e);if(n!==null){if(e=n.tag,e===13){if(e=r2(n),e!==null){t.blockedOn=e,m2(t.priority,function(){f2(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ap(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Uy(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);zy=i,n.target.dispatchEvent(i),zy=null}else return e=Ad(n),e!==null&&lv(e),t.blockedOn=n,!1;e.shift()}return!0}function hb(t,e,n){Ap(t)&&n.delete(e)}function AM(){Ny=!1,ka!==null&&Ap(ka)&&(ka=null),Ra!==null&&Ap(Ra)&&(Ra=null),za!==null&&Ap(za)&&(za=null),Qh.forEach(hb),ed.forEach(hb)}function yh(t,e){t.blockedOn===e&&(t.blockedOn=null,Ny||(Ny=!0,Qr.unstable_scheduleCallback(Qr.unstable_NormalPriority,AM)))}function td(t){function e(s){return yh(s,t)}if(0<Yf.length){yh(Yf[0],t);for(var n=1;n<Yf.length;n++){var i=Yf[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ka!==null&&yh(ka,t),Ra!==null&&yh(Ra,t),za!==null&&yh(za,t),Qh.forEach(e),ed.forEach(e),n=0;n<Sa.length;n++)i=Sa[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Sa.length&&(n=Sa[0],n.blockedOn===null);)g2(n),n.blockedOn===null&&Sa.shift()}var Xc=qo.ReactCurrentBatchConfig,Jp=!0;function PM(t,e,n,i){var s=mn,c=Xc.transition;Xc.transition=null;try{mn=1,cv(t,e,n,i)}finally{mn=s,Xc.transition=c}}function CM(t,e,n,i){var s=mn,c=Xc.transition;Xc.transition=null;try{mn=4,cv(t,e,n,i)}finally{mn=s,Xc.transition=c}}function cv(t,e,n,i){if(Jp){var s=Uy(t,e,n,i);if(s===null)C_(t,e,i,Qp,n),ub(t,i);else if(SM(s,t,e,n,i))i.stopPropagation();else if(ub(t,i),e&4&&-1<TM.indexOf(t)){for(;s!==null;){var c=Ad(s);if(c!==null&&d2(c),c=Uy(t,e,n,i),c===null&&C_(t,e,i,Qp,n),c===s)break;s=c}s!==null&&i.stopPropagation()}else C_(t,e,i,null,n)}}var Qp=null;function Uy(t,e,n,i){if(Qp=null,t=sv(i),t=Al(t),t!==null)if(e=Hl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=r2(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qp=t,null}function _2(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mM()){case ov:return 1;case l2:return 4;case Yp:case gM:return 16;case c2:return 536870912;default:return 16}default:return 16}}var Pa=null,uv=null,Pp=null;function y2(){if(Pp)return Pp;var t,e=uv,n=e.length,i,s="value"in Pa?Pa.value:Pa.textContent,c=s.length;for(t=0;t<n&&e[t]===s[t];t++);var d=n-t;for(i=1;i<=d&&e[n-i]===s[c-i];i++);return Pp=s.slice(t,1<i?1-i:void 0)}function Cp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Kf(){return!0}function db(){return!1}function ns(t){function e(n,i,s,c,d){this._reactName=n,this._targetInst=s,this.type=i,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(c):c[l]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?Kf:db,this.isPropagationStopped=db,this}return jn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Kf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Kf)},persist:function(){},isPersistent:Kf}),e}var xu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hv=ns(xu),Sd=jn({},xu,{view:0,detail:0}),IM=ns(Sd),v_,x_,vh,Bm=jn({},Sd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==vh&&(vh&&t.type==="mousemove"?(v_=t.screenX-vh.screenX,x_=t.screenY-vh.screenY):x_=v_=0,vh=t),v_)},movementY:function(t){return"movementY"in t?t.movementY:x_}}),fb=ns(Bm),MM=jn({},Bm,{dataTransfer:0}),LM=ns(MM),kM=jn({},Sd,{relatedTarget:0}),b_=ns(kM),RM=jn({},xu,{animationName:0,elapsedTime:0,pseudoElement:0}),zM=ns(RM),DM=jn({},xu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),OM=ns(DM),FM=jn({},xu,{data:0}),pb=ns(FM),BM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},NM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=UM[t])?!!e[t]:!1}function dv(){return VM}var jM=jn({},Sd,{key:function(t){if(t.key){var e=BM[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?NM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dv,charCode:function(t){return t.type==="keypress"?Cp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),GM=ns(jM),WM=jn({},Bm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mb=ns(WM),HM=jn({},Sd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dv}),$M=ns(HM),qM=jn({},xu,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZM=ns(qM),XM=jn({},Bm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),YM=ns(XM),KM=[9,13,27,32],fv=Uo&&"CompositionEvent"in window,Nh=null;Uo&&"documentMode"in document&&(Nh=document.documentMode);var JM=Uo&&"TextEvent"in window&&!Nh,v2=Uo&&(!fv||Nh&&8<Nh&&11>=Nh),gb=String.fromCharCode(32),_b=!1;function x2(t,e){switch(t){case"keyup":return KM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function b2(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Rc=!1;function QM(t,e){switch(t){case"compositionend":return b2(e);case"keypress":return e.which!==32?null:(_b=!0,gb);case"textInput":return t=e.data,t===gb&&_b?null:t;default:return null}}function eL(t,e){if(Rc)return t==="compositionend"||!fv&&x2(t,e)?(t=y2(),Pp=uv=Pa=null,Rc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return v2&&e.locale!=="ko"?null:e.data;default:return null}}var tL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tL[t.type]:e==="textarea"}function w2(t,e,n,i){QT(i),e=em(e,"onChange"),0<e.length&&(n=new hv("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Uh=null,nd=null;function nL(t){R2(t,0)}function Nm(t){var e=Oc(t);if($T(e))return t}function iL(t,e){if(t==="change")return e}var E2=!1;if(Uo){var w_;if(Uo){var E_="oninput"in document;if(!E_){var vb=document.createElement("div");vb.setAttribute("oninput","return;"),E_=typeof vb.oninput=="function"}w_=E_}else w_=!1;E2=w_&&(!document.documentMode||9<document.documentMode)}function xb(){Uh&&(Uh.detachEvent("onpropertychange",T2),nd=Uh=null)}function T2(t){if(t.propertyName==="value"&&Nm(nd)){var e=[];w2(e,nd,t,sv(t)),i2(nL,e)}}function rL(t,e,n){t==="focusin"?(xb(),Uh=e,nd=n,Uh.attachEvent("onpropertychange",T2)):t==="focusout"&&xb()}function sL(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nm(nd)}function oL(t,e){if(t==="click")return Nm(e)}function aL(t,e){if(t==="input"||t==="change")return Nm(e)}function lL(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Us=typeof Object.is=="function"?Object.is:lL;function id(t,e){if(Us(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!wy.call(e,s)||!Us(t[s],e[s]))return!1}return!0}function bb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wb(t,e){var n=bb(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=bb(n)}}function S2(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?S2(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function A2(){for(var t=window,e=qp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=qp(t.document)}return e}function pv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cL(t){var e=A2(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&S2(n.ownerDocument.documentElement,n)){if(i!==null&&pv(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,c=Math.min(i.start,s);i=i.end===void 0?c:Math.min(i.end,s),!t.extend&&c>i&&(s=i,i=c,c=s),s=wb(n,c);var d=wb(n,i);s&&d&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),c>i?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var uL=Uo&&"documentMode"in document&&11>=document.documentMode,zc=null,Vy=null,Vh=null,jy=!1;function Eb(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;jy||zc==null||zc!==qp(i)||(i=zc,"selectionStart"in i&&pv(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Vh&&id(Vh,i)||(Vh=i,i=em(Vy,"onSelect"),0<i.length&&(e=new hv("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=zc)))}function Jf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Dc={animationend:Jf("Animation","AnimationEnd"),animationiteration:Jf("Animation","AnimationIteration"),animationstart:Jf("Animation","AnimationStart"),transitionend:Jf("Transition","TransitionEnd")},T_={},P2={};Uo&&(P2=document.createElement("div").style,"AnimationEvent"in window||(delete Dc.animationend.animation,delete Dc.animationiteration.animation,delete Dc.animationstart.animation),"TransitionEvent"in window||delete Dc.transitionend.transition);function Um(t){if(T_[t])return T_[t];if(!Dc[t])return t;var e=Dc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in P2)return T_[t]=e[n];return t}var C2=Um("animationend"),I2=Um("animationiteration"),M2=Um("animationstart"),L2=Um("transitionend"),k2=new Map,Tb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ha(t,e){k2.set(t,e),Wl(e,[t])}for(var S_=0;S_<Tb.length;S_++){var A_=Tb[S_],hL=A_.toLowerCase(),dL=A_[0].toUpperCase()+A_.slice(1);Ha(hL,"on"+dL)}Ha(C2,"onAnimationEnd");Ha(I2,"onAnimationIteration");Ha(M2,"onAnimationStart");Ha("dblclick","onDoubleClick");Ha("focusin","onFocus");Ha("focusout","onBlur");Ha(L2,"onTransitionEnd");tu("onMouseEnter",["mouseout","mouseover"]);tu("onMouseLeave",["mouseout","mouseover"]);tu("onPointerEnter",["pointerout","pointerover"]);tu("onPointerLeave",["pointerout","pointerover"]);Wl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rh));function Sb(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,hM(i,e,void 0,t),t.currentTarget=null}function R2(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],s=i.event;i=i.listeners;e:{var c=void 0;if(e)for(var d=i.length-1;0<=d;d--){var l=i[d],y=l.instance,w=l.currentTarget;if(l=l.listener,y!==c&&s.isPropagationStopped())break e;Sb(s,l,w),c=y}else for(d=0;d<i.length;d++){if(l=i[d],y=l.instance,w=l.currentTarget,l=l.listener,y!==c&&s.isPropagationStopped())break e;Sb(s,l,w),c=y}}}if(Xp)throw t=Fy,Xp=!1,Fy=null,t}function Cn(t,e){var n=e[qy];n===void 0&&(n=e[qy]=new Set);var i=t+"__bubble";n.has(i)||(z2(e,t,2,!1),n.add(i))}function P_(t,e,n){var i=0;e&&(i|=4),z2(n,t,i,e)}var Qf="_reactListening"+Math.random().toString(36).slice(2);function rd(t){if(!t[Qf]){t[Qf]=!0,VT.forEach(function(n){n!=="selectionchange"&&(fL.has(n)||P_(n,!1,t),P_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Qf]||(e[Qf]=!0,P_("selectionchange",!1,e))}}function z2(t,e,n,i){switch(_2(e)){case 1:var s=PM;break;case 4:s=CM;break;default:s=cv}n=s.bind(null,e,n,t),s=void 0,!Oy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function C_(t,e,n,i,s){var c=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var d=i.tag;if(d===3||d===4){var l=i.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(d===4)for(d=i.return;d!==null;){var y=d.tag;if((y===3||y===4)&&(y=d.stateNode.containerInfo,y===s||y.nodeType===8&&y.parentNode===s))return;d=d.return}for(;l!==null;){if(d=Al(l),d===null)return;if(y=d.tag,y===5||y===6){i=c=d;continue e}l=l.parentNode}}i=i.return}i2(function(){var w=c,S=sv(n),I=[];e:{var P=k2.get(t);if(P!==void 0){var B=hv,G=t;switch(t){case"keypress":if(Cp(n)===0)break e;case"keydown":case"keyup":B=GM;break;case"focusin":G="focus",B=b_;break;case"focusout":G="blur",B=b_;break;case"beforeblur":case"afterblur":B=b_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":B=fb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":B=LM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":B=$M;break;case C2:case I2:case M2:B=zM;break;case L2:B=ZM;break;case"scroll":B=IM;break;case"wheel":B=YM;break;case"copy":case"cut":case"paste":B=OM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":B=mb}var K=(e&4)!==0,de=!K&&t==="scroll",Z=K?P!==null?P+"Capture":null:P;K=[];for(var j=w,q;j!==null;){q=j;var se=q.stateNode;if(q.tag===5&&se!==null&&(q=se,Z!==null&&(se=Jh(j,Z),se!=null&&K.push(sd(j,se,q)))),de)break;j=j.return}0<K.length&&(P=new B(P,G,null,n,S),I.push({event:P,listeners:K}))}}if(!(e&7)){e:{if(P=t==="mouseover"||t==="pointerover",B=t==="mouseout"||t==="pointerout",P&&n!==zy&&(G=n.relatedTarget||n.fromElement)&&(Al(G)||G[Vo]))break e;if((B||P)&&(P=S.window===S?S:(P=S.ownerDocument)?P.defaultView||P.parentWindow:window,B?(G=n.relatedTarget||n.toElement,B=w,G=G?Al(G):null,G!==null&&(de=Hl(G),G!==de||G.tag!==5&&G.tag!==6)&&(G=null)):(B=null,G=w),B!==G)){if(K=fb,se="onMouseLeave",Z="onMouseEnter",j="mouse",(t==="pointerout"||t==="pointerover")&&(K=mb,se="onPointerLeave",Z="onPointerEnter",j="pointer"),de=B==null?P:Oc(B),q=G==null?P:Oc(G),P=new K(se,j+"leave",B,n,S),P.target=de,P.relatedTarget=q,se=null,Al(S)===w&&(K=new K(Z,j+"enter",G,n,S),K.target=q,K.relatedTarget=de,se=K),de=se,B&&G)t:{for(K=B,Z=G,j=0,q=K;q;q=Ec(q))j++;for(q=0,se=Z;se;se=Ec(se))q++;for(;0<j-q;)K=Ec(K),j--;for(;0<q-j;)Z=Ec(Z),q--;for(;j--;){if(K===Z||Z!==null&&K===Z.alternate)break t;K=Ec(K),Z=Ec(Z)}K=null}else K=null;B!==null&&Ab(I,P,B,K,!1),G!==null&&de!==null&&Ab(I,de,G,K,!0)}}e:{if(P=w?Oc(w):window,B=P.nodeName&&P.nodeName.toLowerCase(),B==="select"||B==="input"&&P.type==="file")var pe=iL;else if(yb(P))if(E2)pe=aL;else{pe=sL;var be=rL}else(B=P.nodeName)&&B.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(pe=oL);if(pe&&(pe=pe(t,w))){w2(I,pe,n,S);break e}be&&be(t,P,w),t==="focusout"&&(be=P._wrapperState)&&be.controlled&&P.type==="number"&&Iy(P,"number",P.value)}switch(be=w?Oc(w):window,t){case"focusin":(yb(be)||be.contentEditable==="true")&&(zc=be,Vy=w,Vh=null);break;case"focusout":Vh=Vy=zc=null;break;case"mousedown":jy=!0;break;case"contextmenu":case"mouseup":case"dragend":jy=!1,Eb(I,n,S);break;case"selectionchange":if(uL)break;case"keydown":case"keyup":Eb(I,n,S)}var Re;if(fv)e:{switch(t){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else Rc?x2(t,n)&&(Fe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Fe="onCompositionStart");Fe&&(v2&&n.locale!=="ko"&&(Rc||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&Rc&&(Re=y2()):(Pa=S,uv="value"in Pa?Pa.value:Pa.textContent,Rc=!0)),be=em(w,Fe),0<be.length&&(Fe=new pb(Fe,t,null,n,S),I.push({event:Fe,listeners:be}),Re?Fe.data=Re:(Re=b2(n),Re!==null&&(Fe.data=Re)))),(Re=JM?QM(t,n):eL(t,n))&&(w=em(w,"onBeforeInput"),0<w.length&&(S=new pb("onBeforeInput","beforeinput",null,n,S),I.push({event:S,listeners:w}),S.data=Re))}R2(I,e)})}function sd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function em(t,e){for(var n=e+"Capture",i=[];t!==null;){var s=t,c=s.stateNode;s.tag===5&&c!==null&&(s=c,c=Jh(t,n),c!=null&&i.unshift(sd(t,c,s)),c=Jh(t,e),c!=null&&i.push(sd(t,c,s))),t=t.return}return i}function Ec(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ab(t,e,n,i,s){for(var c=e._reactName,d=[];n!==null&&n!==i;){var l=n,y=l.alternate,w=l.stateNode;if(y!==null&&y===i)break;l.tag===5&&w!==null&&(l=w,s?(y=Jh(n,c),y!=null&&d.unshift(sd(n,y,l))):s||(y=Jh(n,c),y!=null&&d.push(sd(n,y,l)))),n=n.return}d.length!==0&&t.push({event:e,listeners:d})}var pL=/\r\n?/g,mL=/\u0000|\uFFFD/g;function Pb(t){return(typeof t=="string"?t:""+t).replace(pL,`
`).replace(mL,"")}function ep(t,e,n){if(e=Pb(e),Pb(t)!==e&&n)throw Error(Ge(425))}function tm(){}var Gy=null,Wy=null;function Hy(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $y=typeof setTimeout=="function"?setTimeout:void 0,gL=typeof clearTimeout=="function"?clearTimeout:void 0,Cb=typeof Promise=="function"?Promise:void 0,_L=typeof queueMicrotask=="function"?queueMicrotask:typeof Cb<"u"?function(t){return Cb.resolve(null).then(t).catch(yL)}:$y;function yL(t){setTimeout(function(){throw t})}function I_(t,e){var n=e,i=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(i===0){t.removeChild(s),td(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=s}while(n);td(e)}function Da(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ib(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var bu=Math.random().toString(36).slice(2),ao="__reactFiber$"+bu,od="__reactProps$"+bu,Vo="__reactContainer$"+bu,qy="__reactEvents$"+bu,vL="__reactListeners$"+bu,xL="__reactHandles$"+bu;function Al(t){var e=t[ao];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Vo]||n[ao]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ib(t);t!==null;){if(n=t[ao])return n;t=Ib(t)}return e}t=n,n=t.parentNode}return null}function Ad(t){return t=t[ao]||t[Vo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Oc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ge(33))}function Vm(t){return t[od]||null}var Zy=[],Fc=-1;function $a(t){return{current:t}}function Mn(t){0>Fc||(t.current=Zy[Fc],Zy[Fc]=null,Fc--)}function An(t,e){Fc++,Zy[Fc]=t.current,t.current=e}var Ga={},nr=$a(Ga),Cr=$a(!1),Rl=Ga;function nu(t,e){var n=t.type.contextTypes;if(!n)return Ga;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},c;for(c in n)s[c]=e[c];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Ir(t){return t=t.childContextTypes,t!=null}function nm(){Mn(Cr),Mn(nr)}function Mb(t,e,n){if(nr.current!==Ga)throw Error(Ge(168));An(nr,e),An(Cr,n)}function D2(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(Ge(108,rM(t)||"Unknown",s));return jn({},n,i)}function im(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ga,Rl=nr.current,An(nr,t),An(Cr,Cr.current),!0}function Lb(t,e,n){var i=t.stateNode;if(!i)throw Error(Ge(169));n?(t=D2(t,e,Rl),i.__reactInternalMemoizedMergedChildContext=t,Mn(Cr),Mn(nr),An(nr,t)):Mn(Cr),An(Cr,n)}var zo=null,jm=!1,M_=!1;function O2(t){zo===null?zo=[t]:zo.push(t)}function bL(t){jm=!0,O2(t)}function qa(){if(!M_&&zo!==null){M_=!0;var t=0,e=mn;try{var n=zo;for(mn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}zo=null,jm=!1}catch(s){throw zo!==null&&(zo=zo.slice(t+1)),a2(ov,qa),s}finally{mn=e,M_=!1}}return null}var Bc=[],Nc=0,rm=null,sm=0,ms=[],gs=0,zl=null,Fo=1,Bo="";function El(t,e){Bc[Nc++]=sm,Bc[Nc++]=rm,rm=t,sm=e}function F2(t,e,n){ms[gs++]=Fo,ms[gs++]=Bo,ms[gs++]=zl,zl=t;var i=Fo;t=Bo;var s=32-Fs(i)-1;i&=~(1<<s),n+=1;var c=32-Fs(e)+s;if(30<c){var d=s-s%5;c=(i&(1<<d)-1).toString(32),i>>=d,s-=d,Fo=1<<32-Fs(e)+s|n<<s|i,Bo=c+t}else Fo=1<<c|n<<s|i,Bo=t}function mv(t){t.return!==null&&(El(t,1),F2(t,1,0))}function gv(t){for(;t===rm;)rm=Bc[--Nc],Bc[Nc]=null,sm=Bc[--Nc],Bc[Nc]=null;for(;t===zl;)zl=ms[--gs],ms[gs]=null,Bo=ms[--gs],ms[gs]=null,Fo=ms[--gs],ms[gs]=null}var Kr=null,Xr=null,zn=!1,zs=null;function B2(t,e){var n=_s(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function kb(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Kr=t,Xr=Da(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Kr=t,Xr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=zl!==null?{id:Fo,overflow:Bo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_s(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Kr=t,Xr=null,!0):!1;default:return!1}}function Xy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Yy(t){if(zn){var e=Xr;if(e){var n=e;if(!kb(t,e)){if(Xy(t))throw Error(Ge(418));e=Da(n.nextSibling);var i=Kr;e&&kb(t,e)?B2(i,n):(t.flags=t.flags&-4097|2,zn=!1,Kr=t)}}else{if(Xy(t))throw Error(Ge(418));t.flags=t.flags&-4097|2,zn=!1,Kr=t}}}function Rb(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Kr=t}function tp(t){if(t!==Kr)return!1;if(!zn)return Rb(t),zn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Hy(t.type,t.memoizedProps)),e&&(e=Xr)){if(Xy(t))throw N2(),Error(Ge(418));for(;e;)B2(t,e),e=Da(e.nextSibling)}if(Rb(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ge(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Xr=Da(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Xr=null}}else Xr=Kr?Da(t.stateNode.nextSibling):null;return!0}function N2(){for(var t=Xr;t;)t=Da(t.nextSibling)}function iu(){Xr=Kr=null,zn=!1}function _v(t){zs===null?zs=[t]:zs.push(t)}var wL=qo.ReactCurrentBatchConfig;function ks(t,e){if(t&&t.defaultProps){e=jn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var om=$a(null),am=null,Uc=null,yv=null;function vv(){yv=Uc=am=null}function xv(t){var e=om.current;Mn(om),t._currentValue=e}function Ky(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Yc(t,e){am=t,yv=Uc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Pr=!0),t.firstContext=null)}function xs(t){var e=t._currentValue;if(yv!==t)if(t={context:t,memoizedValue:e,next:null},Uc===null){if(am===null)throw Error(Ge(308));Uc=t,am.dependencies={lanes:0,firstContext:t}}else Uc=Uc.next=t;return e}var Pl=null;function bv(t){Pl===null?Pl=[t]:Pl.push(t)}function U2(t,e,n,i){var s=e.interleaved;return s===null?(n.next=n,bv(e)):(n.next=s.next,s.next=n),e.interleaved=n,jo(t,i)}function jo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ta=!1;function wv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function V2(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function No(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Oa(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,an&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,jo(t,n)}return s=i.interleaved,s===null?(e.next=e,bv(i)):(e.next=s.next,s.next=e),i.interleaved=e,jo(t,n)}function Ip(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,av(t,n)}}function zb(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var s=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?s=c=d:c=c.next=d,n=n.next}while(n!==null);c===null?s=c=e:c=c.next=e}else s=c=e;n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:c,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function lm(t,e,n,i){var s=t.updateQueue;Ta=!1;var c=s.firstBaseUpdate,d=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var y=l,w=y.next;y.next=null,d===null?c=w:d.next=w,d=y;var S=t.alternate;S!==null&&(S=S.updateQueue,l=S.lastBaseUpdate,l!==d&&(l===null?S.firstBaseUpdate=w:l.next=w,S.lastBaseUpdate=y))}if(c!==null){var I=s.baseState;d=0,S=w=y=null,l=c;do{var P=l.lane,B=l.eventTime;if((i&P)===P){S!==null&&(S=S.next={eventTime:B,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var G=t,K=l;switch(P=e,B=n,K.tag){case 1:if(G=K.payload,typeof G=="function"){I=G.call(B,I,P);break e}I=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=K.payload,P=typeof G=="function"?G.call(B,I,P):G,P==null)break e;I=jn({},I,P);break e;case 2:Ta=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,P=s.effects,P===null?s.effects=[l]:P.push(l))}else B={eventTime:B,lane:P,tag:l.tag,payload:l.payload,callback:l.callback,next:null},S===null?(w=S=B,y=I):S=S.next=B,d|=P;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;P=l,l=P.next,P.next=null,s.lastBaseUpdate=P,s.shared.pending=null}}while(1);if(S===null&&(y=I),s.baseState=y,s.firstBaseUpdate=w,s.lastBaseUpdate=S,e=s.shared.interleaved,e!==null){s=e;do d|=s.lane,s=s.next;while(s!==e)}else c===null&&(s.shared.lanes=0);Ol|=d,t.lanes=d,t.memoizedState=I}}function Db(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],s=i.callback;if(s!==null){if(i.callback=null,i=n,typeof s!="function")throw Error(Ge(191,s));s.call(i)}}}var j2=new UT.Component().refs;function Jy(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:jn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Gm={isMounted:function(t){return(t=t._reactInternals)?Hl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=gr(),s=Ba(t),c=No(i,s);c.payload=e,n!=null&&(c.callback=n),e=Oa(t,c,s),e!==null&&(Bs(e,t,s,i),Ip(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=gr(),s=Ba(t),c=No(i,s);c.tag=1,c.payload=e,n!=null&&(c.callback=n),e=Oa(t,c,s),e!==null&&(Bs(e,t,s,i),Ip(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=gr(),i=Ba(t),s=No(n,i);s.tag=2,e!=null&&(s.callback=e),e=Oa(t,s,i),e!==null&&(Bs(e,t,i,n),Ip(e,t,i))}};function Ob(t,e,n,i,s,c,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,c,d):e.prototype&&e.prototype.isPureReactComponent?!id(n,i)||!id(s,c):!0}function G2(t,e,n){var i=!1,s=Ga,c=e.contextType;return typeof c=="object"&&c!==null?c=xs(c):(s=Ir(e)?Rl:nr.current,i=e.contextTypes,c=(i=i!=null)?nu(t,s):Ga),e=new e(n,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Gm,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=c),e}function Fb(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Gm.enqueueReplaceState(e,e.state,null)}function Qy(t,e,n,i){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=j2,wv(t);var c=e.contextType;typeof c=="object"&&c!==null?s.context=xs(c):(c=Ir(e)?Rl:nr.current,s.context=nu(t,c)),s.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(Jy(t,e,c,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Gm.enqueueReplaceState(s,s.state,null),lm(t,n,s,i),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function xh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ge(309));var i=n.stateNode}if(!i)throw Error(Ge(147,t));var s=i,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(d){var l=s.refs;l===j2&&(l=s.refs={}),d===null?delete l[c]:l[c]=d},e._stringRef=c,e)}if(typeof t!="string")throw Error(Ge(284));if(!n._owner)throw Error(Ge(290,t))}return t}function np(t,e){throw t=Object.prototype.toString.call(e),Error(Ge(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Bb(t){var e=t._init;return e(t._payload)}function W2(t){function e(Z,j){if(t){var q=Z.deletions;q===null?(Z.deletions=[j],Z.flags|=16):q.push(j)}}function n(Z,j){if(!t)return null;for(;j!==null;)e(Z,j),j=j.sibling;return null}function i(Z,j){for(Z=new Map;j!==null;)j.key!==null?Z.set(j.key,j):Z.set(j.index,j),j=j.sibling;return Z}function s(Z,j){return Z=Na(Z,j),Z.index=0,Z.sibling=null,Z}function c(Z,j,q){return Z.index=q,t?(q=Z.alternate,q!==null?(q=q.index,q<j?(Z.flags|=2,j):q):(Z.flags|=2,j)):(Z.flags|=1048576,j)}function d(Z){return t&&Z.alternate===null&&(Z.flags|=2),Z}function l(Z,j,q,se){return j===null||j.tag!==6?(j=F_(q,Z.mode,se),j.return=Z,j):(j=s(j,q),j.return=Z,j)}function y(Z,j,q,se){var pe=q.type;return pe===kc?S(Z,j,q.props.children,se,q.key):j!==null&&(j.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Ea&&Bb(pe)===j.type)?(se=s(j,q.props),se.ref=xh(Z,j,q),se.return=Z,se):(se=Dp(q.type,q.key,q.props,null,Z.mode,se),se.ref=xh(Z,j,q),se.return=Z,se)}function w(Z,j,q,se){return j===null||j.tag!==4||j.stateNode.containerInfo!==q.containerInfo||j.stateNode.implementation!==q.implementation?(j=B_(q,Z.mode,se),j.return=Z,j):(j=s(j,q.children||[]),j.return=Z,j)}function S(Z,j,q,se,pe){return j===null||j.tag!==7?(j=Ll(q,Z.mode,se,pe),j.return=Z,j):(j=s(j,q),j.return=Z,j)}function I(Z,j,q){if(typeof j=="string"&&j!==""||typeof j=="number")return j=F_(""+j,Z.mode,q),j.return=Z,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Hf:return q=Dp(j.type,j.key,j.props,null,Z.mode,q),q.ref=xh(Z,null,j),q.return=Z,q;case Lc:return j=B_(j,Z.mode,q),j.return=Z,j;case Ea:var se=j._init;return I(Z,se(j._payload),q)}if(Lh(j)||mh(j))return j=Ll(j,Z.mode,q,null),j.return=Z,j;np(Z,j)}return null}function P(Z,j,q,se){var pe=j!==null?j.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return pe!==null?null:l(Z,j,""+q,se);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case Hf:return q.key===pe?y(Z,j,q,se):null;case Lc:return q.key===pe?w(Z,j,q,se):null;case Ea:return pe=q._init,P(Z,j,pe(q._payload),se)}if(Lh(q)||mh(q))return pe!==null?null:S(Z,j,q,se,null);np(Z,q)}return null}function B(Z,j,q,se,pe){if(typeof se=="string"&&se!==""||typeof se=="number")return Z=Z.get(q)||null,l(j,Z,""+se,pe);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case Hf:return Z=Z.get(se.key===null?q:se.key)||null,y(j,Z,se,pe);case Lc:return Z=Z.get(se.key===null?q:se.key)||null,w(j,Z,se,pe);case Ea:var be=se._init;return B(Z,j,q,be(se._payload),pe)}if(Lh(se)||mh(se))return Z=Z.get(q)||null,S(j,Z,se,pe,null);np(j,se)}return null}function G(Z,j,q,se){for(var pe=null,be=null,Re=j,Fe=j=0,Ve=null;Re!==null&&Fe<q.length;Fe++){Re.index>Fe?(Ve=Re,Re=null):Ve=Re.sibling;var je=P(Z,Re,q[Fe],se);if(je===null){Re===null&&(Re=Ve);break}t&&Re&&je.alternate===null&&e(Z,Re),j=c(je,j,Fe),be===null?pe=je:be.sibling=je,be=je,Re=Ve}if(Fe===q.length)return n(Z,Re),zn&&El(Z,Fe),pe;if(Re===null){for(;Fe<q.length;Fe++)Re=I(Z,q[Fe],se),Re!==null&&(j=c(Re,j,Fe),be===null?pe=Re:be.sibling=Re,be=Re);return zn&&El(Z,Fe),pe}for(Re=i(Z,Re);Fe<q.length;Fe++)Ve=B(Re,Z,Fe,q[Fe],se),Ve!==null&&(t&&Ve.alternate!==null&&Re.delete(Ve.key===null?Fe:Ve.key),j=c(Ve,j,Fe),be===null?pe=Ve:be.sibling=Ve,be=Ve);return t&&Re.forEach(function(pt){return e(Z,pt)}),zn&&El(Z,Fe),pe}function K(Z,j,q,se){var pe=mh(q);if(typeof pe!="function")throw Error(Ge(150));if(q=pe.call(q),q==null)throw Error(Ge(151));for(var be=pe=null,Re=j,Fe=j=0,Ve=null,je=q.next();Re!==null&&!je.done;Fe++,je=q.next()){Re.index>Fe?(Ve=Re,Re=null):Ve=Re.sibling;var pt=P(Z,Re,je.value,se);if(pt===null){Re===null&&(Re=Ve);break}t&&Re&&pt.alternate===null&&e(Z,Re),j=c(pt,j,Fe),be===null?pe=pt:be.sibling=pt,be=pt,Re=Ve}if(je.done)return n(Z,Re),zn&&El(Z,Fe),pe;if(Re===null){for(;!je.done;Fe++,je=q.next())je=I(Z,je.value,se),je!==null&&(j=c(je,j,Fe),be===null?pe=je:be.sibling=je,be=je);return zn&&El(Z,Fe),pe}for(Re=i(Z,Re);!je.done;Fe++,je=q.next())je=B(Re,Z,Fe,je.value,se),je!==null&&(t&&je.alternate!==null&&Re.delete(je.key===null?Fe:je.key),j=c(je,j,Fe),be===null?pe=je:be.sibling=je,be=je);return t&&Re.forEach(function(bt){return e(Z,bt)}),zn&&El(Z,Fe),pe}function de(Z,j,q,se){if(typeof q=="object"&&q!==null&&q.type===kc&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case Hf:e:{for(var pe=q.key,be=j;be!==null;){if(be.key===pe){if(pe=q.type,pe===kc){if(be.tag===7){n(Z,be.sibling),j=s(be,q.props.children),j.return=Z,Z=j;break e}}else if(be.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===Ea&&Bb(pe)===be.type){n(Z,be.sibling),j=s(be,q.props),j.ref=xh(Z,be,q),j.return=Z,Z=j;break e}n(Z,be);break}else e(Z,be);be=be.sibling}q.type===kc?(j=Ll(q.props.children,Z.mode,se,q.key),j.return=Z,Z=j):(se=Dp(q.type,q.key,q.props,null,Z.mode,se),se.ref=xh(Z,j,q),se.return=Z,Z=se)}return d(Z);case Lc:e:{for(be=q.key;j!==null;){if(j.key===be)if(j.tag===4&&j.stateNode.containerInfo===q.containerInfo&&j.stateNode.implementation===q.implementation){n(Z,j.sibling),j=s(j,q.children||[]),j.return=Z,Z=j;break e}else{n(Z,j);break}else e(Z,j);j=j.sibling}j=B_(q,Z.mode,se),j.return=Z,Z=j}return d(Z);case Ea:return be=q._init,de(Z,j,be(q._payload),se)}if(Lh(q))return G(Z,j,q,se);if(mh(q))return K(Z,j,q,se);np(Z,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,j!==null&&j.tag===6?(n(Z,j.sibling),j=s(j,q),j.return=Z,Z=j):(n(Z,j),j=F_(q,Z.mode,se),j.return=Z,Z=j),d(Z)):n(Z,j)}return de}var ru=W2(!0),H2=W2(!1),Pd={},fo=$a(Pd),ad=$a(Pd),ld=$a(Pd);function Cl(t){if(t===Pd)throw Error(Ge(174));return t}function Ev(t,e){switch(An(ld,e),An(ad,t),An(fo,Pd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ly(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ly(e,t)}Mn(fo),An(fo,e)}function su(){Mn(fo),Mn(ad),Mn(ld)}function $2(t){Cl(ld.current);var e=Cl(fo.current),n=Ly(e,t.type);e!==n&&(An(ad,t),An(fo,n))}function Tv(t){ad.current===t&&(Mn(fo),Mn(ad))}var Nn=$a(0);function cm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var L_=[];function Sv(){for(var t=0;t<L_.length;t++)L_[t]._workInProgressVersionPrimary=null;L_.length=0}var Mp=qo.ReactCurrentDispatcher,k_=qo.ReactCurrentBatchConfig,Dl=0,Vn=null,_i=null,Ci=null,um=!1,jh=!1,cd=0,EL=0;function Yi(){throw Error(Ge(321))}function Av(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Us(t[n],e[n]))return!1;return!0}function Pv(t,e,n,i,s,c){if(Dl=c,Vn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Mp.current=t===null||t.memoizedState===null?PL:CL,t=n(i,s),jh){c=0;do{if(jh=!1,cd=0,25<=c)throw Error(Ge(301));c+=1,Ci=_i=null,e.updateQueue=null,Mp.current=IL,t=n(i,s)}while(jh)}if(Mp.current=hm,e=_i!==null&&_i.next!==null,Dl=0,Ci=_i=Vn=null,um=!1,e)throw Error(Ge(300));return t}function Cv(){var t=cd!==0;return cd=0,t}function oo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ci===null?Vn.memoizedState=Ci=t:Ci=Ci.next=t,Ci}function bs(){if(_i===null){var t=Vn.alternate;t=t!==null?t.memoizedState:null}else t=_i.next;var e=Ci===null?Vn.memoizedState:Ci.next;if(e!==null)Ci=e,_i=t;else{if(t===null)throw Error(Ge(310));_i=t,t={memoizedState:_i.memoizedState,baseState:_i.baseState,baseQueue:_i.baseQueue,queue:_i.queue,next:null},Ci===null?Vn.memoizedState=Ci=t:Ci=Ci.next=t}return Ci}function ud(t,e){return typeof e=="function"?e(t):e}function R_(t){var e=bs(),n=e.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=t;var i=_i,s=i.baseQueue,c=n.pending;if(c!==null){if(s!==null){var d=s.next;s.next=c.next,c.next=d}i.baseQueue=s=c,n.pending=null}if(s!==null){c=s.next,i=i.baseState;var l=d=null,y=null,w=c;do{var S=w.lane;if((Dl&S)===S)y!==null&&(y=y.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:t(i,w.action);else{var I={lane:S,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};y===null?(l=y=I,d=i):y=y.next=I,Vn.lanes|=S,Ol|=S}w=w.next}while(w!==null&&w!==c);y===null?d=i:y.next=l,Us(i,e.memoizedState)||(Pr=!0),e.memoizedState=i,e.baseState=d,e.baseQueue=y,n.lastRenderedState=i}if(t=n.interleaved,t!==null){s=t;do c=s.lane,Vn.lanes|=c,Ol|=c,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function z_(t){var e=bs(),n=e.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=t;var i=n.dispatch,s=n.pending,c=e.memoizedState;if(s!==null){n.pending=null;var d=s=s.next;do c=t(c,d.action),d=d.next;while(d!==s);Us(c,e.memoizedState)||(Pr=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),n.lastRenderedState=c}return[c,i]}function q2(){}function Z2(t,e){var n=Vn,i=bs(),s=e(),c=!Us(i.memoizedState,s);if(c&&(i.memoizedState=s,Pr=!0),i=i.queue,Iv(K2.bind(null,n,i,t),[t]),i.getSnapshot!==e||c||Ci!==null&&Ci.memoizedState.tag&1){if(n.flags|=2048,hd(9,Y2.bind(null,n,i,s,e),void 0,null),Mi===null)throw Error(Ge(349));Dl&30||X2(n,e,s)}return s}function X2(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Vn.updateQueue,e===null?(e={lastEffect:null,stores:null},Vn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Y2(t,e,n,i){e.value=n,e.getSnapshot=i,J2(e)&&Q2(t)}function K2(t,e,n){return n(function(){J2(e)&&Q2(t)})}function J2(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Us(t,n)}catch{return!0}}function Q2(t){var e=jo(t,1);e!==null&&Bs(e,t,1,-1)}function Nb(t){var e=oo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ud,lastRenderedState:t},e.queue=t,t=t.dispatch=AL.bind(null,Vn,t),[e.memoizedState,t]}function hd(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Vn.updateQueue,e===null?(e={lastEffect:null,stores:null},Vn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function eS(){return bs().memoizedState}function Lp(t,e,n,i){var s=oo();Vn.flags|=t,s.memoizedState=hd(1|e,n,void 0,i===void 0?null:i)}function Wm(t,e,n,i){var s=bs();i=i===void 0?null:i;var c=void 0;if(_i!==null){var d=_i.memoizedState;if(c=d.destroy,i!==null&&Av(i,d.deps)){s.memoizedState=hd(e,n,c,i);return}}Vn.flags|=t,s.memoizedState=hd(1|e,n,c,i)}function Ub(t,e){return Lp(8390656,8,t,e)}function Iv(t,e){return Wm(2048,8,t,e)}function tS(t,e){return Wm(4,2,t,e)}function nS(t,e){return Wm(4,4,t,e)}function iS(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function rS(t,e,n){return n=n!=null?n.concat([t]):null,Wm(4,4,iS.bind(null,e,t),n)}function Mv(){}function sS(t,e){var n=bs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Av(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function oS(t,e){var n=bs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Av(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function aS(t,e,n){return Dl&21?(Us(n,e)||(n=u2(),Vn.lanes|=n,Ol|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Pr=!0),t.memoizedState=n)}function TL(t,e){var n=mn;mn=n!==0&&4>n?n:4,t(!0);var i=k_.transition;k_.transition={};try{t(!1),e()}finally{mn=n,k_.transition=i}}function lS(){return bs().memoizedState}function SL(t,e,n){var i=Ba(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},cS(t))uS(e,n);else if(n=U2(t,e,n,i),n!==null){var s=gr();Bs(n,t,i,s),hS(n,e,i)}}function AL(t,e,n){var i=Ba(t),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(cS(t))uS(e,s);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var d=e.lastRenderedState,l=c(d,n);if(s.hasEagerState=!0,s.eagerState=l,Us(l,d)){var y=e.interleaved;y===null?(s.next=s,bv(e)):(s.next=y.next,y.next=s),e.interleaved=s;return}}catch{}finally{}n=U2(t,e,s,i),n!==null&&(s=gr(),Bs(n,t,i,s),hS(n,e,i))}}function cS(t){var e=t.alternate;return t===Vn||e!==null&&e===Vn}function uS(t,e){jh=um=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function hS(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,av(t,n)}}var hm={readContext:xs,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useInsertionEffect:Yi,useLayoutEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useMutableSource:Yi,useSyncExternalStore:Yi,useId:Yi,unstable_isNewReconciler:!1},PL={readContext:xs,useCallback:function(t,e){return oo().memoizedState=[t,e===void 0?null:e],t},useContext:xs,useEffect:Ub,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Lp(4194308,4,iS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Lp(4194308,4,t,e)},useInsertionEffect:function(t,e){return Lp(4,2,t,e)},useMemo:function(t,e){var n=oo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=oo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=SL.bind(null,Vn,t),[i.memoizedState,t]},useRef:function(t){var e=oo();return t={current:t},e.memoizedState=t},useState:Nb,useDebugValue:Mv,useDeferredValue:function(t){return oo().memoizedState=t},useTransition:function(){var t=Nb(!1),e=t[0];return t=TL.bind(null,t[1]),oo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Vn,s=oo();if(zn){if(n===void 0)throw Error(Ge(407));n=n()}else{if(n=e(),Mi===null)throw Error(Ge(349));Dl&30||X2(i,e,n)}s.memoizedState=n;var c={value:n,getSnapshot:e};return s.queue=c,Ub(K2.bind(null,i,c,t),[t]),i.flags|=2048,hd(9,Y2.bind(null,i,c,n,e),void 0,null),n},useId:function(){var t=oo(),e=Mi.identifierPrefix;if(zn){var n=Bo,i=Fo;n=(i&~(1<<32-Fs(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=cd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=EL++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},CL={readContext:xs,useCallback:sS,useContext:xs,useEffect:Iv,useImperativeHandle:rS,useInsertionEffect:tS,useLayoutEffect:nS,useMemo:oS,useReducer:R_,useRef:eS,useState:function(){return R_(ud)},useDebugValue:Mv,useDeferredValue:function(t){var e=bs();return aS(e,_i.memoizedState,t)},useTransition:function(){var t=R_(ud)[0],e=bs().memoizedState;return[t,e]},useMutableSource:q2,useSyncExternalStore:Z2,useId:lS,unstable_isNewReconciler:!1},IL={readContext:xs,useCallback:sS,useContext:xs,useEffect:Iv,useImperativeHandle:rS,useInsertionEffect:tS,useLayoutEffect:nS,useMemo:oS,useReducer:z_,useRef:eS,useState:function(){return z_(ud)},useDebugValue:Mv,useDeferredValue:function(t){var e=bs();return _i===null?e.memoizedState=t:aS(e,_i.memoizedState,t)},useTransition:function(){var t=z_(ud)[0],e=bs().memoizedState;return[t,e]},useMutableSource:q2,useSyncExternalStore:Z2,useId:lS,unstable_isNewReconciler:!1};function ou(t,e){try{var n="",i=e;do n+=iM(i),i=i.return;while(i);var s=n}catch(c){s=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:s,digest:null}}function D_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function e0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ML=typeof WeakMap=="function"?WeakMap:Map;function dS(t,e,n){n=No(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){fm||(fm=!0,u0=i),e0(t,e)},n}function fS(t,e,n){n=No(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;n.payload=function(){return i(s)},n.callback=function(){e0(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){e0(t,e),typeof i!="function"&&(Fa===null?Fa=new Set([this]):Fa.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),n}function Vb(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new ML;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(n)||(s.add(n),t=WL.bind(null,t,e,n),e.then(t,t))}function jb(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Gb(t,e,n,i,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=No(-1,1),e.tag=2,Oa(n,e,1))),n.lanes|=1),t)}var LL=qo.ReactCurrentOwner,Pr=!1;function pr(t,e,n,i){e.child=t===null?H2(e,null,n,i):ru(e,t.child,n,i)}function Wb(t,e,n,i,s){n=n.render;var c=e.ref;return Yc(e,s),i=Pv(t,e,n,i,c,s),n=Cv(),t!==null&&!Pr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Go(t,e,s)):(zn&&n&&mv(e),e.flags|=1,pr(t,e,i,s),e.child)}function Hb(t,e,n,i,s){if(t===null){var c=n.type;return typeof c=="function"&&!Bv(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=c,pS(t,e,c,i,s)):(t=Dp(n.type,null,i,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&s)){var d=c.memoizedProps;if(n=n.compare,n=n!==null?n:id,n(d,i)&&t.ref===e.ref)return Go(t,e,s)}return e.flags|=1,t=Na(c,i),t.ref=e.ref,t.return=e,e.child=t}function pS(t,e,n,i,s){if(t!==null){var c=t.memoizedProps;if(id(c,i)&&t.ref===e.ref)if(Pr=!1,e.pendingProps=i=c,(t.lanes&s)!==0)t.flags&131072&&(Pr=!0);else return e.lanes=t.lanes,Go(t,e,s)}return t0(t,e,n,i,s)}function mS(t,e,n){var i=e.pendingProps,s=i.children,c=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},An(jc,$r),$r|=n;else{if(!(n&1073741824))return t=c!==null?c.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,An(jc,$r),$r|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=c!==null?c.baseLanes:n,An(jc,$r),$r|=i}else c!==null?(i=c.baseLanes|n,e.memoizedState=null):i=n,An(jc,$r),$r|=i;return pr(t,e,s,n),e.child}function gS(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function t0(t,e,n,i,s){var c=Ir(n)?Rl:nr.current;return c=nu(e,c),Yc(e,s),n=Pv(t,e,n,i,c,s),i=Cv(),t!==null&&!Pr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Go(t,e,s)):(zn&&i&&mv(e),e.flags|=1,pr(t,e,n,s),e.child)}function $b(t,e,n,i,s){if(Ir(n)){var c=!0;im(e)}else c=!1;if(Yc(e,s),e.stateNode===null)kp(t,e),G2(e,n,i),Qy(e,n,i,s),i=!0;else if(t===null){var d=e.stateNode,l=e.memoizedProps;d.props=l;var y=d.context,w=n.contextType;typeof w=="object"&&w!==null?w=xs(w):(w=Ir(n)?Rl:nr.current,w=nu(e,w));var S=n.getDerivedStateFromProps,I=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function";I||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==i||y!==w)&&Fb(e,d,i,w),Ta=!1;var P=e.memoizedState;d.state=P,lm(e,i,d,s),y=e.memoizedState,l!==i||P!==y||Cr.current||Ta?(typeof S=="function"&&(Jy(e,n,S,i),y=e.memoizedState),(l=Ta||Ob(e,n,l,i,P,y,w))?(I||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=y),d.props=i,d.state=y,d.context=w,i=l):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{d=e.stateNode,V2(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:ks(e.type,l),d.props=w,I=e.pendingProps,P=d.context,y=n.contextType,typeof y=="object"&&y!==null?y=xs(y):(y=Ir(n)?Rl:nr.current,y=nu(e,y));var B=n.getDerivedStateFromProps;(S=typeof B=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==I||P!==y)&&Fb(e,d,i,y),Ta=!1,P=e.memoizedState,d.state=P,lm(e,i,d,s);var G=e.memoizedState;l!==I||P!==G||Cr.current||Ta?(typeof B=="function"&&(Jy(e,n,B,i),G=e.memoizedState),(w=Ta||Ob(e,n,w,i,P,G,y)||!1)?(S||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(i,G,y),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(i,G,y)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=G),d.props=i,d.state=G,d.context=y,i=w):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),i=!1)}return n0(t,e,n,i,c,s)}function n0(t,e,n,i,s,c){gS(t,e);var d=(e.flags&128)!==0;if(!i&&!d)return s&&Lb(e,n,!1),Go(t,e,c);i=e.stateNode,LL.current=e;var l=d&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&d?(e.child=ru(e,t.child,null,c),e.child=ru(e,null,l,c)):pr(t,e,l,c),e.memoizedState=i.state,s&&Lb(e,n,!0),e.child}function _S(t){var e=t.stateNode;e.pendingContext?Mb(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Mb(t,e.context,!1),Ev(t,e.containerInfo)}function qb(t,e,n,i,s){return iu(),_v(s),e.flags|=256,pr(t,e,n,i),e.child}var i0={dehydrated:null,treeContext:null,retryLane:0};function r0(t){return{baseLanes:t,cachePool:null,transitions:null}}function yS(t,e,n){var i=e.pendingProps,s=Nn.current,c=!1,d=(e.flags&128)!==0,l;if((l=d)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),An(Nn,s&1),t===null)return Yy(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=i.children,t=i.fallback,c?(i=e.mode,c=e.child,d={mode:"hidden",children:d},!(i&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=qm(d,i,0,null),t=Ll(t,i,n,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=r0(n),e.memoizedState=i0,t):Lv(e,d));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return kL(t,e,d,i,l,s,n);if(c){c=i.fallback,d=e.mode,s=t.child,l=s.sibling;var y={mode:"hidden",children:i.children};return!(d&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=y,e.deletions=null):(i=Na(s,y),i.subtreeFlags=s.subtreeFlags&14680064),l!==null?c=Na(l,c):(c=Ll(c,d,n,null),c.flags|=2),c.return=e,i.return=e,i.sibling=c,e.child=i,i=c,c=e.child,d=t.child.memoizedState,d=d===null?r0(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=t.childLanes&~n,e.memoizedState=i0,i}return c=t.child,t=c.sibling,i=Na(c,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Lv(t,e){return e=qm({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ip(t,e,n,i){return i!==null&&_v(i),ru(e,t.child,null,n),t=Lv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function kL(t,e,n,i,s,c,d){if(n)return e.flags&256?(e.flags&=-257,i=D_(Error(Ge(422))),ip(t,e,d,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=i.fallback,s=e.mode,i=qm({mode:"visible",children:i.children},s,0,null),c=Ll(c,s,d,null),c.flags|=2,i.return=e,c.return=e,i.sibling=c,e.child=i,e.mode&1&&ru(e,t.child,null,d),e.child.memoizedState=r0(d),e.memoizedState=i0,c);if(!(e.mode&1))return ip(t,e,d,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var l=i.dgst;return i=l,c=Error(Ge(419)),i=D_(c,i,void 0),ip(t,e,d,i)}if(l=(d&t.childLanes)!==0,Pr||l){if(i=Mi,i!==null){switch(d&-d){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|d)?0:s,s!==0&&s!==c.retryLane&&(c.retryLane=s,jo(t,s),Bs(i,t,s,-1))}return Fv(),i=D_(Error(Ge(421))),ip(t,e,d,i)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=HL.bind(null,t),s._reactRetry=e,null):(t=c.treeContext,Xr=Da(s.nextSibling),Kr=e,zn=!0,zs=null,t!==null&&(ms[gs++]=Fo,ms[gs++]=Bo,ms[gs++]=zl,Fo=t.id,Bo=t.overflow,zl=e),e=Lv(e,i.children),e.flags|=4096,e)}function Zb(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Ky(t.return,e,n)}function O_(t,e,n,i,s){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=i,c.tail=n,c.tailMode=s)}function vS(t,e,n){var i=e.pendingProps,s=i.revealOrder,c=i.tail;if(pr(t,e,i.children,n),i=Nn.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Zb(t,n,e);else if(t.tag===19)Zb(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(An(Nn,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&cm(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),O_(e,!1,s,n,c);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&cm(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}O_(e,!0,n,null,c);break;case"together":O_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function kp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Go(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ol|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ge(153));if(e.child!==null){for(t=e.child,n=Na(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Na(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function RL(t,e,n){switch(e.tag){case 3:_S(e),iu();break;case 5:$2(e);break;case 1:Ir(e.type)&&im(e);break;case 4:Ev(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;An(om,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(An(Nn,Nn.current&1),e.flags|=128,null):n&e.child.childLanes?yS(t,e,n):(An(Nn,Nn.current&1),t=Go(t,e,n),t!==null?t.sibling:null);An(Nn,Nn.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return vS(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),An(Nn,Nn.current),i)break;return null;case 22:case 23:return e.lanes=0,mS(t,e,n)}return Go(t,e,n)}var xS,s0,bS,wS;xS=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};s0=function(){};bS=function(t,e,n,i){var s=t.memoizedProps;if(s!==i){t=e.stateNode,Cl(fo.current);var c=null;switch(n){case"input":s=Py(t,s),i=Py(t,i),c=[];break;case"select":s=jn({},s,{value:void 0}),i=jn({},i,{value:void 0}),c=[];break;case"textarea":s=My(t,s),i=My(t,i),c=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=tm)}ky(n,i);var d;n=null;for(w in s)if(!i.hasOwnProperty(w)&&s.hasOwnProperty(w)&&s[w]!=null)if(w==="style"){var l=s[w];for(d in l)l.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Yh.hasOwnProperty(w)?c||(c=[]):(c=c||[]).push(w,null));for(w in i){var y=i[w];if(l=s!=null?s[w]:void 0,i.hasOwnProperty(w)&&y!==l&&(y!=null||l!=null))if(w==="style")if(l){for(d in l)!l.hasOwnProperty(d)||y&&y.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in y)y.hasOwnProperty(d)&&l[d]!==y[d]&&(n||(n={}),n[d]=y[d])}else n||(c||(c=[]),c.push(w,n)),n=y;else w==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,l=l?l.__html:void 0,y!=null&&l!==y&&(c=c||[]).push(w,y)):w==="children"?typeof y!="string"&&typeof y!="number"||(c=c||[]).push(w,""+y):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Yh.hasOwnProperty(w)?(y!=null&&w==="onScroll"&&Cn("scroll",t),c||l===y||(c=[])):(c=c||[]).push(w,y))}n&&(c=c||[]).push("style",n);var w=c;(e.updateQueue=w)&&(e.flags|=4)}};wS=function(t,e,n,i){n!==i&&(e.flags|=4)};function bh(t,e){if(!zn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ki(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function zL(t,e,n){var i=e.pendingProps;switch(gv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ki(e),null;case 1:return Ir(e.type)&&nm(),Ki(e),null;case 3:return i=e.stateNode,su(),Mn(Cr),Mn(nr),Sv(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(tp(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zs!==null&&(f0(zs),zs=null))),s0(t,e),Ki(e),null;case 5:Tv(e);var s=Cl(ld.current);if(n=e.type,t!==null&&e.stateNode!=null)bS(t,e,n,i,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ge(166));return Ki(e),null}if(t=Cl(fo.current),tp(e)){i=e.stateNode,n=e.type;var c=e.memoizedProps;switch(i[ao]=e,i[od]=c,t=(e.mode&1)!==0,n){case"dialog":Cn("cancel",i),Cn("close",i);break;case"iframe":case"object":case"embed":Cn("load",i);break;case"video":case"audio":for(s=0;s<Rh.length;s++)Cn(Rh[s],i);break;case"source":Cn("error",i);break;case"img":case"image":case"link":Cn("error",i),Cn("load",i);break;case"details":Cn("toggle",i);break;case"input":ib(i,c),Cn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},Cn("invalid",i);break;case"textarea":sb(i,c),Cn("invalid",i)}ky(n,c),s=null;for(var d in c)if(c.hasOwnProperty(d)){var l=c[d];d==="children"?typeof l=="string"?i.textContent!==l&&(c.suppressHydrationWarning!==!0&&ep(i.textContent,l,t),s=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(c.suppressHydrationWarning!==!0&&ep(i.textContent,l,t),s=["children",""+l]):Yh.hasOwnProperty(d)&&l!=null&&d==="onScroll"&&Cn("scroll",i)}switch(n){case"input":$f(i),rb(i,c,!0);break;case"textarea":$f(i),ob(i);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(i.onclick=tm)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{d=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=XT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=d.createElement(n,{is:i.is}):(t=d.createElement(n),n==="select"&&(d=t,i.multiple?d.multiple=!0:i.size&&(d.size=i.size))):t=d.createElementNS(t,n),t[ao]=e,t[od]=i,xS(t,e,!1,!1),e.stateNode=t;e:{switch(d=Ry(n,i),n){case"dialog":Cn("cancel",t),Cn("close",t),s=i;break;case"iframe":case"object":case"embed":Cn("load",t),s=i;break;case"video":case"audio":for(s=0;s<Rh.length;s++)Cn(Rh[s],t);s=i;break;case"source":Cn("error",t),s=i;break;case"img":case"image":case"link":Cn("error",t),Cn("load",t),s=i;break;case"details":Cn("toggle",t),s=i;break;case"input":ib(t,i),s=Py(t,i),Cn("invalid",t);break;case"option":s=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},s=jn({},i,{value:void 0}),Cn("invalid",t);break;case"textarea":sb(t,i),s=My(t,i),Cn("invalid",t);break;default:s=i}ky(n,s),l=s;for(c in l)if(l.hasOwnProperty(c)){var y=l[c];c==="style"?JT(t,y):c==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&YT(t,y)):c==="children"?typeof y=="string"?(n!=="textarea"||y!=="")&&Kh(t,y):typeof y=="number"&&Kh(t,""+y):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Yh.hasOwnProperty(c)?y!=null&&c==="onScroll"&&Cn("scroll",t):y!=null&&tv(t,c,y,d))}switch(n){case"input":$f(t),rb(t,i,!1);break;case"textarea":$f(t),ob(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ja(i.value));break;case"select":t.multiple=!!i.multiple,c=i.value,c!=null?$c(t,!!i.multiple,c,!1):i.defaultValue!=null&&$c(t,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=tm)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ki(e),null;case 6:if(t&&e.stateNode!=null)wS(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ge(166));if(n=Cl(ld.current),Cl(fo.current),tp(e)){if(i=e.stateNode,n=e.memoizedProps,i[ao]=e,(c=i.nodeValue!==n)&&(t=Kr,t!==null))switch(t.tag){case 3:ep(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ep(i.nodeValue,n,(t.mode&1)!==0)}c&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[ao]=e,e.stateNode=i}return Ki(e),null;case 13:if(Mn(Nn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(zn&&Xr!==null&&e.mode&1&&!(e.flags&128))N2(),iu(),e.flags|=98560,c=!1;else if(c=tp(e),i!==null&&i.dehydrated!==null){if(t===null){if(!c)throw Error(Ge(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(Ge(317));c[ao]=e}else iu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ki(e),c=!1}else zs!==null&&(f0(zs),zs=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Nn.current&1?yi===0&&(yi=3):Fv())),e.updateQueue!==null&&(e.flags|=4),Ki(e),null);case 4:return su(),s0(t,e),t===null&&rd(e.stateNode.containerInfo),Ki(e),null;case 10:return xv(e.type._context),Ki(e),null;case 17:return Ir(e.type)&&nm(),Ki(e),null;case 19:if(Mn(Nn),c=e.memoizedState,c===null)return Ki(e),null;if(i=(e.flags&128)!==0,d=c.rendering,d===null)if(i)bh(c,!1);else{if(yi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=cm(t),d!==null){for(e.flags|=128,bh(c,!1),i=d.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)c=n,t=i,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,t=d.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return An(Nn,Nn.current&1|2),e.child}t=t.sibling}c.tail!==null&&ni()>au&&(e.flags|=128,i=!0,bh(c,!1),e.lanes=4194304)}else{if(!i)if(t=cm(d),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),bh(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!zn)return Ki(e),null}else 2*ni()-c.renderingStartTime>au&&n!==1073741824&&(e.flags|=128,i=!0,bh(c,!1),e.lanes=4194304);c.isBackwards?(d.sibling=e.child,e.child=d):(n=c.last,n!==null?n.sibling=d:e.child=d,c.last=d)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=ni(),e.sibling=null,n=Nn.current,An(Nn,i?n&1|2:n&1),e):(Ki(e),null);case 22:case 23:return Ov(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?$r&1073741824&&(Ki(e),e.subtreeFlags&6&&(e.flags|=8192)):Ki(e),null;case 24:return null;case 25:return null}throw Error(Ge(156,e.tag))}function DL(t,e){switch(gv(e),e.tag){case 1:return Ir(e.type)&&nm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return su(),Mn(Cr),Mn(nr),Sv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Tv(e),null;case 13:if(Mn(Nn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ge(340));iu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Mn(Nn),null;case 4:return su(),null;case 10:return xv(e.type._context),null;case 22:case 23:return Ov(),null;case 24:return null;default:return null}}var rp=!1,er=!1,OL=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Vc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Xn(t,e,i)}else n.current=null}function o0(t,e,n){try{n()}catch(i){Xn(t,e,i)}}var Xb=!1;function FL(t,e){if(Gy=Jp,t=A2(),pv(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var s=i.anchorOffset,c=i.focusNode;i=i.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var d=0,l=-1,y=-1,w=0,S=0,I=t,P=null;t:for(;;){for(var B;I!==n||s!==0&&I.nodeType!==3||(l=d+s),I!==c||i!==0&&I.nodeType!==3||(y=d+i),I.nodeType===3&&(d+=I.nodeValue.length),(B=I.firstChild)!==null;)P=I,I=B;for(;;){if(I===t)break t;if(P===n&&++w===s&&(l=d),P===c&&++S===i&&(y=d),(B=I.nextSibling)!==null)break;I=P,P=I.parentNode}I=B}n=l===-1||y===-1?null:{start:l,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for(Wy={focusedElem:t,selectionRange:n},Jp=!1,mt=e;mt!==null;)if(e=mt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,mt=t;else for(;mt!==null;){e=mt;try{var G=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var K=G.memoizedProps,de=G.memoizedState,Z=e.stateNode,j=Z.getSnapshotBeforeUpdate(e.elementType===e.type?K:ks(e.type,K),de);Z.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var q=e.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ge(163))}}catch(se){Xn(e,e.return,se)}if(t=e.sibling,t!==null){t.return=e.return,mt=t;break}mt=e.return}return G=Xb,Xb=!1,G}function Gh(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&t)===t){var c=s.destroy;s.destroy=void 0,c!==void 0&&o0(e,n,c)}s=s.next}while(s!==i)}}function Hm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function a0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ES(t){var e=t.alternate;e!==null&&(t.alternate=null,ES(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ao],delete e[od],delete e[qy],delete e[vL],delete e[xL])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function TS(t){return t.tag===5||t.tag===3||t.tag===4}function Yb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||TS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function l0(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=tm));else if(i!==4&&(t=t.child,t!==null))for(l0(t,e,n),t=t.sibling;t!==null;)l0(t,e,n),t=t.sibling}function c0(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(c0(t,e,n),t=t.sibling;t!==null;)c0(t,e,n),t=t.sibling}var Ni=null,Rs=!1;function _a(t,e,n){for(n=n.child;n!==null;)SS(t,e,n),n=n.sibling}function SS(t,e,n){if(ho&&typeof ho.onCommitFiberUnmount=="function")try{ho.onCommitFiberUnmount(Fm,n)}catch{}switch(n.tag){case 5:er||Vc(n,e);case 6:var i=Ni,s=Rs;Ni=null,_a(t,e,n),Ni=i,Rs=s,Ni!==null&&(Rs?(t=Ni,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ni.removeChild(n.stateNode));break;case 18:Ni!==null&&(Rs?(t=Ni,n=n.stateNode,t.nodeType===8?I_(t.parentNode,n):t.nodeType===1&&I_(t,n),td(t)):I_(Ni,n.stateNode));break;case 4:i=Ni,s=Rs,Ni=n.stateNode.containerInfo,Rs=!0,_a(t,e,n),Ni=i,Rs=s;break;case 0:case 11:case 14:case 15:if(!er&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var c=s,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&o0(n,e,d),s=s.next}while(s!==i)}_a(t,e,n);break;case 1:if(!er&&(Vc(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){Xn(n,e,l)}_a(t,e,n);break;case 21:_a(t,e,n);break;case 22:n.mode&1?(er=(i=er)||n.memoizedState!==null,_a(t,e,n),er=i):_a(t,e,n);break;default:_a(t,e,n)}}function Kb(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new OL),e.forEach(function(i){var s=$L.bind(null,t,i);n.has(i)||(n.add(i),i.then(s,s))})}}function Ls(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var s=n[i];try{var c=t,d=e,l=d;e:for(;l!==null;){switch(l.tag){case 5:Ni=l.stateNode,Rs=!1;break e;case 3:Ni=l.stateNode.containerInfo,Rs=!0;break e;case 4:Ni=l.stateNode.containerInfo,Rs=!0;break e}l=l.return}if(Ni===null)throw Error(Ge(160));SS(c,d,s),Ni=null,Rs=!1;var y=s.alternate;y!==null&&(y.return=null),s.return=null}catch(w){Xn(s,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)AS(e,t),e=e.sibling}function AS(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ls(e,t),no(t),i&4){try{Gh(3,t,t.return),Hm(3,t)}catch(K){Xn(t,t.return,K)}try{Gh(5,t,t.return)}catch(K){Xn(t,t.return,K)}}break;case 1:Ls(e,t),no(t),i&512&&n!==null&&Vc(n,n.return);break;case 5:if(Ls(e,t),no(t),i&512&&n!==null&&Vc(n,n.return),t.flags&32){var s=t.stateNode;try{Kh(s,"")}catch(K){Xn(t,t.return,K)}}if(i&4&&(s=t.stateNode,s!=null)){var c=t.memoizedProps,d=n!==null?n.memoizedProps:c,l=t.type,y=t.updateQueue;if(t.updateQueue=null,y!==null)try{l==="input"&&c.type==="radio"&&c.name!=null&&qT(s,c),Ry(l,d);var w=Ry(l,c);for(d=0;d<y.length;d+=2){var S=y[d],I=y[d+1];S==="style"?JT(s,I):S==="dangerouslySetInnerHTML"?YT(s,I):S==="children"?Kh(s,I):tv(s,S,I,w)}switch(l){case"input":Cy(s,c);break;case"textarea":ZT(s,c);break;case"select":var P=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!c.multiple;var B=c.value;B!=null?$c(s,!!c.multiple,B,!1):P!==!!c.multiple&&(c.defaultValue!=null?$c(s,!!c.multiple,c.defaultValue,!0):$c(s,!!c.multiple,c.multiple?[]:"",!1))}s[od]=c}catch(K){Xn(t,t.return,K)}}break;case 6:if(Ls(e,t),no(t),i&4){if(t.stateNode===null)throw Error(Ge(162));s=t.stateNode,c=t.memoizedProps;try{s.nodeValue=c}catch(K){Xn(t,t.return,K)}}break;case 3:if(Ls(e,t),no(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{td(e.containerInfo)}catch(K){Xn(t,t.return,K)}break;case 4:Ls(e,t),no(t);break;case 13:Ls(e,t),no(t),s=t.child,s.flags&8192&&(c=s.memoizedState!==null,s.stateNode.isHidden=c,!c||s.alternate!==null&&s.alternate.memoizedState!==null||(zv=ni())),i&4&&Kb(t);break;case 22:if(S=n!==null&&n.memoizedState!==null,t.mode&1?(er=(w=er)||S,Ls(e,t),er=w):Ls(e,t),no(t),i&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!S&&t.mode&1)for(mt=t,S=t.child;S!==null;){for(I=mt=S;mt!==null;){switch(P=mt,B=P.child,P.tag){case 0:case 11:case 14:case 15:Gh(4,P,P.return);break;case 1:Vc(P,P.return);var G=P.stateNode;if(typeof G.componentWillUnmount=="function"){i=P,n=P.return;try{e=i,G.props=e.memoizedProps,G.state=e.memoizedState,G.componentWillUnmount()}catch(K){Xn(i,n,K)}}break;case 5:Vc(P,P.return);break;case 22:if(P.memoizedState!==null){Qb(I);continue}}B!==null?(B.return=P,mt=B):Qb(I)}S=S.sibling}e:for(S=null,I=t;;){if(I.tag===5){if(S===null){S=I;try{s=I.stateNode,w?(c=s.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(l=I.stateNode,y=I.memoizedProps.style,d=y!=null&&y.hasOwnProperty("display")?y.display:null,l.style.display=KT("display",d))}catch(K){Xn(t,t.return,K)}}}else if(I.tag===6){if(S===null)try{I.stateNode.nodeValue=w?"":I.memoizedProps}catch(K){Xn(t,t.return,K)}}else if((I.tag!==22&&I.tag!==23||I.memoizedState===null||I===t)&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===t)break e;for(;I.sibling===null;){if(I.return===null||I.return===t)break e;S===I&&(S=null),I=I.return}S===I&&(S=null),I.sibling.return=I.return,I=I.sibling}}break;case 19:Ls(e,t),no(t),i&4&&Kb(t);break;case 21:break;default:Ls(e,t),no(t)}}function no(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(TS(n)){var i=n;break e}n=n.return}throw Error(Ge(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(Kh(s,""),i.flags&=-33);var c=Yb(t);c0(t,c,s);break;case 3:case 4:var d=i.stateNode.containerInfo,l=Yb(t);l0(t,l,d);break;default:throw Error(Ge(161))}}catch(y){Xn(t,t.return,y)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function BL(t,e,n){mt=t,PS(t)}function PS(t,e,n){for(var i=(t.mode&1)!==0;mt!==null;){var s=mt,c=s.child;if(s.tag===22&&i){var d=s.memoizedState!==null||rp;if(!d){var l=s.alternate,y=l!==null&&l.memoizedState!==null||er;l=rp;var w=er;if(rp=d,(er=y)&&!w)for(mt=s;mt!==null;)d=mt,y=d.child,d.tag===22&&d.memoizedState!==null?ew(s):y!==null?(y.return=d,mt=y):ew(s);for(;c!==null;)mt=c,PS(c),c=c.sibling;mt=s,rp=l,er=w}Jb(t)}else s.subtreeFlags&8772&&c!==null?(c.return=s,mt=c):Jb(t)}}function Jb(t){for(;mt!==null;){var e=mt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:er||Hm(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!er)if(n===null)i.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ks(e.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&Db(e,c,i);break;case 3:var d=e.updateQueue;if(d!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Db(e,d,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var y=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&n.focus();break;case"img":y.src&&(n.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var S=w.memoizedState;if(S!==null){var I=S.dehydrated;I!==null&&td(I)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ge(163))}er||e.flags&512&&a0(e)}catch(P){Xn(e,e.return,P)}}if(e===t){mt=null;break}if(n=e.sibling,n!==null){n.return=e.return,mt=n;break}mt=e.return}}function Qb(t){for(;mt!==null;){var e=mt;if(e===t){mt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,mt=n;break}mt=e.return}}function ew(t){for(;mt!==null;){var e=mt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Hm(4,e)}catch(y){Xn(e,n,y)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(y){Xn(e,s,y)}}var c=e.return;try{a0(e)}catch(y){Xn(e,c,y)}break;case 5:var d=e.return;try{a0(e)}catch(y){Xn(e,d,y)}}}catch(y){Xn(e,e.return,y)}if(e===t){mt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,mt=l;break}mt=e.return}}var NL=Math.ceil,dm=qo.ReactCurrentDispatcher,kv=qo.ReactCurrentOwner,ys=qo.ReactCurrentBatchConfig,an=0,Mi=null,hi=null,Ui=0,$r=0,jc=$a(0),yi=0,dd=null,Ol=0,$m=0,Rv=0,Wh=null,Ar=null,zv=0,au=1/0,Ro=null,fm=!1,u0=null,Fa=null,sp=!1,Ca=null,pm=0,Hh=0,h0=null,Rp=-1,zp=0;function gr(){return an&6?ni():Rp!==-1?Rp:Rp=ni()}function Ba(t){return t.mode&1?an&2&&Ui!==0?Ui&-Ui:wL.transition!==null?(zp===0&&(zp=u2()),zp):(t=mn,t!==0||(t=window.event,t=t===void 0?16:_2(t.type)),t):1}function Bs(t,e,n,i){if(50<Hh)throw Hh=0,h0=null,Error(Ge(185));Td(t,n,i),(!(an&2)||t!==Mi)&&(t===Mi&&(!(an&2)&&($m|=n),yi===4&&Aa(t,Ui)),Mr(t,i),n===1&&an===0&&!(e.mode&1)&&(au=ni()+500,jm&&qa()))}function Mr(t,e){var n=t.callbackNode;wM(t,e);var i=Kp(t,t===Mi?Ui:0);if(i===0)n!==null&&cb(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&cb(n),e===1)t.tag===0?bL(tw.bind(null,t)):O2(tw.bind(null,t)),_L(function(){!(an&6)&&qa()}),n=null;else{switch(h2(i)){case 1:n=ov;break;case 4:n=l2;break;case 16:n=Yp;break;case 536870912:n=c2;break;default:n=Yp}n=DS(n,CS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function CS(t,e){if(Rp=-1,zp=0,an&6)throw Error(Ge(327));var n=t.callbackNode;if(Kc()&&t.callbackNode!==n)return null;var i=Kp(t,t===Mi?Ui:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=mm(t,i);else{e=i;var s=an;an|=2;var c=MS();(Mi!==t||Ui!==e)&&(Ro=null,au=ni()+500,Ml(t,e));do try{jL();break}catch(l){IS(t,l)}while(1);vv(),dm.current=c,an=s,hi!==null?e=0:(Mi=null,Ui=0,e=yi)}if(e!==0){if(e===2&&(s=By(t),s!==0&&(i=s,e=d0(t,s))),e===1)throw n=dd,Ml(t,0),Aa(t,i),Mr(t,ni()),n;if(e===6)Aa(t,i);else{if(s=t.current.alternate,!(i&30)&&!UL(s)&&(e=mm(t,i),e===2&&(c=By(t),c!==0&&(i=c,e=d0(t,c))),e===1))throw n=dd,Ml(t,0),Aa(t,i),Mr(t,ni()),n;switch(t.finishedWork=s,t.finishedLanes=i,e){case 0:case 1:throw Error(Ge(345));case 2:Tl(t,Ar,Ro);break;case 3:if(Aa(t,i),(i&130023424)===i&&(e=zv+500-ni(),10<e)){if(Kp(t,0)!==0)break;if(s=t.suspendedLanes,(s&i)!==i){gr(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=$y(Tl.bind(null,t,Ar,Ro),e);break}Tl(t,Ar,Ro);break;case 4:if(Aa(t,i),(i&4194240)===i)break;for(e=t.eventTimes,s=-1;0<i;){var d=31-Fs(i);c=1<<d,d=e[d],d>s&&(s=d),i&=~c}if(i=s,i=ni()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*NL(i/1960))-i,10<i){t.timeoutHandle=$y(Tl.bind(null,t,Ar,Ro),i);break}Tl(t,Ar,Ro);break;case 5:Tl(t,Ar,Ro);break;default:throw Error(Ge(329))}}}return Mr(t,ni()),t.callbackNode===n?CS.bind(null,t):null}function d0(t,e){var n=Wh;return t.current.memoizedState.isDehydrated&&(Ml(t,e).flags|=256),t=mm(t,e),t!==2&&(e=Ar,Ar=n,e!==null&&f0(e)),t}function f0(t){Ar===null?Ar=t:Ar.push.apply(Ar,t)}function UL(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var s=n[i],c=s.getSnapshot;s=s.value;try{if(!Us(c(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Aa(t,e){for(e&=~Rv,e&=~$m,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fs(e),i=1<<n;t[n]=-1,e&=~i}}function tw(t){if(an&6)throw Error(Ge(327));Kc();var e=Kp(t,0);if(!(e&1))return Mr(t,ni()),null;var n=mm(t,e);if(t.tag!==0&&n===2){var i=By(t);i!==0&&(e=i,n=d0(t,i))}if(n===1)throw n=dd,Ml(t,0),Aa(t,e),Mr(t,ni()),n;if(n===6)throw Error(Ge(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Tl(t,Ar,Ro),Mr(t,ni()),null}function Dv(t,e){var n=an;an|=1;try{return t(e)}finally{an=n,an===0&&(au=ni()+500,jm&&qa())}}function Fl(t){Ca!==null&&Ca.tag===0&&!(an&6)&&Kc();var e=an;an|=1;var n=ys.transition,i=mn;try{if(ys.transition=null,mn=1,t)return t()}finally{mn=i,ys.transition=n,an=e,!(an&6)&&qa()}}function Ov(){$r=jc.current,Mn(jc)}function Ml(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,gL(n)),hi!==null)for(n=hi.return;n!==null;){var i=n;switch(gv(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&nm();break;case 3:su(),Mn(Cr),Mn(nr),Sv();break;case 5:Tv(i);break;case 4:su();break;case 13:Mn(Nn);break;case 19:Mn(Nn);break;case 10:xv(i.type._context);break;case 22:case 23:Ov()}n=n.return}if(Mi=t,hi=t=Na(t.current,null),Ui=$r=e,yi=0,dd=null,Rv=$m=Ol=0,Ar=Wh=null,Pl!==null){for(e=0;e<Pl.length;e++)if(n=Pl[e],i=n.interleaved,i!==null){n.interleaved=null;var s=i.next,c=n.pending;if(c!==null){var d=c.next;c.next=s,i.next=d}n.pending=i}Pl=null}return t}function IS(t,e){do{var n=hi;try{if(vv(),Mp.current=hm,um){for(var i=Vn.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}um=!1}if(Dl=0,Ci=_i=Vn=null,jh=!1,cd=0,kv.current=null,n===null||n.return===null){yi=1,dd=e,hi=null;break}e:{var c=t,d=n.return,l=n,y=e;if(e=Ui,l.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var w=y,S=l,I=S.tag;if(!(S.mode&1)&&(I===0||I===11||I===15)){var P=S.alternate;P?(S.updateQueue=P.updateQueue,S.memoizedState=P.memoizedState,S.lanes=P.lanes):(S.updateQueue=null,S.memoizedState=null)}var B=jb(d);if(B!==null){B.flags&=-257,Gb(B,d,l,c,e),B.mode&1&&Vb(c,w,e),e=B,y=w;var G=e.updateQueue;if(G===null){var K=new Set;K.add(y),e.updateQueue=K}else G.add(y);break e}else{if(!(e&1)){Vb(c,w,e),Fv();break e}y=Error(Ge(426))}}else if(zn&&l.mode&1){var de=jb(d);if(de!==null){!(de.flags&65536)&&(de.flags|=256),Gb(de,d,l,c,e),_v(ou(y,l));break e}}c=y=ou(y,l),yi!==4&&(yi=2),Wh===null?Wh=[c]:Wh.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var Z=dS(c,y,e);zb(c,Z);break e;case 1:l=y;var j=c.type,q=c.stateNode;if(!(c.flags&128)&&(typeof j.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Fa===null||!Fa.has(q)))){c.flags|=65536,e&=-e,c.lanes|=e;var se=fS(c,l,e);zb(c,se);break e}}c=c.return}while(c!==null)}kS(n)}catch(pe){e=pe,hi===n&&n!==null&&(hi=n=n.return);continue}break}while(1)}function MS(){var t=dm.current;return dm.current=hm,t===null?hm:t}function Fv(){(yi===0||yi===3||yi===2)&&(yi=4),Mi===null||!(Ol&268435455)&&!($m&268435455)||Aa(Mi,Ui)}function mm(t,e){var n=an;an|=2;var i=MS();(Mi!==t||Ui!==e)&&(Ro=null,Ml(t,e));do try{VL();break}catch(s){IS(t,s)}while(1);if(vv(),an=n,dm.current=i,hi!==null)throw Error(Ge(261));return Mi=null,Ui=0,yi}function VL(){for(;hi!==null;)LS(hi)}function jL(){for(;hi!==null&&!fM();)LS(hi)}function LS(t){var e=zS(t.alternate,t,$r);t.memoizedProps=t.pendingProps,e===null?kS(t):hi=e,kv.current=null}function kS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=DL(n,e),n!==null){n.flags&=32767,hi=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{yi=6,hi=null;return}}else if(n=zL(n,e,$r),n!==null){hi=n;return}if(e=e.sibling,e!==null){hi=e;return}hi=e=t}while(e!==null);yi===0&&(yi=5)}function Tl(t,e,n){var i=mn,s=ys.transition;try{ys.transition=null,mn=1,GL(t,e,n,i)}finally{ys.transition=s,mn=i}return null}function GL(t,e,n,i){do Kc();while(Ca!==null);if(an&6)throw Error(Ge(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ge(177));t.callbackNode=null,t.callbackPriority=0;var c=n.lanes|n.childLanes;if(EM(t,c),t===Mi&&(hi=Mi=null,Ui=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||sp||(sp=!0,DS(Yp,function(){return Kc(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=ys.transition,ys.transition=null;var d=mn;mn=1;var l=an;an|=4,kv.current=null,FL(t,n),AS(n,t),cL(Wy),Jp=!!Gy,Wy=Gy=null,t.current=n,BL(n),pM(),an=l,mn=d,ys.transition=c}else t.current=n;if(sp&&(sp=!1,Ca=t,pm=s),c=t.pendingLanes,c===0&&(Fa=null),_M(n.stateNode),Mr(t,ni()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],i(s.value,{componentStack:s.stack,digest:s.digest});if(fm)throw fm=!1,t=u0,u0=null,t;return pm&1&&t.tag!==0&&Kc(),c=t.pendingLanes,c&1?t===h0?Hh++:(Hh=0,h0=t):Hh=0,qa(),null}function Kc(){if(Ca!==null){var t=h2(pm),e=ys.transition,n=mn;try{if(ys.transition=null,mn=16>t?16:t,Ca===null)var i=!1;else{if(t=Ca,Ca=null,pm=0,an&6)throw Error(Ge(331));var s=an;for(an|=4,mt=t.current;mt!==null;){var c=mt,d=c.child;if(mt.flags&16){var l=c.deletions;if(l!==null){for(var y=0;y<l.length;y++){var w=l[y];for(mt=w;mt!==null;){var S=mt;switch(S.tag){case 0:case 11:case 15:Gh(8,S,c)}var I=S.child;if(I!==null)I.return=S,mt=I;else for(;mt!==null;){S=mt;var P=S.sibling,B=S.return;if(ES(S),S===w){mt=null;break}if(P!==null){P.return=B,mt=P;break}mt=B}}}var G=c.alternate;if(G!==null){var K=G.child;if(K!==null){G.child=null;do{var de=K.sibling;K.sibling=null,K=de}while(K!==null)}}mt=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,mt=d;else e:for(;mt!==null;){if(c=mt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:Gh(9,c,c.return)}var Z=c.sibling;if(Z!==null){Z.return=c.return,mt=Z;break e}mt=c.return}}var j=t.current;for(mt=j;mt!==null;){d=mt;var q=d.child;if(d.subtreeFlags&2064&&q!==null)q.return=d,mt=q;else e:for(d=j;mt!==null;){if(l=mt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Hm(9,l)}}catch(pe){Xn(l,l.return,pe)}if(l===d){mt=null;break e}var se=l.sibling;if(se!==null){se.return=l.return,mt=se;break e}mt=l.return}}if(an=s,qa(),ho&&typeof ho.onPostCommitFiberRoot=="function")try{ho.onPostCommitFiberRoot(Fm,t)}catch{}i=!0}return i}finally{mn=n,ys.transition=e}}return!1}function nw(t,e,n){e=ou(n,e),e=dS(t,e,1),t=Oa(t,e,1),e=gr(),t!==null&&(Td(t,1,e),Mr(t,e))}function Xn(t,e,n){if(t.tag===3)nw(t,t,n);else for(;e!==null;){if(e.tag===3){nw(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Fa===null||!Fa.has(i))){t=ou(n,t),t=fS(e,t,1),e=Oa(e,t,1),t=gr(),e!==null&&(Td(e,1,t),Mr(e,t));break}}e=e.return}}function WL(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=gr(),t.pingedLanes|=t.suspendedLanes&n,Mi===t&&(Ui&n)===n&&(yi===4||yi===3&&(Ui&130023424)===Ui&&500>ni()-zv?Ml(t,0):Rv|=n),Mr(t,e)}function RS(t,e){e===0&&(t.mode&1?(e=Xf,Xf<<=1,!(Xf&130023424)&&(Xf=4194304)):e=1);var n=gr();t=jo(t,e),t!==null&&(Td(t,e,n),Mr(t,n))}function HL(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),RS(t,n)}function $L(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ge(314))}i!==null&&i.delete(e),RS(t,n)}var zS;zS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Cr.current)Pr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Pr=!1,RL(t,e,n);Pr=!!(t.flags&131072)}else Pr=!1,zn&&e.flags&1048576&&F2(e,sm,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;kp(t,e),t=e.pendingProps;var s=nu(e,nr.current);Yc(e,n),s=Pv(null,e,i,t,s,n);var c=Cv();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ir(i)?(c=!0,im(e)):c=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,wv(e),s.updater=Gm,e.stateNode=s,s._reactInternals=e,Qy(e,i,t,n),e=n0(null,e,i,!0,c,n)):(e.tag=0,zn&&c&&mv(e),pr(null,e,s,n),e=e.child),e;case 16:i=e.elementType;e:{switch(kp(t,e),t=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=ZL(i),t=ks(i,t),s){case 0:e=t0(null,e,i,t,n);break e;case 1:e=$b(null,e,i,t,n);break e;case 11:e=Wb(null,e,i,t,n);break e;case 14:e=Hb(null,e,i,ks(i.type,t),n);break e}throw Error(Ge(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ks(i,s),t0(t,e,i,s,n);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ks(i,s),$b(t,e,i,s,n);case 3:e:{if(_S(e),t===null)throw Error(Ge(387));i=e.pendingProps,c=e.memoizedState,s=c.element,V2(t,e),lm(e,i,null,n);var d=e.memoizedState;if(i=d.element,c.isDehydrated)if(c={element:i,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){s=ou(Error(Ge(423)),e),e=qb(t,e,i,n,s);break e}else if(i!==s){s=ou(Error(Ge(424)),e),e=qb(t,e,i,n,s);break e}else for(Xr=Da(e.stateNode.containerInfo.firstChild),Kr=e,zn=!0,zs=null,n=H2(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(iu(),i===s){e=Go(t,e,n);break e}pr(t,e,i,n)}e=e.child}return e;case 5:return $2(e),t===null&&Yy(e),i=e.type,s=e.pendingProps,c=t!==null?t.memoizedProps:null,d=s.children,Hy(i,s)?d=null:c!==null&&Hy(i,c)&&(e.flags|=32),gS(t,e),pr(t,e,d,n),e.child;case 6:return t===null&&Yy(e),null;case 13:return yS(t,e,n);case 4:return Ev(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=ru(e,null,i,n):pr(t,e,i,n),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ks(i,s),Wb(t,e,i,s,n);case 7:return pr(t,e,e.pendingProps,n),e.child;case 8:return pr(t,e,e.pendingProps.children,n),e.child;case 12:return pr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,c=e.memoizedProps,d=s.value,An(om,i._currentValue),i._currentValue=d,c!==null)if(Us(c.value,d)){if(c.children===s.children&&!Cr.current){e=Go(t,e,n);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var l=c.dependencies;if(l!==null){d=c.child;for(var y=l.firstContext;y!==null;){if(y.context===i){if(c.tag===1){y=No(-1,n&-n),y.tag=2;var w=c.updateQueue;if(w!==null){w=w.shared;var S=w.pending;S===null?y.next=y:(y.next=S.next,S.next=y),w.pending=y}}c.lanes|=n,y=c.alternate,y!==null&&(y.lanes|=n),Ky(c.return,n,e),l.lanes|=n;break}y=y.next}}else if(c.tag===10)d=c.type===e.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(Ge(341));d.lanes|=n,l=d.alternate,l!==null&&(l.lanes|=n),Ky(d,n,e),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===e){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}pr(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,Yc(e,n),s=xs(s),i=i(s),e.flags|=1,pr(t,e,i,n),e.child;case 14:return i=e.type,s=ks(i,e.pendingProps),s=ks(i.type,s),Hb(t,e,i,s,n);case 15:return pS(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:ks(i,s),kp(t,e),e.tag=1,Ir(i)?(t=!0,im(e)):t=!1,Yc(e,n),G2(e,i,s),Qy(e,i,s,n),n0(null,e,i,!0,t,n);case 19:return vS(t,e,n);case 22:return mS(t,e,n)}throw Error(Ge(156,e.tag))};function DS(t,e){return a2(t,e)}function qL(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(t,e,n,i){return new qL(t,e,n,i)}function Bv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ZL(t){if(typeof t=="function")return Bv(t)?1:0;if(t!=null){if(t=t.$$typeof,t===iv)return 11;if(t===rv)return 14}return 2}function Na(t,e){var n=t.alternate;return n===null?(n=_s(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Dp(t,e,n,i,s,c){var d=2;if(i=t,typeof t=="function")Bv(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case kc:return Ll(n.children,s,c,e);case nv:d=8,s|=8;break;case Ey:return t=_s(12,n,e,s|2),t.elementType=Ey,t.lanes=c,t;case Ty:return t=_s(13,n,e,s),t.elementType=Ty,t.lanes=c,t;case Sy:return t=_s(19,n,e,s),t.elementType=Sy,t.lanes=c,t;case WT:return qm(n,s,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case jT:d=10;break e;case GT:d=9;break e;case iv:d=11;break e;case rv:d=14;break e;case Ea:d=16,i=null;break e}throw Error(Ge(130,t==null?t:typeof t,""))}return e=_s(d,n,e,s),e.elementType=t,e.type=i,e.lanes=c,e}function Ll(t,e,n,i){return t=_s(7,t,i,e),t.lanes=n,t}function qm(t,e,n,i){return t=_s(22,t,i,e),t.elementType=WT,t.lanes=n,t.stateNode={isHidden:!1},t}function F_(t,e,n){return t=_s(6,t,null,e),t.lanes=n,t}function B_(t,e,n){return e=_s(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function XL(t,e,n,i,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=y_(0),this.expirationTimes=y_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=y_(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Nv(t,e,n,i,s,c,d,l,y){return t=new XL(t,e,n,l,y),e===1?(e=1,c===!0&&(e|=8)):e=0,c=_s(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},wv(c),t}function YL(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function OS(t){if(!t)return Ga;t=t._reactInternals;e:{if(Hl(t)!==t||t.tag!==1)throw Error(Ge(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ir(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ge(171))}if(t.tag===1){var n=t.type;if(Ir(n))return D2(t,n,e)}return e}function FS(t,e,n,i,s,c,d,l,y){return t=Nv(n,i,!0,t,s,c,d,l,y),t.context=OS(null),n=t.current,i=gr(),s=Ba(n),c=No(i,s),c.callback=e??null,Oa(n,c,s),t.current.lanes=s,Td(t,s,i),Mr(t,i),t}function Zm(t,e,n,i){var s=e.current,c=gr(),d=Ba(s);return n=OS(n),e.context===null?e.context=n:e.pendingContext=n,e=No(c,d),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Oa(s,e,d),t!==null&&(Bs(t,s,d,c),Ip(t,s,d)),d}function gm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function iw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Uv(t,e){iw(t,e),(t=t.alternate)&&iw(t,e)}function KL(){return null}var BS=typeof reportError=="function"?reportError:function(t){console.error(t)};function Vv(t){this._internalRoot=t}Xm.prototype.render=Vv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ge(409));Zm(t,e,null,null)};Xm.prototype.unmount=Vv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Fl(function(){Zm(null,t,null,null)}),e[Vo]=null}};function Xm(t){this._internalRoot=t}Xm.prototype.unstable_scheduleHydration=function(t){if(t){var e=p2();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Sa.length&&e!==0&&e<Sa[n].priority;n++);Sa.splice(n,0,t),n===0&&g2(t)}};function jv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ym(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function rw(){}function JL(t,e,n,i,s){if(s){if(typeof i=="function"){var c=i;i=function(){var w=gm(d);c.call(w)}}var d=FS(e,i,t,0,null,!1,!1,"",rw);return t._reactRootContainer=d,t[Vo]=d.current,rd(t.nodeType===8?t.parentNode:t),Fl(),d}for(;s=t.lastChild;)t.removeChild(s);if(typeof i=="function"){var l=i;i=function(){var w=gm(y);l.call(w)}}var y=Nv(t,0,!1,null,null,!1,!1,"",rw);return t._reactRootContainer=y,t[Vo]=y.current,rd(t.nodeType===8?t.parentNode:t),Fl(function(){Zm(e,y,n,i)}),y}function Km(t,e,n,i,s){var c=n._reactRootContainer;if(c){var d=c;if(typeof s=="function"){var l=s;s=function(){var y=gm(d);l.call(y)}}Zm(e,d,t,s)}else d=JL(n,e,t,s,i);return gm(d)}d2=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=kh(e.pendingLanes);n!==0&&(av(e,n|1),Mr(e,ni()),!(an&6)&&(au=ni()+500,qa()))}break;case 13:Fl(function(){var i=jo(t,1);if(i!==null){var s=gr();Bs(i,t,1,s)}}),Uv(t,1)}};lv=function(t){if(t.tag===13){var e=jo(t,134217728);if(e!==null){var n=gr();Bs(e,t,134217728,n)}Uv(t,134217728)}};f2=function(t){if(t.tag===13){var e=Ba(t),n=jo(t,e);if(n!==null){var i=gr();Bs(n,t,e,i)}Uv(t,e)}};p2=function(){return mn};m2=function(t,e){var n=mn;try{return mn=t,e()}finally{mn=n}};Dy=function(t,e,n){switch(e){case"input":if(Cy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var s=Vm(i);if(!s)throw Error(Ge(90));$T(i),Cy(i,s)}}}break;case"textarea":ZT(t,n);break;case"select":e=n.value,e!=null&&$c(t,!!n.multiple,e,!1)}};t2=Dv;n2=Fl;var QL={usingClientEntryPoint:!1,Events:[Ad,Oc,Vm,QT,e2,Dv]},wh={findFiberByHostInstance:Al,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ek={bundleType:wh.bundleType,version:wh.version,rendererPackageName:wh.rendererPackageName,rendererConfig:wh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=s2(t),t===null?null:t.stateNode},findFiberByHostInstance:wh.findFiberByHostInstance||KL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var op=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!op.isDisabled&&op.supportsFiber)try{Fm=op.inject(ek),ho=op}catch{}}ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QL;ts.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!jv(e))throw Error(Ge(200));return YL(t,e,null,n)};ts.createRoot=function(t,e){if(!jv(t))throw Error(Ge(299));var n=!1,i="",s=BS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Nv(t,1,!1,null,null,n,!1,i,s),t[Vo]=e.current,rd(t.nodeType===8?t.parentNode:t),new Vv(e)};ts.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ge(188)):(t=Object.keys(t).join(","),Error(Ge(268,t)));return t=s2(e),t=t===null?null:t.stateNode,t};ts.flushSync=function(t){return Fl(t)};ts.hydrate=function(t,e,n){if(!Ym(e))throw Error(Ge(200));return Km(null,t,e,!0,n)};ts.hydrateRoot=function(t,e,n){if(!jv(t))throw Error(Ge(405));var i=n!=null&&n.hydratedSources||null,s=!1,c="",d=BS;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),e=FS(e,null,t,1,n??null,s,!1,c,d),t[Vo]=e.current,rd(t),i)for(t=0;t<i.length;t++)n=i[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Xm(e)};ts.render=function(t,e,n){if(!Ym(e))throw Error(Ge(200));return Km(null,t,e,!1,n)};ts.unmountComponentAtNode=function(t){if(!Ym(t))throw Error(Ge(40));return t._reactRootContainer?(Fl(function(){Km(null,null,t,!1,function(){t._reactRootContainer=null,t[Vo]=null})}),!0):!1};ts.unstable_batchedUpdates=Dv;ts.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Ym(n))throw Error(Ge(200));if(t==null||t._reactInternals===void 0)throw Error(Ge(38));return Km(t,e,n,!1,i)};ts.version="18.2.0-next-9e3b772b8-20220608";function NS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NS)}catch(t){console.error(t)}}NS(),FT.exports=ts;var Gv=FT.exports,US,sw=Gv;US=sw.createRoot,sw.hydrateRoot;const tk="modulepreload",nk=function(t){return"/dev-site/aix/"+t},ow={},ik=function(e,n,i){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(c=>{if(c=nk(c),c in ow)return;ow[c]=!0;const d=c.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(!!i)for(let S=s.length-1;S>=0;S--){const I=s[S];if(I.href===c&&(!d||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${l}`))return;const w=document.createElement("link");if(w.rel=d?"stylesheet":tk,d||(w.as="script",w.crossOrigin=""),w.href=c,document.head.appendChild(w),d)return new Promise((S,I)=>{w.addEventListener("load",S),w.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>e()).catch(c=>{const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c})},rk=at.createContext(null);function sk(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return n===s&&i===c}function Do(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Do(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!Do(t[s],e[s]))return!1;return!0}return!1}function ok(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function aw(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();Do(n,i)||e.setProjection(n)}function lw(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function cw(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const s=t.center;t.center=new s.constructor(n.longitude,n.latitude),i=i||s!==t.center}if("zoom"in n){const s=t.zoom;t.zoom=n.zoom,i=i||s!==t.zoom}if("bearing"in n){const s=t.bearing;t.bearing=n.bearing,i=i||s!==t.bearing}if("pitch"in n){const s=t.pitch;t.pitch=n.pitch,i=i||s!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const ak=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function uw(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let s=null;"interactive"in i&&(s=Object.assign({},i),delete s.interactive);const c=e[i.ref];if(c){s=s||Object.assign({},i),delete s.ref;for(const d of ak)d in c&&(s[d]=c[d])}return s||i});return{...t,layers:n}}const hw={version:8,sources:{},layers:[]},dw={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},N_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},fw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},lk=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],ck=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class lu{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const c=this.props[fw[s.type]];c?c(s):s.type==="error"&&console.error(s.error)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const c=this.props[dw[s.type]];c&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),c(s),delete s.features)},this._onCameraEvent=s=>{if(!this._internalUpdate){const c=this.props[N_[s.type]];c&&c(s)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const s=this._updateSize(e),c=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||s||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=lu.savedMaps.pop();if(!i)return null;const s=i.map,c=s.getContainer();for(n.className=c.className;c.childNodes.length>0;)n.appendChild(c.childNodes[0]);s._container=n;const d=s._resizeObserver;d&&(d.disconnect(),d.observe(n)),i.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:l}=e;return l&&(l.bounds?s.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),s._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=hw}=n,s={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||uk()||null,container:e,style:uw(i)},c=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),n.gl){const S=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=S,n.gl)}const d=new this._MapClass(s);c.padding&&d.setPadding(c.padding),n.cursor&&(d.getCanvas().style.cursor=n.cursor),this._createShadowTransform(d);const l=d._render;d._render=S=>{this._inRender=!0,l.call(d,S),this._inRender=!1};const y=d._renderTaskQueue.run;d._renderTaskQueue.run=S=>{y.call(d._renderTaskQueue,S),this._onBeforeRepaint()},d.on("render",()=>this._onAfterRepaint());const w=d.fire;d.fire=this._fireEvent.bind(this,w),d.on("resize",()=>{this._renderTransform.resize(d.transform.width,d.transform.height)}),d.on("styledata",()=>{this._updateStyleComponents(this.props,{}),aw(d.transform,this._renderTransform)}),d.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const S in dw)d.on(S,this._onPointerEvent);for(const S in N_)d.on(S,this._onCameraEvent);for(const S in fw)d.on(S,this._onEvent);this._map=d}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),lu.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=ok(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,s=this._renderTransform,{zoom:c,pitch:d,bearing:l}=s,y=i.isMoving();y&&(s.cameraElevationReference="sea");const w=cw(s,{...lw(i.transform),...e});if(y&&(s.cameraElevationReference="ground"),w&&n){const S=this._deferredEvents;S.move=!0,S.zoom||(S.zoom=c!==s.zoom),S.rotate||(S.rotate=l!==s.bearing),S.pitch||(S.pitch=d!==s.pitch)}return y||cw(i.transform,e),w}_updateSettings(e,n){const i=this._map;let s=!1;for(const c of lk)if(c in e&&!Do(e[c],n[c])){s=!0;const d=i[`set${c[0].toUpperCase()}${c.slice(1)}`];d==null||d.call(i,e[c])}return s}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=hw,styleDiffing:s=!0}=e,c={diff:s};return"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(uw(i),c),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let s=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Do(e.light,n.light)&&(s=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Do(e.fog,n.fog)&&(s=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Do(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(s=!0,i.setTerrain(e.terrain))),s}_updateHandlers(e,n){var i,s;const c=this._map;let d=!1;for(const l of ck){const y=(i=e[l])!==null&&i!==void 0?i:!0,w=(s=n[l])!==null&&s!==void 0?s:!0;Do(y,w)||(d=!0,y?c[l].enable(y):c[l].disable())}return d}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:s=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:s.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const c=e.type,d=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),y=l.length>0;!y&&d&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,y&&!d&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=c}else this._hoveredFeatures=null}_fireEvent(e,n,i){const s=this._map,c=s.transform,d=typeof n=="string"?n:n.type;return d==="move"&&this._updateViewState(this.props,!1),d in N_&&(typeof n=="object"&&(n.viewState=lw(c)),this._map.isMoving())?(s.transform=this._renderTransform,e.call(s,n,i),s.transform=c,s):(e.call(s,n,i),s)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{aw(this._renderTransform,n),e.transform=n}}}lu.savedMaps=[];function uk(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const hk=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function dk(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const s=e.transform;e.transform=t.transform;const c=e.project(i);return e.transform=s,c},unproject:i=>{const s=e.transform;e.transform=t.transform;const c=e.unproject(i);return e.transform=s,c},queryTerrainElevation:(i,s)=>{const c=e.transform;e.transform=t.transform;const d=e.queryTerrainElevation(i,s);return e.transform=c,d},queryRenderedFeatures:(i,s)=>{const c=e.transform;e.transform=t.transform;const d=e.queryRenderedFeatures(i,s);return e.transform=c,d}};for(const i of fk(e))!(i in n)&&!hk.includes(i)&&(n[i]=e[i].bind(e));return n}function fk(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const pk=typeof document<"u"?at.useLayoutEffect:at.useEffect,mk=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function gk(t,e){for(const i of mk)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!0)}const Jm=at.createContext(null);function _k(t,e,n){const i=at.useContext(rk),[s,c]=at.useState(null),d=at.useRef(),{current:l}=at.useRef({mapLib:null,map:null});at.useEffect(()=>{const S=t.mapLib;let I=!0,P;return Promise.resolve(S||n).then(B=>{if(!I)return;if(!B)throw new Error("Invalid mapLib");const G="Map"in B?B:B.default;if(!G.Map)throw new Error("Invalid mapLib");if(gk(G,t),!G.supported||G.supported(t))t.reuseMaps&&(P=lu.reuse(t,d.current)),P||(P=new lu(G.Map,t,d.current)),l.map=dk(P),l.mapLib=G,c(P),i==null||i.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(B=>{const{onError:G}=t;G?G({type:"error",target:null,originalEvent:null,error:B}):console.error(B)}),()=>{I=!1,P&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?P.recycle():P.destroy())}},[]),pk(()=>{s&&s.setProps(t)}),at.useImperativeHandle(e,()=>l.map,[s]);const y=at.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),w={height:"100%"};return at.createElement("div",{id:t.id,ref:d,style:y},s&&at.createElement(Jm.Provider,{value:l},at.createElement("div",{"mapboxgl-children":"",style:w},t.children)))}const yk=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function $l(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const s=e[i];Number.isFinite(s)&&!yk.test(i)?n[i]=`${s}px`:n[i]=s}}function vk(t,e){const{map:n,mapLib:i}=at.useContext(Jm),s=at.useRef({props:t});s.current.props=t;const c=at.useMemo(()=>{let K=!1;at.Children.forEach(t.children,j=>{j&&(K=!0)});const de={...t,element:K?document.createElement("div"):null},Z=new i.Marker(de);return Z.setLngLat([t.longitude,t.latitude]),Z.getElement().addEventListener("click",j=>{var q,se;(se=(q=s.current.props).onClick)===null||se===void 0||se.call(q,{type:"click",target:Z,originalEvent:j})}),Z.on("dragstart",j=>{var q,se;const pe=j;pe.lngLat=c.getLngLat(),(se=(q=s.current.props).onDragStart)===null||se===void 0||se.call(q,pe)}),Z.on("drag",j=>{var q,se;const pe=j;pe.lngLat=c.getLngLat(),(se=(q=s.current.props).onDrag)===null||se===void 0||se.call(q,pe)}),Z.on("dragend",j=>{var q,se;const pe=j;pe.lngLat=c.getLngLat(),(se=(q=s.current.props).onDragEnd)===null||se===void 0||se.call(q,pe)}),Z},[]);at.useEffect(()=>(c.addTo(n.getMap()),()=>{c.remove()}),[]);const{longitude:d,latitude:l,offset:y,style:w,draggable:S=!1,popup:I=null,rotation:P=0,rotationAlignment:B="auto",pitchAlignment:G="auto"}=t;return at.useEffect(()=>{$l(c.getElement(),w)},[w]),at.useImperativeHandle(e,()=>c,[]),(c.getLngLat().lng!==d||c.getLngLat().lat!==l)&&c.setLngLat([d,l]),y&&!sk(c.getOffset(),y)&&c.setOffset(y),c.isDraggable()!==S&&c.setDraggable(S),c.getRotation()!==P&&c.setRotation(P),c.getRotationAlignment()!==B&&c.setRotationAlignment(B),c.getPitchAlignment()!==G&&c.setPitchAlignment(G),c.getPopup()!==I&&c.setPopup(I),Gv.createPortal(t.children,c.getElement())}at.memo(at.forwardRef(vk));function pw(t){return new Set(t?t.trim().split(/\s+/):[])}function xk(t,e){const{map:n,mapLib:i}=at.useContext(Jm),s=at.useMemo(()=>document.createElement("div"),[]),c=at.useRef({props:t});c.current.props=t;const d=at.useMemo(()=>{const l={...t},y=new i.Popup(l);return y.setLngLat([t.longitude,t.latitude]),y.once("open",w=>{var S,I;(I=(S=c.current.props).onOpen)===null||I===void 0||I.call(S,w)}),y},[]);if(at.useEffect(()=>{const l=y=>{var w,S;(S=(w=c.current.props).onClose)===null||S===void 0||S.call(w,y)};return d.on("close",l),d.setDOMContent(s).addTo(n.getMap()),()=>{d.off("close",l),d.isOpen()&&d.remove()}},[]),at.useEffect(()=>{$l(d.getElement(),t.style)},[t.style]),at.useImperativeHandle(e,()=>d,[]),d.isOpen()&&((d.getLngLat().lng!==t.longitude||d.getLngLat().lat!==t.latitude)&&d.setLngLat([t.longitude,t.latitude]),t.offset&&!Do(d.options.offset,t.offset)&&d.setOffset(t.offset),(d.options.anchor!==t.anchor||d.options.maxWidth!==t.maxWidth)&&(d.options.anchor=t.anchor,d.setMaxWidth(t.maxWidth)),d.options.className!==t.className)){const l=pw(d.options.className),y=pw(t.className);for(const w of l)y.has(w)||d.removeClassName(w);for(const w of y)l.has(w)||d.addClassName(w);d.options.className=t.className}return Gv.createPortal(t.children,s)}at.memo(at.forwardRef(xk));function Cd(t,e,n,i){const s=at.useContext(Jm),c=at.useMemo(()=>t(s),[]);return at.useEffect(()=>{const d=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,y=typeof n=="function"?n:typeof e=="function"?e:null,{map:w}=s;return w.hasControl(c)||(w.addControl(c,d==null?void 0:d.position),l&&l(s)),()=>{y&&y(s),w.hasControl(c)&&w.removeControl(c)}},[]),c}function bk(t){const e=Cd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return at.useEffect(()=>{$l(e._container,t.style)},[t.style]),null}at.memo(bk);function wk(t){const e=Cd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return at.useEffect(()=>{$l(e._controlContainer,t.style)},[t.style]),null}at.memo(wk);function Ek(t,e){const n=at.useRef({props:t}),i=Cd(({mapLib:s})=>{const c=new s.GeolocateControl(t),d=c._setupUI;return c._setupUI=l=>{c._container.hasChildNodes()||d(l)},c.on("geolocate",l=>{var y,w;(w=(y=n.current.props).onGeolocate)===null||w===void 0||w.call(y,l)}),c.on("error",l=>{var y,w;(w=(y=n.current.props).onError)===null||w===void 0||w.call(y,l)}),c.on("outofmaxbounds",l=>{var y,w;(w=(y=n.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(y,l)}),c.on("trackuserlocationstart",l=>{var y,w;(w=(y=n.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(y,l)}),c.on("trackuserlocationend",l=>{var y,w;(w=(y=n.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(y,l)}),c},{position:t.position});return n.current.props=t,at.useImperativeHandle(e,()=>i,[]),at.useEffect(()=>{$l(i._container,t.style)},[t.style]),null}at.memo(at.forwardRef(Ek));function Tk(t){const e=Cd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return at.useEffect(()=>{$l(e._container,t.style)},[t.style]),null}at.memo(Tk);function Sk(t){const e=Cd(({mapLib:c})=>new c.ScaleControl(t),{position:t.position}),n=at.useRef(t),i=n.current;n.current=t;const{style:s}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),at.useEffect(()=>{$l(e._container,s)},[s]),null}at.memo(Sk);const Ak=ik(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl-b25bb000.js"),[]),Pk=(()=>at.forwardRef(function(e,n){return _k(e,n,Ak)}))();var VS={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(OI,function(){var n,i,s;function c(l,y){if(!n)n=y;else if(!i)i=y;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),s=y(S),typeof window<"u"&&(s.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}c(["exports"],function(l){var y=w;function w(a,r,u,f){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=u,this.p2y=f}function S(a,r,u,f){const g=new y(a,r,u,f);return function(v){return g.solve(v)}}w.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var u=a,f=0;f<8;f++){var g=this.sampleCurveX(u)-a;if(Math.abs(g)<r)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=g/v}var b=0,T=1;for(u=a,f=0;f<20&&(g=this.sampleCurveX(u),!(Math.abs(g-a)<r));f++)a>g?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};const I=S(.25,.1,.25,1);function P(a,r,u){return Math.min(u,Math.max(r,a))}function B(a,r,u){const f=u-r,g=((a-r)%f+f)%f+r;return g===r?u:g}function G(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}let K=1;function de(a,r){a.forEach(u=>{r[u]&&(r[u]=r[u].bind(r))})}function Z(a,r,u){const f={};for(const g in a)f[g]=r.call(u||this,a[g],g,a);return f}function j(a,r,u){const f={};for(const g in a)r.call(u||this,a[g],g,a)&&(f[g]=a[g]);return f}function q(a){return Array.isArray(a)?a.map(q):typeof a=="object"&&a?Z(a,q):a}const se={};function pe(a){se[a]||(typeof console<"u"&&console.warn(a),se[a]=!0)}function be(a,r,u){return(u.y-a.y)*(r.x-a.x)>(r.y-a.y)*(u.x-a.x)}function Re(a){let r=0;for(let u,f,g=0,v=a.length,b=v-1;g<v;b=g++)u=a[g],f=a[b],r+=(f.x-u.x)*(u.y+f.y);return r}function Fe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ve(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,g,v)=>{const b=g||v;return r[f]=!b||b.toLowerCase(),""}),r["max-age"]){const u=parseInt(r["max-age"],10);isNaN(u)?delete r["max-age"]:r["max-age"]=u}return r}let je,pt,bt=null;function St(a){if(bt==null){const r=a.navigator?a.navigator.userAgent:null;bt=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return bt}function kt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Gn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const u=window.document.createElement("canvas"),f=u.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return u.width=a.width,u.height=a.height,f.drawImage(a,0,0,a.width,a.height),f.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(je||(je=document.createElement("a")),je.href=a,je.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(pt==null&&(pt=matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}};var xt=xi;function xi(a,r){this.x=a,this.y=r}xi.prototype={clone:function(){return new xi(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,u=a.y-this.y;return r*r+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),u=Math.sin(a),f=u*this.x+r*this.y;return this.x=r*this.x-u*this.y,this.y=f,this},_rotateAround:function(a,r){var u=Math.cos(a),f=Math.sin(a),g=r.y+f*(this.x-r.x)+u*(this.y-r.y);return this.x=r.x+u*(this.x-r.x)-f*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xi.convert=function(a){return a instanceof xi?a:Array.isArray(a)?new xi(a[0],a[1]):a};const tt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Et="mapbox-tiles";let Pt,nn,rn=500,ir=50;function ii(){typeof caches>"u"||Pt||(Pt=caches.open(Et))}let bi=1/0;const ri={supported:!1,testSupport:function(a){!qt&&wi&&(Dn?is(a):un=a)}};let un,wi,qt=!1,Dn=!1;function is(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,wi),a.isContextLost())return;ri.supported=!0}catch{}a.deleteTexture(r),qt=!0}typeof document<"u"&&(wi=document.createElement("img"),wi.onload=function(){un&&is(un),un=null,Dn=!0},wi.onerror=function(){qt=!0,un=null},wi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Li={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Li);class Yn extends Error{constructor(r,u,f,g){super(`AJAXError: ${u} (${r}): ${f}`),this.status=r,this.statusText=u,this.url=f,this.body=g}}const Lr=Fe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ji(a,r){const u=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Lr(),signal:u.signal});let g=!1,v=!1;return a.type==="json"&&f.headers.set("Accept","application/json"),((b,T,A)=>{if(v)return;const L=Date.now();fetch(f).then(z=>z.ok?((O,V,$)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(X=>{v||(V&&$&&function(ae,oe,ve){if(ii(),!Pt)return;const Se={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((Ee,De)=>Se.headers.set(De,Ee));const ye=Ve(oe.headers.get("Cache-Control")||"");ye["no-store"]||(ye["max-age"]&&Se.headers.set("Expires",new Date(ve+1e3*ye["max-age"]).toUTCString()),new Date(Se.headers.get("Expires")).getTime()-ve<42e4||function(Ee,De){if(nn===void 0)try{new Response(new ReadableStream),nn=!0}catch{nn=!1}nn?De(Ee.body):Ee.blob().then(De)}(oe,Ee=>{const De=new Response(Ee,Se);ii(),Pt&&Pt.then(ze=>ze.put(function(it){const ct=it.indexOf("?");return ct<0?it:it.slice(0,ct)}(ae.url),De)).catch(ze=>pe(ze.message))}))}(f,V,$),g=!0,r(null,X,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(X=>{v||r(new Error(X.message))})})(z,null,L):z.blob().then(O=>r(new Yn(z.status,z.statusText,a.url,O)))).catch(z=>{z.code!==20&&r(new Error(z.message))})})(),{cancel:()=>{v=!0,g||u.abort()}}}const di=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Fe()){const f=a.url.substring(0,a.url.indexOf("://"));return(tt.REGISTERED_PROTOCOLS[f]||ji)(a,r)}}if(!(/^file:/.test(u=a.url)||/^file:/.test(Lr())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ji(a,r);if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var u;return function(f,g){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const b in f.headers)v.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let b=v.response;if(f.type==="json")try{b=JSON.parse(v.response)}catch(T){return g(T)}g(null,b,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const b=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});g(new Yn(v.status,v.statusText,f.url,b))}},v.send(f.body),{cancel:()=>v.abort()}}(a,r)},Gi=function(a,r){return di(G(a,{type:"arrayBuffer"}),r)};function Vs(a){const r=window.document.createElement("a");return r.href=a,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ki,On;ki=[],On=0;const rs=function(a,r){if(ri.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),On>=tt.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return ki.push(v),v}On++;let u=!1;const f=()=>{if(!u)for(u=!0,On--;ki.length&&On<tt.MAX_PARALLEL_IMAGE_REQUESTS;){const v=ki.shift(),{requestParameters:b,callback:T,cancelled:A}=v;A||(v.cancel=rs(b,T).cancel)}},g=Gi(a,(v,b,T,A)=>{f(),v?r(v):b&&function(L,z){typeof createImageBitmap=="function"?function(O,V){const $=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap($).then(X=>{V(null,X)}).catch(X=>{V(new Error(`Could not load image because of ${X.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(L,z):function(O,V){const $=new Image;$.onload=()=>{V(null,$),URL.revokeObjectURL($.src),$.onload=null,window.requestAnimationFrame(()=>{$.src=Gt})},$.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new Blob([new Uint8Array(O)],{type:"image/png"});$.src=O.byteLength?URL.createObjectURL(X):Gt}(L,z)}(b,(L,z)=>{L!=null?r(L):z!=null&&r(null,z,{cacheControl:T,expires:A})})});return{cancel:()=>{g.cancel(),f()}}};function go(a,r,u){u[a]&&u[a].indexOf(r)!==-1||(u[a]=u[a]||[],u[a].push(r))}function kr(a,r,u){if(u&&u[a]){const f=u[a].indexOf(r);f!==-1&&u[a].splice(f,1)}}class Rr{constructor(r,u={}){G(this,u),this.type=r}}class js extends Rr{constructor(r,u={}){super("error",G({error:r},u))}}class vr{on(r,u){return this._listeners=this._listeners||{},go(r,u,this._listeners),this}off(r,u){return kr(r,u,this._listeners),kr(r,u,this._oneTimeListeners),this}once(r,u){return this._oneTimeListeners=this._oneTimeListeners||{},go(r,u,this._oneTimeListeners),this}fire(r,u){typeof r=="string"&&(r=new Rr(r,u||{}));const f=r.type;if(this.listens(f)){r.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,r);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of v)kr(f,T,this._oneTimeListeners),T.call(this,r);const b=this._eventedParent;b&&(G(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof js&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,u){return this._eventedParent=r,this._eventedParentData=u,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class $e{constructor(r,u,f,g){this.message=(r?`${r}: `:"")+f,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function ss(a){const r=a.value;return r?[new $e(a.key,r,"constants have been deprecated as of v8")]:[]}function Ei(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}function Ut(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Wi(a){if(Array.isArray(a))return a.map(Wi);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const u in a)r[u]=Wi(a[u]);return r}return Ut(a)}class Ri extends Error{constructor(r,u){super(u),this.message=u,this.key=r}}class zi{constructor(r,u=[]){this.parent=r,this.bindings={};for(const[f,g]of u)this.bindings[f]=g}concat(r){return new zi(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const os={kind:"null"},He={kind:"number"},Mt={kind:"string"},It={kind:"boolean"},Kn={kind:"color"},zr={kind:"object"},Ct={kind:"value"},rr={kind:"collator"},Wn={kind:"formatted"},Gs={kind:"padding"},Ln={kind:"resolvedImage"};function si(a,r){return{kind:"array",itemType:a,N:r}}function en(a){if(a.kind==="array"){const r=en(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const Ws=[os,He,Mt,It,Kn,Wn,zr,si(Ct),Gs,Ln];function xr(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!xr(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const u of Ws)if(!xr(u,r))return null}}return`Expected ${en(a)} but found ${en(r)} instead.`}function br(a,r){return r.some(u=>u.kind===a.kind)}function ws(a,r){return r.some(u=>u==="null"?a===null:u==="array"?Array.isArray(a):u==="object"?a&&!Array.isArray(a)&&typeof a=="object":u===typeof a)}var Hs,as={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ee(a){return(a=Math.round(a))<0?0:a>255?255:a}function R(a){return ee(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function F(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function Y(a,r,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?a+(r-a)*u*6:2*u<1?r:3*u<2?a+(r-a)*(2/3-u)*6:a}try{Hs={}.parseCSSColor=function(a){var r,u=a.replace(/ /g,"").toLowerCase();if(u in as)return as[u].slice();if(u[0]==="#")return u.length===4?(r=parseInt(u.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:u.length===7&&(r=parseInt(u.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var f=u.indexOf("("),g=u.indexOf(")");if(f!==-1&&g+1===u.length){var v=u.substr(0,f),b=u.substr(f+1,g-(f+1)).split(","),T=1;switch(v){case"rgba":if(b.length!==4)return null;T=F(b.pop());case"rgb":return b.length!==3?null:[R(b[0]),R(b[1]),R(b[2]),T];case"hsla":if(b.length!==4)return null;T=F(b.pop());case"hsl":if(b.length!==3)return null;var A=(parseFloat(b[0])%360+360)%360/360,L=F(b[1]),z=F(b[2]),O=z<=.5?z*(L+1):z+L-z*L,V=2*z-O;return[ee(255*Y(V,O,A+1/3)),ee(255*Y(V,O,A)),ee(255*Y(V,O,A-1/3)),T];default:return null}}return null}}catch{}class J{constructor(r,u,f,g=1){this.r=r,this.g=u,this.b=f,this.a=g}static parse(r){if(!r)return;if(r instanceof J)return r;if(typeof r!="string")return;const u=Hs(r);return u?new J(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[r,u,f,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(u)},${Math.round(f)},${g})`}toArray(){const{r,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*u/g,255*f/g,g]}}J.black=new J(0,0,0,1),J.white=new J(1,1,1,1),J.transparent=new J(0,0,0,0),J.red=new J(1,0,0,1);class ce{constructor(r,u,f){this.sensitivity=r?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,u){return this.collator.compare(r,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class me{constructor(r,u,f,g,v){this.text=r,this.image=u,this.scale=f,this.fontStack=g,this.textColor=v}}class he{constructor(r){this.sections=r}static fromString(r){return new he([new me(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof he?r:he.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class le{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof le)return r;if(typeof r=="number")return new le([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const u of r)if(typeof u!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new le(r)}}toString(){return JSON.stringify(this.values)}}class ge{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ge({name:r,available:!1}):null}}function Ce(a,r,u,f){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[a,r,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[a,r,u,f]:[a,r,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oe(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof J||a instanceof ce||a instanceof he||a instanceof le||a instanceof ge)return!0;if(Array.isArray(a)){for(const r of a)if(!Oe(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!Oe(a[r]))return!1;return!0}return!1}function Pe(a){if(a===null)return os;if(typeof a=="string")return Mt;if(typeof a=="boolean")return It;if(typeof a=="number")return He;if(a instanceof J)return Kn;if(a instanceof ce)return rr;if(a instanceof he)return Wn;if(a instanceof le)return Gs;if(a instanceof ge)return Ln;if(Array.isArray(a)){const r=a.length;let u;for(const f of a){const g=Pe(f);if(u){if(u===g)continue;u=Ct;break}u=g}return si(u||Ct,r)}return zr}function rt(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof J||a instanceof he||a instanceof le||a instanceof ge?a.toString():JSON.stringify(a)}class lt{constructor(r,u){this.type=r,this.value=u}static parse(r,u){if(r.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Oe(r[1]))return u.error("invalid value");const f=r[1];let g=Pe(f);const v=u.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new lt(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ye{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const gt={string:Mt,number:He,boolean:It,object:zr};class dt{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");let f,g=1;const v=r[0];if(v==="array"){let T,A;if(r.length>2){const L=r[1];if(typeof L!="string"||!(L in gt)||L==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);T=gt[L],g++}else T=Ct;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=r[2],g++}f=si(T,A)}else{if(!gt[v])throw new Error(`Types doesn't contain name = ${v}`);f=gt[v]}const b=[];for(;g<r.length;g++){const T=u.parse(r[g],g,Ct);if(!T)return null;b.push(T)}return new dt(f,b)}evaluate(r){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(r);if(!xr(this.type,Pe(f)))return f;if(u===this.args.length-1)throw new Ye(`Expected value to be of type ${en(this.type)}, but found ${en(Pe(f))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Rt={"to-boolean":It,"to-color":Kn,"to-number":He,"to-string":Mt};class vt{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[0];if(!Rt[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&r.length!==2)return u.error("Expected one argument.");const g=Rt[f],v=[];for(let b=1;b<r.length;b++){const T=u.parse(r[b],b,Ct);if(!T)return null;v.push(T)}return new vt(g,v)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let u,f;for(const g of this.args){if(u=g.evaluate(r),f=null,u instanceof J)return u;if(typeof u=="string"){const v=r.parseColor(u);if(v)return v}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ce(u[0],u[1],u[2],u[3]),!f))return new J(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ye(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="padding"){let u;for(const f of this.args){u=f.evaluate(r);const g=le.parse(u);if(g)return g}throw new Ye(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(r),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new Ye(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?he.fromString(rt(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?ge.fromString(rt(this.args[0].evaluate(r))):rt(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const At=["Unknown","Point","LineString","Polygon"];class Ft{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?At[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let u=this._parseColorCache[r];return u||(u=this._parseColorCache[r]=J.parse(r)),u}}class Vt{constructor(r,u,f,g){this.name=r,this.type=u,this._evaluate=f,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,u){const f=r[0],g=Vt.definitions[f];if(!g)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=b.filter(([L])=>!Array.isArray(L)||L.length===r.length-1);let A=null;for(const[L,z]of T){A=new Ne(u.registry,u.path,null,u.scope);const O=[];let V=!1;for(let $=1;$<r.length;$++){const X=r[$],ae=Array.isArray(L)?L[$-1]:L.type,oe=A.parse(X,1+O.length,ae);if(!oe){V=!0;break}O.push(oe)}if(!V)if(Array.isArray(L)&&L.length!==O.length)A.error(`Expected ${L.length} arguments, but found ${O.length} instead.`);else{for(let $=0;$<O.length;$++){const X=Array.isArray(L)?L[$]:L.type,ae=O[$];A.concat($+1).checkSubtype(X,ae.type)}if(A.errors.length===0)return new Vt(f,v,z,O)}}if(T.length===1)u.errors.push(...A.errors);else{const L=(T.length?T:b).map(([O])=>{return V=O,Array.isArray(V)?`(${V.map(en).join(", ")})`:`(${en(V.type)}...)`;var V}).join(" | "),z=[];for(let O=1;O<r.length;O++){const V=u.parse(r[O],1+z.length);if(!V)return null;z.push(en(V.type))}u.error(`Expected arguments of type ${L}, but found (${z.join(", ")}) instead.`)}return null}static register(r,u){Vt.definitions=u;for(const f in u)r[f]=Vt}}class dn{constructor(r,u,f){this.type=rr,this.locale=f,this.caseSensitive=r,this.diacriticSensitive=u}static parse(r,u){if(r.length!==2)return u.error("Expected one argument.");const f=r[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,It);if(!g)return null;const v=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,It);if(!v)return null;let b=null;return f.locale&&(b=u.parse(f.locale,1,Mt),!b)?null:new dn(g,v,b)}evaluate(r){return new ce(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const fn=8192;function Jn(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Dr(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function fi(a,r){const u=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(u*g*fn),Math.round(f*g*fn)]}function Xt(a,r,u){const f=a[0]-r[0],g=a[1]-r[1],v=a[0]-u[0],b=a[1]-u[1];return f*b-v*g==0&&f*v<=0&&g*b<=0}function _o(a,r){let u=!1;for(let b=0,T=r.length;b<T;b++){const A=r[b];for(let L=0,z=A.length;L<z-1;L++){if(Xt(a,A[L],A[L+1]))return!1;(g=A[L])[1]>(f=a)[1]!=(v=A[L+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(u=!u)}}var f,g,v;return u}function yo(a,r){for(let u=0;u<r.length;u++)if(_o(a,r[u]))return!0;return!1}function Ko(a,r,u,f){const g=f[0]-u[0],v=f[1]-u[1],b=(a[0]-u[0])*v-g*(a[1]-u[1]),T=(r[0]-u[0])*v-g*(r[1]-u[1]);return b>0&&T<0||b<0&&T>0}function Jo(a,r,u){for(const L of u)for(let z=0;z<L.length-1;++z)if((T=[(b=L[z+1])[0]-(v=L[z])[0],b[1]-v[1]])[0]*(A=[(g=r)[0]-(f=a)[0],g[1]-f[1]])[1]-T[1]*A[0]!=0&&Ko(f,g,v,b)&&Ko(v,b,f,g))return!0;var f,g,v,b,T,A;return!1}function $s(a,r){for(let u=0;u<a.length;++u)if(!_o(a[u],r))return!1;for(let u=0;u<a.length-1;++u)if(Jo(a[u],a[u+1],r))return!1;return!0}function Or(a,r){for(let u=0;u<r.length;u++)if($s(a,r[u]))return!0;return!1}function Qo(a,r,u){const f=[];for(let g=0;g<a.length;g++){const v=[];for(let b=0;b<a[g].length;b++){const T=fi(a[g][b],u);Jn(r,T),v.push(T)}f.push(v)}return f}function ea(a,r,u){const f=[];for(let g=0;g<a.length;g++){const v=Qo(a[g],r,u);f.push(v)}return f}function ta(a,r,u,f){if(a[0]<u[0]||a[0]>u[2]){const g=.5*f;let v=a[0]-u[0]>g?-f:u[0]-a[0]>g?f:0;v===0&&(v=a[0]-u[2]>g?-f:u[2]-a[0]>g?f:0),a[0]+=v}Jn(r,a)}function Za(a,r,u,f){const g=Math.pow(2,f.z)*fn,v=[f.x*fn,f.y*fn],b=[];for(const T of a)for(const A of T){const L=[A.x+v[0],A.y+v[1]];ta(L,r,u,g),b.push(L)}return b}function Yl(a,r,u,f){const g=Math.pow(2,f.z)*fn,v=[f.x*fn,f.y*fn],b=[];for(const A of a){const L=[];for(const z of A){const O=[z.x+v[0],z.y+v[1]];Jn(r,O),L.push(O)}b.push(L)}if(r[2]-r[0]<=g/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of b)for(const L of A)ta(L,r,u,g)}var T;return b}class Es{constructor(r,u){this.type=It,this.geojson=r,this.geometries=u}static parse(r,u){if(r.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Oe(r[1])){const f=r[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const v=f.features[g].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Es(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Es(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Es(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=Qo(f.coordinates,v,b),A=Za(u.geometry(),g,v,b);if(!Dr(g,v))return!1;for(const L of A)if(!_o(L,T))return!1}if(f.type==="MultiPolygon"){const T=ea(f.coordinates,v,b),A=Za(u.geometry(),g,v,b);if(!Dr(g,v))return!1;for(const L of A)if(!yo(L,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=Qo(f.coordinates,v,b),A=Yl(u.geometry(),g,v,b);if(!Dr(g,v))return!1;for(const L of A)if(!$s(L,T))return!1}if(f.type==="MultiPolygon"){const T=ea(f.coordinates,v,b),A=Yl(u.geometry(),g,v,b);if(!Dr(g,v))return!1;for(const L of A)if(!Or(L,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function H(a){if(a instanceof Vt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Es)return!1;let r=!0;return a.eachChild(u=>{r&&!H(u)&&(r=!1)}),r}function Q(a){if(a instanceof Vt&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(u=>{r&&!Q(u)&&(r=!1)}),r}function ue(a,r){if(a instanceof Vt&&r.indexOf(a.name)>=0)return!1;let u=!0;return a.eachChild(f=>{u&&!ue(f,r)&&(u=!1)}),u}class Ae{constructor(r,u){this.type=u.type,this.name=r,this.boundExpression=u}static parse(r,u){if(r.length!==2||typeof r[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=r[1];return u.scope.has(f)?new Ae(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Ne{constructor(r,u=[],f,g=new zi,v=[]){this.registry=r,this.path=u,this.key=u.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=v,this.expectedType=f}parse(r,u,f,g,v={}){return u?this.concat(u,f,g)._parse(r,v):this._parse(r,v)}_parse(r,u){function f(g,v,b){return b==="assert"?new dt(v,[g]):b==="coerce"?new vt(v,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let b=v.parse(r,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,A=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string")if(T.kind!=="padding"||A.kind!=="value"&&A.kind!=="number"&&A.kind!=="array"){if(this.checkSubtype(T,A))return null}else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"assert")}if(!(b instanceof lt)&&b.type.kind!=="resolvedImage"&&ot(b)){const T=new Ft;try{b=new lt(b.type,b.evaluate(T))}catch(A){return this.error(A.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,u,f){const g=typeof r=="number"?this.path.concat(r):this.path,v=f?this.scope.concat(f):this.scope;return new Ne(this.registry,g,u||null,v,this.errors)}error(r,...u){const f=`${this.key}${u.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ri(f,r))}checkSubtype(r,u){const f=xr(r,u);return f&&this.error(f),f}}function ot(a){if(a instanceof Ae)return ot(a.boundExpression);if(a instanceof Vt&&a.name==="error"||a instanceof dn||a instanceof Es)return!1;const r=a instanceof vt||a instanceof dt;let u=!0;return a.eachChild(f=>{u=r?u&&ot(f):u&&f instanceof lt}),!!u&&H(a)&&ue(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Bt(a,r){const u=a.length-1;let f,g,v=0,b=u,T=0;for(;v<=b;)if(T=Math.floor((v+b)/2),f=a[T],g=a[T+1],f<=r){if(T===u||r<g)return T;v=T+1}else{if(!(f>r))throw new Ye("Input is not a number.");b=T-1}return 0}class En{constructor(r,u,f){this.type=r,this.input=u,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(r,u){if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(r[1],1,He);if(!f)return null;const g=[];let v=null;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);for(let b=1;b<r.length;b+=2){const T=b===1?-1/0:r[b],A=r[b+1],L=b,z=b+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const O=u.parse(A,z,v);if(!O)return null;v=v||O.type,g.push([T,O])}return new En(v,f,g)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const v=u.length;return g>=u[v-1]?f[v-1].evaluate(r):f[Bt(u,g)].evaluate(r)}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function zt(a,r,u){return a*(1-u)+r*u}var Fn=Object.freeze({__proto__:null,number:zt,color:function(a,r,u){return new J(zt(a.r,r.r,u),zt(a.g,r.g,u),zt(a.b,r.b,u),zt(a.a,r.a,u))},array:function(a,r,u){return a.map((f,g)=>zt(f,r[g],u))},padding:function(a,r,u){const f=a.values,g=r.values;return new le([zt(f[0],g[0],u),zt(f[1],g[1],u),zt(f[2],g[2],u),zt(f[3],g[3],u)])}});const sr=.95047,jd=1.08883,Eu=4/29,Kl=6/29,Gd=3*Kl*Kl,ug=Math.PI/180,hg=180/Math.PI;function Tu(a){return a>.008856451679035631?Math.pow(a,1/3):a/Gd+Eu}function Su(a){return a>Kl?a*a*a:Gd*(a-Eu)}function Au(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Pu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Jt(a){const r=Pu(a.r),u=Pu(a.g),f=Pu(a.b),g=Tu((.4124564*r+.3575761*u+.1804375*f)/sr),v=Tu((.2126729*r+.7151522*u+.072175*f)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-Tu((.0193339*r+.119192*u+.9503041*f)/jd)),alpha:a.a}}function Wd(a){let r=(a.l+16)/116,u=isNaN(a.a)?r:r+a.a/500,f=isNaN(a.b)?r:r-a.b/200;return r=1*Su(r),u=sr*Su(u),f=jd*Su(f),new J(Au(3.2404542*u-1.5371385*r-.4985314*f),Au(-.969266*u+1.8760108*r+.041556*f),Au(.0556434*u-.2040259*r+1.0572252*f),a.alpha)}function dg(a,r,u){const f=r-a;return a+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const Xa={forward:Jt,reverse:Wd,interpolate:function(a,r,u){return{l:zt(a.l,r.l,u),a:zt(a.a,r.a,u),b:zt(a.b,r.b,u),alpha:zt(a.alpha,r.alpha,u)}}},Ya={forward:function(a){const{l:r,a:u,b:f}=Jt(a),g=Math.atan2(f,u)*hg;return{h:g<0?g+360:g,c:Math.sqrt(u*u+f*f),l:r,alpha:a.a}},reverse:function(a){const r=a.h*ug,u=a.c;return Wd({l:a.l,a:Math.cos(r)*u,b:Math.sin(r)*u,alpha:a.alpha})},interpolate:function(a,r,u){return{h:dg(a.h,r.h,u),c:zt(a.c,r.c,u),l:zt(a.l,r.l,u),alpha:zt(a.alpha,r.alpha,u)}}};var Hd=Object.freeze({__proto__:null,lab:Xa,hcl:Ya});class or{constructor(r,u,f,g,v){this.type=r,this.operator=u,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,T]of v)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(r,u,f,g){let v=0;if(r.name==="exponential")v=Cu(u,r.base,f,g);else if(r.name==="linear")v=Cu(u,1,f,g);else if(r.name==="cubic-bezier"){const b=r.controlPoints;v=new y(b[0],b[1],b[2],b[3]).solve(Cu(u,1,f,g))}return v}static parse(r,u){let[f,g,v,...b]=r;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(z=>typeof z!="number"||z<0||z>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(v=u.parse(v,2,He),!v)return null;const T=[];let A=null;f==="interpolate-hcl"||f==="interpolate-lab"?A=Kn:u.expectedType&&u.expectedType.kind!=="value"&&(A=u.expectedType);for(let L=0;L<b.length;L+=2){const z=b[L],O=b[L+1],V=L+3,$=L+4;if(typeof z!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(T.length&&T[T.length-1][0]>=z)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const X=u.parse(O,$,A);if(!X)return null;A=A||X.type,T.push([z,X])}return A.kind==="number"||A.kind==="color"||A.kind==="padding"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new or(A,f,g,v,T):u.error(`Type ${en(A)} is not interpolatable.`)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const v=u.length;if(g>=u[v-1])return f[v-1].evaluate(r);const b=Bt(u,g),T=or.interpolationFactor(this.interpolation,g,u[b],u[b+1]),A=f[b].evaluate(r),L=f[b+1].evaluate(r);return this.operator==="interpolate"?Fn[this.type.kind.toLowerCase()](A,L,T):this.operator==="interpolate-hcl"?Ya.reverse(Ya.interpolate(Ya.forward(A),Ya.forward(L),T)):Xa.reverse(Xa.interpolate(Xa.forward(A),Xa.forward(L),T))}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Cu(a,r,u,f){const g=f-u,v=a-u;return g===0?0:r===1?v/g:(Math.pow(r,v)-1)/(Math.pow(r,g)-1)}class Jl{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expectected at least one argument.");let f=null;const g=u.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const T of r.slice(1)){const A=u.parse(T,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!A)return null;f=f||A.type,v.push(A)}if(!f)throw new Error("No output type");const b=g&&v.some(T=>xr(g,T.type));return new Jl(b?Ct:f,v)}evaluate(r){let u,f=null,g=0;for(const v of this.args)if(g++,f=v.evaluate(r),f&&f instanceof ge&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f!==null)break;return f}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class Ql{constructor(r,u){this.type=u.type,this.bindings=[].concat(r),this.result=u}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const u of this.bindings)r(u[1]);r(this.result)}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const f=[];for(let v=1;v<r.length-1;v+=2){const b=r[v];if(typeof b!="string")return u.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=u.parse(r[v+1],v+1);if(!T)return null;f.push([b,T])}const g=u.parse(r[r.length-1],r.length-1,u.expectedType,f);return g?new Ql(f,g):null}outputDefined(){return this.result.outputDefined()}}class Iu{constructor(r,u,f){this.type=r,this.index=u,this.input=f}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,He),g=u.parse(r[2],2,si(u.expectedType||Ct));return f&&g?new Iu(g.type.itemType,f,g):null}evaluate(r){const u=this.index.evaluate(r),f=this.input.evaluate(r);if(u<0)throw new Ye(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Ye(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Ye(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Mu{constructor(r,u){this.type=It,this.needle=r,this.haystack=u}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Ct),g=u.parse(r[2],2,Ct);return f&&g?br(f.type,[It,Mt,He,os,Ct])?new Mu(f,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${en(f.type)} instead`):null}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!f)return!1;if(!ws(u,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${en(Pe(u))} instead.`);if(!ws(f,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${en(Pe(f))} instead.`);return f.indexOf(u)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class ec{constructor(r,u,f){this.type=He,this.needle=r,this.haystack=u,this.fromIndex=f}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Ct),g=u.parse(r[2],2,Ct);if(!f||!g)return null;if(!br(f.type,[It,Mt,He,os,Ct]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${en(f.type)} instead`);if(r.length===4){const v=u.parse(r[3],3,He);return v?new ec(f,g,v):null}return new ec(f,g)}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!ws(u,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${en(Pe(u))} instead.`);if(!ws(f,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${en(Pe(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return f.indexOf(u,g)}return f.indexOf(u)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Lu{constructor(r,u,f,g,v,b){this.inputType=r,this.type=u,this.input=f,this.cases=g,this.outputs=v,this.otherwise=b}static parse(r,u){if(r.length<5)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return u.error("Expected an even number of arguments.");let f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v={},b=[];for(let L=2;L<r.length-1;L+=2){let z=r[L];const O=r[L+1];Array.isArray(z)||(z=[z]);const V=u.concat(L);if(z.length===0)return V.error("Expected at least one branch label.");for(const X of z){if(typeof X!="number"&&typeof X!="string")return V.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return V.error("Numeric branch labels must be integer values.");if(f){if(V.checkSubtype(f,Pe(X)))return null}else f=Pe(X);if(v[String(X)]!==void 0)return V.error("Branch labels must be unique.");v[String(X)]=b.length}const $=u.parse(O,L,g);if(!$)return null;g=g||$.type,b.push($)}const T=u.parse(r[1],1,Ct);if(!T)return null;const A=u.parse(r[r.length-1],r.length-1,g);return A?T.type.kind!=="value"&&u.concat(1).checkSubtype(f,T.type)?null:new Lu(f,g,T,v,b,A):null}evaluate(r){const u=this.input.evaluate(r);return(Pe(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class ku{constructor(r,u,f){this.type=r,this.branches=u,this.otherwise=f}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const g=[];for(let b=1;b<r.length-1;b+=2){const T=u.parse(r[b],b,It);if(!T)return null;const A=u.parse(r[b+1],b+1,f);if(!A)return null;g.push([T,A]),f=f||A.type}const v=u.parse(r[r.length-1],r.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new ku(f,g,v)}evaluate(r){for(const[u,f]of this.branches)if(u.evaluate(r))return f.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[u,f]of this.branches)r(u),r(f);r(this.otherwise)}outputDefined(){return this.branches.every(([r,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class tc{constructor(r,u,f,g){this.type=r,this.input=u,this.beginIndex=f,this.endIndex=g}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,Ct),g=u.parse(r[2],2,He);if(!f||!g)return null;if(!br(f.type,[si(Ct),Mt,Ct]))return u.error(`Expected first argument to be of type array or string, but found ${en(f.type)} instead`);if(r.length===4){const v=u.parse(r[3],3,He);return v?new tc(f.type,f,g,v):null}return new tc(f.type,f,g)}evaluate(r){const u=this.input.evaluate(r),f=this.beginIndex.evaluate(r);if(!ws(u,["string","array"]))throw new Ye(`Expected first argument to be of type array or string, but found ${en(Pe(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return u.slice(f,g)}return u.slice(f)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function $d(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function qd(a,r,u,f){return f.compare(r,u)===0}function na(a,r,u){const f=a!=="=="&&a!=="!=";return class jS{constructor(v,b,T){this.type=It,this.lhs=v,this.rhs=b,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}static parse(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");const T=v[0];let A=b.parse(v[1],1,Ct);if(!A)return null;if(!$d(T,A.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${en(A.type)}'.`);let L=b.parse(v[2],2,Ct);if(!L)return null;if(!$d(T,L.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${en(L.type)}'.`);if(A.type.kind!==L.type.kind&&A.type.kind!=="value"&&L.type.kind!=="value")return b.error(`Cannot compare types '${en(A.type)}' and '${en(L.type)}'.`);f&&(A.type.kind==="value"&&L.type.kind!=="value"?A=new dt(L.type,[A]):A.type.kind!=="value"&&L.type.kind==="value"&&(L=new dt(A.type,[L])));let z=null;if(v.length===4){if(A.type.kind!=="string"&&L.type.kind!=="string"&&A.type.kind!=="value"&&L.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(z=b.parse(v[3],3,rr),!z)return null}return new jS(A,L,z)}evaluate(v){const b=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const A=Pe(b),L=Pe(T);if(A.kind!==L.kind||A.kind!=="string"&&A.kind!=="number")throw new Ye(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${A.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const A=Pe(b),L=Pe(T);if(A.kind!=="string"||L.kind!=="string")return r(v,b,T)}return this.collator?u(v,b,T,this.collator.evaluate(v)):r(v,b,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const fg=na("==",function(a,r,u){return r===u},qd),pg=na("!=",function(a,r,u){return r!==u},function(a,r,u,f){return!qd(0,r,u,f)}),mg=na("<",function(a,r,u){return r<u},function(a,r,u,f){return f.compare(r,u)<0}),gg=na(">",function(a,r,u){return r>u},function(a,r,u,f){return f.compare(r,u)>0}),_g=na("<=",function(a,r,u){return r<=u},function(a,r,u,f){return f.compare(r,u)<=0}),yg=na(">=",function(a,r,u){return r>=u},function(a,r,u,f){return f.compare(r,u)>=0});class Ru{constructor(r,u,f,g,v){this.type=Mt,this.number=r,this.locale=u,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(r,u){if(r.length!==3)return u.error("Expected two arguments.");const f=u.parse(r[1],1,He);if(!f)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=u.parse(g.locale,1,Mt),!v))return null;let b=null;if(g.currency&&(b=u.parse(g.currency,1,Mt),!b))return null;let T=null;if(g["min-fraction-digits"]&&(T=u.parse(g["min-fraction-digits"],1,He),!T))return null;let A=null;return g["max-fraction-digits"]&&(A=u.parse(g["max-fraction-digits"],1,He),!A)?null:new Ru(f,v,b,T,A)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class nc{constructor(r){this.type=Wn,this.sections=r}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const g=[];let v=!1;for(let b=1;b<=r.length-1;++b){const T=r[b];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let A=null;if(T["font-scale"]&&(A=u.parse(T["font-scale"],1,He),!A))return null;let L=null;if(T["text-font"]&&(L=u.parse(T["text-font"],1,si(Mt)),!L))return null;let z=null;if(T["text-color"]&&(z=u.parse(T["text-color"],1,Kn),!z))return null;const O=g[g.length-1];O.scale=A,O.font=L,O.textColor=z}else{const A=u.parse(r[b],1,Ct);if(!A)return null;const L=A.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:A,scale:null,font:null,textColor:null})}}return new nc(g)}evaluate(r){return new he(this.sections.map(u=>{const f=u.content.evaluate(r);return Pe(f)===Ln?new me("",f,null,null,null):new me(rt(f),null,u.scale?u.scale.evaluate(r):null,u.font?u.font.evaluate(r).join(","):null,u.textColor?u.textColor.evaluate(r):null)}))}eachChild(r){for(const u of this.sections)r(u.content),u.scale&&r(u.scale),u.font&&r(u.font),u.textColor&&r(u.textColor)}outputDefined(){return!1}}class zu{constructor(r){this.type=Ln,this.input=r}static parse(r,u){if(r.length!==2)return u.error("Expected two arguments.");const f=u.parse(r[1],1,Mt);return f?new zu(f):u.error("No image name provided.")}evaluate(r){const u=this.input.evaluate(r),f=ge.fromString(u);return f&&r.availableImages&&(f.available=r.availableImages.indexOf(u)>-1),f}eachChild(r){r(this.input)}outputDefined(){return!1}}class Du{constructor(r){this.type=He,this.input=r}static parse(r,u){if(r.length!==2)return u.error(`Expected 1 argument, but found ${r.length-1} instead.`);const f=u.parse(r[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${en(f.type)} instead.`):new Du(f):null}evaluate(r){const u=this.input.evaluate(r);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Ye(`Expected value to be of type string or array, but found ${en(Pe(u))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const ia={"==":fg,"!=":pg,">":gg,"<":mg,">=":yg,"<=":_g,array:dt,at:Iu,boolean:dt,case:ku,coalesce:Jl,collator:dn,format:nc,image:zu,in:Mu,"index-of":ec,interpolate:or,"interpolate-hcl":or,"interpolate-lab":or,length:Du,let:Ql,literal:lt,match:Lu,number:dt,"number-format":Ru,object:dt,slice:tc,step:En,string:dt,"to-boolean":vt,"to-color":vt,"to-number":vt,"to-string":vt,var:Ae,within:Es};function Zd(a,[r,u,f,g]){r=r.evaluate(a),u=u.evaluate(a),f=f.evaluate(a);const v=g?g.evaluate(a):1,b=Ce(r,u,f,v);if(b)throw new Ye(b);return new J(r/255*v,u/255*v,f/255*v,v)}function Xd(a,r){return a in r}function ic(a,r){const u=r[a];return u===void 0?null:u}function vo(a){return{type:a}}function Yd(a){return{result:"success",value:a}}function ra(a){return{result:"error",value:a}}function gn(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Kd(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Wt(a){return!!a.expression&&a.expression.interpolated}function Qt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function pn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function vn(a){return a}function Ka(a,r){const u=r.type==="color",f=a.stops&&typeof a.stops[0][0]=="object",g=f||!(f||a.property!==void 0),v=a.type||(Wt(r)?"exponential":"interval");if(u||r.type==="padding"){const L=u?J.parse:le.parse;(a=Ei({},a)).stops&&(a.stops=a.stops.map(z=>[z[0],L(z[1])])),a.default=L(a.default?a.default:r.default)}if(a.colorSpace&&a.colorSpace!=="rgb"&&!Hd[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,T,A;if(v==="exponential")b=Jd;else if(v==="interval")b=xg;else if(v==="categorical"){b=vg,T=Object.create(null);for(const L of a.stops)T[L[0]]=L[1];A=typeof a.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);b=bg}if(f){const L={},z=[];for(let $=0;$<a.stops.length;$++){const X=a.stops[$],ae=X[0].zoom;L[ae]===void 0&&(L[ae]={zoom:ae,type:a.type,property:a.property,default:a.default,stops:[]},z.push(ae)),L[ae].stops.push([X[0].value,X[1]])}const O=[];for(const $ of z)O.push([L[$].zoom,Ka(L[$],r)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:or.interpolationFactor.bind(void 0,V),zoomStops:O.map($=>$[0]),evaluate:({zoom:$},X)=>Jd({stops:O,base:a.base},r,$).evaluate($,X)}}if(g){const L=v==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:or.interpolationFactor.bind(void 0,L),zoomStops:a.stops.map(z=>z[0]),evaluate:({zoom:z})=>b(a,r,z,T,A)}}return{kind:"source",evaluate(L,z){const O=z&&z.properties?z.properties[a.property]:void 0;return O===void 0?sa(a.default,r.default):b(a,r,O,T,A)}}}function sa(a,r,u){return a!==void 0?a:r!==void 0?r:u!==void 0?u:void 0}function vg(a,r,u,f,g){return sa(typeof u===g?f[u]:void 0,a.default,r.default)}function xg(a,r,u){if(Qt(u)!=="number")return sa(a.default,r.default);const f=a.stops.length;if(f===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[f-1][0])return a.stops[f-1][1];const g=Bt(a.stops.map(v=>v[0]),u);return a.stops[g][1]}function Jd(a,r,u){const f=a.base!==void 0?a.base:1;if(Qt(u)!=="number")return sa(a.default,r.default);const g=a.stops.length;if(g===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[g-1][0])return a.stops[g-1][1];const v=Bt(a.stops.map(z=>z[0]),u),b=function(z,O,V,$){const X=$-V,ae=z-V;return X===0?0:O===1?ae/X:(Math.pow(O,ae)-1)/(Math.pow(O,X)-1)}(u,f,a.stops[v][0],a.stops[v+1][0]),T=a.stops[v][1],A=a.stops[v+1][1];let L=Fn[r.type]||vn;if(a.colorSpace&&a.colorSpace!=="rgb"){const z=Hd[a.colorSpace];L=(O,V)=>z.reverse(z.interpolate(z.forward(O),z.forward(V),b))}return typeof T.evaluate=="function"?{evaluate(...z){const O=T.evaluate.apply(void 0,z),V=A.evaluate.apply(void 0,z);if(O!==void 0&&V!==void 0)return L(O,V,b)}}:L(T,A,b)}function bg(a,r,u){switch(r.type){case"color":u=J.parse(u);break;case"formatted":u=he.fromString(u.toString());break;case"resolvedImage":u=ge.fromString(u.toString());break;case"padding":u=le.parse(u);break;default:Qt(u)===r.type||r.type==="enum"&&r.values[u]||(u=void 0)}return sa(u,a.default,r.default)}Vt.register(ia,{error:[{kind:"error"},[Mt],(a,[r])=>{throw new Ye(r.evaluate(a))}],typeof:[Mt,[Ct],(a,[r])=>en(Pe(r.evaluate(a)))],"to-rgba":[si(He,4),[Kn],(a,[r])=>r.evaluate(a).toArray()],rgb:[Kn,[He,He,He],Zd],rgba:[Kn,[He,He,He,He],Zd],has:{type:It,overloads:[[[Mt],(a,[r])=>Xd(r.evaluate(a),a.properties())],[[Mt,zr],(a,[r,u])=>Xd(r.evaluate(a),u.evaluate(a))]]},get:{type:Ct,overloads:[[[Mt],(a,[r])=>ic(r.evaluate(a),a.properties())],[[Mt,zr],(a,[r,u])=>ic(r.evaluate(a),u.evaluate(a))]]},"feature-state":[Ct,[Mt],(a,[r])=>ic(r.evaluate(a),a.featureState||{})],properties:[zr,[],a=>a.properties()],"geometry-type":[Mt,[],a=>a.geometryType()],id:[Ct,[],a=>a.id()],zoom:[He,[],a=>a.globals.zoom],"heatmap-density":[He,[],a=>a.globals.heatmapDensity||0],"line-progress":[He,[],a=>a.globals.lineProgress||0],accumulated:[Ct,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[He,vo(He),(a,r)=>{let u=0;for(const f of r)u+=f.evaluate(a);return u}],"*":[He,vo(He),(a,r)=>{let u=1;for(const f of r)u*=f.evaluate(a);return u}],"-":{type:He,overloads:[[[He,He],(a,[r,u])=>r.evaluate(a)-u.evaluate(a)],[[He],(a,[r])=>-r.evaluate(a)]]},"/":[He,[He,He],(a,[r,u])=>r.evaluate(a)/u.evaluate(a)],"%":[He,[He,He],(a,[r,u])=>r.evaluate(a)%u.evaluate(a)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(a,[r,u])=>Math.pow(r.evaluate(a),u.evaluate(a))],sqrt:[He,[He],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[He,[He],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[He,[He],(a,[r])=>Math.log(r.evaluate(a))],log2:[He,[He],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[He,[He],(a,[r])=>Math.sin(r.evaluate(a))],cos:[He,[He],(a,[r])=>Math.cos(r.evaluate(a))],tan:[He,[He],(a,[r])=>Math.tan(r.evaluate(a))],asin:[He,[He],(a,[r])=>Math.asin(r.evaluate(a))],acos:[He,[He],(a,[r])=>Math.acos(r.evaluate(a))],atan:[He,[He],(a,[r])=>Math.atan(r.evaluate(a))],min:[He,vo(He),(a,r)=>Math.min(...r.map(u=>u.evaluate(a)))],max:[He,vo(He),(a,r)=>Math.max(...r.map(u=>u.evaluate(a)))],abs:[He,[He],(a,[r])=>Math.abs(r.evaluate(a))],round:[He,[He],(a,[r])=>{const u=r.evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[He,[He],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[He,[He],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[It,[Mt,Ct],(a,[r,u])=>a.properties()[r.value]===u.value],"filter-id-==":[It,[Ct],(a,[r])=>a.id()===r.value],"filter-type-==":[It,[Mt],(a,[r])=>a.geometryType()===r.value],"filter-<":[It,[Mt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<g}],"filter-id-<":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<f}],"filter->":[It,[Mt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>g}],"filter-id->":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>f}],"filter-<=":[It,[Mt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<=f}],"filter->=":[It,[Mt,Ct],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[It,[Ct],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>=f}],"filter-has":[It,[Ct],(a,[r])=>r.value in a.properties()],"filter-has-id":[It,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[It,[si(Mt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[It,[si(Ct)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[It,[Mt,si(Ct)],(a,[r,u])=>u.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[It,[Mt,si(Ct)],(a,[r,u])=>function(f,g,v,b){for(;v<=b;){const T=v+b>>1;if(g[T]===f)return!0;g[T]>f?b=T-1:v=T+1}return!1}(a.properties()[r.value],u.value,0,u.value.length-1)],all:{type:It,overloads:[[[It,It],(a,[r,u])=>r.evaluate(a)&&u.evaluate(a)],[vo(It),(a,r)=>{for(const u of r)if(!u.evaluate(a))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(a,[r,u])=>r.evaluate(a)||u.evaluate(a)],[vo(It),(a,r)=>{for(const u of r)if(u.evaluate(a))return!0;return!1}]]},"!":[It,[It],(a,[r])=>!r.evaluate(a)],"is-supported-script":[It,[Mt],(a,[r])=>{const u=a.globals&&a.globals.isSupportedScript;return!u||u(r.evaluate(a))}],upcase:[Mt,[Mt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Mt,[Mt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Mt,vo(Ct),(a,r)=>r.map(u=>rt(u.evaluate(a))).join("")],"resolved-locale":[Mt,[rr],(a,[r])=>r.evaluate(a).resolvedLocale()]});class rc{constructor(r,u){this.expression=r,this._warningHistory={},this._evaluator=new Ft,this._defaultValue=u?function(f){return f.type==="color"&&pn(f.default)?new J(0,0,0,0):f.type==="color"?J.parse(f.default)||null:f.type==="padding"?le.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._evaluator.globals=r,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(r,u,f,g,v,b){this._evaluator.globals=r,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ye(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Ja(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ia}function Qa(a,r){const u=new Ne(ia,[],r?function(g){const v={color:Kn,string:Mt,number:He,enum:Mt,boolean:It,formatted:Wn,padding:Gs,resolvedImage:Ln};return g.type==="array"?si(v[g.value]||Ct,g.length):v[g.type]}(r):void 0),f=u.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Yd(new rc(f,r)):ra(u.errors)}class el{constructor(r,u){this.kind=r,this._styleExpression=u,this.isStateDependent=r!=="constant"&&!Q(u.expression)}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,v,b)}evaluate(r,u,f,g,v,b){return this._styleExpression.evaluate(r,u,f,g,v,b)}}class Ou{constructor(r,u,f,g){this.kind=r,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=r!=="camera"&&!Q(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,u,f,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,v,b)}evaluate(r,u,f,g,v,b){return this._styleExpression.evaluate(r,u,f,g,v,b)}interpolationFactor(r,u,f){return this.interpolationType?or.interpolationFactor(this.interpolationType,r,u,f):0}}function Qd(a,r){const u=Qa(a,r);if(u.result==="error")return u;const f=u.value.expression,g=H(f);if(!g&&!gn(r))return ra([new Ri("","data expressions not supported")]);const v=ue(f,["zoom"]);if(!v&&!Kd(r))return ra([new Ri("","zoom expressions not supported")]);const b=oc(f);return b||v?b instanceof Ri?ra([b]):b instanceof or&&!Wt(r)?ra([new Ri("",'"interpolate" expressions cannot be used with this property')]):Yd(b?new Ou(g?"camera":"composite",u.value,b.labels,b instanceof or?b.interpolation:void 0):new el(g?"constant":"source",u.value)):ra([new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sc{constructor(r,u){this._parameters=r,this._specification=u,Ei(this,Ka(this._parameters,this._specification))}static deserialize(r){return new sc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function oc(a){let r=null;if(a instanceof Ql)r=oc(a.result);else if(a instanceof Jl){for(const u of a.args)if(r=oc(u),r)break}else(a instanceof En||a instanceof or)&&a.input instanceof Vt&&a.input.name==="zoom"&&(r=a);return r instanceof Ri||a.eachChild(u=>{const f=oc(u);f instanceof Ri?r=f:!r&&f?r=new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&f&&r!==f&&(r=new Ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Fr(a){const r=a.key,u=a.value,f=a.valueSpec||{},g=a.objectElementValidators||{},v=a.style,b=a.styleSpec;let T=[];const A=Qt(u);if(A!=="object")return[new $e(r,u,`object expected, ${A} found`)];for(const L in u){const z=L.split(".")[0],O=f[z]||f["*"];let V;if(g[z])V=g[z];else if(f[z])V=lr;else if(g["*"])V=g["*"];else{if(!f["*"]){T.push(new $e(r,u[L],`unknown property "${L}"`));continue}V=lr}T=T.concat(V({key:(r&&`${r}.`)+L,value:u[L],valueSpec:O,style:v,styleSpec:b,object:u,objectKey:L},u))}for(const L in f)g[L]||f[L].required&&f[L].default===void 0&&u[L]===void 0&&T.push(new $e(r,u,`missing required property "${L}"`));return T}function ef(a){const r=a.value,u=a.valueSpec,f=a.style,g=a.styleSpec,v=a.key,b=a.arrayElementValidator||lr;if(Qt(r)!=="array")return[new $e(v,r,`array expected, ${Qt(r)} found`)];if(u.length&&r.length!==u.length)return[new $e(v,r,`array length ${u.length} expected, length ${r.length} found`)];if(u["min-length"]&&r.length<u["min-length"])return[new $e(v,r,`array length at least ${u["min-length"]} expected, length ${r.length} found`)];let T={type:u.value,values:u.values};g.$version<7&&(T.function=u.function),Qt(u.value)==="object"&&(T=u.value);let A=[];for(let L=0;L<r.length;L++)A=A.concat(b({array:r,arrayIndex:L,value:r[L],valueSpec:T,style:f,styleSpec:g,key:`${v}[${L}]`}));return A}function Fu(a){const r=a.key,u=a.value,f=a.valueSpec;let g=Qt(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new $e(r,u,`number expected, ${g} found`)]:"minimum"in f&&u<f.minimum?[new $e(r,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new $e(r,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function tf(a){const r=a.valueSpec,u=Ut(a.value.type);let f,g,v,b={};const T=u!=="categorical"&&a.value.property===void 0,A=!T,L=Qt(a.value.stops)==="array"&&Qt(a.value.stops[0])==="array"&&Qt(a.value.stops[0][0])==="object",z=Fr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function($){if(u==="identity")return[new $e($.key,$.value,'identity function may not have a "stops" property')];let X=[];const ae=$.value;return X=X.concat(ef({key:$.key,value:ae,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:O})),Qt(ae)==="array"&&ae.length===0&&X.push(new $e($.key,ae,"array must have at least one stop")),X},default:function($){return lr({key:$.key,value:$.value,valueSpec:r,style:$.style,styleSpec:$.styleSpec})}}});return u==="identity"&&T&&z.push(new $e(a.key,a.value,'missing required property "property"')),u==="identity"||a.value.stops||z.push(new $e(a.key,a.value,'missing required property "stops"')),u==="exponential"&&a.valueSpec.expression&&!Wt(a.valueSpec)&&z.push(new $e(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(A&&!gn(a.valueSpec)?z.push(new $e(a.key,a.value,"property functions not supported")):T&&!Kd(a.valueSpec)&&z.push(new $e(a.key,a.value,"zoom functions not supported"))),u!=="categorical"&&!L||a.value.property!==void 0||z.push(new $e(a.key,a.value,'"property" property is required')),z;function O($){let X=[];const ae=$.value,oe=$.key;if(Qt(ae)!=="array")return[new $e(oe,ae,`array expected, ${Qt(ae)} found`)];if(ae.length!==2)return[new $e(oe,ae,`array length 2 expected, length ${ae.length} found`)];if(L){if(Qt(ae[0])!=="object")return[new $e(oe,ae,`object expected, ${Qt(ae[0])} found`)];if(ae[0].zoom===void 0)return[new $e(oe,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new $e(oe,ae,"object stop key must have value")];if(v&&v>Ut(ae[0].zoom))return[new $e(oe,ae[0].zoom,"stop zoom values must appear in ascending order")];Ut(ae[0].zoom)!==v&&(v=Ut(ae[0].zoom),g=void 0,b={}),X=X.concat(Fr({key:`${oe}[0]`,value:ae[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Fu,value:V}}))}else X=X.concat(V({key:`${oe}[0]`,value:ae[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},ae));return Ja(Wi(ae[1]))?X.concat([new $e(`${oe}[1]`,ae[1],"expressions are not allowed in function stops.")]):X.concat(lr({key:`${oe}[1]`,value:ae[1],valueSpec:r,style:$.style,styleSpec:$.styleSpec}))}function V($,X){const ae=Qt($.value),oe=Ut($.value),ve=$.value!==null?$.value:X;if(f){if(ae!==f)return[new $e($.key,ve,`${ae} stop domain type must match previous stop domain type ${f}`)]}else f=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new $e($.key,ve,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&u!=="categorical"){let Se=`number expected, ${ae} found`;return gn(r)&&u===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e($.key,ve,Se)]}return u!=="categorical"||ae!=="number"||isFinite(oe)&&Math.floor(oe)===oe?u!=="categorical"&&ae==="number"&&g!==void 0&&oe<g?[new $e($.key,ve,"stop domain values must appear in ascending order")]:(g=oe,u==="categorical"&&oe in b?[new $e($.key,ve,"stop domain values must be unique")]:(b[oe]=!0,[])):[new $e($.key,ve,`integer expected, found ${oe}`)]}}function xo(a){const r=(a.expressionContext==="property"?Qd:Qa)(Wi(a.value),a.valueSpec);if(r.result==="error")return r.value.map(f=>new $e(`${a.key}${f.key}`,a.value,f.message));const u=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!u.outputDefined())return[new $e(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Q(u))return[new $e(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Q(u))return[new $e(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ue(u,["zoom","feature-state"]))return[new $e(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!H(u))return[new $e(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tl(a){const r=a.key,u=a.value,f=a.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Ut(u))===-1&&g.push(new $e(r,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Ut(u))===-1&&g.push(new $e(r,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function oa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!oa(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const wg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ac(a){if(a==null)return{filter:()=>!0,needGeometry:!1};oa(a)||(a=nl(a));const r=Qa(a,wg);if(r.result==="error")throw new Error(r.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,g)=>r.value.evaluate(u,f,{},g),needGeometry:rf(a)}}function nf(a,r){return a<r?-1:a>r?1:0}function rf(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(rf(a[r]))return!0;return!1}function nl(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Bu(a[1],a[2],"=="):r==="!="?aa(Bu(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Bu(a[1],a[2],r):r==="any"?(u=a.slice(1),["any"].concat(u.map(nl))):r==="all"?["all"].concat(a.slice(1).map(nl)):r==="none"?["all"].concat(a.slice(1).map(nl).map(aa)):r==="in"?lc(a[1],a.slice(2)):r==="!in"?aa(lc(a[1],a.slice(2))):r==="has"?il(a[1]):r==="!has"?aa(il(a[1])):r!=="within"||a;var u}function Bu(a,r,u){switch(a){case"$type":return[`filter-type-${u}`,r];case"$id":return[`filter-id-${u}`,r];default:return[`filter-${u}`,a,r]}}function lc(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(u=>typeof u!=typeof r[0])?["filter-in-large",a,["literal",r.sort(nf)]]:["filter-in-small",a,["literal",r]]}}function il(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function aa(a){return["!",a]}function rl(a){return oa(Wi(a.value))?xo(Ei({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):sf(a)}function sf(a){const r=a.value,u=a.key;if(Qt(r)!=="array")return[new $e(u,r,`array expected, ${Qt(r)} found`)];const f=a.styleSpec;let g,v=[];if(r.length<1)return[new $e(u,r,"filter array must have at least 1 element")];switch(v=v.concat(tl({key:`${u}[0]`,value:r[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ut(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Ut(r[1])==="$type"&&v.push(new $e(u,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new $e(u,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Qt(r[1]),g!=="string"&&v.push(new $e(`${u}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=Qt(r[b]),Ut(r[1])==="$type"?v=v.concat(tl({key:`${u}[${b}]`,value:r[b],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new $e(`${u}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)v=v.concat(sf({key:`${u}[${b}]`,value:r[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Qt(r[1]),r.length!==2?v.push(new $e(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new $e(`${u}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=Qt(r[1]),r.length!==2?v.push(new $e(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new $e(`${u}[1]`,r[1],`object expected, ${g} found`))}return v}function sl(a,r){const u=a.key,f=a.style,g=a.styleSpec,v=a.value,b=a.objectKey,T=g[`${r}_${a.layerType}`];if(!T)return[];const A=b.match(/^(.*)-transition$/);if(r==="paint"&&A&&T[A[1]]&&T[A[1]].transition)return lr({key:u,value:v,valueSpec:g.transition,style:f,styleSpec:g});const L=a.valueSpec||T[b];if(!L)return[new $e(u,v,`unknown property "${b}"`)];let z;if(Qt(v)==="string"&&gn(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(v)))return[new $e(u,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const O=[];return a.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&O.push(new $e(u,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&pn(Wi(v))&&Ut(v.type)==="identity"&&O.push(new $e(u,v,'"text-font" does not support identity functions'))),O.concat(lr({key:a.key,value:v,valueSpec:L,style:f,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:b}))}function of(a){return sl(a,"paint")}function af(a){return sl(a,"layout")}function lf(a){let r=[];const u=a.value,f=a.key,g=a.style,v=a.styleSpec;u.type||u.ref||r.push(new $e(f,u,'either "type" or "ref" is required'));let b=Ut(u.type);const T=Ut(u.ref);if(u.id){const A=Ut(u.id);for(let L=0;L<a.arrayIndex;L++){const z=g.layers[L];Ut(z.id)===A&&r.push(new $e(f,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let A;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&r.push(new $e(f,u[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{Ut(L.id)===T&&(A=L)}),A?A.ref?r.push(new $e(f,u.ref,"ref cannot reference another ref layer")):b=Ut(A.type):r.push(new $e(f,u.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(u.source){const A=g.sources&&g.sources[u.source],L=A&&Ut(A.type);A?L==="vector"&&b==="raster"?r.push(new $e(f,u.source,`layer "${u.id}" requires a raster source`)):L==="raster"&&b!=="raster"?r.push(new $e(f,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&b!=="hillshade"?r.push(new $e(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!u.paint||!u.paint["line-gradient"]||L==="geojson"&&A.lineMetrics||r.push(new $e(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new $e(f,u,`layer "${u.id}" must specify a "source-layer"`)):r.push(new $e(f,u.source,`source "${u.source}" not found`))}else r.push(new $e(f,u,'missing required property "source"'));return r=r.concat(Fr({key:f,value:u,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lr({key:`${f}.type`,value:u.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"}),filter:rl,layout:A=>Fr({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":L=>af(Ei({layerType:b},L))}}),paint:A=>Fr({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":L=>of(Ei({layerType:b},L))}})}})),r}function la(a){const r=a.value,u=a.key,f=Qt(r);return f!=="string"?[new $e(u,r,`string expected, ${f} found`)]:[]}const cf={promoteId:function({key:a,value:r}){if(Qt(r)==="string")return la({key:a,value:r});{const u=[];for(const f in r)u.push(...la({key:`${a}.${f}`,value:r[f]}));return u}}};function ol(a){const r=a.value,u=a.key,f=a.styleSpec,g=a.style;if(!r.type)return[new $e(u,r,'"type" is required')];const v=Ut(r.type);let b;switch(v){case"vector":case"raster":case"raster-dem":return b=Fr({key:u,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:cf}),b;case"geojson":if(b=Fr({key:u,value:r,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:cf}),r.cluster)for(const T in r.clusterProperties){const[A,L]=r.clusterProperties[T],z=typeof A=="string"?[A,["accumulated"],["get",T]]:A;b.push(...xo({key:`${u}.${T}.map`,value:L,expressionContext:"cluster-map"})),b.push(...xo({key:`${u}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return Fr({key:u,value:r,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Fr({key:u,value:r,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new $e(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tl({key:`${u}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:f})}}function al(a){const r=a.value,u=a.styleSpec,f=u.light,g=a.style;let v=[];const b=Qt(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new $e("light",r,`object expected, ${b} found`)]),v;for(const T in r){const A=T.match(/^(.*)-transition$/);v=v.concat(A&&f[A[1]]&&f[A[1]].transition?lr({key:T,value:r[T],valueSpec:u.transition,style:g,styleSpec:u}):f[T]?lr({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new $e(T,r[T],`unknown property "${T}"`)])}return v}function ar(a){const r=a.value,u=a.styleSpec,f=u.terrain,g=a.style;let v=[];const b=Qt(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new $e("terrain",r,`object expected, ${b} found`)]),v;for(const T in r)v=v.concat(f[T]?lr({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new $e(T,r[T],`unknown property "${T}"`)]);return v}const ll={"*":()=>[],array:ef,boolean:function(a){const r=a.value,u=a.key,f=Qt(r);return f!=="boolean"?[new $e(u,r,`boolean expected, ${f} found`)]:[]},number:Fu,color:function(a){const r=a.key,u=a.value,f=Qt(u);return f!=="string"?[new $e(r,u,`color expected, ${f} found`)]:Hs(u)===null?[new $e(r,u,`color expected, "${u}" found`)]:[]},constants:ss,enum:tl,filter:rl,function:tf,layer:lf,object:Fr,source:ol,light:al,terrain:ar,string:la,formatted:function(a){return la(a).length===0?[]:xo(a)},resolvedImage:function(a){return la(a).length===0?[]:xo(a)},padding:function(a){const r=a.key,u=a.value;if(Qt(u)==="array"){if(u.length<1||u.length>4)return[new $e(r,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let g=[];for(let v=0;v<u.length;v++)g=g.concat(lr({key:`${r}[${v}]`,value:u[v],valueSpec:f}));return g}return Fu({key:r,value:u,valueSpec:{}})}};function lr(a){const r=a.value,u=a.valueSpec,f=a.styleSpec;return u.expression&&pn(Ut(r))?tf(a):u.expression&&Ja(Wi(r))?xo(a):u.type&&ll[u.type]?ll[u.type](a):Fr(Ei({},a,{valueSpec:u.type?f[u.type]:u}))}function Eg(a){const r=a.value,u=a.key,f=la(a);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new $e(u,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new $e(u,r,'"glyphs" url must include a "{range}" token'))),f}function qs(a,r=Me){let u=[];return u=u.concat(lr({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Eg,"*":()=>[]}})),a.constants&&(u=u.concat(ss({key:"constants",value:a.constants,style:a,styleSpec:r}))),uf(u)}function uf(a){return[].concat(a).sort((r,u)=>r.line-u.line)}function Ts(a){return function(...r){return uf(a.apply(this,r))}}qs.source=Ts(ol),qs.light=Ts(al),qs.terrain=Ts(ar),qs.layer=Ts(lf),qs.filter=Ts(rl),qs.paintProperty=Ts(of),qs.layoutProperty=Ts(af);const cl=qs,Nu=cl.light,Tg=cl.paintProperty,Sg=cl.layoutProperty;function cc(a,r){let u=!1;if(r&&r.length)for(const f of r)a.fire(new js(new Error(f.message))),u=!0;return u}class ul{constructor(r,u,f){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const b=new Int32Array(this.arrayBuffer);r=b[0],this.d=(u=b[1])+2*(f=b[2]);for(let A=0;A<this.d*this.d;A++){const L=b[3+A],z=b[3+A+1];g.push(L===z?null:b.subarray(L,z))}const T=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=r,this.padding=f,this.scale=u/r,this.uid=0;const v=f/u*r;this.min=-v,this.max=r+v}insert(r,u,f,g,v){this._forEachCell(u,f,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,u,f,g,v,b){this.cells[v].push(b)}query(r,u,f,g,v){const b=this.min,T=this.max;if(r<=b&&u<=b&&T<=f&&T<=g&&!v)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(r,u,f,g,this._queryCell,A,{},v),A}}_queryCell(r,u,f,g,v,b,T,A){const L=this.cells[v];if(L!==null){const z=this.keys,O=this.bboxes;for(let V=0;V<L.length;V++){const $=L[V];if(T[$]===void 0){const X=4*$;(A?A(O[X+0],O[X+1],O[X+2],O[X+3]):r<=O[X+2]&&u<=O[X+3]&&f>=O[X+0]&&g>=O[X+1])?(T[$]=!0,b.push(z[$])):T[$]=!1}}}}_forEachCell(r,u,f,g,v,b,T,A){const L=this._convertToCellCoord(r),z=this._convertToCellCoord(u),O=this._convertToCellCoord(f),V=this._convertToCellCoord(g);for(let $=L;$<=O;$++)for(let X=z;X<=V;X++){const ae=this.d*X+$;if((!A||A(this._convertFromCellCoord($),this._convertFromCellCoord(X),this._convertFromCellCoord($+1),this._convertFromCellCoord(X+1)))&&v.call(this,r,u,f,g,ae,b,T,A))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,u=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(u+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=u;for(let b=0;b<r.length;b++){const T=r[b];g[3+b]=v,g.set(T,v),v+=T.length}return g[3+r.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+r.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(r,u){const f=r.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(r){return new ul(r.buffer)}}const Ss={};function st(a,r,u={}){if(Ss[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),Ss[a]={klass:r,omit:u.omit||[],shallow:u.shallow||[]}}st("Object",Object),st("TransferableGridIndex",ul),st("Color",J),st("Error",Error),st("AJAXError",Yn),st("ResolvedImage",ge),st("StylePropertyFunction",sc),st("StyleExpression",rc,{omit:["_evaluator"]}),st("ZoomDependentExpression",Ou),st("ZoomConstantExpression",el),st("CompoundExpression",Vt,{omit:["_evaluate"]});for(const a in ia)ia[a]._classRegistryKey||st(`Expression_${a}`,ia[a]);function hf(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function bo(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(hf(a)||kt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const u=a;return r&&r.push(u.buffer),u}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const u=[];for(const f of a)u.push(bo(f,r));return u}if(typeof a=="object"){const u=a.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!Ss[f])throw new Error(`${f} is not registered.`);const g=u.serialize?u.serialize(a,r):{};if(u.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in a){if(!a.hasOwnProperty(v)||Ss[f].omit.indexOf(v)>=0)continue;const b=a[v];g[v]=Ss[f].shallow.indexOf(v)>=0?b:bo(b,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof a)}function Zs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||hf(a)||kt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Zs);if(typeof a=="object"){const r=a.$name||"Object";if(!Ss[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:u}=Ss[r];if(!u)throw new Error(`can't deserialize unregistered class ${r}`);if(u.deserialize)return u.deserialize(a);const f=Object.create(u.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const v=a[g];f[g]=Ss[r].shallow.indexOf(g)>=0?v:Zs(v)}return f}throw new Error("can't deserialize object of type "+typeof a)}class Uu{constructor(){this.first=!0}update(r,u){const f=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=f,!0))}}const Ke={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function uc(a){for(const r of a)if(ju(r.charCodeAt(0)))return!0;return!1}function Ag(a){for(const r of a)if(!Vu(r.charCodeAt(0)))return!1;return!0}function Vu(a){return!(Ke.Arabic(a)||Ke["Arabic Supplement"](a)||Ke["Arabic Extended-A"](a)||Ke["Arabic Presentation Forms-A"](a)||Ke["Arabic Presentation Forms-B"](a))}function ju(a){return!(a!==746&&a!==747&&(a<4352||!(Ke["Bopomofo Extended"](a)||Ke.Bopomofo(a)||Ke["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ke["CJK Compatibility Ideographs"](a)||Ke["CJK Compatibility"](a)||Ke["CJK Radicals Supplement"](a)||Ke["CJK Strokes"](a)||!(!Ke["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ke["CJK Unified Ideographs Extension A"](a)||Ke["CJK Unified Ideographs"](a)||Ke["Enclosed CJK Letters and Months"](a)||Ke["Hangul Compatibility Jamo"](a)||Ke["Hangul Jamo Extended-A"](a)||Ke["Hangul Jamo Extended-B"](a)||Ke["Hangul Jamo"](a)||Ke["Hangul Syllables"](a)||Ke.Hiragana(a)||Ke["Ideographic Description Characters"](a)||Ke.Kanbun(a)||Ke["Kangxi Radicals"](a)||Ke["Katakana Phonetic Extensions"](a)||Ke.Katakana(a)&&a!==12540||!(!Ke["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ke["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ke["Unified Canadian Aboriginal Syllabics"](a)||Ke["Unified Canadian Aboriginal Syllabics Extended"](a)||Ke["Vertical Forms"](a)||Ke["Yijing Hexagram Symbols"](a)||Ke["Yi Syllables"](a)||Ke["Yi Radicals"](a))))}function df(a){return!(ju(a)||function(r){return!!(Ke["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ke["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ke["Letterlike Symbols"](r)||Ke["Number Forms"](r)||Ke["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ke["Control Pictures"](r)&&r!==9251||Ke["Optical Character Recognition"](r)||Ke["Enclosed Alphanumerics"](r)||Ke["Geometric Shapes"](r)||Ke["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ke["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ke["CJK Symbols and Punctuation"](r)||Ke.Katakana(r)||Ke["Private Use Area"](r)||Ke["CJK Compatibility Forms"](r)||Ke["Small Form Variants"](r)||Ke["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function ff(a){return a>=1424&&a<=2303||Ke["Arabic Presentation Forms-A"](a)||Ke["Arabic Presentation Forms-B"](a)}function Pg(a,r){return!(!r&&ff(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ke.Khmer(a))}function pf(a){for(const r of a)if(ff(r.charCodeAt(0)))return!0;return!1}const Gu="deferred",Wu="loading",Hu="loaded";let $u=null,Hi="unavailable",Xs=null;const mf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Hi="error"),$u&&$u(a)};function ca(){qu.fire(new Rr("pluginStateChange",{pluginStatus:Hi,pluginURL:Xs}))}const qu=new vr,hl=function(){return Hi},gf=function(){if(Hi!==Gu||!Xs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Hi=Wu,ca(),Xs&&Gi({url:Xs},a=>{a?mf(a):(Hi=Hu,ca())})},wr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Hi===Hu||wr.applyArabicShaping!=null,isLoading:()=>Hi===Wu,setState(a){if(!Fe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Hi=a.pluginStatus,Xs=a.pluginURL},isParsed(){if(!Fe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return wr.applyArabicShaping!=null&&wr.processBidirectionalText!=null&&wr.processStyledBidirectionalText!=null},getPluginURL(){if(!Fe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Xs}};class xn{constructor(r,u){this.zoom=r,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uu,this.transition={})}isSupportedScript(r){return function(u,f){for(const g of u)if(!Pg(g.charCodeAt(0),f))return!1;return!0}(r,wr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,u=r-Math.floor(r),f=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class dl{constructor(r,u){this.property=r,this.value=u,this.expression=function(f,g){if(pn(f))return new sc(f,g);if(Ja(f)){const v=Qd(f,g);if(v.result==="error")throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=f;return g.type==="color"&&typeof f=="string"?v=J.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)||(v=le.parse(f)),{kind:"constant",evaluate:()=>v}}}(u===void 0?r.specification.default:u,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,u,f){return this.property.possiblyEvaluate(this,r,u,f)}}class hc{constructor(r){this.property=r,this.value=new dl(r,void 0)}transitioned(r,u){return new yf(this.property,this.value,u,G({},r.transition,this.transition),r.now)}untransitioned(){return new yf(this.property,this.value,null,{},0)}}class _f{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return q(this._values[r].value.value)}setValue(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new hc(this._values[r].property)),this._values[r].value=new dl(this._values[r].property,u===null?void 0:q(u))}getTransition(r){return q(this._values[r].transition)}setTransition(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new hc(this._values[r].property)),this._values[r].transition=q(u)||void 0}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f);const g=this.getTransition(u);g!==void 0&&(r[`${u}-transition`]=g)}return r}transitioned(r,u){const f=new vf(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(r,u._values[g]);return f}untransitioned(){const r=new vf(this._properties);for(const u of Object.keys(this._values))r._values[u]=this._values[u].untransitioned();return r}}class yf{constructor(r,u,f,g,v){this.property=r,this.value=u,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(r,u,f){const g=r.now||0,v=this.value.possiblyEvaluate(r,u,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return b.possiblyEvaluate(r,u,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,u,f),v,function(A){if(A<=0)return 0;if(A>=1)return 1;const L=A*A,z=L*A;return 4*(A<.5?z:3*(A-L)+z-.75)}(T))}}return v}}class vf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,u,f){const g=new fl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,u,f);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Cg{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return q(this._values[r].value)}setValue(r,u){this._values[r]=new dl(this._values[r].property,u===null?void 0:q(u))}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f)}return r}possiblyEvaluate(r,u,f){const g=new fl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(r,u,f);return g}}class ls{constructor(r,u,f){this.property=r,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,u,f,g){return this.property.evaluate(this.value,this.parameters,r,u,f,g)}}class fl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ht{constructor(r){this.specification=r}possiblyEvaluate(r,u){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(u)}interpolate(r,u,f){const g=Fn[this.specification.type];return g?g(r,u,f):r}}class wt{constructor(r,u){this.specification=r,this.overrides=u}possiblyEvaluate(r,u,f,g){return new ls(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(u,null,{},f,g)}:r.expression,u)}interpolate(r,u,f){if(r.value.kind!=="constant"||u.value.kind!=="constant")return r;if(r.value.value===void 0||u.value.value===void 0)return new ls(this,{kind:"constant",value:void 0},r.parameters);const g=Fn[this.specification.type];return g?new ls(this,{kind:"constant",value:g(r.value.value,u.value.value,f)},r.parameters):r}evaluate(r,u,f,g,v,b){return r.kind==="constant"?r.value:r.evaluate(u,f,g,v,b)}}class ua extends wt{possiblyEvaluate(r,u,f,g){if(r.value===void 0)return new ls(this,{kind:"constant",value:void 0},u);if(r.expression.kind==="constant"){const v=r.expression.evaluate(u,null,{},f,g),b=r.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(b,b,b,u);return new ls(this,{kind:"constant",value:T},u)}if(r.expression.kind==="camera"){const v=this._calculate(r.expression.evaluate({zoom:u.zoom-1}),r.expression.evaluate({zoom:u.zoom}),r.expression.evaluate({zoom:u.zoom+1}),u);return new ls(this,{kind:"constant",value:v},u)}return new ls(this,r.expression,u)}evaluate(r,u,f,g,v,b){if(r.kind==="source"){const T=r.evaluate(u,f,g,v,b);return this._calculate(T,T,T,u)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(u.zoom)-1},f,g),r.evaluate({zoom:Math.floor(u.zoom)},f,g),r.evaluate({zoom:Math.floor(u.zoom)+1},f,g),u):r.value}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class Zu{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const v=r.expression.evaluate(u,null,{},f,g);return this._calculate(v,v,v,u)}return this._calculate(r.expression.evaluate(new xn(Math.floor(u.zoom-1),u)),r.expression.evaluate(new xn(Math.floor(u.zoom),u)),r.expression.evaluate(new xn(Math.floor(u.zoom+1),u)),u)}}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class Ys{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){return!!r.expression.evaluate(u,null,{},f,g)}interpolate(){return!1}}class pi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in r){const f=r[u];f.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new dl(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new hc(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate({})}}}st("DataDrivenProperty",wt),st("DataConstantProperty",ht),st("CrossFadedDataDrivenProperty",ua),st("CrossFadedProperty",Zu),st("ColorRampProperty",Ys);const Ks="-transition";class cs extends vr{constructor(r,u){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),u.layout&&(this._unevaluatedLayout=new Cg(u.layout)),u.paint)){this._transitionablePaint=new _f(u.paint);for(const f in r.paint)this.setPaintProperty(f,r.paint[f],{validate:!1});for(const f in r.layout)this.setLayoutProperty(f,r.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,u,f={}){u!=null&&this._validate(Sg,`layers.${this.id}.layout.${r}`,r,u,f)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,u):this.visibility=u)}getPaintProperty(r){return r.endsWith(Ks)?this._transitionablePaint.getTransition(r.slice(0,-Ks.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,u,f={}){if(u!=null&&this._validate(Tg,`layers.${this.id}.paint.${r}`,r,u,f))return!1;if(r.endsWith(Ks))return this._transitionablePaint.setTransition(r.slice(0,-Ks.length),u||void 0),!1;{const g=this._transitionablePaint._values[r],v=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(r,u),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value;return A.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(r,T,A)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,u,f){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,u){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,u)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),j(r,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(r,u,f,g,v={}){return(!v||v.validate!==!1)&&cc(this,r.call(cl,{key:u,layerType:this.type,objectKey:f,value:g,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const u=this.paint.get(r);if(u instanceof ls&&gn(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const xf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Js{constructor(r,u){this._structArray=r,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,u){return r._trim(),u&&(r.isTransferred=!0,u.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const u=Object.create(this.prototype);return u.arrayBuffer=r.arrayBuffer,u.length=r.length,u.capacity=r.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hn(a,r=1){let u=0,f=0;return{members:a.map(g=>{const v=xf[g.type].BYTES_PER_ELEMENT,b=u=Xu(u,Math.max(r,v)),T=g.components||1;return f=Math.max(f,v),u+=v*T,{name:g.name,type:g.type,components:T,offset:b}}),size:Xu(u,Math.max(f,r)),alignment:r}}function Xu(a,r){return Math.ceil(a/r)*r}class wo extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.int16[g+0]=u,this.int16[g+1]=f,r}}wo.prototype.bytesPerElement=4,st("StructArrayLayout2i4",wo);class m extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=4*r;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=v,r}}m.prototype.bytesPerElement=8,st("StructArrayLayout4i8",m);class o extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=6*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=v,this.int16[A+4]=b,this.int16[A+5]=T,r}}o.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",o);class h extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=4*r,L=8*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.uint8[L+4]=g,this.uint8[L+5]=v,this.uint8[L+6]=b,this.uint8[L+7]=T,r}}h.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",h);class p extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.float32[g+0]=u,this.float32[g+1]=f,r}}p.prototype.bytesPerElement=8,st("StructArrayLayout2f8",p);class _ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z){const O=this.length;return this.resize(O+1),this.emplace(O,r,u,f,g,v,b,T,A,L,z)}emplace(r,u,f,g,v,b,T,A,L,z,O){const V=10*r;return this.uint16[V+0]=u,this.uint16[V+1]=f,this.uint16[V+2]=g,this.uint16[V+3]=v,this.uint16[V+4]=b,this.uint16[V+5]=T,this.uint16[V+6]=A,this.uint16[V+7]=L,this.uint16[V+8]=z,this.uint16[V+9]=O,r}}_.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",_);class x extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z,O,V){const $=this.length;return this.resize($+1),this.emplace($,r,u,f,g,v,b,T,A,L,z,O,V)}emplace(r,u,f,g,v,b,T,A,L,z,O,V,$){const X=12*r;return this.int16[X+0]=u,this.int16[X+1]=f,this.int16[X+2]=g,this.int16[X+3]=v,this.uint16[X+4]=b,this.uint16[X+5]=T,this.uint16[X+6]=A,this.uint16[X+7]=L,this.int16[X+8]=z,this.int16[X+9]=O,this.int16[X+10]=V,this.int16[X+11]=$,r}}x.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",x);class E extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.float32[v+0]=u,this.float32[v+1]=f,this.float32[v+2]=g,r}}E.prototype.bytesPerElement=12,st("StructArrayLayout3f12",E);class C extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint32[1*r+0]=u,r}}C.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",C);class M extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L){const z=this.length;return this.resize(z+1),this.emplace(z,r,u,f,g,v,b,T,A,L)}emplace(r,u,f,g,v,b,T,A,L,z){const O=10*r,V=5*r;return this.int16[O+0]=u,this.int16[O+1]=f,this.int16[O+2]=g,this.int16[O+3]=v,this.int16[O+4]=b,this.int16[O+5]=T,this.uint32[V+3]=A,this.uint16[O+8]=L,this.uint16[O+9]=z,r}}M.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",M);class k extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,v,b)}emplace(r,u,f,g,v,b,T){const A=6*r;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=v,this.int16[A+4]=b,this.int16[A+5]=T,r}}k.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",k);class D extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v){const b=this.length;return this.resize(b+1),this.emplace(b,r,u,f,g,v)}emplace(r,u,f,g,v,b){const T=4*r,A=8*r;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[A+6]=v,this.int16[A+7]=b,r}}D.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",D);class N extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=12*r,T=3*r;return this.uint8[b+0]=u,this.uint8[b+1]=f,this.float32[T+1]=g,this.float32[T+2]=v,r}}N.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",N);class W extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.uint16[v+0]=u,this.uint16[v+1]=f,this.uint16[v+2]=g,r}}W.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",W);class ie extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae,oe,ve){const Se=this.length;return this.resize(Se+1),this.emplace(Se,r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae,oe,ve)}emplace(r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae,oe,ve,Se){const ye=24*r,Ee=12*r,De=48*r;return this.int16[ye+0]=u,this.int16[ye+1]=f,this.uint16[ye+2]=g,this.uint16[ye+3]=v,this.uint32[Ee+2]=b,this.uint32[Ee+3]=T,this.uint32[Ee+4]=A,this.uint16[ye+10]=L,this.uint16[ye+11]=z,this.uint16[ye+12]=O,this.float32[Ee+7]=V,this.float32[Ee+8]=$,this.uint8[De+36]=X,this.uint8[De+37]=ae,this.uint8[De+38]=oe,this.uint32[Ee+10]=ve,this.int16[ye+22]=Se,r}}ie.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class te extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae,oe,ve,Se,ye,Ee,De,ze,it,ct,Je,Ze,We,Qe){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae,oe,ve,Se,ye,Ee,De,ze,it,ct,Je,Ze,We,Qe)}emplace(r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae,oe,ve,Se,ye,Ee,De,ze,it,ct,Je,Ze,We,Qe,Xe){const Ue=34*r,yt=17*r;return this.int16[Ue+0]=u,this.int16[Ue+1]=f,this.int16[Ue+2]=g,this.int16[Ue+3]=v,this.int16[Ue+4]=b,this.int16[Ue+5]=T,this.int16[Ue+6]=A,this.int16[Ue+7]=L,this.uint16[Ue+8]=z,this.uint16[Ue+9]=O,this.uint16[Ue+10]=V,this.uint16[Ue+11]=$,this.uint16[Ue+12]=X,this.uint16[Ue+13]=ae,this.uint16[Ue+14]=oe,this.uint16[Ue+15]=ve,this.uint16[Ue+16]=Se,this.uint16[Ue+17]=ye,this.uint16[Ue+18]=Ee,this.uint16[Ue+19]=De,this.uint16[Ue+20]=ze,this.uint16[Ue+21]=it,this.uint16[Ue+22]=ct,this.uint32[yt+12]=Je,this.float32[yt+13]=Ze,this.float32[yt+14]=We,this.float32[yt+15]=Qe,this.float32[yt+16]=Xe,r}}te.prototype.bytesPerElement=68,st("StructArrayLayout8i15ui1ul4f68",te);class ne extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.float32[1*r+0]=u,r}}ne.prototype.bytesPerElement=4,st("StructArrayLayout1f4",ne);class fe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=3*r;return this.int16[v+0]=u,this.int16[v+1]=f,this.int16[v+2]=g,r}}fe.prototype.bytesPerElement=6,st("StructArrayLayout3i6",fe);class _e extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const v=4*r;return this.uint32[2*r+0]=u,this.uint16[v+2]=f,this.uint16[v+3]=g,r}}_e.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",_e);class xe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.uint16[g+0]=u,this.uint16[g+1]=f,r}}xe.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",xe);class re extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint16[1*r+0]=u,r}}re.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",re);class Te extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,r,u,f,g)}emplace(r,u,f,g,v){const b=4*r;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=v,r}}Te.prototype.bytesPerElement=16,st("StructArrayLayout4f16",Te);class we extends Js{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new xt(this.anchorPointX,this.anchorPointY)}}we.prototype.size=20;class Le extends M{get(r){return new we(this,r)}}st("CollisionBoxArray",Le);class ke extends Js{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ke.prototype.size=48;class Be extends ie{get(r){return new ke(this,r)}}st("PlacedSymbolArray",Be);class Ie extends Js{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ie.prototype.size=68;class et extends te{get(r){return new Ie(this,r)}}st("SymbolInstanceArray",et);class qe extends ne{getoffsetX(r){return this.float32[1*r+0]}}st("GlyphOffsetArray",qe);class nt extends fe{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}st("SymbolLineVertexArray",nt);class Lt extends Js{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Lt.prototype.size=8;class Dt extends _e{get(r){return new Lt(this,r)}}st("FeatureIndexArray",Dt);class _t extends wo{}class sn extends wo{}class on extends wo{}class Ht extends o{}class $t extends h{}class ln extends p{}class oi extends _{}class us extends x{}class Br extends E{}class hs extends C{}class Qs extends k{}class Er extends N{}class $i extends W{}class As extends xe{}const dc=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qn}=dc;class Nt{constructor(r=[]){this.segments=r}prepareSegment(r,u,f,g){let v=this.segments[this.segments.length-1];return r>Nt.MAX_VERTEX_ARRAY_LENGTH&&pe(`Max vertices per segment is ${Nt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!v||v.vertexLength+r>Nt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const r of this.segments)for(const u in r.vaos)r.vaos[u].destroy()}static simpleSegment(r,u,f,g){return new Nt([{vertexOffset:r,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function tn(a,r){return 256*(a=P(Math.floor(a),0,255))+P(Math.floor(r),0,255)}Nt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",Nt);const ai=Hn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var li={exports:{}},bn={exports:{}};bn.exports=function(a,r){var u,f,g,v,b,T,A,L;for(f=a.length-(u=3&a.length),g=r,b=3432918353,T=461845907,L=0;L<f;)A=255&a.charCodeAt(L)|(255&a.charCodeAt(++L))<<8|(255&a.charCodeAt(++L))<<16|(255&a.charCodeAt(++L))<<24,++L,g=27492+(65535&(v=5*(65535&(g=(g^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&a.charCodeAt(L+2))<<16;case 2:A^=(255&a.charCodeAt(L+1))<<8;case 1:g^=A=(65535&(A=(A=(65535&(A^=255&a.charCodeAt(L)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Tr={exports:{}};Tr.exports=function(a,r){for(var u,f=a.length,g=r^f,v=0;f>=4;)u=1540483477*(65535&(u=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&a.charCodeAt(v+2))<<16;case 2:g^=(255&a.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Eo=bn.exports,Yu=Tr.exports;li.exports=Eo,li.exports.murmur3=Eo,li.exports.murmur2=Yu;class ha{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,u,f,g){this.ids.push(bf(r)),this.positions.push(u,f,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=bf(r);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=u?g=b:f=b+1}const v=[];for(;this.ids[f]===u;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(r,u){const f=new Float64Array(r.ids),g=new Uint32Array(r.positions);return Ku(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(r){const u=new ha;return u.ids=r.ids,u.positions=r.positions,u.indexed=!0,u}}function bf(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:li.exports(String(a))}function Ku(a,r,u,f){for(;u<f;){const g=a[u+f>>1];let v=u-1,b=f+1;for(;;){do v++;while(a[v]<g);do b--;while(a[b]>g);if(v>=b)break;eo(a,v,b),eo(r,3*v,3*b),eo(r,3*v+1,3*b+1),eo(r,3*v+2,3*b+2)}b-u<f-b?(Ku(a,r,u,b),u=b+1):(Ku(a,r,b+1,f),f=b)}}function eo(a,r,u){const f=a[r];a[r]=a[u],a[u]=f}st("FeaturePositionMap",ha);class To{constructor(r,u){this.gl=r.gl,this.location=u}}class So extends To{constructor(r,u){super(r,u),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class fc extends To{constructor(r,u){super(r,u),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Ix extends To{constructor(r,u){super(r,u),this.current=J.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const qP=new Float32Array(16);function Ig(a){return[tn(255*a.r,255*a.g),tn(255*a.b,255*a.a)]}class Ju{constructor(r,u,f){this.value=r,this.uniformNames=u.map(g=>`u_${g}`),this.type=f}setUniform(r,u,f){r.set(f.constantOr(this.value))}getBinding(r,u,f){return this.type==="color"?new Ix(r,u):new So(r,u)}}class pc{constructor(r,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=r.tlbr}setUniform(r,u,f,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&r.set(v)}getBinding(r,u,f){return f.substr(0,9)==="u_pattern"?new fc(r,u):new So(r,u)}}class Ao{constructor(r,u,f,g){this.expression=r,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,u,f,g,v){const b=this.paintVertexArray.length,T=this.expression.evaluate(new xn(0),u,{},g,[],v);this.paintVertexArray.resize(r),this._setPaintValue(b,r,T)}updatePaintArray(r,u,f,g){const v=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(r,u,v)}_setPaintValue(r,u,f){if(this.type==="color"){const g=Ig(f);for(let v=r;v<u;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=r;g<u;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ps{constructor(r,u,f,g,v,b){this.expression=r,this.uniformNames=u.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=u.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,u,f,g,v){const b=this.expression.evaluate(new xn(this.zoom),u,{},g,[],v),T=this.expression.evaluate(new xn(this.zoom+1),u,{},g,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(A,r,b,T)}updatePaintArray(r,u,f,g){const v=this.expression.evaluate({zoom:this.zoom},f,g),b=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(r,u,v,b)}_setPaintValue(r,u,f,g){if(this.type==="color"){const v=Ig(f),b=Ig(g);for(let T=r;T<u;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1])}else{for(let v=r;v<u;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=P(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,u,f){return new So(r,u)}}class da{constructor(r,u,f,g,v,b){this.expression=r,this.type=u,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,u,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(r,u,f,g,v){this._setPaintValues(r,u,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(r,u,f,g){if(!g||!f)return;const{min:v,mid:b,max:T}=f,A=g[v],L=g[b],z=g[T];if(A&&L&&z)for(let O=r;O<u;O++)this.zoomInPaintVertexArray.emplace(O,L.tl[0],L.tl[1],L.br[0],L.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],L.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,L.tl[0],L.tl[1],L.br[0],L.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],L.pixelRatio,z.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,ai.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,ai.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Mx{constructor(r,u,f){this.binders={},this._buffers=[];const g=[];for(const v in r.paint._values){if(!f(v))continue;const b=r.paint.get(v);if(!(b instanceof ls&&gn(b.property.specification)))continue;const T=ZP(v,r.type),A=b.value,L=b.property.specification.type,z=b.property.useIntegerZoom,O=b.property.specification["property-type"],V=O==="cross-faded"||O==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=V?new pc(A.value,T):new Ju(A.value,T,L),g.push(`/u_${v}`);else if(A.kind==="source"||V){const $=Lx(v,L,"source");this.binders[v]=V?new da(A,L,z,u,$,r.id):new Ao(A,T,L,$),g.push(`/a_${v}`)}else{const $=Lx(v,L,"composite");this.binders[v]=new Ps(A,T,L,z,u,$),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const u=this.binders[r];return u instanceof Ao||u instanceof Ps?u.maxValue:0}populatePaintArrays(r,u,f,g,v){for(const b in this.binders){const T=this.binders[b];(T instanceof Ao||T instanceof Ps||T instanceof da)&&T.populatePaintArray(r,u,f,g,v)}}setConstantPatternPositions(r,u){for(const f in this.binders){const g=this.binders[f];g instanceof pc&&g.setConstantPatternPositions(r,u)}}updatePaintArrays(r,u,f,g,v){let b=!1;for(const T in r){const A=u.getPositions(T);for(const L of A){const z=f.feature(L.index);for(const O in this.binders){const V=this.binders[O];if((V instanceof Ao||V instanceof Ps||V instanceof da)&&V.expression.isStateDependent===!0){const $=g.paint.get(O);V.expression=$.value,V.updatePaintArray(L.start,L.end,z,r[T],v),b=!0}}}}return b}defines(){const r=[];for(const u in this.binders){const f=this.binders[u];(f instanceof Ju||f instanceof pc)&&r.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Ao||f instanceof Ps)for(let g=0;g<f.paintVertexAttributes.length;g++)r.push(f.paintVertexAttributes[g].name);else if(f instanceof da)for(let g=0;g<ai.members.length;g++)r.push(ai.members[g].name)}return r}getBinderUniforms(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Ju||f instanceof pc||f instanceof Ps)for(const g of f.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,u){const f=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof Ju||v instanceof pc||v instanceof Ps){for(const b of v.uniformNames)if(u[b]){const T=v.getBinding(r,u[b],b);f.push({name:b,property:g,binding:T})}}}return f}setUniforms(r,u,f,g){for(const{name:v,property:b,binding:T}of u)this.binders[b].setUniform(T,g,f.get(b),v)}updatePaintBuffers(r){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(r&&f instanceof da){const g=r.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof Ao||f instanceof Ps)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(r){for(const u in this.binders){const f=this.binders[u];(f instanceof Ao||f instanceof Ps||f instanceof da)&&f.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const u=this.binders[r];(u instanceof Ao||u instanceof Ps||u instanceof da)&&u.destroy()}}}class pl{constructor(r,u,f=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new Mx(g,u,f);this.needsUpload=!1,this._featureMap=new ha,this._bufferOffset=0}populatePaintArrays(r,u,f,g,v,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,u,g,v,b);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,u,f,g){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,u,v,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function ZP(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function Lx(a,r,u){const f={color:{source:p,composite:Te},number:{source:ne,composite:p}},g=function(v){return{"line-pattern":{source:oi,composite:oi},"fill-pattern":{source:oi,composite:oi},"fill-extrusion-pattern":{source:oi,composite:oi}}[v]}(a);return g&&g[u]||f[r][u]}st("ConstantBinder",Ju),st("CrossFadedConstantBinder",pc),st("SourceExpressionBinder",Ao),st("CrossFadedCompositeBinder",da),st("CompositeExpressionBinder",Ps),st("ProgramConfiguration",Mx,{omit:["_buffers"]}),st("ProgramConfigurationSet",pl);var ei=8192;const Mg=Math.pow(2,14)-1,kx=-Mg-1;function ml(a){const r=ei/a.extent,u=a.loadGeometry();for(let f=0;f<u.length;f++){const g=u[f];for(let v=0;v<g.length;v++){const b=g[v],T=Math.round(b.x*r),A=Math.round(b.y*r);b.x=P(T,kx,Mg),b.y=P(A,kx,Mg),(T<b.x||T>b.x+1||A<b.y||A>b.y+1)&&pe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function gl(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?ml(a):[]}}function wf(a,r,u,f,g){a.emplaceBack(2*r+(f+1)/2,2*u+(g+1)/2)}class Lg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new sn,this.indexArray=new $i,this.segments=new Nt,this.programConfigurations=new pl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){const g=this.layers[0],v=[];let b=null,T=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),T=!b.isConstant());for(const{feature:A,id:L,index:z,sourceLayerIndex:O}of r){const V=this.layers[0]._featureFilter.needGeometry,$=gl(A,V);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),$,f))continue;const X=T?b.evaluate($,{},f):void 0,ae={id:L,properties:A.properties,type:A.type,sourceLayerIndex:O,index:z,geometry:V?$.geometry:ml(A),patterns:{},sortKey:X};v.push(ae)}T&&v.sort((A,L)=>A.sortKey-L.sortKey);for(const A of v){const{geometry:L,index:z,sourceLayerIndex:O}=A,V=r[z].feature;this.addFeature(A,L,z,f),u.featureIndex.insert(V,L,z,O,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Qn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,u,f,g){for(const v of u)for(const b of v){const T=b.x,A=b.y;if(T<0||T>=ei||A<0||A>=ei)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),z=L.vertexLength;wf(this.layoutVertexArray,T,A,-1,-1),wf(this.layoutVertexArray,T,A,1,-1),wf(this.layoutVertexArray,T,A,1,1),wf(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,{},g)}}function Rx(a,r){for(let u=0;u<a.length;u++)if(mc(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(mc(a,r[u]))return!0;return!!kg(a,r)}function XP(a,r,u){return!!mc(a,r)||!!Rg(r,a,u)}function zx(a,r){if(a.length===1)return Ox(r,a[0]);for(let u=0;u<r.length;u++){const f=r[u];for(let g=0;g<f.length;g++)if(mc(a,f[g]))return!0}for(let u=0;u<a.length;u++)if(Ox(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(kg(a,r[u]))return!0;return!1}function YP(a,r,u){if(a.length>1){if(kg(a,r))return!0;for(let f=0;f<r.length;f++)if(Rg(r[f],a,u))return!0}for(let f=0;f<a.length;f++)if(Rg(a[f],r,u))return!0;return!1}function kg(a,r){if(a.length===0||r.length===0)return!1;for(let u=0;u<a.length-1;u++){const f=a[u],g=a[u+1];for(let v=0;v<r.length-1;v++)if(KP(f,g,r[v],r[v+1]))return!0}return!1}function KP(a,r,u,f){return be(a,u,f)!==be(r,u,f)&&be(a,r,u)!==be(a,r,f)}function Rg(a,r,u){const f=u*u;if(r.length===1)return a.distSqr(r[0])<f;for(let g=1;g<r.length;g++)if(Dx(a,r[g-1],r[g])<f)return!0;return!1}function Dx(a,r,u){const f=r.distSqr(u);if(f===0)return a.distSqr(r);const g=((a.x-r.x)*(u.x-r.x)+(a.y-r.y)*(u.y-r.y))/f;return a.distSqr(g<0?r:g>1?u:u.sub(r)._mult(g)._add(r))}function Ox(a,r){let u,f,g,v=!1;for(let b=0;b<a.length;b++){u=a[b];for(let T=0,A=u.length-1;T<u.length;A=T++)f=u[T],g=u[A],f.y>r.y!=g.y>r.y&&r.x<(g.x-f.x)*(r.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function mc(a,r){let u=!1;for(let f=0,g=a.length-1;f<a.length;g=f++){const v=a[f],b=a[g];v.y>r.y!=b.y>r.y&&r.x<(b.x-v.x)*(r.y-v.y)/(b.y-v.y)+v.x&&(u=!u)}return u}function JP(a,r,u){const f=u[0],g=u[2];if(a.x<f.x&&r.x<f.x||a.x>g.x&&r.x>g.x||a.y<f.y&&r.y<f.y||a.y>g.y&&r.y>g.y)return!1;const v=be(a,r,u[0]);return v!==be(a,r,u[1])||v!==be(a,r,u[2])||v!==be(a,r,u[3])}function Qu(a,r,u){const f=r.paint.get(a).value;return f.kind==="constant"?f.value:u.programConfigurations.get(r.id).getMaxValue(a)}function Ef(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Tf(a,r,u,f,g){if(!r[0]&&!r[1])return a;const v=xt.convert(r)._mult(g);u==="viewport"&&v._rotate(-f);const b=[];for(let T=0;T<a.length;T++)b.push(a[T].sub(v));return b}st("CircleBucket",Lg,{omit:["layers"]});const QP=new pi({"circle-sort-key":new wt(Me.layout_circle["circle-sort-key"])});var eC={paint:new pi({"circle-radius":new wt(Me.paint_circle["circle-radius"]),"circle-color":new wt(Me.paint_circle["circle-color"]),"circle-blur":new wt(Me.paint_circle["circle-blur"]),"circle-opacity":new wt(Me.paint_circle["circle-opacity"]),"circle-translate":new ht(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Me.paint_circle["circle-stroke-opacity"])}),layout:QP},qi=1e-6,Zi=typeof Float32Array<"u"?Float32Array:Array;function Fx(){var a=new Zi(9);return Zi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function zg(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Bx(a,r,u){var f=r[0],g=r[1],v=r[2],b=r[3],T=r[4],A=r[5],L=r[6],z=r[7],O=r[8],V=r[9],$=r[10],X=r[11],ae=r[12],oe=r[13],ve=r[14],Se=r[15],ye=u[0],Ee=u[1],De=u[2],ze=u[3];return a[0]=ye*f+Ee*T+De*O+ze*ae,a[1]=ye*g+Ee*A+De*V+ze*oe,a[2]=ye*v+Ee*L+De*$+ze*ve,a[3]=ye*b+Ee*z+De*X+ze*Se,a[4]=(ye=u[4])*f+(Ee=u[5])*T+(De=u[6])*O+(ze=u[7])*ae,a[5]=ye*g+Ee*A+De*V+ze*oe,a[6]=ye*v+Ee*L+De*$+ze*ve,a[7]=ye*b+Ee*z+De*X+ze*Se,a[8]=(ye=u[8])*f+(Ee=u[9])*T+(De=u[10])*O+(ze=u[11])*ae,a[9]=ye*g+Ee*A+De*V+ze*oe,a[10]=ye*v+Ee*L+De*$+ze*ve,a[11]=ye*b+Ee*z+De*X+ze*Se,a[12]=(ye=u[12])*f+(Ee=u[13])*T+(De=u[14])*O+(ze=u[15])*ae,a[13]=ye*g+Ee*A+De*V+ze*oe,a[14]=ye*v+Ee*L+De*$+ze*ve,a[15]=ye*b+Ee*z+De*X+ze*Se,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var eh,tC=Bx;function Nx(){var a=new Zi(3);return Zi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ux(a,r,u){var f=new Zi(3);return f[0]=a,f[1]=r,f[2]=u,f}function Sf(a,r,u){var f=r[0],g=r[1],v=r[2],b=r[3];return a[0]=u[0]*f+u[4]*g+u[8]*v+u[12]*b,a[1]=u[1]*f+u[5]*g+u[9]*v+u[13]*b,a[2]=u[2]*f+u[6]*g+u[10]*v+u[14]*b,a[3]=u[3]*f+u[7]*g+u[11]*v+u[15]*b,a}function Vx(){var a=new Zi(4);return Zi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function jx(a,r){const u=Sf([],[a.x,a.y,0,1],r);return new xt(u[0]/u[3],u[1]/u[3])}Nx(),eh=new Zi(4),Zi!=Float32Array&&(eh[0]=0,eh[1]=0,eh[2]=0,eh[3]=0),Nx(),Ux(1,0,0),Ux(0,1,0),Vx(),Vx(),Fx(),function(){var a;a=new Zi(2),Zi!=Float32Array&&(a[0]=0,a[1]=0)}();class Gx extends Lg{}st("HeatmapBucket",Gx,{omit:["layers"]});var nC={paint:new pi({"heatmap-radius":new wt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ys(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(Me.paint_heatmap["heatmap-opacity"])})};function Dg(a,{width:r,height:u},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*u*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*u*f}`)}else g=new Uint8Array(r*u*f);return a.width=r,a.height=u,a.data=g,a}function Wx(a,{width:r,height:u},f){if(r===a.width&&u===a.height)return;const g=Dg({},{width:r,height:u},f);Og(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,u)},f),a.width=r,a.height=u,a.data=g.data}function Og(a,r,u,f,g,v){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||u.x>a.width-g.width||u.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||f.x>r.width-g.width||f.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,T=r.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<g.height;A++){const L=((u.y+A)*a.width+u.x)*v,z=((f.y+A)*r.width+f.x)*v;for(let O=0;O<g.width*v;O++)T[z+O]=b[L+O]}return r}class th{constructor(r,u){Dg(this,r,1,u)}resize(r){Wx(this,r,1)}clone(){return new th({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,v){Og(r,u,f,g,v,1)}}class Nr{constructor(r,u){Dg(this,r,4,u)}resize(r){Wx(this,r,4)}replace(r,u){u?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Nr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,v){Og(r,u,f,g,v,4)}}function Hx(a){const r={},u=a.resolution||256,f=a.clips?a.clips.length:1,g=a.image||new Nr({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const v=(b,T,A)=>{r[a.evaluationKey]=A;const L=a.expression.evaluate(r);g.data[b+T+0]=Math.floor(255*L.r/L.a),g.data[b+T+1]=Math.floor(255*L.g/L.a),g.data[b+T+2]=Math.floor(255*L.b/L.a),g.data[b+T+3]=Math.floor(255*L.a)};if(a.clips)for(let b=0,T=0;b<f;++b,T+=4*u)for(let A=0,L=0;A<u;A++,L+=4){const z=A/(u-1),{start:O,end:V}=a.clips[b];v(T,L,O*(1-z)+V*z)}else for(let b=0,T=0;b<u;b++,T+=4)v(0,T,b/(u-1));return g}st("AlphaImage",th),st("RGBAImage",Nr);var iC={paint:new pi({"hillshade-illumination-direction":new ht(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(Me.paint_hillshade["hillshade-accent-color"])})};const rC=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:sC}=rC;var Af={exports:{}};function Pf(a,r,u){u=u||2;var f,g,v,b,T,A,L,z=r&&r.length,O=z?r[0]*u:a.length,V=$x(a,0,O,u,!0),$=[];if(!V||V.next===V.prev)return $;if(z&&(V=function(ae,oe,ve,Se){var ye,Ee,De,ze=[];for(ye=0,Ee=oe.length;ye<Ee;ye++)(De=$x(ae,oe[ye]*Se,ye<Ee-1?oe[ye+1]*Se:ae.length,Se,!1))===De.next&&(De.steiner=!0),ze.push(fC(De));for(ze.sort(uC),ye=0;ye<ze.length;ye++)ve=hC(ze[ye],ve);return ve}(a,r,V,u)),a.length>80*u){f=v=a[0],g=b=a[1];for(var X=u;X<O;X+=u)(T=a[X])<f&&(f=T),(A=a[X+1])<g&&(g=A),T>v&&(v=T),A>b&&(b=A);L=(L=Math.max(v-f,b-g))!==0?32767/L:0}return nh(V,$,u,f,g,L,0),$}function $x(a,r,u,f,g){var v,b;if(g===Ng(a,r,u,f)>0)for(v=r;v<u;v+=f)b=Xx(v,a[v],a[v+1],b);else for(v=u-f;v>=r;v-=f)b=Xx(v,a[v],a[v+1],b);return b&&Cf(b,b.next)&&(rh(b),b=b.next),b}function _l(a,r){if(!a)return a;r||(r=a);var u,f=a;do if(u=!1,f.steiner||!Cf(f,f.next)&&Bn(f.prev,f,f.next)!==0)f=f.next;else{if(rh(f),(f=r=f.prev)===f.next)break;u=!0}while(u||f!==r);return r}function nh(a,r,u,f,g,v,b){if(a){!b&&v&&function(z,O,V,$){var X=z;do X.z===0&&(X.z=Fg(X.x,X.y,O,V,$)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==z);X.prevZ.nextZ=null,X.prevZ=null,function(ae){var oe,ve,Se,ye,Ee,De,ze,it,ct=1;do{for(ve=ae,ae=null,Ee=null,De=0;ve;){for(De++,Se=ve,ze=0,oe=0;oe<ct&&(ze++,Se=Se.nextZ);oe++);for(it=ct;ze>0||it>0&&Se;)ze!==0&&(it===0||!Se||ve.z<=Se.z)?(ye=ve,ve=ve.nextZ,ze--):(ye=Se,Se=Se.nextZ,it--),Ee?Ee.nextZ=ye:ae=ye,ye.prevZ=Ee,Ee=ye;ve=Se}Ee.nextZ=null,ct*=2}while(De>1)}(X)}(a,f,g,v);for(var T,A,L=a;a.prev!==a.next;)if(T=a.prev,A=a.next,v?aC(a,f,g,v):oC(a))r.push(T.i/u|0),r.push(a.i/u|0),r.push(A.i/u|0),rh(a),a=A.next,L=A.next;else if((a=A)===L){b?b===1?nh(a=lC(_l(a),r,u),r,u,f,g,v,2):b===2&&cC(a,r,u,f,g,v):nh(_l(a),r,u,f,g,v,1);break}}}function oC(a){var r=a.prev,u=a,f=a.next;if(Bn(r,u,f)>=0)return!1;for(var g=r.x,v=u.x,b=f.x,T=r.y,A=u.y,L=f.y,z=g<v?g<b?g:b:v<b?v:b,O=T<A?T<L?T:L:A<L?A:L,V=g>v?g>b?g:b:v>b?v:b,$=T>A?T>L?T:L:A>L?A:L,X=f.next;X!==r;){if(X.x>=z&&X.x<=V&&X.y>=O&&X.y<=$&&gc(g,T,v,A,b,L,X.x,X.y)&&Bn(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function aC(a,r,u,f){var g=a.prev,v=a,b=a.next;if(Bn(g,v,b)>=0)return!1;for(var T=g.x,A=v.x,L=b.x,z=g.y,O=v.y,V=b.y,$=T<A?T<L?T:L:A<L?A:L,X=z<O?z<V?z:V:O<V?O:V,ae=T>A?T>L?T:L:A>L?A:L,oe=z>O?z>V?z:V:O>V?O:V,ve=Fg($,X,r,u,f),Se=Fg(ae,oe,r,u,f),ye=a.prevZ,Ee=a.nextZ;ye&&ye.z>=ve&&Ee&&Ee.z<=Se;){if(ye.x>=$&&ye.x<=ae&&ye.y>=X&&ye.y<=oe&&ye!==g&&ye!==b&&gc(T,z,A,O,L,V,ye.x,ye.y)&&Bn(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Ee.x>=$&&Ee.x<=ae&&Ee.y>=X&&Ee.y<=oe&&Ee!==g&&Ee!==b&&gc(T,z,A,O,L,V,Ee.x,Ee.y)&&Bn(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;ye&&ye.z>=ve;){if(ye.x>=$&&ye.x<=ae&&ye.y>=X&&ye.y<=oe&&ye!==g&&ye!==b&&gc(T,z,A,O,L,V,ye.x,ye.y)&&Bn(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Ee&&Ee.z<=Se;){if(Ee.x>=$&&Ee.x<=ae&&Ee.y>=X&&Ee.y<=oe&&Ee!==g&&Ee!==b&&gc(T,z,A,O,L,V,Ee.x,Ee.y)&&Bn(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function lC(a,r,u){var f=a;do{var g=f.prev,v=f.next.next;!Cf(g,v)&&qx(g,f,f.next,v)&&ih(g,v)&&ih(v,g)&&(r.push(g.i/u|0),r.push(f.i/u|0),r.push(v.i/u|0),rh(f),rh(f.next),f=a=v),f=f.next}while(f!==a);return _l(f)}function cC(a,r,u,f,g,v){var b=a;do{for(var T=b.next.next;T!==b.prev;){if(b.i!==T.i&&pC(b,T)){var A=Zx(b,T);return b=_l(b,b.next),A=_l(A,A.next),nh(b,r,u,f,g,v,0),void nh(A,r,u,f,g,v,0)}T=T.next}b=b.next}while(b!==a)}function uC(a,r){return a.x-r.x}function hC(a,r){var u=function(g,v){var b,T=v,A=g.x,L=g.y,z=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){var O=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(O<=A&&O>z&&(z=O,b=T.x<T.next.x?T:T.next,O===A))return b}T=T.next}while(T!==v);if(!b)return null;var V,$=b,X=b.x,ae=b.y,oe=1/0;T=b;do A>=T.x&&T.x>=X&&A!==T.x&&gc(L<ae?A:z,L,X,ae,L<ae?z:A,L,T.x,T.y)&&(V=Math.abs(L-T.y)/(A-T.x),ih(T,g)&&(V<oe||V===oe&&(T.x>b.x||T.x===b.x&&dC(b,T)))&&(b=T,oe=V)),T=T.next;while(T!==$);return b}(a,r);if(!u)return r;var f=Zx(u,a);return _l(f,f.next),_l(u,u.next)}function dC(a,r){return Bn(a.prev,a,r.prev)<0&&Bn(r.next,a,a.next)<0}function Fg(a,r,u,f,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-u)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-f)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function fC(a){var r=a,u=a;do(r.x<u.x||r.x===u.x&&r.y<u.y)&&(u=r),r=r.next;while(r!==a);return u}function gc(a,r,u,f,g,v,b,T){return(g-b)*(r-T)>=(a-b)*(v-T)&&(a-b)*(f-T)>=(u-b)*(r-T)&&(u-b)*(v-T)>=(g-b)*(f-T)}function pC(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(u,f){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==f.i&&g.next.i!==f.i&&qx(g,g.next,u,f))return!0;g=g.next}while(g!==u);return!1}(a,r)&&(ih(a,r)&&ih(r,a)&&function(u,f){var g=u,v=!1,b=(u.x+f.x)/2,T=(u.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&b<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==u);return v}(a,r)&&(Bn(a.prev,a,r.prev)||Bn(a,r.prev,r))||Cf(a,r)&&Bn(a.prev,a,a.next)>0&&Bn(r.prev,r,r.next)>0)}function Bn(a,r,u){return(r.y-a.y)*(u.x-r.x)-(r.x-a.x)*(u.y-r.y)}function Cf(a,r){return a.x===r.x&&a.y===r.y}function qx(a,r,u,f){var g=Mf(Bn(a,r,u)),v=Mf(Bn(a,r,f)),b=Mf(Bn(u,f,a)),T=Mf(Bn(u,f,r));return g!==v&&b!==T||!(g!==0||!If(a,u,r))||!(v!==0||!If(a,f,r))||!(b!==0||!If(u,a,f))||!(T!==0||!If(u,r,f))}function If(a,r,u){return r.x<=Math.max(a.x,u.x)&&r.x>=Math.min(a.x,u.x)&&r.y<=Math.max(a.y,u.y)&&r.y>=Math.min(a.y,u.y)}function Mf(a){return a>0?1:a<0?-1:0}function ih(a,r){return Bn(a.prev,a,a.next)<0?Bn(a,r,a.next)>=0&&Bn(a,a.prev,r)>=0:Bn(a,r,a.prev)<0||Bn(a,a.next,r)<0}function Zx(a,r){var u=new Bg(a.i,a.x,a.y),f=new Bg(r.i,r.x,r.y),g=a.next,v=r.prev;return a.next=r,r.prev=a,u.next=g,g.prev=u,f.next=u,u.prev=f,v.next=f,f.prev=v,f}function Xx(a,r,u,f){var g=new Bg(a,r,u);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function rh(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Bg(a,r,u){this.i=a,this.x=r,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ng(a,r,u,f){for(var g=0,v=r,b=u-f;v<u;v+=f)g+=(a[b]-a[v])*(a[v+1]+a[b+1]),b=v;return g}function mC(a,r,u,f,g){Yx(a,r,u||0,f||a.length-1,g||gC)}function Yx(a,r,u,f,g){for(;f>u;){if(f-u>600){var v=f-u+1,b=r-u+1,T=Math.log(v),A=.5*Math.exp(2*T/3),L=.5*Math.sqrt(T*A*(v-A)/v)*(b-v/2<0?-1:1);Yx(a,r,Math.max(u,Math.floor(r-b*A/v+L)),Math.min(f,Math.floor(r+(v-b)*A/v+L)),g)}var z=a[r],O=u,V=f;for(sh(a,u,r),g(a[f],z)>0&&sh(a,u,f);O<V;){for(sh(a,O,V),O++,V--;g(a[O],z)<0;)O++;for(;g(a[V],z)>0;)V--}g(a[u],z)===0?sh(a,u,V):sh(a,++V,f),V<=r&&(u=V+1),r<=V&&(f=V-1)}}function sh(a,r,u){var f=a[r];a[r]=a[u],a[u]=f}function gC(a,r){return a<r?-1:a>r?1:0}function Ug(a,r){const u=a.length;if(u<=1)return[a];const f=[];let g,v;for(let b=0;b<u;b++){const T=Re(a[b]);T!==0&&(a[b].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(g&&f.push(g),g=[a[b]]):g.push(a[b]))}if(g&&f.push(g),r>1)for(let b=0;b<f.length;b++)f[b].length<=r||(mC(f[b],r,1,f[b].length-1,_C),f[b]=f[b].slice(0,r));return f}function _C(a,r){return r.area-a.area}function Vg(a,r,u){const f=u.patternDependencies;let g=!1;for(const v of r){const b=v.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const T=b.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function jg(a,r,u,f,g){const v=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:f-1},u,{},g.availableImages),L=T.evaluate({zoom:f},u,{},g.availableImages),z=T.evaluate({zoom:f+1},u,{},g.availableImages);A=A&&A.name?A.name:A,L=L&&L.name?L.name:L,z=z&&z.name?z.name:z,v[A]=!0,v[L]=!0,v[z]=!0,u.patterns[b.id]={min:A,mid:L,max:z}}}return u}Af.exports=Pf,Af.exports.default=Pf,Pf.deviation=function(a,r,u,f){var g=r&&r.length,v=Math.abs(Ng(a,0,g?r[0]*u:a.length,u));if(g)for(var b=0,T=r.length;b<T;b++)v-=Math.abs(Ng(a,r[b]*u,b<T-1?r[b+1]*u:a.length,u));var A=0;for(b=0;b<f.length;b+=3){var L=f[b]*u,z=f[b+1]*u,O=f[b+2]*u;A+=Math.abs((a[L]-a[O])*(a[z+1]-a[L+1])-(a[L]-a[z])*(a[O+1]-a[L+1]))}return v===0&&A===0?0:Math.abs((A-v)/v)},Pf.flatten=function(a){for(var r=a[0][0].length,u={vertices:[],holes:[],dimensions:r},f=0,g=0;g<a.length;g++){for(var v=0;v<a[g].length;v++)for(var b=0;b<r;b++)u.vertices.push(a[g][v][b]);g>0&&u.holes.push(f+=a[g-1].length)}return u};class Gg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new on,this.indexArray=new $i,this.indexArray2=new As,this.programConfigurations=new pl(r.layers,r.zoom),this.segments=new Nt,this.segments2=new Nt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=Vg("fill",this.layers,u);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),b=[];for(const{feature:T,id:A,index:L,sourceLayerIndex:z}of r){const O=this.layers[0]._featureFilter.needGeometry,V=gl(T,O);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),V,f))continue;const $=v?g.evaluate(V,{},f,u.availableImages):void 0,X={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:L,geometry:O?V.geometry:ml(T),patterns:{},sortKey:$};b.push(X)}v&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:L,sourceLayerIndex:z}=T;if(this.hasPattern){const O=jg("fill",this.layers,T,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(T,A,L,f,{});u.featureIndex.insert(r[L].feature,A,L,z,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,sC),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,u,f,g,v){for(const b of Ug(u,500)){let T=0;for(const $ of b)T+=$.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),L=A.vertexLength,z=[],O=[];for(const $ of b){if($.length===0)continue;$!==b[0]&&O.push(z.length/2);const X=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ae=X.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ae+$.length-1,ae),z.push($[0].x),z.push($[0].y);for(let oe=1;oe<$.length;oe++)this.layoutVertexArray.emplaceBack($[oe].x,$[oe].y),this.indexArray2.emplaceBack(ae+oe-1,ae+oe),z.push($[oe].x),z.push($[oe].y);X.vertexLength+=$.length,X.primitiveLength+=$.length}const V=Af.exports(z,O);for(let $=0;$<V.length;$+=3)this.indexArray.emplaceBack(L+V[$],L+V[$+1],L+V[$+2]);A.vertexLength+=T,A.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}}st("FillBucket",Gg,{omit:["layers","patternFeatures"]});const yC=new pi({"fill-sort-key":new wt(Me.layout_fill["fill-sort-key"])});var vC={paint:new pi({"fill-antialias":new ht(Me.paint_fill["fill-antialias"]),"fill-opacity":new wt(Me.paint_fill["fill-opacity"]),"fill-color":new wt(Me.paint_fill["fill-color"]),"fill-outline-color":new wt(Me.paint_fill["fill-outline-color"]),"fill-translate":new ht(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ua(Me.paint_fill["fill-pattern"])}),layout:yC};const xC=Hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bC=Hn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:wC}=xC;var fa={},EC=xt,Kx=_c;function _c(a,r,u,f,g){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=g,a.readFields(TC,this,r)}function TC(a,r,u){a==1?r.id=u.readVarint():a==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var b=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[b]=T}}(u,r):a==3?r.type=u.readVarint():a==4&&(r._geometry=u.pos)}function SC(a){for(var r,u,f=0,g=0,v=a.length,b=v-1;g<v;b=g++)f+=((u=a[b]).x-(r=a[g]).x)*(r.y+u.y);return f}_c.types=["Unknown","Point","LineString","Polygon"],_c.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,u=a.readVarint()+a.pos,f=1,g=0,v=0,b=0,T=[];a.pos<u;){if(g<=0){var A=a.readVarint();f=7&A,g=A>>3}if(g--,f===1||f===2)v+=a.readSVarint(),b+=a.readSVarint(),f===1&&(r&&T.push(r),r=[]),r.push(new EC(v,b));else{if(f!==7)throw new Error("unknown command "+f);r&&r.push(r[0].clone())}}return r&&T.push(r),T},_c.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,u=1,f=0,g=0,v=0,b=1/0,T=-1/0,A=1/0,L=-1/0;a.pos<r;){if(f<=0){var z=a.readVarint();u=7&z,f=z>>3}if(f--,u===1||u===2)(g+=a.readSVarint())<b&&(b=g),g>T&&(T=g),(v+=a.readSVarint())<A&&(A=v),v>L&&(L=v);else if(u!==7)throw new Error("unknown command "+u)}return[b,A,T,L]},_c.prototype.toGeoJSON=function(a,r,u){var f,g,v=this.extent*Math.pow(2,u),b=this.extent*a,T=this.extent*r,A=this.loadGeometry(),L=_c.types[this.type];function z($){for(var X=0;X<$.length;X++){var ae=$[X];$[X]=[360*(ae.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(f=0;f<A.length;f++)O[f]=A[f][0];z(A=O);break;case 2:for(f=0;f<A.length;f++)z(A[f]);break;case 3:for(A=function($){var X=$.length;if(X<=1)return[$];for(var ae,oe,ve=[],Se=0;Se<X;Se++){var ye=SC($[Se]);ye!==0&&(oe===void 0&&(oe=ye<0),oe===ye<0?(ae&&ve.push(ae),ae=[$[Se]]):ae.push($[Se]))}return ae&&ve.push(ae),ve}(A),f=0;f<A.length;f++)for(g=0;g<A[f].length;g++)z(A[f][g])}A.length===1?A=A[0]:L="Multi"+L;var V={type:"Feature",geometry:{type:L,coordinates:A},properties:this.properties};return"id"in this&&(V.id=this.id),V};var AC=Kx,Jx=Qx;function Qx(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(PC,this,r),this.length=this._features.length}function PC(a,r,u){a===15?r.version=u.readVarint():a===1?r.name=u.readString():a===5?r.extent=u.readVarint():a===2?r._features.push(u.pos):a===3?r._keys.push(u.readString()):a===4&&r._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(u))}Qx.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new AC(this._pbf,r,this.extent,this._keys,this._values)};var CC=Jx;function IC(a,r,u){if(a===3){var f=new CC(u,u.readVarint()+u.pos);f.length&&(r[f.name]=f)}}fa.VectorTile=function(a,r){this.layers=a.readFields(IC,{},r)},fa.VectorTileFeature=Kx,fa.VectorTileLayer=Jx;const MC=fa.VectorTileFeature.types,Wg=Math.pow(2,13);function oh(a,r,u,f,g,v,b,T){a.emplaceBack(r,u,2*Math.floor(f*Wg)+b,g*Wg*2,v*Wg*2,Math.round(T))}class Hg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Ht,this.centroidVertexArray=new _t,this.indexArray=new $i,this.programConfigurations=new pl(r.layers,r.zoom),this.segments=new Nt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.features=[],this.hasPattern=Vg("fill-extrusion",this.layers,u);for(const{feature:g,id:v,index:b,sourceLayerIndex:T}of r){const A=this.layers[0]._featureFilter.needGeometry,L=gl(g,A);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),L,f))continue;const z={id:v,sourceLayerIndex:T,index:b,geometry:A?L.geometry:ml(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(jg("fill-extrusion",this.layers,z,this.zoom,u)):this.addFeature(z,z.geometry,b,f,{}),u.featureIndex.insert(g,z.geometry,b,T,this.index,!0)}}addFeatures(r,u,f){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,u,f)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,wC),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,bC.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,u,f,g,v){const b={x:0,y:0,vertexCount:0};for(const T of Ug(u,500)){let A=0;for(const X of T)A+=X.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of T){if(X.length===0||kC(X))continue;let ae=0;for(let oe=0;oe<X.length;oe++){const ve=X[oe];if(oe>=1){const Se=X[oe-1];if(!LC(ve,Se)){L.vertexLength+4>Nt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ye=ve.sub(Se)._perp()._unit(),Ee=Se.dist(ve);ae+Ee>32768&&(ae=0),oh(this.layoutVertexArray,ve.x,ve.y,ye.x,ye.y,0,0,ae),oh(this.layoutVertexArray,ve.x,ve.y,ye.x,ye.y,0,1,ae),b.x+=2*ve.x,b.y+=2*ve.y,b.vertexCount+=2,ae+=Ee,oh(this.layoutVertexArray,Se.x,Se.y,ye.x,ye.y,0,0,ae),oh(this.layoutVertexArray,Se.x,Se.y,ye.x,ye.y,0,1,ae),b.x+=2*Se.x,b.y+=2*Se.y,b.vertexCount+=2;const De=L.vertexLength;this.indexArray.emplaceBack(De,De+2,De+1),this.indexArray.emplaceBack(De+1,De+2,De+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+A>Nt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),MC[r.type]!=="Polygon")continue;const z=[],O=[],V=L.vertexLength;for(const X of T)if(X.length!==0){X!==T[0]&&O.push(z.length/2);for(let ae=0;ae<X.length;ae++){const oe=X[ae];oh(this.layoutVertexArray,oe.x,oe.y,0,0,1,1,0),b.x+=oe.x,b.y+=oe.y,b.vertexCount+=1,z.push(oe.x),z.push(oe.y)}}const $=Af.exports(z,O);for(let X=0;X<$.length;X+=3)this.indexArray.emplaceBack(V+$[X],V+$[X+2],V+$[X+1]);L.primitiveLength+=$.length/3,L.vertexLength+=A}for(let T=0;T<b.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}}function LC(a,r){return a.x===r.x&&(a.x<0||a.x>ei)||a.y===r.y&&(a.y<0||a.y>ei)}function kC(a){return a.every(r=>r.x<0)||a.every(r=>r.x>ei)||a.every(r=>r.y<0)||a.every(r=>r.y>ei)}st("FillExtrusionBucket",Hg,{omit:["layers","features"]});var RC={paint:new pi({"fill-extrusion-opacity":new ht(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ua(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ht(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ah(a,r){return a.x*r.x+a.y*r.y}function e1(a,r){if(a.length===1){let u=0;const f=r[u++];let g;for(;!g||f.equals(g);)if(g=r[u++],!g)return 1/0;for(;u<r.length;u++){const v=r[u],b=a[0],T=g.sub(f),A=v.sub(f),L=b.sub(f),z=ah(T,T),O=ah(T,A),V=ah(A,A),$=ah(L,T),X=ah(L,A),ae=z*V-O*O,oe=(V*$-O*X)/ae,ve=(z*X-O*$)/ae,Se=f.z*(1-oe-ve)+g.z*oe+v.z*ve;if(isFinite(Se))return Se}return 1/0}{let u=1/0;for(const f of r)u=Math.min(u,f.z);return u}}const zC=Hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:DC}=zC,OC=Hn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:FC}=OC,BC=fa.VectorTileFeature.types,NC=Math.cos(Math.PI/180*37.5),t1=Math.pow(2,14)/.5;class $g{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new $t,this.layoutVertexArray2=new ln,this.indexArray=new $i,this.programConfigurations=new pl(r.layers,r.zoom),this.segments=new Nt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=Vg("line",this.layers,u);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),b=[];for(const{feature:T,id:A,index:L,sourceLayerIndex:z}of r){const O=this.layers[0]._featureFilter.needGeometry,V=gl(T,O);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),V,f))continue;const $=v?g.evaluate(V,{},f):void 0,X={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:L,geometry:O?V.geometry:ml(T),patterns:{},sortKey:$};b.push(X)}v&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:L,sourceLayerIndex:z}=T;if(this.hasPattern){const O=jg("line",this.layers,T,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(T,A,L,f,{});u.featureIndex.insert(r[L].feature,A,L,z,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,FC)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,DC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,u,f,g,v){const b=this.layers[0].layout,T=b.get("line-join").evaluate(r,{}),A=b.get("line-cap"),L=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of u)this.addLine(O,r,T,A,L,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,v,g)}addLine(r,u,f,g,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<r.length-1;ve++)this.totalDistance+=r[ve].dist(r[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=BC[u.type]==="Polygon";let A=r.length;for(;A>=2&&r[A-1].equals(r[A-2]);)A--;let L=0;for(;L<A-1&&r[L].equals(r[L+1]);)L++;if(A<(T?3:2))return;f==="bevel"&&(v=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,$,X,ae,oe;this.e1=this.e2=-1,T&&(V=r[A-2],oe=r[L].sub(V)._unit()._perp());for(let ve=L;ve<A;ve++){if(X=ve===A-1?T?r[L+1]:void 0:r[ve+1],X&&r[ve].equals(X))continue;oe&&(ae=oe),V&&($=V),V=r[ve],oe=X?X.sub(V)._unit()._perp():ae,ae=ae||oe;let Se=ae.add(oe);Se.x===0&&Se.y===0||Se._unit();const ye=ae.x*oe.x+ae.y*oe.y,Ee=Se.x*oe.x+Se.y*oe.y,De=Ee!==0?1/Ee:1/0,ze=2*Math.sqrt(2-2*Ee),it=Ee<NC&&$&&X,ct=ae.x*oe.y-ae.y*oe.x>0;if(it&&ve>L){const We=V.dist($);if(We>2*z){const Qe=V.sub(V.sub($)._mult(z/We)._round());this.updateDistance($,Qe),this.addCurrentVertex(Qe,ae,0,0,O),$=Qe}}const Je=$&&X;let Ze=Je?f:T?"butt":g;if(Je&&Ze==="round"&&(De<b?Ze="miter":De<=2&&(Ze="fakeround")),Ze==="miter"&&De>v&&(Ze="bevel"),Ze==="bevel"&&(De>2&&(Ze="flipbevel"),De<v&&(Ze="miter")),$&&this.updateDistance($,V),Ze==="miter")Se._mult(De),this.addCurrentVertex(V,Se,0,0,O);else if(Ze==="flipbevel"){if(De>100)Se=oe.mult(-1);else{const We=De*ae.add(oe).mag()/ae.sub(oe).mag();Se._perp()._mult(We*(ct?-1:1))}this.addCurrentVertex(V,Se,0,0,O),this.addCurrentVertex(V,Se.mult(-1),0,0,O)}else if(Ze==="bevel"||Ze==="fakeround"){const We=-Math.sqrt(De*De-1),Qe=ct?We:0,Xe=ct?0:We;if($&&this.addCurrentVertex(V,ae,Qe,Xe,O),Ze==="fakeround"){const Ue=Math.round(180*ze/Math.PI/20);for(let yt=1;yt<Ue;yt++){let ft=yt/Ue;if(ft!==.5){const _n=ft-.5;ft+=ft*_n*(ft-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*_n*_n+(.848013+ye*(.215638*ye-1.06021)))}const Ot=oe.sub(ae)._mult(ft)._add(ae)._unit()._mult(ct?-1:1);this.addHalfVertex(V,Ot.x,Ot.y,!1,ct,0,O)}}X&&this.addCurrentVertex(V,oe,-Qe,-Xe,O)}else if(Ze==="butt")this.addCurrentVertex(V,Se,0,0,O);else if(Ze==="square"){const We=$?1:-1;this.addCurrentVertex(V,Se,We,We,O)}else Ze==="round"&&($&&(this.addCurrentVertex(V,ae,0,0,O),this.addCurrentVertex(V,ae,1,1,O,!0)),X&&(this.addCurrentVertex(V,oe,-1,-1,O,!0),this.addCurrentVertex(V,oe,0,0,O)));if(it&&ve<A-1){const We=V.dist(X);if(We>2*z){const Qe=V.add(X.sub(V)._mult(z/We)._round());this.updateDistance(V,Qe),this.addCurrentVertex(Qe,oe,0,0,O),V=Qe}}}}addCurrentVertex(r,u,f,g,v,b=!1){const T=u.y*g-u.x,A=-u.y-u.x*g;this.addHalfVertex(r,u.x+u.y*f,u.y-u.x*f,b,!1,f,v),this.addHalfVertex(r,T,A,b,!0,-g,v),this.distance>t1/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(r,u,f,g,v,b))}addHalfVertex({x:r,y:u},f,g,v,b,T,A){const L=.5*(this.lineClips?this.scaledDistance*(t1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(v?1:0),(u<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),A.primitiveLength++),b?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,u){this.distance+=r.dist(u),this.updateScaledDistance()}}st("LineBucket",$g,{omit:["layers","patternFeatures"]});const UC=new pi({"line-cap":new ht(Me.layout_line["line-cap"]),"line-join":new wt(Me.layout_line["line-join"]),"line-miter-limit":new ht(Me.layout_line["line-miter-limit"]),"line-round-limit":new ht(Me.layout_line["line-round-limit"]),"line-sort-key":new wt(Me.layout_line["line-sort-key"])});var n1={paint:new pi({"line-opacity":new wt(Me.paint_line["line-opacity"]),"line-color":new wt(Me.paint_line["line-color"]),"line-translate":new ht(Me.paint_line["line-translate"]),"line-translate-anchor":new ht(Me.paint_line["line-translate-anchor"]),"line-width":new wt(Me.paint_line["line-width"]),"line-gap-width":new wt(Me.paint_line["line-gap-width"]),"line-offset":new wt(Me.paint_line["line-offset"]),"line-blur":new wt(Me.paint_line["line-blur"]),"line-dasharray":new Zu(Me.paint_line["line-dasharray"]),"line-pattern":new ua(Me.paint_line["line-pattern"]),"line-gradient":new Ys(Me.paint_line["line-gradient"])}),layout:UC};const i1=new class extends wt{possiblyEvaluate(a,r){return r=new xn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,u,f){return r=G({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,u,f)}}(n1.paint.properties["line-width"].specification);function r1(a,r){return r>0?r+2*a:a}i1.useIntegerZoom=!0;const VC=Hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jC=Hn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const GC=Hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Hn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const s1=Hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WC=Hn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function HC(a,r,u){return a.sections.forEach(f=>{f.text=function(g,v,b){const T=v.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),wr.applyArabicShaping&&(g=wr.applyArabicShaping(g)),g}(f.text,r,u)}),a}Hn([{name:"triangle",components:3,type:"Uint16"}]),Hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Hn([{type:"Float32",name:"offsetX"}]),Hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const lh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var mi=24,qg=hn,o1=function(a,r,u,f,g){var v,b,T=8*g-f-1,A=(1<<T)-1,L=A>>1,z=-7,O=u?g-1:0,V=u?-1:1,$=a[r+O];for(O+=V,v=$&(1<<-z)-1,$>>=-z,z+=T;z>0;v=256*v+a[r+O],O+=V,z-=8);for(b=v&(1<<-z)-1,v>>=-z,z+=f;z>0;b=256*b+a[r+O],O+=V,z-=8);if(v===0)v=1-L;else{if(v===A)return b?NaN:1/0*($?-1:1);b+=Math.pow(2,f),v-=L}return($?-1:1)*b*Math.pow(2,v-f)},a1=function(a,r,u,f,g,v){var b,T,A,L=8*v-g-1,z=(1<<L)-1,O=z>>1,V=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=f?0:v-1,X=f?1:-1,ae=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,b=z):(b=Math.floor(Math.log(r)/Math.LN2),r*(A=Math.pow(2,-b))<1&&(b--,A*=2),(r+=b+O>=1?V/A:V*Math.pow(2,1-O))*A>=2&&(b++,A/=2),b+O>=z?(T=0,b=z):b+O>=1?(T=(r*A-1)*Math.pow(2,g),b+=O):(T=r*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;a[u+$]=255&T,$+=X,T/=256,g-=8);for(b=b<<g|T,L+=g;L>0;a[u+$]=255&b,$+=X,b/=256,L-=8);a[u+$-X]|=128*ae};function hn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}hn.Varint=0,hn.Fixed64=1,hn.Bytes=2,hn.Fixed32=5;var pa,Zg=4294967296,l1=1/Zg,c1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Po(a){return a.type===hn.Bytes?a.readVarint()+a.pos:a.pos+1}function yc(a,r,u){return u?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function u1(a,r,u){var f=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));u.realloc(f);for(var g=u.pos-1;g>=a;g--)u.buf[g+f]=u.buf[g]}function $C(a,r){for(var u=0;u<a.length;u++)r.writeVarint(a[u])}function qC(a,r){for(var u=0;u<a.length;u++)r.writeSVarint(a[u])}function ZC(a,r){for(var u=0;u<a.length;u++)r.writeFloat(a[u])}function XC(a,r){for(var u=0;u<a.length;u++)r.writeDouble(a[u])}function YC(a,r){for(var u=0;u<a.length;u++)r.writeBoolean(a[u])}function KC(a,r){for(var u=0;u<a.length;u++)r.writeFixed32(a[u])}function JC(a,r){for(var u=0;u<a.length;u++)r.writeSFixed32(a[u])}function QC(a,r){for(var u=0;u<a.length;u++)r.writeFixed64(a[u])}function eI(a,r){for(var u=0;u<a.length;u++)r.writeSFixed64(a[u])}function Lf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function vc(a,r,u){a[u]=r,a[u+1]=r>>>8,a[u+2]=r>>>16,a[u+3]=r>>>24}function h1(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function tI(a,r,u){a===1&&u.readMessage(nI,r)}function nI(a,r,u){if(a===3){const{id:f,bitmap:g,width:v,height:b,left:T,top:A,advance:L}=u.readMessage(iI,{});r.push({id:f,bitmap:new th({width:v+6,height:b+6},g),metrics:{width:v,height:b,left:T,top:A,advance:L}})}}function iI(a,r,u){a===1?r.id=u.readVarint():a===2?r.bitmap=u.readBytes():a===3?r.width=u.readVarint():a===4?r.height=u.readVarint():a===5?r.left=u.readSVarint():a===6?r.top=u.readSVarint():a===7&&(r.advance=u.readVarint())}function d1(a){let r=0,u=0;for(const b of a)r+=b.w*b.h,u=Math.max(u,b.w);a.sort((b,T)=>T.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),u),h:1/0}];let g=0,v=0;for(const b of a)for(let T=f.length-1;T>=0;T--){const A=f[T];if(!(b.w>A.w||b.h>A.h)){if(b.x=A.x,b.y=A.y,v=Math.max(v,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===A.w&&b.h===A.h){const L=f.pop();T<f.length&&(f[T]=L)}else b.h===A.h?(A.x+=b.w,A.w-=b.w):b.w===A.w?(A.y+=b.h,A.h-=b.h):(f.push({x:A.x+b.w,y:A.y,w:A.w-b.w,h:b.h}),A.y+=b.h,A.h-=b.h);break}}return{w:g,h:v,fill:r/(g*v)||0}}hn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,a(g,r,this),this.pos===v&&this.skip(f)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Lf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=h1(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Lf(this.buf,this.pos)+Lf(this.buf,this.pos+4)*Zg;return this.pos+=8,a},readSFixed64:function(){var a=Lf(this.buf,this.pos)+h1(this.buf,this.pos+4)*Zg;return this.pos+=8,a},readFloat:function(){var a=o1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=o1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,u,f=this.buf;return r=127&(u=f[this.pos++]),u<128?r:(r|=(127&(u=f[this.pos++]))<<7,u<128?r:(r|=(127&(u=f[this.pos++]))<<14,u<128?r:(r|=(127&(u=f[this.pos++]))<<21,u<128?r:function(g,v,b){var T,A,L=b.buf;if(T=(112&(A=L[b.pos++]))>>4,A<128||(T|=(127&(A=L[b.pos++]))<<3,A<128)||(T|=(127&(A=L[b.pos++]))<<10,A<128)||(T|=(127&(A=L[b.pos++]))<<17,A<128)||(T|=(127&(A=L[b.pos++]))<<24,A<128)||(T|=(1&(A=L[b.pos++]))<<31,A<128))return yc(g,T,v);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(u=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&c1?function(u,f,g){return c1.decode(u.subarray(f,g))}(this.buf,r,a):function(u,f,g){for(var v="",b=f;b<g;){var T,A,L,z=u[b],O=null,V=z>239?4:z>223?3:z>191?2:1;if(b+V>g)break;V===1?z<128&&(O=z):V===2?(192&(T=u[b+1]))==128&&(O=(31&z)<<6|63&T)<=127&&(O=null):V===3?(A=u[b+2],(192&(T=u[b+1]))==128&&(192&A)==128&&((O=(15&z)<<12|(63&T)<<6|63&A)<=2047||O>=55296&&O<=57343)&&(O=null)):V===4&&(A=u[b+2],L=u[b+3],(192&(T=u[b+1]))==128&&(192&A)==128&&(192&L)==128&&((O=(15&z)<<18|(63&T)<<12|(63&A)<<6|63&L)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,V=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),b+=V}return v}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==hn.Bytes)return a.push(this.readVarint(r));var u=Po(this);for(a=a||[];this.pos<u;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==hn.Bytes)return a.push(this.readSVarint());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==hn.Bytes)return a.push(this.readBoolean());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==hn.Bytes)return a.push(this.readFloat());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==hn.Bytes)return a.push(this.readDouble());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==hn.Bytes)return a.push(this.readFixed32());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==hn.Bytes)return a.push(this.readSFixed32());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==hn.Bytes)return a.push(this.readFixed64());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==hn.Bytes)return a.push(this.readSFixed64());var r=Po(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===hn.Varint)for(;this.buf[this.pos++]>127;);else if(r===hn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===hn.Fixed32)this.pos+=4;else{if(r!==hn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var u=new Uint8Array(r);u.set(this.buf),this.buf=u,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),vc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),vc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),vc(this.buf,-1&a,this.pos),vc(this.buf,Math.floor(a*l1),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),vc(this.buf,-1&a,this.pos),vc(this.buf,Math.floor(a*l1),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,u){var f,g;if(r>=0?(f=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(f=~(-r%4294967296))?f=f+1|0:(f=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,b,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(f,0,u),function(v,b){var T=(7&v)<<4;b.buf[b.pos++]|=T|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(g,u)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(f,g,v){for(var b,T,A=0;A<g.length;A++){if((b=g.charCodeAt(A))>55295&&b<57344){if(!T){b>56319||A+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):T=b;continue}if(b<56320){f[v++]=239,f[v++]=191,f[v++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(f[v++]=239,f[v++]=191,f[v++]=189,T=null);b<128?f[v++]=b:(b<2048?f[v++]=b>>6|192:(b<65536?f[v++]=b>>12|224:(f[v++]=b>>18|240,f[v++]=b>>12&63|128),f[v++]=b>>6&63|128),f[v++]=63&b|128)}return v}(this.buf,a,this.pos);var u=this.pos-r;u>=128&&u1(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeFloat:function(a){this.realloc(4),a1(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),a1(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var u=0;u<r;u++)this.buf[this.pos++]=a[u]},writeRawMessage:function(a,r){this.pos++;var u=this.pos;a(r,this);var f=this.pos-u;f>=128&&u1(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,r,u){this.writeTag(a,hn.Bytes),this.writeRawMessage(r,u)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,$C,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,qC,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,YC,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,ZC,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,XC,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,KC,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,JC,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,QC,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,eI,r)},writeBytesField:function(a,r){this.writeTag(a,hn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,hn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,hn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,hn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,hn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,hn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,hn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,hn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,hn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,hn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};class Xg{constructor(r,{pixelRatio:u,version:f,stretchX:g,stretchY:v,content:b}){this.paddedRect=r,this.pixelRatio=u,this.stretchX=g,this.stretchY=v,this.content=b,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class f1{constructor(r,u){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(r,f,v),this.addImages(u,g,v);const{w:b,h:T}=d1(v),A=new Nr({width:b||1,height:T||1});for(const L in r){const z=r[L],O=f[L].paddedRect;Nr.copy(z.data,A,{x:0,y:0},{x:O.x+1,y:O.y+1},z.data)}for(const L in u){const z=u[L],O=g[L].paddedRect,V=O.x+1,$=O.y+1,X=z.data.width,ae=z.data.height;Nr.copy(z.data,A,{x:0,y:0},{x:V,y:$},z.data),Nr.copy(z.data,A,{x:0,y:ae-1},{x:V,y:$-1},{width:X,height:1}),Nr.copy(z.data,A,{x:0,y:0},{x:V,y:$+ae},{width:X,height:1}),Nr.copy(z.data,A,{x:X-1,y:0},{x:V-1,y:$},{width:1,height:ae}),Nr.copy(z.data,A,{x:0,y:0},{x:V+X,y:$},{width:1,height:ae})}this.image=A,this.iconPositions=f,this.patternPositions=g}addImages(r,u,f){for(const g in r){const v=r[g],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};f.push(b),u[g]=new Xg(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,u){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in r.updatedImages)this.patchUpdatedImage(this.iconPositions[f],r.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],r.getImage(f),u)}patchUpdatedImage(r,u,f){if(!r||!u||r.version===u.version)return;r.version=u.version;const[g,v]=r.tl;f.update(u.data,void 0,{x:g,y:v})}}st("ImagePosition",Xg),st("ImageAtlas",f1),l.WritingMode=void 0,(pa=l.WritingMode||(l.WritingMode={}))[pa.none=0]="none",pa[pa.horizontal=1]="horizontal",pa[pa.vertical=2]="vertical",pa[pa.horizontalOnly=3]="horizontalOnly";const kf=-17;class ch{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,u){const f=new ch;return f.scale=r||1,f.fontStack=u,f}static forImage(r){const u=new ch;return u.imageName=r,u}}class xc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,u){const f=new xc;for(let g=0;g<r.sections.length;g++){const v=r.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,u)}return f}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let u="";for(let f=0;f<r.length;f++){const g=r.charCodeAt(f+1)||null,v=r.charCodeAt(f-1)||null;u+=g&&df(g)&&!lh[r[f+1]]||v&&df(v)&&!lh[r[f-1]]||!lh[r[f]]?r[f]:lh[r[f]]}return u}(this.text)}trim(){let r=0;for(let f=0;f<this.text.length&&zf[this.text.charCodeAt(f)];f++)r++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=r&&zf[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(r,u),this.sectionIndex=this.sectionIndex.slice(r,u)}substring(r,u){const f=new xc;return f.text=this.text.substring(r,u),f.sectionIndex=this.sectionIndex.slice(r,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,u)=>Math.max(r,this.sections[u].scale),0)}addTextSection(r,u){this.text+=r.text,this.sections.push(ch.forText(r.scale,r.fontStack||u));const f=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(f)}addImageSection(r){const u=r.image?r.image.name:"";if(u.length===0)return void pe("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ch.forImage(u)),this.sectionIndex.push(this.sections.length-1)):pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rf(a,r,u,f,g,v,b,T,A,L,z,O,V,$,X,ae){const oe=xc.fromFeature(a,g);let ve;O===l.WritingMode.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:ye}=wr;if(Se&&oe.sections.length===1){ve=[];const ze=Se(oe.toString(),Yg(oe,L,v,r,f,$,X));for(const it of ze){const ct=new xc;ct.text=it,ct.sections=oe.sections;for(let Je=0;Je<it.length;Je++)ct.sectionIndex.push(0);ve.push(ct)}}else if(ye){ve=[];const ze=ye(oe.text,oe.sectionIndex,Yg(oe,L,v,r,f,$,X));for(const it of ze){const ct=new xc;ct.text=it[0],ct.sectionIndex=it[1],ct.sections=oe.sections,ve.push(ct)}}else ve=function(ze,it){const ct=[],Je=ze.text;let Ze=0;for(const We of it)ct.push(ze.substring(Ze,We)),Ze=We;return Ze<Je.length&&ct.push(ze.substring(Ze,Je.length)),ct}(oe,Yg(oe,L,v,r,f,$,X));const Ee=[],De={positionedLines:Ee,text:oe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(ze,it,ct,Je,Ze,We,Qe,Xe,Ue,yt,ft,Ot){let _n=0,wn=kf,ti=0,Vr=0;const Ti=Xe==="right"?1:Xe==="left"?0:.5;let $n=0;for(const qn of Ze){qn.trim();const Ai=qn.getMaxScale(),Oi=(Ai-1)*mi,Xi={positionedGlyphs:[],lineOffset:0};ze.positionedLines[$n]=Xi;const ur=Xi.positionedGlyphs;let hr=0;if(!qn.length()){wn+=We,++$n;continue}for(let ui=0;ui<qn.length();ui++){const jt=qn.getSection(ui),Sr=qn.getSectionIndex(ui),Pi=qn.getCharCode(ui);let Fi=0,ds=null,Cs=null,Is=null,Io=mi;const fs=!(Ue===l.WritingMode.horizontal||!ft&&!ju(Pi)||ft&&(zf[Pi]||(ci=Pi,Ke.Arabic(ci)||Ke["Arabic Supplement"](ci)||Ke["Arabic Extended-A"](ci)||Ke["Arabic Presentation Forms-A"](ci)||Ke["Arabic Presentation Forms-B"](ci))));if(jt.imageName){const jr=Je[jt.imageName];if(!jr)continue;Is=jt.imageName,ze.iconsInText=ze.iconsInText||!0,Cs=jr.paddedRect;const dr=jr.displaySize;jt.scale=jt.scale*mi/Ot,ds={width:dr[0],height:dr[1],left:1,top:-3,advance:fs?dr[1]:dr[0]},Fi=Oi+(mi-dr[1]*jt.scale),Io=ds.advance;const Mo=fs?dr[0]*jt.scale-mi*Ai:dr[1]*jt.scale-mi*Ai;Mo>0&&Mo>hr&&(hr=Mo)}else{const jr=ct[jt.fontStack],dr=jr&&jr[Pi];if(dr&&dr.rect)Cs=dr.rect,ds=dr.metrics;else{const Mo=it[jt.fontStack],dh=Mo&&Mo[Pi];if(!dh)continue;ds=dh.metrics}Fi=(Ai-jt.scale)*mi}fs?(ze.verticalizable=!0,ur.push({glyph:Pi,imageName:Is,x:_n,y:wn+Fi,vertical:fs,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Sr,metrics:ds,rect:Cs}),_n+=Io*jt.scale+yt):(ur.push({glyph:Pi,imageName:Is,x:_n,y:wn+Fi,vertical:fs,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Sr,metrics:ds,rect:Cs}),_n+=ds.advance*jt.scale+yt)}ur.length!==0&&(ti=Math.max(_n-yt,ti),oI(ur,0,ur.length-1,Ti,hr)),_n=0;const Tn=We*Ai+hr;Xi.lineOffset=Math.max(hr,Oi),wn+=Tn,Vr=Math.max(Tn,Vr),++$n}var ci;const Si=wn-kf,{horizontalAlign:Di,verticalAlign:cr}=Kg(Qe);(function(qn,Ai,Oi,Xi,ur,hr,Tn,ui,jt){const Sr=(Ai-Oi)*ur;let Pi=0;Pi=hr!==Tn?-ui*Xi-kf:(-Xi*jt+.5)*Tn;for(const Fi of qn)for(const ds of Fi.positionedGlyphs)ds.x+=Sr,ds.y+=Pi})(ze.positionedLines,Ti,Di,cr,ti,Vr,We,Si,Ze.length),ze.top+=-cr*Si,ze.bottom=ze.top+Si,ze.left+=-Di*ti,ze.right=ze.left+ti}(De,r,u,f,ve,b,T,A,O,L,V,ae),!function(ze){for(const it of ze)if(it.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&De}const zf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function p1(a,r,u,f,g,v){if(r.imageName){const b=f[r.imageName];return b?b.displaySize[0]*r.scale*mi/v+g:0}{const b=u[r.fontStack],T=b&&b[a];return T?T.metrics.advance*r.scale+g:0}}function m1(a,r,u,f){const g=Math.pow(a-r,2);return f?a<r?g/2:2*g:g+Math.abs(u)*u}function sI(a,r,u){let f=0;return a===10&&(f-=1e4),u&&(f+=150),a!==40&&a!==65288||(f+=50),r!==41&&r!==65289||(f+=50),f}function g1(a,r,u,f,g,v){let b=null,T=m1(r,u,g,v);for(const A of f){const L=m1(r-A.x,u,g,v)+A.badness;L<=T&&(b=A,T=L)}return{index:a,x:r,priorBreak:b,badness:T}}function _1(a){return a?_1(a.priorBreak).concat(a.index):[]}function Yg(a,r,u,f,g,v,b){if(v!=="point")return[];if(!a)return[];const T=[],A=function(V,$,X,ae,oe,ve){let Se=0;for(let ye=0;ye<V.length();ye++){const Ee=V.getSection(ye);Se+=p1(V.getCharCode(ye),Ee,ae,oe,$,ve)}return Se/Math.max(1,Math.ceil(Se/X))}(a,r,u,f,g,b),L=a.text.indexOf("")>=0;let z=0;for(let V=0;V<a.length();V++){const $=a.getSection(V),X=a.getCharCode(V);if(zf[X]||(z+=p1(X,$,f,g,r,b)),V<a.length()-1){const ae=!((O=X)<11904||!(Ke["Bopomofo Extended"](O)||Ke.Bopomofo(O)||Ke["CJK Compatibility Forms"](O)||Ke["CJK Compatibility Ideographs"](O)||Ke["CJK Compatibility"](O)||Ke["CJK Radicals Supplement"](O)||Ke["CJK Strokes"](O)||Ke["CJK Symbols and Punctuation"](O)||Ke["CJK Unified Ideographs Extension A"](O)||Ke["CJK Unified Ideographs"](O)||Ke["Enclosed CJK Letters and Months"](O)||Ke["Halfwidth and Fullwidth Forms"](O)||Ke.Hiragana(O)||Ke["Ideographic Description Characters"](O)||Ke["Kangxi Radicals"](O)||Ke["Katakana Phonetic Extensions"](O)||Ke.Katakana(O)||Ke["Vertical Forms"](O)||Ke["Yi Radicals"](O)||Ke["Yi Syllables"](O)));(rI[X]||ae||$.imageName)&&T.push(g1(V+1,z,A,T,sI(X,a.getCharCode(V+1),ae&&L),!1))}}var O;return _1(g1(a.length(),z,A,T,0,!0))}function Kg(a){let r=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:r,verticalAlign:u}}function oI(a,r,u,f,g){if(!f&&!g)return;const v=a[u],b=(a[u].x+v.metrics.advance*v.scale)*f;for(let T=r;T<=u;T++)a[T].x-=b,a[T].y+=g}function aI(a,r,u){const{horizontalAlign:f,verticalAlign:g}=Kg(u),v=r[0]-a.displaySize[0]*f,b=r[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function y1(a,r,u,f,g,v){const b=a.image;let T;if(b.content){const oe=b.content,ve=b.pixelRatio||1;T=[oe[0]/ve,oe[1]/ve,b.displaySize[0]-oe[2]/ve,b.displaySize[1]-oe[3]/ve]}const A=r.left*v,L=r.right*v;let z,O,V,$;u==="width"||u==="both"?($=g[0]+A-f[3],O=g[0]+L+f[1]):($=g[0]+(A+L-b.displaySize[0])/2,O=$+b.displaySize[0]);const X=r.top*v,ae=r.bottom*v;return u==="height"||u==="both"?(z=g[1]+X-f[0],V=g[1]+ae+f[2]):(z=g[1]+(X+ae-b.displaySize[1])/2,V=z+b.displaySize[1]),{image:b,top:z,right:O,bottom:V,left:$,collisionPadding:T}}const Co=128;function v1(a,r){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new xn(a+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=u;let v=0;for(;v<f.length&&f[v]<=a;)v++;v=Math.max(0,v-1);let b=v;for(;b<f.length&&f[b]<a+1;)b++;b=Math.min(f.length-1,b);const T=f[v],A=f[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:A,minSize:u.evaluate(new xn(T)),maxSize:u.evaluate(new xn(A)),interpolationType:g}}}class ma extends xt{constructor(r,u,f,g){super(r,u),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new ma(this.x,this.y,this.angle,this.segment)}}function x1(a,r,u,f,g){if(r.segment===void 0)return!0;let v=r,b=r.segment+1,T=0;for(;T>-u/2;){if(b--,b<0)return!1;T-=a[b].dist(v),v=a[b]}T+=a[b].dist(a[b+1]),b++;const A=[];let L=0;for(;T<u/2;){const z=a[b],O=a[b+1];if(!O)return!1;let V=a[b-1].angleTo(z)-z.angleTo(O);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:V}),L+=V;T-A[0].distance>f;)L-=A.shift().angleDelta;if(L>g)return!1;b++,T+=z.dist(O)}return!0}function b1(a){let r=0;for(let u=0;u<a.length-1;u++)r+=a[u].dist(a[u+1]);return r}function w1(a,r,u){return a?.6*r*u:0}function E1(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function lI(a,r,u,f,g,v){const b=w1(u,g,v),T=E1(u,f)*v;let A=0;const L=b1(a)/2;for(let z=0;z<a.length-1;z++){const O=a[z],V=a[z+1],$=O.dist(V);if(A+$>L){const X=(L-A)/$,ae=zt(O.x,V.x,X),oe=zt(O.y,V.y,X),ve=new ma(ae,oe,V.angleTo(O),z);return ve._round(),!b||x1(a,ve,T,b,r)?ve:void 0}A+=$}}function cI(a,r,u,f,g,v,b,T,A){const L=w1(f,v,b),z=E1(f,g),O=z*b,V=a[0].x===0||a[0].x===A||a[0].y===0||a[0].y===A;return r-O<r/4&&(r=O+r/4),T1(a,V?r/2*T%r:(z/2+2*v)*b*T%r,r,L,u,O,V,!1,A)}function T1(a,r,u,f,g,v,b,T,A){const L=v/2,z=b1(a);let O=0,V=r-u,$=[];for(let X=0;X<a.length-1;X++){const ae=a[X],oe=a[X+1],ve=ae.dist(oe),Se=oe.angleTo(ae);for(;V+u<O+ve;){V+=u;const ye=(V-O)/ve,Ee=zt(ae.x,oe.x,ye),De=zt(ae.y,oe.y,ye);if(Ee>=0&&Ee<A&&De>=0&&De<A&&V-L>=0&&V+L<=z){const ze=new ma(Ee,De,Se,X);ze._round(),f&&!x1(a,ze,v,f,g)||$.push(ze)}}O+=ve}return T||$.length||b||($=T1(a,O/2,u,f,g,v,b,!0,A)),$}function S1(a,r,u,f,g){const v=[];for(let b=0;b<a.length;b++){const T=a[b];let A;for(let L=0;L<T.length-1;L++){let z=T[L],O=T[L+1];z.x<r&&O.x<r||(z.x<r?z=new xt(r,z.y+(r-z.x)/(O.x-z.x)*(O.y-z.y))._round():O.x<r&&(O=new xt(r,z.y+(r-z.x)/(O.x-z.x)*(O.y-z.y))._round()),z.y<u&&O.y<u||(z.y<u?z=new xt(z.x+(u-z.y)/(O.y-z.y)*(O.x-z.x),u)._round():O.y<u&&(O=new xt(z.x+(u-z.y)/(O.y-z.y)*(O.x-z.x),u)._round()),z.x>=f&&O.x>=f||(z.x>=f?z=new xt(f,z.y+(f-z.x)/(O.x-z.x)*(O.y-z.y))._round():O.x>=f&&(O=new xt(f,z.y+(f-z.x)/(O.x-z.x)*(O.y-z.y))._round()),z.y>=g&&O.y>=g||(z.y>=g?z=new xt(z.x+(g-z.y)/(O.y-z.y)*(O.x-z.x),g)._round():O.y>=g&&(O=new xt(z.x+(g-z.y)/(O.y-z.y)*(O.x-z.x),g)._round()),A&&z.equals(A[A.length-1])||(A=[z],v.push(A)),A.push(O)))))}}return v}function A1(a,r,u,f){const g=[],v=a.image,b=v.pixelRatio,T=v.paddedRect.w-2,A=v.paddedRect.h-2,L=a.right-a.left,z=a.bottom-a.top,O=v.stretchX||[[0,T]],V=v.stretchY||[[0,A]],$=(We,Qe)=>We+Qe[1]-Qe[0],X=O.reduce($,0),ae=V.reduce($,0),oe=T-X,ve=A-ae;let Se=0,ye=X,Ee=0,De=ae,ze=0,it=oe,ct=0,Je=ve;if(v.content&&f){const We=v.content;Se=Df(O,0,We[0]),Ee=Df(V,0,We[1]),ye=Df(O,We[0],We[2]),De=Df(V,We[1],We[3]),ze=We[0]-Se,ct=We[1]-Ee,it=We[2]-We[0]-ye,Je=We[3]-We[1]-De}const Ze=(We,Qe,Xe,Ue)=>{const yt=Of(We.stretch-Se,ye,L,a.left),ft=Ff(We.fixed-ze,it,We.stretch,X),Ot=Of(Qe.stretch-Ee,De,z,a.top),_n=Ff(Qe.fixed-ct,Je,Qe.stretch,ae),wn=Of(Xe.stretch-Se,ye,L,a.left),ti=Ff(Xe.fixed-ze,it,Xe.stretch,X),Vr=Of(Ue.stretch-Ee,De,z,a.top),Ti=Ff(Ue.fixed-ct,Je,Ue.stretch,ae),$n=new xt(yt,Ot),ci=new xt(wn,Ot),Si=new xt(wn,Vr),Di=new xt(yt,Vr),cr=new xt(ft/b,_n/b),qn=new xt(ti/b,Ti/b),Ai=r*Math.PI/180;if(Ai){const ur=Math.sin(Ai),hr=Math.cos(Ai),Tn=[hr,-ur,ur,hr];$n._matMult(Tn),ci._matMult(Tn),Di._matMult(Tn),Si._matMult(Tn)}const Oi=We.stretch+We.fixed,Xi=Qe.stretch+Qe.fixed;return{tl:$n,tr:ci,bl:Di,br:Si,tex:{x:v.paddedRect.x+1+Oi,y:v.paddedRect.y+1+Xi,w:Xe.stretch+Xe.fixed-Oi,h:Ue.stretch+Ue.fixed-Xi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:qn,minFontScaleX:it/b/L,minFontScaleY:Je/b/z,isSDF:u}};if(f&&(v.stretchX||v.stretchY)){const We=P1(O,oe,X),Qe=P1(V,ve,ae);for(let Xe=0;Xe<We.length-1;Xe++){const Ue=We[Xe],yt=We[Xe+1];for(let ft=0;ft<Qe.length-1;ft++)g.push(Ze(Ue,Qe[ft],yt,Qe[ft+1]))}}else g.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return g}function Df(a,r,u){let f=0;for(const g of a)f+=Math.max(r,Math.min(u,g[1]))-Math.max(r,Math.min(u,g[0]));return f}function P1(a,r,u){const f=[{fixed:-1,stretch:0}];for(const[g,v]of a){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(v-g)})}return f.push({fixed:r+1,stretch:u}),f}function Of(a,r,u,f){return a/r*u+f}function Ff(a,r,u,f){return a-r*u/f}st("Anchor",ma);class Bf{constructor(r,u,f,g,v,b,T,A,L,z){if(this.boxStartIndex=r.length,L){let O=b.top,V=b.bottom;const $=b.collisionPadding;$&&(O-=$[1],V+=$[3]);let X=V-O;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let O=b.top*T-A[0],V=b.bottom*T+A[2],$=b.left*T-A[3],X=b.right*T+A[1];const ae=b.collisionPadding;if(ae&&($-=ae[0]*T,O-=ae[1]*T,X+=ae[2]*T,V+=ae[3]*T),z){const oe=new xt($,O),ve=new xt(X,O),Se=new xt($,V),ye=new xt(X,V),Ee=z*Math.PI/180;oe._rotate(Ee),ve._rotate(Ee),Se._rotate(Ee),ye._rotate(Ee),$=Math.min(oe.x,ve.x,Se.x,ye.x),X=Math.max(oe.x,ve.x,Se.x,ye.x),O=Math.min(oe.y,ve.y,Se.y,ye.y),V=Math.max(oe.y,ve.y,Se.y,ye.y)}r.emplaceBack(u.x,u.y,$,O,X,V,f,g,v)}this.boxEndIndex=r.length}}class uI{constructor(r=[],u=hI){if(this.data=r,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:u,compare:f}=this,g=u[r];for(;r>0;){const v=r-1>>1,b=u[v];if(f(g,b)>=0)break;u[r]=b,r=v}u[r]=g}_down(r){const{data:u,compare:f}=this,g=this.length>>1,v=u[r];for(;r<g;){let b=1+(r<<1),T=u[b];const A=b+1;if(A<this.length&&f(u[A],T)<0&&(b=A,T=u[A]),f(T,v)>=0)break;u[r]=T,r=b}u[r]=v}}function hI(a,r){return a<r?-1:a>r?1:0}function dI(a,r=1,u=!1){let f=1/0,g=1/0,v=-1/0,b=-1/0;const T=a[0];for(let $=0;$<T.length;$++){const X=T[$];(!$||X.x<f)&&(f=X.x),(!$||X.y<g)&&(g=X.y),(!$||X.x>v)&&(v=X.x),(!$||X.y>b)&&(b=X.y)}const A=Math.min(v-f,b-g);let L=A/2;const z=new uI([],fI);if(A===0)return new xt(f,g);for(let $=f;$<v;$+=A)for(let X=g;X<b;X+=A)z.push(new bc($+L,X+L,L,a));let O=function($){let X=0,ae=0,oe=0;const ve=$[0];for(let Se=0,ye=ve.length,Ee=ye-1;Se<ye;Ee=Se++){const De=ve[Se],ze=ve[Ee],it=De.x*ze.y-ze.x*De.y;ae+=(De.x+ze.x)*it,oe+=(De.y+ze.y)*it,X+=3*it}return new bc(ae/X,oe/X,0,$)}(a),V=z.length;for(;z.length;){const $=z.pop();($.d>O.d||!O.d)&&(O=$,u&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,V)),$.max-O.d<=r||(L=$.h/2,z.push(new bc($.p.x-L,$.p.y-L,L,a)),z.push(new bc($.p.x+L,$.p.y-L,L,a)),z.push(new bc($.p.x-L,$.p.y+L,L,a)),z.push(new bc($.p.x+L,$.p.y+L,L,a)),V+=4)}return u&&(console.log(`num probes: ${V}`),console.log(`best distance: ${O.d}`)),O.p}function fI(a,r){return r.max-a.max}function bc(a,r,u,f){this.p=new xt(a,r),this.h=u,this.d=function(g,v){let b=!1,T=1/0;for(let A=0;A<v.length;A++){const L=v[A];for(let z=0,O=L.length,V=O-1;z<O;V=z++){const $=L[z],X=L[V];$.y>g.y!=X.y>g.y&&g.x<(X.x-$.x)*(g.y-$.y)/(X.y-$.y)+$.x&&(b=!b),T=Math.min(T,Dx(g,$,X))}}return(b?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const Jg=Number.POSITIVE_INFINITY;function C1(a,r){return r[1]!==Jg?function(u,f,g){let v=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),u){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(u){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,b]}(a,r[0],r[1]):function(u,f){let g=0,v=0;f<0&&(f=0);const b=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-f;break;case"top":v=f-7}switch(u){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,v]}(a,r[0])}function Qg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pI(a,r,u,f,g,v,b,T,A,L,z){let O=v.textMaxSize.evaluate(r,{});O===void 0&&(O=b);const V=a.layers[0].layout,$=V.get("icon-offset").evaluate(r,{},z),X=M1(u.horizontal),ae=b/24,oe=a.tilePixelRatio*ae,ve=a.tilePixelRatio*O/24,Se=a.tilePixelRatio*T,ye=a.tilePixelRatio*V.get("symbol-spacing"),Ee=V.get("text-padding")*a.tilePixelRatio,De=function(Ue,yt,ft,Ot=1){const _n=Ue.get("icon-padding").evaluate(yt,{},ft),wn=_n&&_n.values;return[wn[0]*Ot,wn[1]*Ot,wn[2]*Ot,wn[3]*Ot]}(V,r,z,a.tilePixelRatio),ze=V.get("text-max-angle")/180*Math.PI,it=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",ct=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Je=V.get("symbol-placement"),Ze=ye/2,We=V.get("icon-text-fit");let Qe;f&&We!=="none"&&(a.allowVerticalPlacement&&u.vertical&&(Qe=y1(f,u.vertical,We,V.get("icon-text-fit-padding"),$,ae)),X&&(f=y1(f,X,We,V.get("icon-text-fit-padding"),$,ae)));const Xe=(Ue,yt)=>{yt.x<0||yt.x>=ei||yt.y<0||yt.y>=ei||function(ft,Ot,_n,wn,ti,Vr,Ti,$n,ci,Si,Di,cr,qn,Ai,Oi,Xi,ur,hr,Tn,ui,jt,Sr,Pi,Fi,ds){const Cs=ft.addToLineVertexArray(Ot,_n);let Is,Io,fs,jr,dr=0,Mo=0,dh=0,$1=0,c_=-1,u_=-1;const Lo={};let q1=li.exports(""),h_=0,d_=0;if($n._unevaluatedLayout.getValue("text-radial-offset")===void 0?[h_,d_]=$n.layout.get("text-offset").evaluate(jt,{},Fi).map(fr=>fr*mi):(h_=$n.layout.get("text-radial-offset").evaluate(jt,{},Fi)*mi,d_=Jg),ft.allowVerticalPlacement&&wn.vertical){const fr=$n.layout.get("text-rotate").evaluate(jt,{},Fi)+90;fs=new Bf(ci,Ot,Si,Di,cr,wn.vertical,qn,Ai,Oi,fr),Ti&&(jr=new Bf(ci,Ot,Si,Di,cr,Ti,ur,hr,Oi,fr))}if(ti){const fr=$n.layout.get("icon-rotate").evaluate(jt,{}),to=$n.layout.get("icon-text-fit")!=="none",fh=A1(ti,fr,Pi,to),ph=Ti?A1(Ti,fr,Pi,to):void 0;Io=new Bf(ci,Ot,Si,Di,cr,ti,ur,hr,!1,fr),dr=4*fh.length;const Y1=ft.iconSizeData;let vl=null;Y1.kind==="source"?(vl=[Co*$n.layout.get("icon-size").evaluate(jt,{})],vl[0]>ga&&pe(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Y1.kind==="composite"&&(vl=[Co*Sr.compositeIconSizes[0].evaluate(jt,{},Fi),Co*Sr.compositeIconSizes[1].evaluate(jt,{},Fi)],(vl[0]>ga||vl[1]>ga)&&pe(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,fh,vl,ui,Tn,jt,l.WritingMode.none,Ot,Cs.lineStartIndex,Cs.lineLength,-1,Fi),c_=ft.icon.placedSymbolArray.length-1,ph&&(Mo=4*ph.length,ft.addSymbols(ft.icon,ph,vl,ui,Tn,jt,l.WritingMode.vertical,Ot,Cs.lineStartIndex,Cs.lineLength,-1,Fi),u_=ft.icon.placedSymbolArray.length-1)}const Z1=Object.keys(wn.horizontal);for(const fr of Z1){const to=wn.horizontal[fr];if(!Is){q1=li.exports(to.text);const ph=$n.layout.get("text-rotate").evaluate(jt,{},Fi);Is=new Bf(ci,Ot,Si,Di,cr,to,qn,Ai,Oi,ph)}const fh=to.positionedLines.length===1;if(dh+=I1(ft,Ot,to,Vr,$n,Oi,jt,Xi,Cs,wn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,fh?Z1:[fr],Lo,c_,Sr,Fi),fh)break}wn.vertical&&($1+=I1(ft,Ot,wn.vertical,Vr,$n,Oi,jt,Xi,Cs,l.WritingMode.vertical,["vertical"],Lo,u_,Sr,Fi));const PI=Is?Is.boxStartIndex:ft.collisionBoxArray.length,CI=Is?Is.boxEndIndex:ft.collisionBoxArray.length,II=fs?fs.boxStartIndex:ft.collisionBoxArray.length,MI=fs?fs.boxEndIndex:ft.collisionBoxArray.length,LI=Io?Io.boxStartIndex:ft.collisionBoxArray.length,kI=Io?Io.boxEndIndex:ft.collisionBoxArray.length,RI=jr?jr.boxStartIndex:ft.collisionBoxArray.length,zI=jr?jr.boxEndIndex:ft.collisionBoxArray.length;let Ms=-1;const Gf=(fr,to)=>fr&&fr.circleDiameter?Math.max(fr.circleDiameter,to):to;Ms=Gf(Is,Ms),Ms=Gf(fs,Ms),Ms=Gf(Io,Ms),Ms=Gf(jr,Ms);const X1=Ms>-1?1:0;X1&&(Ms*=ds/mi),ft.glyphOffsetArray.length>=wc.MAX_GLYPHS&&pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,jt.sortKey),ft.symbolInstances.emplaceBack(Ot.x,Ot.y,Lo.right>=0?Lo.right:-1,Lo.center>=0?Lo.center:-1,Lo.left>=0?Lo.left:-1,Lo.vertical||-1,c_,u_,q1,PI,CI,II,MI,LI,kI,RI,zI,Si,dh,$1,dr,Mo,X1,0,qn,h_,d_,Ms)}(a,yt,Ue,u,f,g,Qe,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,oe,[Ee,Ee,Ee,Ee],it,A,Se,De,ct,$,r,v,L,z,b)};if(Je==="line")for(const Ue of S1(r.geometry,0,0,ei,ei)){const yt=cI(Ue,ye,ze,u.vertical||X,f,24,ve,a.overscaling,ei);for(const ft of yt){const Ot=X;Ot&&mI(a,Ot.text,Ze,ft)||Xe(Ue,ft)}}else if(Je==="line-center"){for(const Ue of r.geometry)if(Ue.length>1){const yt=lI(Ue,ze,u.vertical||X,f,24,ve);yt&&Xe(Ue,yt)}}else if(r.type==="Polygon")for(const Ue of Ug(r.geometry,0)){const yt=dI(Ue,16);Xe(Ue[0],new ma(yt.x,yt.y,0))}else if(r.type==="LineString")for(const Ue of r.geometry)Xe(Ue,new ma(Ue[0].x,Ue[0].y,0));else if(r.type==="Point")for(const Ue of r.geometry)for(const yt of Ue)Xe([yt],new ma(yt.x,yt.y,0))}const ga=32640;function I1(a,r,u,f,g,v,b,T,A,L,z,O,V,$,X){const ae=function(Se,ye,Ee,De,ze,it,ct,Je){const Ze=De.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,We=[];for(const Qe of ye.positionedLines)for(const Xe of Qe.positionedGlyphs){if(!Xe.rect)continue;const Ue=Xe.rect||{};let yt=4,ft=!0,Ot=1,_n=0;const wn=(ze||Je)&&Xe.vertical,ti=Xe.metrics.advance*Xe.scale/2;if(Je&&ye.verticalizable){const Tn=(Xe.scale-1)*mi,ui=(mi-Xe.metrics.width*Xe.scale)/2;_n=Qe.lineOffset/2-(Xe.imageName?-ui:Tn)}if(Xe.imageName){const Tn=ct[Xe.imageName];ft=Tn.sdf,Ot=Tn.pixelRatio,yt=1/Ot}const Vr=ze?[Xe.x+ti,Xe.y]:[0,0];let Ti=ze?[0,0]:[Xe.x+ti+Ee[0],Xe.y+Ee[1]-_n],$n=[0,0];wn&&($n=Ti,Ti=[0,0]);const ci=(Xe.metrics.left-yt)*Xe.scale-ti+Ti[0],Si=(-Xe.metrics.top-yt)*Xe.scale+Ti[1],Di=ci+Ue.w*Xe.scale/Ot,cr=Si+Ue.h*Xe.scale/Ot,qn=new xt(ci,Si),Ai=new xt(Di,Si),Oi=new xt(ci,cr),Xi=new xt(Di,cr);if(wn){const Tn=new xt(-ti,ti-kf),ui=-Math.PI/2,jt=12-ti,Sr=new xt(22-jt,-(Xe.imageName?jt:0)),Pi=new xt(...$n);qn._rotateAround(ui,Tn)._add(Sr)._add(Pi),Ai._rotateAround(ui,Tn)._add(Sr)._add(Pi),Oi._rotateAround(ui,Tn)._add(Sr)._add(Pi),Xi._rotateAround(ui,Tn)._add(Sr)._add(Pi)}if(Ze){const Tn=Math.sin(Ze),ui=Math.cos(Ze),jt=[ui,-Tn,Tn,ui];qn._matMult(jt),Ai._matMult(jt),Oi._matMult(jt),Xi._matMult(jt)}const ur=new xt(0,0),hr=new xt(0,0);We.push({tl:qn,tr:Ai,bl:Oi,br:Xi,tex:Ue,writingMode:ye.writingMode,glyphOffset:Vr,sectionIndex:Xe.sectionIndex,isSDF:ft,pixelOffsetTL:ur,pixelOffsetBR:hr,minFontScaleX:0,minFontScaleY:0})}return We}(0,u,T,g,v,b,f,a.allowVerticalPlacement),oe=a.textSizeData;let ve=null;oe.kind==="source"?(ve=[Co*g.layout.get("text-size").evaluate(b,{})],ve[0]>ga&&pe(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ve=[Co*$.compositeTextSizes[0].evaluate(b,{},X),Co*$.compositeTextSizes[1].evaluate(b,{},X)],(ve[0]>ga||ve[1]>ga)&&pe(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ae,ve,T,v,b,L,r,A.lineStartIndex,A.lineLength,V,X);for(const Se of z)O[Se]=a.text.placedSymbolArray.length-1;return 4*ae.length}function M1(a){for(const r in a)return a[r];return null}function mI(a,r,u,f){const g=a.compareText;if(r in g){const v=g[r];for(let b=v.length-1;b>=0;b--)if(f.dist(v[b])<u)return!0}else g[r]=[];return g[r].push(f),!1}const gI=fa.VectorTileFeature.types,_I=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nf(a,r,u,f,g,v,b,T,A,L,z,O,V){const $=T?Math.min(ga,Math.round(T[0])):0,X=T?Math.min(ga,Math.round(T[1])):0;a.emplaceBack(r,u,Math.round(32*f),Math.round(32*g),v,b,($<<1)+(A?1:0),X,16*L,16*z,256*O,256*V)}function e_(a,r,u){a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u)}function yI(a){for(const r of a.sections)if(pf(r.text))return!0;return!1}class t_{constructor(r){this.layoutVertexArray=new us,this.indexArray=new $i,this.programConfigurations=r,this.segments=new Nt,this.dynamicLayoutVertexArray=new Br,this.opacityVertexArray=new hs,this.placedSymbolArray=new Be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,VC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,jC.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,_I,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",t_);class n_{constructor(r,u,f){this.layoutVertexArray=new r,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Nt,this.collisionVertexArray=new Er}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,GC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",n_);class wc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(b=>b.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zg([]),this.placementViewportMatrix=zg([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=v1(this.zoom,u["text-size"]),this.iconSizeData=v1(this.zoom,u["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=r_(f,"text-overlap","text-allow-overlap")!=="never"||r_(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>l.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=r.sourceID}createArrays(){this.text=new t_(new pl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new t_(new pl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new qe,this.lineVertexArray=new nt,this.symbolInstances=new et}calculateGlyphDependencies(r,u,f,g,v){for(let b=0;b<r.length;b++)if(u[r.charCodeAt(b)]=!0,(f||g)&&v){const T=lh[r.charAt(b)];T&&(u[T.charCodeAt(0)]=!0)}}populate(r,u,f){const g=this.layers[0],v=g.layout,b=v.get("text-font"),T=v.get("text-field"),A=v.get("icon-image"),L=(T.value.kind!=="constant"||T.value.value instanceof he&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!L&&!z)return;const V=u.iconDependencies,$=u.glyphDependencies,X=u.availableImages,ae=new xn(this.zoom);for(const{feature:oe,id:ve,index:Se,sourceLayerIndex:ye}of r){const Ee=g._featureFilter.needGeometry,De=gl(oe,Ee);if(!g._featureFilter.filter(ae,De,f))continue;let ze,it;if(Ee||(De.geometry=ml(oe)),L){const Je=g.getValueAndResolveTokens("text-field",De,f,X),Ze=he.factory(Je);yI(Ze)&&(this.hasRTLText=!0),(!this.hasRTLText||hl()==="unavailable"||this.hasRTLText&&wr.isParsed())&&(ze=HC(Ze,g,De))}if(z){const Je=g.getValueAndResolveTokens("icon-image",De,f,X);it=Je instanceof ge?Je:ge.fromString(Je)}if(!ze&&!it)continue;const ct=this.sortFeaturesByKey?O.evaluate(De,{},f):void 0;if(this.features.push({id:ve,text:ze,icon:it,index:Se,sourceLayerIndex:ye,geometry:De.geometry,properties:oe.properties,type:gI[oe.type],sortKey:ct}),it&&(V[it.name]=!0),ze){const Je=b.evaluate(De,{},f).join(","),Ze=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const We of ze.sections)if(We.image)V[We.image.name]=!0;else{const Qe=uc(ze.toString()),Xe=We.fontStack||Je,Ue=$[Xe]=$[Xe]||{};this.calculateGlyphDependencies(We.text,Ue,Ze,this.allowVerticalPlacement,Qe)}}}v.get("symbol-placement")==="line"&&(this.features=function(oe){const ve={},Se={},ye=[];let Ee=0;function De(Je){ye.push(oe[Je]),Ee++}function ze(Je,Ze,We){const Qe=Se[Je];return delete Se[Je],Se[Ze]=Qe,ye[Qe].geometry[0].pop(),ye[Qe].geometry[0]=ye[Qe].geometry[0].concat(We[0]),Qe}function it(Je,Ze,We){const Qe=ve[Ze];return delete ve[Ze],ve[Je]=Qe,ye[Qe].geometry[0].shift(),ye[Qe].geometry[0]=We[0].concat(ye[Qe].geometry[0]),Qe}function ct(Je,Ze,We){const Qe=We?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Je}:${Qe.x}:${Qe.y}`}for(let Je=0;Je<oe.length;Je++){const Ze=oe[Je],We=Ze.geometry,Qe=Ze.text?Ze.text.toString():null;if(!Qe){De(Je);continue}const Xe=ct(Qe,We),Ue=ct(Qe,We,!0);if(Xe in Se&&Ue in ve&&Se[Xe]!==ve[Ue]){const yt=it(Xe,Ue,We),ft=ze(Xe,Ue,ye[yt].geometry);delete ve[Xe],delete Se[Ue],Se[ct(Qe,ye[ft].geometry,!0)]=ft,ye[yt].geometry=null}else Xe in Se?ze(Xe,Ue,We):Ue in ve?it(Xe,Ue,We):(De(Je),ve[Xe]=Ee-1,Se[Ue]=Ee-1)}return ye.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,ve)=>oe.sortKey-ve.sortKey)}update(r,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(r,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,u){const f=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(u[r.segment+1]),v=r.dist(u[r.segment]);const b={};for(let T=r.segment+1;T<u.length;T++)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:g},T<u.length-1&&(g+=u[T+1].dist(u[T]));for(let T=r.segment||0;T>=0;T--)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=u[T-1].dist(u[T]));for(let T=0;T<u.length;T++){const A=b[T];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(r,u,f,g,v,b,T,A,L,z,O,V){const $=r.indexArray,X=r.layoutVertexArray,ae=r.segments.prepareSegment(4*u.length,X,$,this.canOverlap?b.sortKey:void 0),oe=this.glyphOffsetArray.length,ve=ae.vertexLength,Se=this.allowVerticalPlacement&&T===l.WritingMode.vertical?Math.PI/2:0,ye=b.text&&b.text.sections;for(let Ee=0;Ee<u.length;Ee++){const{tl:De,tr:ze,bl:it,br:ct,tex:Je,pixelOffsetTL:Ze,pixelOffsetBR:We,minFontScaleX:Qe,minFontScaleY:Xe,glyphOffset:Ue,isSDF:yt,sectionIndex:ft}=u[Ee],Ot=ae.vertexLength,_n=Ue[1];Nf(X,A.x,A.y,De.x,_n+De.y,Je.x,Je.y,f,yt,Ze.x,Ze.y,Qe,Xe),Nf(X,A.x,A.y,ze.x,_n+ze.y,Je.x+Je.w,Je.y,f,yt,We.x,Ze.y,Qe,Xe),Nf(X,A.x,A.y,it.x,_n+it.y,Je.x,Je.y+Je.h,f,yt,Ze.x,We.y,Qe,Xe),Nf(X,A.x,A.y,ct.x,_n+ct.y,Je.x+Je.w,Je.y+Je.h,f,yt,We.x,We.y,Qe,Xe),e_(r.dynamicLayoutVertexArray,A,Se),$.emplaceBack(Ot,Ot+1,Ot+2),$.emplaceBack(Ot+1,Ot+2,Ot+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),Ee!==u.length-1&&ft===u[Ee+1].sectionIndex||r.programConfigurations.populatePaintArrays(X.length,b,b.index,{},V,ye&&ye[ft])}r.placedSymbolArray.emplaceBack(A.x,A.y,oe,this.glyphOffsetArray.length-oe,ve,L,z,A.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,O)}_addCollisionDebugVertex(r,u,f,g,v,b){return u.emplaceBack(0,0),r.emplaceBack(f.x,f.y,g,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(r,u,f,g,v,b,T){const A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),L=A.vertexLength,z=v.layoutVertexArray,O=v.collisionVertexArray,V=T.anchorX,$=T.anchorY;this._addCollisionDebugVertex(z,O,b,V,$,new xt(r,u)),this._addCollisionDebugVertex(z,O,b,V,$,new xt(f,u)),this._addCollisionDebugVertex(z,O,b,V,$,new xt(f,g)),this._addCollisionDebugVertex(z,O,b,V,$,new xt(r,g)),A.vertexLength+=4;const X=v.indexArray;X.emplaceBack(L,L+1),X.emplaceBack(L+1,L+2),X.emplaceBack(L+2,L+3),X.emplaceBack(L+3,L),A.primitiveLength+=4}addDebugCollisionBoxes(r,u,f,g){for(let v=r;v<u;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new n_(Qs,s1.members,As),this.iconCollisionBox=new n_(Qs,s1.members,As);for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(r,u,f,g,v,b,T,A,L){const z={};for(let O=u;O<f;O++){const V=r.get(O);z.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.textFeatureIndex=V.featureIndex;break}for(let O=g;O<v;O++){const V=r.get(O);z.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalTextFeatureIndex=V.featureIndex;break}for(let O=b;O<T;O++){const V=r.get(O);z.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.iconFeatureIndex=V.featureIndex;break}for(let O=A;O<L;O++){const V=r.get(O);z.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalIconFeatureIndex=V.featureIndex;break}return z}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,u){const f=r.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)r.indexArray.emplaceBack(v,v+1,v+2),r.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(r),f=Math.cos(r),g=[],v=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const A=this.symbolInstances.get(T);g.push(0|Math.round(u*A.anchorX+f*A.anchorY)),v.push(A.featureIndex)}return b.sort((T,A)=>g[T]-g[A]||v[A]-v[T]),b}addToSortKeyRanges(r,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,v,b)=>{g>=0&&b.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}st("SymbolBucket",wc,{omit:["layers","collisionBoxArray","features","compareText"]}),wc.MAX_GLYPHS=65535,wc.addDynamicAttributes=e_;const vI=new pi({"symbol-placement":new ht(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ht(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ht(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ht(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Me.layout_symbol["icon-size"]),"icon-text-fit":new ht(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ht(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Me.layout_symbol["icon-image"]),"icon-rotate":new wt(Me.layout_symbol["icon-rotate"]),"icon-padding":new wt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Me.layout_symbol["icon-offset"]),"icon-anchor":new wt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(Me.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Me.layout_symbol["text-field"]),"text-font":new wt(Me.layout_symbol["text-font"]),"text-size":new wt(Me.layout_symbol["text-size"]),"text-max-width":new wt(Me.layout_symbol["text-max-width"]),"text-line-height":new ht(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Me.layout_symbol["text-justify"]),"text-radial-offset":new wt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Me.layout_symbol["text-anchor"]),"text-max-angle":new ht(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(Me.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Me.layout_symbol["text-rotate"]),"text-padding":new ht(Me.layout_symbol["text-padding"]),"text-keep-upright":new ht(Me.layout_symbol["text-keep-upright"]),"text-transform":new wt(Me.layout_symbol["text-transform"]),"text-offset":new wt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new ht(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new ht(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new ht(Me.layout_symbol["text-ignore-placement"]),"text-optional":new ht(Me.layout_symbol["text-optional"])});var i_={paint:new pi({"icon-opacity":new wt(Me.paint_symbol["icon-opacity"]),"icon-color":new wt(Me.paint_symbol["icon-color"]),"icon-halo-color":new wt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new wt(Me.paint_symbol["text-opacity"]),"text-color":new wt(Me.paint_symbol["text-color"],{runtimeType:Kn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new wt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Me.paint_symbol["text-halo-blur"]),"text-translate":new ht(Me.paint_symbol["text-translate"]),"text-translate-anchor":new ht(Me.paint_symbol["text-translate-anchor"])}),layout:vI};class L1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:os,this.defaultValue=r}evaluate(r){if(r.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(r.formattedSection))return u.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",L1,{omit:["defaultValue"]});class Uf extends cs{constructor(r){super(r,i_)}recalculate(r,u){if(super.recalculate(r,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,u,f,g){const v=this.layout.get(r).evaluate(u,{},f,g),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||Ja(b.value)||!v?v:function(T,A){return A.replace(/{([^{}]+)}/g,(L,z)=>z in T?String(T[z]):"")}(u.properties,v)}createBucket(r){return new wc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of i_.paint.overridableProperties){if(!Uf.hasPaintOverride(this.layout,r))continue;const u=this.paint.get(r),f=new L1(u),g=new rc(f,u.property.specification);let v=null;v=u.value.kind==="constant"||u.value.kind==="source"?new el("source",g):new Ou("composite",g,u.value.zoomStops),this.paint._values[r]=new ls(u.property,v,u.parameters)}}_handleOverridablePaintPropertyUpdate(r,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Uf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,u){const f=r.get("text-field"),g=i_.paint.properties[u];let v=!1;const b=T=>{for(const A of T)if(g.overrides&&g.overrides.hasOverride(A))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof he)b(f.value.value.sections);else if(f.value.kind==="source"){const T=L=>{v||(L instanceof lt&&Pe(L.value)===Wn?b(L.value.sections):L instanceof nc?b(L.sections):L.eachChild(T))},A=f.value;A._styleExpression&&T(A._styleExpression.expression)}return v}}function r_(a,r,u){let f="never";const g=a.get(r);return g?f=g:a.get(u)&&(f="always"),f}var xI={paint:new pi({"background-color":new ht(Me.paint_background["background-color"]),"background-pattern":new Zu(Me.paint_background["background-pattern"]),"background-opacity":new ht(Me.paint_background["background-opacity"])})},bI={paint:new pi({"raster-opacity":new ht(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new ht(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(Me.paint_raster["raster-saturation"]),"raster-contrast":new ht(Me.paint_raster["raster-contrast"]),"raster-resampling":new ht(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(Me.paint_raster["raster-fade-duration"])})};class wI extends cs{constructor(r){super(r,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const EI={circle:class extends cs{constructor(a){super(a,eC)}createBucket(a){return new Lg(a)}queryRadius(a){const r=a;return Qu("circle-radius",this,r)+Qu("circle-stroke-width",this,r)+Ef(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b,T){const A=Tf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,b),L=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),z=this.paint.get("circle-pitch-alignment")==="map",O=z?A:function($,X){return $.map(ae=>jx(ae,X))}(A,T),V=z?L*b:L;for(const $ of f)for(const X of $){const ae=z?X:jx(X,T);let oe=V;const ve=Sf([],[X.x,X.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=ve[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=v.cameraToCenterDistance/ve[3]),XP(O,ae,oe))return!0}return!1}},heatmap:class extends cs{constructor(a){super(a,nC),this._updateColorRamp()}createBucket(a){return new Gx(a)}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends cs{constructor(a){super(a,iC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends cs{constructor(a){super(a,vC)}recalculate(a,r){super.recalculate(a,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Gg(a)}queryRadius(){return Ef(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b){return zx(Tf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,b),f)}isTileClipped(){return!0}},"fill-extrusion":class extends cs{constructor(a){super(a,RC)}createBucket(a){return new Hg(a)}queryRadius(){return Ef(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,r,u,f,g,v,b,T){const A=Tf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,b),L=this.paint.get("fill-extrusion-height").evaluate(r,u),z=this.paint.get("fill-extrusion-base").evaluate(r,u),O=function($,X,ae,oe){const ve=[];for(const Se of $){const ye=[Se.x,Se.y,0,1];Sf(ye,ye,X),ve.push(new xt(ye[0]/ye[3],ye[1]/ye[3]))}return ve}(A,T),V=function($,X,ae,oe){const ve=[],Se=[],ye=oe[8]*X,Ee=oe[9]*X,De=oe[10]*X,ze=oe[11]*X,it=oe[8]*ae,ct=oe[9]*ae,Je=oe[10]*ae,Ze=oe[11]*ae;for(const We of $){const Qe=[],Xe=[];for(const Ue of We){const yt=Ue.x,ft=Ue.y,Ot=oe[0]*yt+oe[4]*ft+oe[12],_n=oe[1]*yt+oe[5]*ft+oe[13],wn=oe[2]*yt+oe[6]*ft+oe[14],ti=oe[3]*yt+oe[7]*ft+oe[15],Vr=wn+De,Ti=ti+ze,$n=Ot+it,ci=_n+ct,Si=wn+Je,Di=ti+Ze,cr=new xt((Ot+ye)/Ti,(_n+Ee)/Ti);cr.z=Vr/Ti,Qe.push(cr);const qn=new xt($n/Di,ci/Di);qn.z=Si/Di,Xe.push(qn)}ve.push(Qe),Se.push(Xe)}return[ve,Se]}(f,z,L,T);return function($,X,ae){let oe=1/0;zx(ae,X)&&(oe=e1(ae,X[0]));for(let ve=0;ve<X.length;ve++){const Se=X[ve],ye=$[ve];for(let Ee=0;Ee<Se.length-1;Ee++){const De=Se[Ee],ze=[De,Se[Ee+1],ye[Ee+1],ye[Ee],De];Rx(ae,ze)&&(oe=Math.min(oe,e1(ae,ze)))}}return oe!==1/0&&oe}(V[0],V[1],O)}},line:class extends cs{constructor(a){super(a,n1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof En,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=i1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new $g(a)}queryRadius(a){const r=a,u=r1(Qu("line-width",this,r),Qu("line-gap-width",this,r)),f=Qu("line-offset",this,r);return u/2+Math.abs(f)+Ef(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,u,f,g,v,b){const T=Tf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,b),A=b/2*r1(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),L=this.paint.get("line-offset").evaluate(r,u);return L&&(f=function(z,O){const V=[];for(let $=0;$<z.length;$++){const X=z[$],ae=[];for(let oe=0;oe<X.length;oe++){const ve=X[oe-1],Se=X[oe],ye=X[oe+1],Ee=oe===0?new xt(0,0):Se.sub(ve)._unit()._perp(),De=oe===X.length-1?new xt(0,0):ye.sub(Se)._unit()._perp(),ze=Ee._add(De)._unit(),it=ze.x*De.x+ze.y*De.y;it!==0&&ze._mult(1/it),ae.push(ze._mult(O)._add(Se))}V.push(ae)}return V}(f,L*b)),function(z,O,V){for(let $=0;$<O.length;$++){const X=O[$];if(z.length>=3){for(let ae=0;ae<X.length;ae++)if(mc(z,X[ae]))return!0}if(YP(z,X,V))return!0}return!1}(T,f,A)}isTileClipped(){return!0}},symbol:Uf,background:class extends cs{constructor(a){super(a,xI)}},raster:class extends cs{constructor(a){super(a,bI)}}};class TI{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const k1=63710088e-1;class Rn{constructor(r,u){if(isNaN(r)||isNaN(u))throw new Error(`Invalid LngLat object: (${r}, ${u})`);if(this.lng=+r,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Rn(B(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const u=Math.PI/180,f=this.lat*u,g=r.lat*u,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((r.lng-this.lng)*u);return k1*Math.acos(Math.min(v,1))}toBounds(r=0){const u=360*r/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new yl(new Rn(this.lng-f,this.lat-u),new Rn(this.lng+f,this.lat+u))}static convert(r){if(r instanceof Rn)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Rn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Rn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class yl{constructor(r,u){r&&(u?this.setSouthWest(r).setNorthEast(u):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Rn?new Rn(r.lng,r.lat):Rn.convert(r),this}setSouthWest(r){return this._sw=r instanceof Rn?new Rn(r.lng,r.lat):Rn.convert(r),this}extend(r){const u=this._sw,f=this._ne;let g,v;if(r instanceof Rn)g=r,v=r;else{if(!(r instanceof yl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(yl.convert(r)):this.extend(Rn.convert(r)):this;if(g=r._sw,v=r._ne,!g||!v)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(v.lng,f.lng),f.lat=Math.max(v.lat,f.lat)):(this._sw=new Rn(g.lng,g.lat),this._ne=new Rn(v.lng,v.lat)),this}getCenter(){return new Rn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Rn(this.getWest(),this.getNorth())}getSouthEast(){return new Rn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:u,lat:f}=Rn.convert(r);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(r){return r instanceof yl?r:r&&new yl(r)}}const R1=2*Math.PI*k1;function z1(a){return R1*Math.cos(a*Math.PI/180)}function D1(a){return(180+a)/360}function O1(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function F1(a,r){return a/z1(r)}function s_(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Vf{constructor(r,u,f=0){this.x=+r,this.y=+u,this.z=+f}static fromLngLat(r,u=0){const f=Rn.convert(r);return new Vf(D1(f.lng),O1(f.lat),F1(u,f.lat))}toLngLat(){return new Rn(360*this.x-180,s_(this.y))}toAltitude(){return this.z*z1(s_(this.y))}meterInMercatorCoordinateUnits(){return 1/R1*(r=s_(this.y),1/Math.cos(r*Math.PI/180));var r}}function B1(a,r,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[a*f-2*Math.PI*6378137/2,r*f-2*Math.PI*6378137/2]}class o_{constructor(r,u,f){if(r<0||r>25||f<0||f>=Math.pow(2,r)||u<0||u>=Math.pow(2,r))throw new Error(`x=${u}, y=${f}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=u,this.y=f,this.key=uh(0,r,r,u,f)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,u,f){const g=(b=this.y,T=this.z,A=B1(256*(v=this.x),256*(b=Math.pow(2,T)-b-1),T),L=B1(256*(v+1),256*(b+1),T),A[0]+","+A[1]+","+L[0]+","+L[1]);var v,b,T,A,L;const z=function(O,V,$){let X,ae="";for(let oe=O;oe>0;oe--)X=1<<oe-1,ae+=(V&X?1:0)+($&X?2:0);return ae}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const u=this.z-r.z;return u>0&&r.x===this.x>>u&&r.y===this.y>>u}getTilePoint(r){const u=Math.pow(2,this.z);return new xt((r.x*u-this.x)*ei,(r.y*u-this.y)*ei)}toString(){return`${this.z}/${this.x}/${this.y}`}}class N1{constructor(r,u){this.wrap=r,this.canonical=u,this.key=uh(r,u.z,u.z,u.x,u.y)}}class Ur{constructor(r,u,f,g,v){if(r<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${f}`);this.overscaledZ=r,this.wrap=u,this.canonical=new o_(f,+g,+v),this.key=uh(u,r,f,g,v)}clone(){return new Ur(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-r;return r>this.canonical.z?new Ur(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ur(r,this.wrap,r,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(r,u){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-r;return r>this.canonical.z?uh(this.wrap*+u,r,this.canonical.z,this.canonical.x,this.canonical.y):uh(this.wrap*+u,r,r,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const u=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>u&&r.canonical.y===this.canonical.y>>u}children(r){if(this.overscaledZ>=r)return[new Ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Ur(u,this.wrap,u,f,g),new Ur(u,this.wrap,u,f+1,g),new Ur(u,this.wrap,u,f,g+1),new Ur(u,this.wrap,u,f+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ur(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new N1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Vf(r.x-this.wrap,r.y))}}function uh(a,r,u,f,g){(a*=2)<0&&(a=-1*a-1);const v=1<<u;return(v*v*a+v*g+f).toString(36)+u.toString(36)+r.toString(36)}st("CanonicalTileID",o_),st("OverscaledTileID",Ur,{omit:["posMatrix"]});class U1{constructor(r,u,f){if(this.uid=r,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void pe(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const g=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let b=0;b<g;b++){const T=this.get(v,b);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(r,u){const f=new Uint8Array(this.data.buffer),g=4*this._idx(r,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,u){if(r<-1||r>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(r+1)}_unpackMapbox(r,u,f){return(256*r*256+256*u+f)/10-1e4}_unpackTerrarium(r,u,f){return 256*r+u+f/256-32768}getPixels(){return new Nr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,u,f){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,v=u*this.dim+this.dim,b=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:b=T-1;break;case 1:T=b+1}const A=-u*this.dim,L=-f*this.dim;for(let z=b;z<T;z++)for(let O=g;O<v;O++)this.data[this._idx(O,z)]=r.data[this._idx(O+A,z+L)]}}st("DEMData",U1);class V1{constructor(r){this._stringToNumber={},this._numberToString=[];for(let u=0;u<r.length;u++){const f=r[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class j1{constructor(r,u,f,g,v){this.type="Feature",this._vectorTileFeature=r,r._z=u,r._x=f,r._y=g,this.properties=r.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(r[u]=this[u]);return r}}class G1{constructor(r,u){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new ul(ei,16,0),this.grid3D=new ul(ei,16,0),this.featureIndexArray=new Dt,this.promoteId=u}insert(r,u,f,g,v,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v);const A=b?this.grid3D:this.grid;for(let L=0;L<u.length;L++){const z=u[L],O=[1/0,1/0,-1/0,-1/0];for(let V=0;V<z.length;V++){const $=z[V];O[0]=Math.min(O[0],$.x),O[1]=Math.min(O[1],$.y),O[2]=Math.max(O[2],$.x),O[3]=Math.max(O[3],$.y)}O[0]<ei&&O[1]<ei&&O[2]>=0&&O[3]>=0&&A.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fa.VectorTile(new qg(this.rawTileData)).layers,this.sourceLayerCoder=new V1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,u,f,g){this.loadVTLayers();const v=r.params||{},b=ei/r.tileSize/r.scale,T=ac(v.filter),A=r.queryGeometry,L=r.queryPadding*b,z=H1(A),O=this.grid.query(z.minX-L,z.minY-L,z.maxX+L,z.maxY+L),V=H1(r.cameraQueryGeometry),$=this.grid3D.query(V.minX-L,V.minY-L,V.maxX+L,V.maxY+L,(oe,ve,Se,ye)=>function(Ee,De,ze,it,ct){for(const Ze of Ee)if(De<=Ze.x&&ze<=Ze.y&&it>=Ze.x&&ct>=Ze.y)return!0;const Je=[new xt(De,ze),new xt(De,ct),new xt(it,ct),new xt(it,ze)];if(Ee.length>2){for(const Ze of Je)if(mc(Ee,Ze))return!0}for(let Ze=0;Ze<Ee.length-1;Ze++)if(JP(Ee[Ze],Ee[Ze+1],Je))return!0;return!1}(r.cameraQueryGeometry,oe-L,ve-L,Se+L,ye+L));for(const oe of $)O.push(oe);O.sort(SI);const X={};let ae;for(let oe=0;oe<O.length;oe++){const ve=O[oe];if(ve===ae)continue;ae=ve;const Se=this.featureIndexArray.get(ve);let ye=null;this.loadMatchingFeature(X,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,T,v.layers,v.availableImages,u,f,g,(Ee,De,ze)=>(ye||(ye=ml(Ee)),De.queryIntersectsFeature(A,Ee,ze,ye,this.z,r.transform,b,r.pixelPosMatrix)))}return X}loadMatchingFeature(r,u,f,g,v,b,T,A,L,z,O){const V=this.bucketLayerIDs[u];if(b&&!function(oe,ve){for(let Se=0;Se<oe.length;Se++)if(ve.indexOf(oe[Se])>=0)return!0;return!1}(b,V))return;const $=this.sourceLayerCoder.decode(f),X=this.vtLayers[$].feature(g);if(v.needGeometry){const oe=gl(X,!0);if(!v.filter(new xn(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!v.filter(new xn(this.tileID.overscaledZ),X))return;const ae=this.getId(X,$);for(let oe=0;oe<V.length;oe++){const ve=V[oe];if(b&&b.indexOf(ve)<0)continue;const Se=A[ve];if(!Se)continue;let ye={};ae&&z&&(ye=z.getState(Se.sourceLayer||"_geojsonTileLayer",ae));const Ee=G({},L[ve]);Ee.paint=W1(Ee.paint,Se.paint,X,ye,T),Ee.layout=W1(Ee.layout,Se.layout,X,ye,T);const De=!O||O(X,Se,ye);if(!De)continue;const ze=new j1(X,this.z,this.x,this.y,ae);ze.layer=Ee;let it=r[ve];it===void 0&&(it=r[ve]=[]),it.push({featureIndex:g,feature:ze,intersectionZ:De})}}lookupSymbolFeatures(r,u,f,g,v,b,T,A){const L={};this.loadVTLayers();const z=ac(v);for(const O of r)this.loadMatchingFeature(L,f,g,O,z,b,T,A,u);return L}hasLayer(r){for(const u of this.bucketLayerIDs)for(const f of u)if(r===f)return!0;return!1}getId(r,u){let f=r.id;return this.promoteId&&(f=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function W1(a,r,u,f,g){return Z(a,(v,b)=>{const T=r instanceof fl?r.get(b):null;return T&&T.evaluate?T.evaluate(u,f,g):T})}function H1(a){let r=1/0,u=1/0,f=-1/0,g=-1/0;for(const v of a)r=Math.min(r,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{minX:r,minY:u,maxX:f,maxY:g}}function SI(a,r){return r-a}var a_;st("FeatureIndex",G1,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(a_=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",a_.load="load",a_.fullLoad="fullLoad";let jf=null,hh=[];const l_=1e3/30,AI={mark(a){performance.mark(a)},frame(a){const r=a;jf!=null&&hh.push(r-jf),jf=r},clearMetrics(){jf=null,hh=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,r=performance.getEntriesByName("fullLoadTime")[0].duration,u=hh.length,f=1/(hh.reduce((v,b)=>v+b,0)/u/1e3),g=hh.filter(v=>v>l_).reduce((v,b)=>v+(b-l_)/l_,0);return{loadTime:a,fullLoadTime:r,fps:f,percentDroppedFrames:g/(u+g)*100}}};l.AJAXError=Yn,l.ARRAY_TYPE=Zi,l.Actor=class{constructor(a,r,u){this.target=a,this.parent=r,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},de(["receive","process"],this),this.invoker=new TI(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fe()?a:window}send(a,r,u,f,g=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[v]=u);const b=St(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!u,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:bo(r,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(a){const r=a.data,u=r.id;if(u&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else Fe()||r.mustQueue?(this.tasks[u]=r,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,r)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){if(r.type==="<response>"){const u=this.callbacks[a];delete this.callbacks[a],u&&(r.error?u(Zs(r.error)):u(null,Zs(r.data)))}else{let u=!1;const f=St(this.globalScope)?void 0:[],g=r.hasCallback?(T,A)=>{u=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:T?bo(T):null,data:bo(A,f)},f)}:T=>{u=!0};let v=null;const b=Zs(r.data);if(this.parent[r.type])v=this.parent[r.type](r.sourceMapId,b,g);else if(this.parent.getWorkerSource){const T=r.type.split(".");v=this.parent.getWorkerSource(r.sourceMapId,T[0],b.source)[T[1]](b,g)}else g(new Error(`Could not find function ${r.type}`));!u&&v&&v.cancel&&(this.cancelCallbacks[a]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=th,l.CanonicalTileID=o_,l.CollisionBoxArray=Le,l.CollisionCircleLayoutArray=class extends D{},l.Color=J,l.DEMData=U1,l.DataConstantProperty=ht,l.DictionaryCoder=V1,l.EXTENT=ei,l.ErrorEvent=js,l.EvaluationParameters=xn,l.Event=Rr,l.Evented=vr,l.FeatureIndex=G1,l.FillBucket=Gg,l.FillExtrusionBucket=Hg,l.GeoJSONFeature=j1,l.ImageAtlas=f1,l.ImagePosition=Xg,l.LineBucket=$g,l.LineStripIndexArray=class extends re{},l.LngLat=Rn,l.LngLatBounds=yl,l.MercatorCoordinate=Vf,l.ONE_EM=mi,l.OverscaledTileID=Ur,l.PerformanceUtils=AI,l.PosArray=_t,l.Properties=pi,l.QuadTriangleArray=class extends W{},l.RGBAImage=Nr,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.ResourceType=Li,l.SegmentVector=Nt,l.SymbolBucket=wc,l.Transitionable=_f,l.TriangleIndexArray=$i,l.Uniform1f=So,l.Uniform1i=class extends To{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.Uniform2f=class extends To{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.Uniform3f=class extends To{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.Uniform4f=fc,l.UniformColor=Ix,l.UniformMatrix4f=class extends To{constructor(a,r){super(a,r),this.current=qP}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.UnwrappedTileID=N1,l.ValidationError=$e,l.ZoomHistory=Uu,l.add=function(a,r,u){return a[0]=r[0]+u[0],a[1]=r[1]+u[1],a[2]=r[2]+u[2],a},l.addDynamicAttributes=e_,l.asyncAll=function(a,r,u){if(!a.length)return u(null,[]);let f=a.length;const g=new Array(a.length);let v=null;a.forEach((b,T)=>{r(b,(A,L)=>{A&&(v=A),g[T]=L,--f==0&&u(v,g)})})},l.bezier=S,l.bindAll=de,l.cacheEntryPossiblyAdded=function(a){bi++,bi>ir&&(a.getActor().send("enforceCacheSizeLimit",rn),bi=0)},l.clamp=P,l.clearTileCache=function(a){const r=caches.delete(Et);a&&r.catch(a).then(()=>a())},l.clipLine=S1,l.clone=function(a){var r=new Zi(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.clone$1=q,l.clone$2=function(a){var r=new Zi(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},l.collisionCircleLayout=WC,l.config=tt,l.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.create=function(){var a=new Zi(16);return Zi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l.create$1=Fx,l.createExpression=Qa,l.createFilter=ac,l.createLayout=Hn,l.createStyleLayer=function(a){return a.type==="custom"?new wI(a):new EI[a.type](a)},l.cross=function(a,r,u){var f=r[0],g=r[1],v=r[2],b=u[0],T=u[1],A=u[2];return a[0]=g*A-v*T,a[1]=v*b-f*A,a[2]=f*T-g*b,a},l.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},l.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.ease=I,l.emitValidationErrors=cc,l.enforceCacheSizeLimit=function(a){ii(),Pt&&Pt.then(r=>{r.keys().then(u=>{for(let f=0;f<u.length-a;f++)r.delete(u[f])})})},l.equals=function(a,r){var u=a[0],f=a[1],g=a[2],v=a[3],b=a[4],T=a[5],A=a[6],L=a[7],z=a[8],O=a[9],V=a[10],$=a[11],X=a[12],ae=a[13],oe=a[14],ve=a[15],Se=r[0],ye=r[1],Ee=r[2],De=r[3],ze=r[4],it=r[5],ct=r[6],Je=r[7],Ze=r[8],We=r[9],Qe=r[10],Xe=r[11],Ue=r[12],yt=r[13],ft=r[14],Ot=r[15];return Math.abs(u-Se)<=qi*Math.max(1,Math.abs(u),Math.abs(Se))&&Math.abs(f-ye)<=qi*Math.max(1,Math.abs(f),Math.abs(ye))&&Math.abs(g-Ee)<=qi*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(v-De)<=qi*Math.max(1,Math.abs(v),Math.abs(De))&&Math.abs(b-ze)<=qi*Math.max(1,Math.abs(b),Math.abs(ze))&&Math.abs(T-it)<=qi*Math.max(1,Math.abs(T),Math.abs(it))&&Math.abs(A-ct)<=qi*Math.max(1,Math.abs(A),Math.abs(ct))&&Math.abs(L-Je)<=qi*Math.max(1,Math.abs(L),Math.abs(Je))&&Math.abs(z-Ze)<=qi*Math.max(1,Math.abs(z),Math.abs(Ze))&&Math.abs(O-We)<=qi*Math.max(1,Math.abs(O),Math.abs(We))&&Math.abs(V-Qe)<=qi*Math.max(1,Math.abs(V),Math.abs(Qe))&&Math.abs($-Xe)<=qi*Math.max(1,Math.abs($),Math.abs(Xe))&&Math.abs(X-Ue)<=qi*Math.max(1,Math.abs(X),Math.abs(Ue))&&Math.abs(ae-yt)<=qi*Math.max(1,Math.abs(ae),Math.abs(yt))&&Math.abs(oe-ft)<=qi*Math.max(1,Math.abs(oe),Math.abs(ft))&&Math.abs(ve-Ot)<=qi*Math.max(1,Math.abs(ve),Math.abs(Ot))},l.evaluateSizeForFeature=function(a,{uSize:r,uSizeT:u},{lowerSize:f,upperSize:g}){return a.kind==="source"?f/Co:a.kind==="composite"?zt(f/Co,g/Co,u):r},l.evaluateSizeForZoom=function(a,r){let u=0,f=0;if(a.kind==="constant")f=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:b}=a,T=g?P(or.interpolationFactor(g,r,v,b),0,1):0;a.kind==="camera"?f=zt(a.minSize,a.maxSize,T):u=T}return{uSizeT:u,uSize:f}},l.evaluateVariableOffset=C1,l.evented=qu,l.exported=Gn,l.exported$1=ri,l.extend=G,l.filterObject=j,l.fromRotation=function(a,r){var u=Math.sin(r),f=Math.cos(r);return a[0]=f,a[1]=u,a[2]=0,a[3]=-u,a[4]=f,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},l.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.getAnchorAlignment=Kg,l.getAnchorJustification=Qg,l.getArrayBuffer=Gi,l.getImage=rs,l.getJSON=function(a,r){return di(G(a,{type:"json"}),r)},l.getOverlapMode=r_,l.getRTLTextPluginStatus=hl,l.getReferrer=Lr,l.getVideo=function(a,r){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){r(null,u)};for(let f=0;f<a.length;f++){const g=window.document.createElement("source");Vs(a[f])||(u.crossOrigin="Anonymous"),g.src=a[f],u.appendChild(g)}return{cancel:()=>{}}},l.identity=zg,l.invert=function(a,r){var u=r[0],f=r[1],g=r[2],v=r[3],b=r[4],T=r[5],A=r[6],L=r[7],z=r[8],O=r[9],V=r[10],$=r[11],X=r[12],ae=r[13],oe=r[14],ve=r[15],Se=u*T-f*b,ye=u*A-g*b,Ee=u*L-v*b,De=f*A-g*T,ze=f*L-v*T,it=g*L-v*A,ct=z*ae-O*X,Je=z*oe-V*X,Ze=z*ve-$*X,We=O*oe-V*ae,Qe=O*ve-$*ae,Xe=V*ve-$*oe,Ue=Se*Xe-ye*Qe+Ee*We+De*Ze-ze*Je+it*ct;return Ue?(a[0]=(T*Xe-A*Qe+L*We)*(Ue=1/Ue),a[1]=(g*Qe-f*Xe-v*We)*Ue,a[2]=(ae*it-oe*ze+ve*De)*Ue,a[3]=(V*ze-O*it-$*De)*Ue,a[4]=(A*Ze-b*Xe-L*Je)*Ue,a[5]=(u*Xe-g*Ze+v*Je)*Ue,a[6]=(oe*Ee-X*it-ve*ye)*Ue,a[7]=(z*it-V*Ee+$*ye)*Ue,a[8]=(b*Qe-T*Ze+L*ct)*Ue,a[9]=(f*Ze-u*Qe-v*ct)*Ue,a[10]=(X*ze-ae*Ee+ve*Se)*Ue,a[11]=(O*Ee-z*ze-$*Se)*Ue,a[12]=(T*Je-b*We-A*ct)*Ue,a[13]=(u*We-f*Je+g*ct)*Ue,a[14]=(ae*ye-X*De-oe*Se)*Ue,a[15]=(z*De-O*ye+V*Se)*Ue,a):null},l.isImageBitmap=kt,l.isSafari=St,l.isWorker=Fe,l.keysDifference=function(a,r){const u=[];for(const f in a)f in r||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){wr.isLoading()||wr.isLoaded()||hl()!=="deferred"||gf()},l.makeRequest=di,l.mapObject=Z,l.mercatorXfromLng=D1,l.mercatorYfromLat=O1,l.mercatorZfromAltitude=F1,l.mul=tC,l.mul$1=function(a,r,u){return a[0]=r[0]*u[0],a[1]=r[1]*u[1],a[2]=r[2]*u[2],a[3]=r[3]*u[3],a},l.multiply=Bx,l.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.normalize=function(a,r){var u=r[0],f=r[1],g=r[2],v=u*u+f*f+g*g;return v>0&&(v=1/Math.sqrt(v)),a[0]=r[0]*v,a[1]=r[1]*v,a[2]=r[2]*v,a},l.number=zt,l.ortho=function(a,r,u,f,g,v,b){var T=1/(r-u),A=1/(f-g),L=1/(v-b);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*L,a[11]=0,a[12]=(r+u)*T,a[13]=(g+f)*A,a[14]=(b+v)*L,a[15]=1,a},l.parseCacheControl=Ve,l.parseGlyphPbf=function(a){return new qg(a).readFields(tI,[])},l.pbf=qg,l.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ei/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0].layout,u=a.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new xn(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new xn(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new xn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:L}=a.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new xn(A),a.canonical),u["text-size"].possiblyEvaluate(new xn(L),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:L}=a.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new xn(A),a.canonical),u["icon-size"].possiblyEvaluate(new xn(L),a.canonical)]}const g=r.get("text-line-height")*mi,v=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),T=r.get("text-size");for(const A of a.bucket.features){const L=r.get("text-font").evaluate(A,{},a.canonical).join(","),z=T.evaluate(A,{},a.canonical),O=f.layoutTextSize.evaluate(A,{},a.canonical),V=f.layoutIconSize.evaluate(A,{},a.canonical),$={horizontal:{},vertical:void 0},X=A.text;let ae,oe=[0,0];if(X){const ye=X.toString(),Ee=r.get("text-letter-spacing").evaluate(A,{},a.canonical)*mi,De=Ag(ye)?Ee:0,ze=r.get("text-anchor").evaluate(A,{},a.canonical),it=r.get("text-variable-anchor");if(!it){const Qe=r.get("text-radial-offset").evaluate(A,{},a.canonical);oe=Qe?C1(ze,[Qe*mi,Jg]):r.get("text-offset").evaluate(A,{},a.canonical).map(Xe=>Xe*mi)}let ct=v?"center":r.get("text-justify").evaluate(A,{},a.canonical);const Je=r.get("symbol-placement"),Ze=Je==="point"?r.get("text-max-width").evaluate(A,{},a.canonical)*mi:0,We=()=>{a.bucket.allowVerticalPlacement&&uc(ye)&&($.vertical=Rf(X,a.glyphMap,a.glyphPositions,a.imagePositions,L,Ze,g,ze,"left",De,oe,l.WritingMode.vertical,!0,Je,O,z))};if(!v&&it){const Qe=ct==="auto"?it.map(Ue=>Qg(Ue)):[ct];let Xe=!1;for(let Ue=0;Ue<Qe.length;Ue++){const yt=Qe[Ue];if(!$.horizontal[yt])if(Xe)$.horizontal[yt]=$.horizontal[0];else{const ft=Rf(X,a.glyphMap,a.glyphPositions,a.imagePositions,L,Ze,g,"center",yt,De,oe,l.WritingMode.horizontal,!1,Je,O,z);ft&&($.horizontal[yt]=ft,Xe=ft.positionedLines.length===1)}}We()}else{ct==="auto"&&(ct=Qg(ze));const Qe=Rf(X,a.glyphMap,a.glyphPositions,a.imagePositions,L,Ze,g,ze,ct,De,oe,l.WritingMode.horizontal,!1,Je,O,z);Qe&&($.horizontal[ct]=Qe),We(),uc(ye)&&v&&b&&($.vertical=Rf(X,a.glyphMap,a.glyphPositions,a.imagePositions,L,Ze,g,ze,ct,De,oe,l.WritingMode.vertical,!1,Je,O,z))}}let ve=!1;if(A.icon&&A.icon.name){const ye=a.imageMap[A.icon.name];ye&&(ae=aI(a.imagePositions[A.icon.name],r.get("icon-offset").evaluate(A,{},a.canonical),r.get("icon-anchor").evaluate(A,{},a.canonical)),ve=!!ye.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Se=M1($.horizontal)||$.vertical;a.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||ae)&&pI(a.bucket,A,$,ae,a.imageMap,f,O,V,oe,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.perspective=function(a,r,u,f,g){var v,b=1/Math.tan(r/2);return a[0]=b/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+f)*(v=1/(f-g)),a[14]=2*g*f*v):(a[10]=-1,a[14]=-2*f),a},l.pick=function(a,r){const u={};for(let f=0;f<r.length;f++){const g=r[f];g in a&&(u[g]=a[g])}return u},l.plugin=wr,l.pointGeometry=xt,l.polygonIntersectsPolygon=Rx,l.potpack=d1,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=st,l.registerForPluginStateChange=function(a){return a({pluginStatus:Hi,pluginURL:Xs}),qu.on("pluginStateChange",a),a},l.renderColorRamp=Hx,l.rotateX=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),v=r[4],b=r[5],T=r[6],A=r[7],L=r[8],z=r[9],O=r[10],V=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=v*g+L*f,a[5]=b*g+z*f,a[6]=T*g+O*f,a[7]=A*g+V*f,a[8]=L*g-v*f,a[9]=z*g-b*f,a[10]=O*g-T*f,a[11]=V*g-A*f,a},l.rotateZ=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),v=r[0],b=r[1],T=r[2],A=r[3],L=r[4],z=r[5],O=r[6],V=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=v*g+L*f,a[1]=b*g+z*f,a[2]=T*g+O*f,a[3]=A*g+V*f,a[4]=L*g-v*f,a[5]=z*g-b*f,a[6]=O*g-T*f,a[7]=V*g-A*f,a},l.scale=function(a,r,u){var f=u[0],g=u[1],v=u[2];return a[0]=r[0]*f,a[1]=r[1]*f,a[2]=r[2]*f,a[3]=r[3]*f,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*v,a[9]=r[9]*v,a[10]=r[10]*v,a[11]=r[11]*v,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.scale$1=function(a,r,u){return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a},l.setCacheLimits=function(a,r){rn=a,ir=r},l.setRTLTextPlugin=function(a,r,u=!1){if(Hi===Gu||Hi===Wu||Hi===Hu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xs=Gn.resolveURL(a),Hi=Gu,$u=r,ca(),u||gf()},l.spec=Me,l.sphericalToCartesian=function([a,r,u]){return r+=90,r*=Math.PI/180,u*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(u),y:a*Math.sin(r)*Math.sin(u),z:a*Math.cos(u)}},l.sqrLen=function(a){var r=a[0],u=a[1];return r*r+u*u},l.sub=function(a,r,u){return a[0]=r[0]-u[0],a[1]=r[1]-u[1],a[2]=r[2]-u[2],a},l.toEvaluationFeature=gl,l.transformMat3=function(a,r,u){var f=r[0],g=r[1],v=r[2];return a[0]=f*u[0]+g*u[3]+v*u[6],a[1]=f*u[1]+g*u[4]+v*u[7],a[2]=f*u[2]+g*u[5]+v*u[8],a},l.transformMat4=Sf,l.transformMat4$1=function(a,r,u){var f=r[0],g=r[1];return a[0]=u[0]*f+u[4]*g+u[12],a[1]=u[1]*f+u[5]*g+u[13],a},l.translate=function(a,r,u){var f,g,v,b,T,A,L,z,O,V,$,X,ae=u[0],oe=u[1],ve=u[2];return r===a?(a[12]=r[0]*ae+r[4]*oe+r[8]*ve+r[12],a[13]=r[1]*ae+r[5]*oe+r[9]*ve+r[13],a[14]=r[2]*ae+r[6]*oe+r[10]*ve+r[14],a[15]=r[3]*ae+r[7]*oe+r[11]*ve+r[15]):(g=r[1],v=r[2],b=r[3],T=r[4],A=r[5],L=r[6],z=r[7],O=r[8],V=r[9],$=r[10],X=r[11],a[0]=f=r[0],a[1]=g,a[2]=v,a[3]=b,a[4]=T,a[5]=A,a[6]=L,a[7]=z,a[8]=O,a[9]=V,a[10]=$,a[11]=X,a[12]=f*ae+T*oe+O*ve+r[12],a[13]=g*ae+A*oe+V*ve+r[13],a[14]=v*ae+L*oe+$*ve+r[14],a[15]=b*ae+z*oe+X*ve+r[15]),a},l.triggerPluginCompletionEvent=mf,l.unicodeBlockLookup=Ke,l.uniqueId=function(){return K++},l.validateCustomStyleLayer=function(a){const r=[],u=a.id;return u===void 0&&r.push({message:`layers.${u}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${u}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateLight=Nu,l.validateStyle=cl,l.vectorTile=fa,l.warnOnce=pe,l.wrap=B}),c(["./shared"],function(l){function y(ee){const R=typeof ee;if(R==="number"||R==="boolean"||R==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let J="[";for(const ce of ee)J+=`${y(ce)},`;return`${J}]`}const F=Object.keys(ee).sort();let Y="{";for(let J=0;J<F.length;J++)Y+=`${JSON.stringify(F[J])}:${y(ee[F[J]])},`;return`${Y}}`}function w(ee){let R="";for(const F of l.refProperties)R+=`/${y(ee[F])}`;return R}class S{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,F){for(const J of R){this._layerConfigs[J.id]=J;const ce=this._layers[J.id]=l.createStyleLayer(J);ce._featureFilter=l.createFilter(ce.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of F)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const Y=function(J,ce){const me={};for(let le=0;le<J.length;le++){const ge=ce&&ce[J[le].id]||w(J[le]);ce&&(ce[J[le].id]=ge);let Ce=me[ge];Ce||(Ce=me[ge]=[]),Ce.push(J[le])}const he=[];for(const le in me)he.push(me[le]);return he}(Object.values(this._layerConfigs),this.keyCache);for(const J of Y){const ce=J.map(Oe=>this._layers[Oe.id]),me=ce[0];if(me.visibility==="none")continue;const he=me.source||"";let le=this.familiesBySource[he];le||(le=this.familiesBySource[he]={});const ge=me.sourceLayer||"_geojsonTileLayer";let Ce=le[ge];Ce||(Ce=le[ge]=[]),Ce.push(ce)}}}class I{constructor(R){const F={},Y=[];for(const he in R){const le=R[he],ge=F[he]={};for(const Ce in le){const Oe=le[+Ce];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Pe={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};Y.push(Pe),ge[Ce]={rect:Pe,metrics:Oe.metrics}}}const{w:J,h:ce}=l.potpack(Y),me=new l.AlphaImage({width:J||1,height:ce||1});for(const he in R){const le=R[he];for(const ge in le){const Ce=le[+ge];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Oe=F[he][ge].rect;l.AlphaImage.copy(Ce.bitmap,me,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},Ce.bitmap)}}this.image=me,this.positions=F}}l.register("GlyphAtlas",I);class P{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,F,Y,J,ce){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const me=new l.DictionaryCoder(Object.keys(R.layers).sort()),he=new l.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];const le={},ge={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},Ce=F.familiesBySource[this.source];for(const vt in Ce){const At=R.layers[vt];if(!At)continue;At.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ft=me.encode(vt),Vt=[];for(let dn=0;dn<At.length;dn++){const fn=At.feature(dn),Jn=he.getId(fn,vt);Vt.push({feature:fn,id:Jn,index:dn,sourceLayerIndex:Ft})}for(const dn of Ce[vt]){const fn=dn[0];fn.source!==this.source&&l.warnOnce(`layer.source = ${fn.source} does not equal this.source = ${this.source}`),fn.minzoom&&this.zoom<Math.floor(fn.minzoom)||fn.maxzoom&&this.zoom>=fn.maxzoom||fn.visibility!=="none"&&(B(dn,this.zoom,Y),(le[fn.id]=fn.createBucket({index:he.bucketLayerIDs.length,layers:dn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(Vt,ge,this.tileID.canonical),he.bucketLayerIDs.push(dn.map(Jn=>Jn.id)))}}let Oe,Pe,rt,lt;const Ye=l.mapObject(ge.glyphDependencies,vt=>Object.keys(vt).map(Number));Object.keys(Ye).length?J.send("getGlyphs",{uid:this.uid,stacks:Ye},(vt,At)=>{Oe||(Oe=vt,Pe=At,Rt.call(this))}):Pe={};const gt=Object.keys(ge.iconDependencies);gt.length?J.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"icons"},(vt,At)=>{Oe||(Oe=vt,rt=At,Rt.call(this))}):rt={};const dt=Object.keys(ge.patternDependencies);function Rt(){if(Oe)return ce(Oe);if(Pe&&rt&&lt){const vt=new I(Pe),At=new l.ImageAtlas(rt,lt);for(const Ft in le){const Vt=le[Ft];Vt instanceof l.SymbolBucket?(B(Vt.layers,this.zoom,Y),l.performSymbolLayout({bucket:Vt,glyphMap:Pe,glyphPositions:vt.positions,imageMap:rt,imagePositions:At.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof l.LineBucket||Vt instanceof l.FillBucket||Vt instanceof l.FillExtrusionBucket)&&(B(Vt.layers,this.zoom,Y),Vt.addFeatures(ge,this.tileID.canonical,At.patternPositions))}this.status="done",ce(null,{buckets:Object.values(le).filter(Ft=>!Ft.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vt.image,imageAtlas:At,glyphMap:this.returnDependencies?Pe:null,iconMap:this.returnDependencies?rt:null,glyphPositions:this.returnDependencies?vt.positions:null})}}dt.length?J.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"},(vt,At)=>{Oe||(Oe=vt,lt=At,Rt.call(this))}):lt={},Rt.call(this)}}function B(ee,R,F){const Y=new l.EvaluationParameters(R);for(const J of ee)J.recalculate(Y,F)}function G(ee,R){const F=l.getArrayBuffer(ee.request,(Y,J,ce,me)=>{Y?R(Y):J&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(J)),rawData:J,cacheControl:ce,expires:me})});return()=>{F.cancel(),R()}}class K{constructor(R,F,Y,J){this.actor=R,this.layerIndex=F,this.availableImages=Y,this.loadVectorData=J||G,this.loading={},this.loaded={}}loadTile(R,F){const Y=R.uid;this.loading||(this.loading={});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),ce=this.loading[Y]=new P(R);ce.abort=this.loadVectorData(R,(me,he)=>{if(delete this.loading[Y],me||!he)return ce.status="done",this.loaded[Y]=ce,F(me);const le=he.rawData,ge={};he.expires&&(ge.expires=he.expires),he.cacheControl&&(ge.cacheControl=he.cacheControl);const Ce={};if(J){const Oe=J.finish();Oe&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ce.vectorTile=he.vectorTile,ce.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(Oe,Pe)=>{if(Oe||!Pe)return F(Oe);F(null,l.extend({rawTileData:le.slice(0)},Pe,ge,Ce))}),this.loaded=this.loaded||{},this.loaded[Y]=ce})}reloadTile(R,F){const Y=this.loaded,J=R.uid,ce=this;if(Y&&Y[J]){const me=Y[J];me.showCollisionBoxes=R.showCollisionBoxes;const he=(le,ge)=>{const Ce=me.reloadCallback;Ce&&(delete me.reloadCallback,me.parse(me.vectorTile,ce.layerIndex,this.availableImages,ce.actor,Ce)),F(le,ge)};me.status==="parsing"?me.reloadCallback=he:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}}abortTile(R,F){const Y=this.loading,J=R.uid;Y&&Y[J]&&Y[J].abort&&(Y[J].abort(),delete Y[J]),F()}removeTile(R,F){const Y=this.loaded,J=R.uid;Y&&Y[J]&&delete Y[J],F()}}class de{constructor(){this.loaded={}}loadTile(R,F){const{uid:Y,encoding:J,rawImageData:ce}=R,me=l.isImageBitmap(ce)?this.getImageData(ce):ce,he=new l.DEMData(Y,me,J);this.loaded=this.loaded||{},this.loaded[Y]=he,F(null,he)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(R){const F=this.loaded,Y=R.uid;F&&F[Y]&&delete F[Y]}}var Z=function ee(R,F){var Y,J=R&&R.type;if(J==="FeatureCollection")for(Y=0;Y<R.features.length;Y++)ee(R.features[Y],F);else if(J==="GeometryCollection")for(Y=0;Y<R.geometries.length;Y++)ee(R.geometries[Y],F);else if(J==="Feature")ee(R.geometry,F);else if(J==="Polygon")j(R.coordinates,F);else if(J==="MultiPolygon")for(Y=0;Y<R.coordinates.length;Y++)j(R.coordinates[Y],F);return R};function j(ee,R){if(ee.length!==0){q(ee[0],R);for(var F=1;F<ee.length;F++)q(ee[F],!R)}}function q(ee,R){for(var F=0,Y=0,J=0,ce=ee.length,me=ce-1;J<ce;me=J++){var he=(ee[J][0]-ee[me][0])*(ee[me][1]+ee[J][1]),le=F+he;Y+=Math.abs(F)>=Math.abs(he)?F-le+he:he-le+F,F=le}F+Y>=0!=!!R&&ee.reverse()}const se=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class pe{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const F of this._feature.geometry)R.push([new l.pointGeometry(F[0],F[1])]);return R}{const R=[];for(const F of this._feature.geometry){const Y=[];for(const J of F)Y.push(new l.pointGeometry(J[0],J[1]));R.push(Y)}return R}}toGeoJSON(R,F,Y){return se.call(this,R,F,Y)}}class be{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new pe(this._features[R])}}var Re={exports:{}},Fe=l.pointGeometry,Ve=l.vectorTile.VectorTileFeature,je=pt;function pt(ee,R){this.options=R||{},this.features=ee,this.length=ee.length}function bt(ee,R){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=R||4096}pt.prototype.feature=function(ee){return new bt(this.features[ee],this.options.extent)},bt.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var R=0;R<ee.length;R++){for(var F=ee[R],Y=[],J=0;J<F.length;J++)Y.push(new Fe(F[J][0],F[J][1]));this.geometry.push(Y)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,R=1/0,F=-1/0,Y=1/0,J=-1/0,ce=0;ce<ee.length;ce++)for(var me=ee[ce],he=0;he<me.length;he++){var le=me[he];R=Math.min(R,le.x),F=Math.max(F,le.x),Y=Math.min(Y,le.y),J=Math.max(J,le.y)}return[R,Y,F,J]},bt.prototype.toGeoJSON=Ve.prototype.toGeoJSON;var St=l.pbf,kt=je;function Gn(ee){var R=new St;return function(F,Y){for(var J in F.layers)Y.writeMessage(3,xt,F.layers[J])}(ee,R),R.finish()}function xt(ee,R){var F;R.writeVarintField(15,ee.version||1),R.writeStringField(1,ee.name||""),R.writeVarintField(5,ee.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<ee.length;F++)Y.feature=ee.feature(F),R.writeMessage(2,xi,Y);var J=Y.keys;for(F=0;F<J.length;F++)R.writeStringField(3,J[F]);var ce=Y.values;for(F=0;F<ce.length;F++)R.writeMessage(4,rn,ce[F])}function xi(ee,R){var F=ee.feature;F.id!==void 0&&R.writeVarintField(1,F.id),R.writeMessage(2,tt,ee),R.writeVarintField(3,F.type),R.writeMessage(4,nn,F)}function tt(ee,R){var F=ee.feature,Y=ee.keys,J=ee.values,ce=ee.keycache,me=ee.valuecache;for(var he in F.properties){var le=F.properties[he],ge=ce[he];if(le!==null){ge===void 0&&(Y.push(he),ce[he]=ge=Y.length-1),R.writeVarint(ge);var Ce=typeof le;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(le=JSON.stringify(le));var Oe=Ce+":"+le,Pe=me[Oe];Pe===void 0&&(J.push(le),me[Oe]=Pe=J.length-1),R.writeVarint(Pe)}}}function Et(ee,R){return(R<<3)+(7&ee)}function Pt(ee){return ee<<1^ee>>31}function nn(ee,R){for(var F=ee.loadGeometry(),Y=ee.type,J=0,ce=0,me=F.length,he=0;he<me;he++){var le=F[he],ge=1;Y===1&&(ge=le.length),R.writeVarint(Et(1,ge));for(var Ce=Y===3?le.length-1:le.length,Oe=0;Oe<Ce;Oe++){Oe===1&&Y!==1&&R.writeVarint(Et(2,Ce-1));var Pe=le[Oe].x-J,rt=le[Oe].y-ce;R.writeVarint(Pt(Pe)),R.writeVarint(Pt(rt)),J+=Pe,ce+=rt}Y===3&&R.writeVarint(Et(7,1))}}function rn(ee,R){var F=typeof ee;F==="string"?R.writeStringField(1,ee):F==="boolean"?R.writeBooleanField(7,ee):F==="number"&&(ee%1!=0?R.writeDoubleField(3,ee):ee<0?R.writeSVarintField(6,ee):R.writeVarintField(5,ee))}function ir(ee,R,F,Y,J,ce){if(J-Y<=F)return;const me=Y+J>>1;ii(ee,R,me,Y,J,ce%2),ir(ee,R,F,Y,me-1,ce+1),ir(ee,R,F,me+1,J,ce+1)}function ii(ee,R,F,Y,J,ce){for(;J>Y;){if(J-Y>600){const ge=J-Y+1,Ce=F-Y+1,Oe=Math.log(ge),Pe=.5*Math.exp(2*Oe/3),rt=.5*Math.sqrt(Oe*Pe*(ge-Pe)/ge)*(Ce-ge/2<0?-1:1);ii(ee,R,F,Math.max(Y,Math.floor(F-Ce*Pe/ge+rt)),Math.min(J,Math.floor(F+(ge-Ce)*Pe/ge+rt)),ce)}const me=R[2*F+ce];let he=Y,le=J;for(bi(ee,R,Y,F),R[2*J+ce]>me&&bi(ee,R,Y,J);he<le;){for(bi(ee,R,he,le),he++,le--;R[2*he+ce]<me;)he++;for(;R[2*le+ce]>me;)le--}R[2*Y+ce]===me?bi(ee,R,Y,le):(le++,bi(ee,R,le,J)),le<=F&&(Y=le+1),F<=le&&(J=le-1)}}function bi(ee,R,F,Y){ri(ee,F,Y),ri(R,2*F,2*Y),ri(R,2*F+1,2*Y+1)}function ri(ee,R,F){const Y=ee[R];ee[R]=ee[F],ee[F]=Y}function un(ee,R,F,Y){const J=ee-F,ce=R-Y;return J*J+ce*ce}Re.exports=Gn,Re.exports.fromVectorTileJs=Gn,Re.exports.fromGeojsonVt=function(ee,R){R=R||{};var F={};for(var Y in ee)F[Y]=new kt(ee[Y].features,R),F[Y].name=Y,F[Y].version=R.version,F[Y].extent=R.extent;return Gn({layers:F})},Re.exports.GeoJSONWrapper=kt;const wi=ee=>ee[0],qt=ee=>ee[1];class Dn{constructor(R,F=wi,Y=qt,J=64,ce=Float64Array){this.nodeSize=J,this.points=R;const me=R.length<65536?Uint16Array:Uint32Array,he=this.ids=new me(R.length),le=this.coords=new ce(2*R.length);for(let ge=0;ge<R.length;ge++)he[ge]=ge,le[2*ge]=F(R[ge]),le[2*ge+1]=Y(R[ge]);ir(he,le,J,0,he.length-1,0)}range(R,F,Y,J){return function(ce,me,he,le,ge,Ce,Oe){const Pe=[0,ce.length-1,0],rt=[];let lt,Ye;for(;Pe.length;){const gt=Pe.pop(),dt=Pe.pop(),Rt=Pe.pop();if(dt-Rt<=Oe){for(let Ft=Rt;Ft<=dt;Ft++)lt=me[2*Ft],Ye=me[2*Ft+1],lt>=he&&lt<=ge&&Ye>=le&&Ye<=Ce&&rt.push(ce[Ft]);continue}const vt=Math.floor((Rt+dt)/2);lt=me[2*vt],Ye=me[2*vt+1],lt>=he&&lt<=ge&&Ye>=le&&Ye<=Ce&&rt.push(ce[vt]);const At=(gt+1)%2;(gt===0?he<=lt:le<=Ye)&&(Pe.push(Rt),Pe.push(vt-1),Pe.push(At)),(gt===0?ge>=lt:Ce>=Ye)&&(Pe.push(vt+1),Pe.push(dt),Pe.push(At))}return rt}(this.ids,this.coords,R,F,Y,J,this.nodeSize)}within(R,F,Y){return function(J,ce,me,he,le,ge){const Ce=[0,J.length-1,0],Oe=[],Pe=le*le;for(;Ce.length;){const rt=Ce.pop(),lt=Ce.pop(),Ye=Ce.pop();if(lt-Ye<=ge){for(let At=Ye;At<=lt;At++)un(ce[2*At],ce[2*At+1],me,he)<=Pe&&Oe.push(J[At]);continue}const gt=Math.floor((Ye+lt)/2),dt=ce[2*gt],Rt=ce[2*gt+1];un(dt,Rt,me,he)<=Pe&&Oe.push(J[gt]);const vt=(rt+1)%2;(rt===0?me-le<=dt:he-le<=Rt)&&(Ce.push(Ye),Ce.push(gt-1),Ce.push(vt)),(rt===0?me+le>=dt:he+le>=Rt)&&(Ce.push(gt+1),Ce.push(lt),Ce.push(vt))}return Oe}(this.ids,this.coords,R,F,Y,this.nodeSize)}}const is={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},Li=Math.fround||(Yn=new Float32Array(1),ee=>(Yn[0]=+ee,Yn[0]));var Yn;class Lr{constructor(R){this.options=rs(Object.create(is),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:F,minZoom:Y,maxZoom:J,nodeSize:ce}=this.options;F&&console.time("total time");const me=`prepare ${R.length} points`;F&&console.time(me),this.points=R;let he=[];for(let le=0;le<R.length;le++)R[le].geometry&&he.push(di(R[le],le));this.trees[J+1]=new Dn(he,go,kr,ce,Float32Array),F&&console.timeEnd(me);for(let le=J;le>=Y;le--){const ge=+Date.now();he=this._cluster(he,le),this.trees[le]=new Dn(he,go,kr,ce,Float32Array),F&&console.log("z%d: %d clusters in %dms",le,he.length,+Date.now()-ge)}return F&&console.timeEnd("total time"),this}getClusters(R,F){let Y=((R[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,R[1]));let ce=R[2]===180?180:((R[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)Y=-180,ce=180;else if(Y>ce){const Ce=this.getClusters([Y,J,180,me],F),Oe=this.getClusters([-180,J,ce,me],F);return Ce.concat(Oe)}const he=this.trees[this._limitZoom(F)],le=he.range(Gt(Y),ki(me),Gt(ce),ki(J)),ge=[];for(const Ce of le){const Oe=he.points[Ce];ge.push(Oe.numPoints?Gi(Oe):this.points[Oe.index])}return ge}getChildren(R){const F=this._getOriginId(R),Y=this._getOriginZoom(R),J="No cluster with the specified id.",ce=this.trees[Y];if(!ce)throw new Error(J);const me=ce.points[F];if(!me)throw new Error(J);const he=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),le=ce.within(me.x,me.y,he),ge=[];for(const Ce of le){const Oe=ce.points[Ce];Oe.parentId===R&&ge.push(Oe.numPoints?Gi(Oe):this.points[Oe.index])}if(ge.length===0)throw new Error(J);return ge}getLeaves(R,F,Y){const J=[];return this._appendLeaves(J,R,F=F||10,Y=Y||0,0),J}getTile(R,F,Y){const J=this.trees[this._limitZoom(R)],ce=Math.pow(2,R),{extent:me,radius:he}=this.options,le=he/me,ge=(Y-le)/ce,Ce=(Y+1+le)/ce,Oe={features:[]};return this._addTileFeatures(J.range((F-le)/ce,ge,(F+1+le)/ce,Ce),J.points,F,Y,ce,Oe),F===0&&this._addTileFeatures(J.range(1-le/ce,ge,1,Ce),J.points,ce,Y,ce,Oe),F===ce-1&&this._addTileFeatures(J.range(0,ge,le/ce,Ce),J.points,-1,Y,ce,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(R){let F=this._getOriginZoom(R)-1;for(;F<=this.options.maxZoom;){const Y=this.getChildren(R);if(F++,Y.length!==1)break;R=Y[0].properties.cluster_id}return F}_appendLeaves(R,F,Y,J,ce){const me=this.getChildren(F);for(const he of me){const le=he.properties;if(le&&le.cluster?ce+le.point_count<=J?ce+=le.point_count:ce=this._appendLeaves(R,le.cluster_id,Y,J,ce):ce<J?ce++:R.push(he),R.length===Y)break}return ce}_addTileFeatures(R,F,Y,J,ce,me){for(const he of R){const le=F[he],ge=le.numPoints;let Ce,Oe,Pe;if(ge)Ce=Vs(le),Oe=le.x,Pe=le.y;else{const Ye=this.points[le.index];Ce=Ye.properties,Oe=Gt(Ye.geometry.coordinates[0]),Pe=ki(Ye.geometry.coordinates[1])}const rt={type:1,geometry:[[Math.round(this.options.extent*(Oe*ce-Y)),Math.round(this.options.extent*(Pe*ce-J))]],tags:Ce};let lt;ge?lt=le.id:this.options.generateId?lt=le.index:this.points[le.index].id&&(lt=this.points[le.index].id),lt!==void 0&&(rt.id=lt),me.features.push(rt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,F){const Y=[],{radius:J,extent:ce,reduce:me,minPoints:he}=this.options,le=J/(ce*Math.pow(2,F));for(let ge=0;ge<R.length;ge++){const Ce=R[ge];if(Ce.zoom<=F)continue;Ce.zoom=F;const Oe=this.trees[F+1],Pe=Oe.within(Ce.x,Ce.y,le),rt=Ce.numPoints||1;let lt=rt;for(const Ye of Pe){const gt=Oe.points[Ye];gt.zoom>F&&(lt+=gt.numPoints||1)}if(lt>rt&&lt>=he){let Ye=Ce.x*rt,gt=Ce.y*rt,dt=me&&rt>1?this._map(Ce,!0):null;const Rt=(ge<<5)+(F+1)+this.points.length;for(const vt of Pe){const At=Oe.points[vt];if(At.zoom<=F)continue;At.zoom=F;const Ft=At.numPoints||1;Ye+=At.x*Ft,gt+=At.y*Ft,At.parentId=Rt,me&&(dt||(dt=this._map(Ce,!0)),me(dt,this._map(At)))}Ce.parentId=Rt,Y.push(ji(Ye/lt,gt/lt,Rt,lt,dt))}else if(Y.push(Ce),lt>1)for(const Ye of Pe){const gt=Oe.points[Ye];gt.zoom<=F||(gt.zoom=F,Y.push(gt))}}return Y}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,F){if(R.numPoints)return F?rs({},R.properties):R.properties;const Y=this.points[R.index].properties,J=this.options.map(Y);return F&&J===Y?rs({},J):J}}function ji(ee,R,F,Y,J){return{x:Li(ee),y:Li(R),zoom:1/0,id:F,parentId:-1,numPoints:Y,properties:J}}function di(ee,R){const[F,Y]=ee.geometry.coordinates;return{x:Li(Gt(F)),y:Li(ki(Y)),zoom:1/0,index:R,parentId:-1}}function Gi(ee){return{type:"Feature",id:ee.id,properties:Vs(ee),geometry:{type:"Point",coordinates:[(R=ee.x,360*(R-.5)),On(ee.y)]}};var R}function Vs(ee){const R=ee.numPoints,F=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return rs(rs({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:R,point_count_abbreviated:F})}function Gt(ee){return ee/360+.5}function ki(ee){const R=Math.sin(ee*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function On(ee){const R=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function rs(ee,R){for(const F in R)ee[F]=R[F];return ee}function go(ee){return ee.x}function kr(ee){return ee.y}function Rr(ee,R,F,Y){for(var J,ce=Y,me=F-R>>1,he=F-R,le=ee[R],ge=ee[R+1],Ce=ee[F],Oe=ee[F+1],Pe=R+3;Pe<F;Pe+=3){var rt=js(ee[Pe],ee[Pe+1],le,ge,Ce,Oe);if(rt>ce)J=Pe,ce=rt;else if(rt===ce){var lt=Math.abs(Pe-me);lt<he&&(J=Pe,he=lt)}}ce>Y&&(J-R>3&&Rr(ee,R,J,Y),ee[J+2]=ce,F-J>3&&Rr(ee,J,F,Y))}function js(ee,R,F,Y,J,ce){var me=J-F,he=ce-Y;if(me!==0||he!==0){var le=((ee-F)*me+(R-Y)*he)/(me*me+he*he);le>1?(F=J,Y=ce):le>0&&(F+=me*le,Y+=he*le)}return(me=ee-F)*me+(he=R-Y)*he}function vr(ee,R,F,Y){var J={id:ee===void 0?null:ee,type:R,geometry:F,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var me=ce.geometry,he=ce.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Me(ce,me);else if(he==="Polygon"||he==="MultiLineString")for(var le=0;le<me.length;le++)Me(ce,me[le]);else if(he==="MultiPolygon")for(le=0;le<me.length;le++)for(var ge=0;ge<me[le].length;ge++)Me(ce,me[le][ge])}(J),J}function Me(ee,R){for(var F=0;F<R.length;F+=3)ee.minX=Math.min(ee.minX,R[F]),ee.minY=Math.min(ee.minY,R[F+1]),ee.maxX=Math.max(ee.maxX,R[F]),ee.maxY=Math.max(ee.maxY,R[F+1])}function $e(ee,R,F,Y){if(R.geometry){var J=R.geometry.coordinates,ce=R.geometry.type,me=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),he=[],le=R.id;if(F.promoteId?le=R.properties[F.promoteId]:F.generateId&&(le=Y||0),ce==="Point")ss(J,he);else if(ce==="MultiPoint")for(var ge=0;ge<J.length;ge++)ss(J[ge],he);else if(ce==="LineString")Ei(J,he,me,!1);else if(ce==="MultiLineString"){if(F.lineMetrics){for(ge=0;ge<J.length;ge++)Ei(J[ge],he=[],me,!1),ee.push(vr(le,"LineString",he,R.properties));return}Ut(J,he,me,!1)}else if(ce==="Polygon")Ut(J,he,me,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(ge=0;ge<R.geometry.geometries.length;ge++)$e(ee,{id:le,geometry:R.geometry.geometries[ge],properties:R.properties},F,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<J.length;ge++){var Ce=[];Ut(J[ge],Ce,me,!0),he.push(Ce)}}ee.push(vr(le,ce,he,R.properties))}}function ss(ee,R){R.push(Wi(ee[0])),R.push(Ri(ee[1])),R.push(0)}function Ei(ee,R,F,Y){for(var J,ce,me=0,he=0;he<ee.length;he++){var le=Wi(ee[he][0]),ge=Ri(ee[he][1]);R.push(le),R.push(ge),R.push(0),he>0&&(me+=Y?(J*ge-le*ce)/2:Math.sqrt(Math.pow(le-J,2)+Math.pow(ge-ce,2))),J=le,ce=ge}var Ce=R.length-3;R[2]=1,Rr(R,0,Ce,F),R[Ce+2]=1,R.size=Math.abs(me),R.start=0,R.end=R.size}function Ut(ee,R,F,Y){for(var J=0;J<ee.length;J++){var ce=[];Ei(ee[J],ce,F,Y),R.push(ce)}}function Wi(ee){return ee/360+.5}function Ri(ee){var R=Math.sin(ee*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function zi(ee,R,F,Y,J,ce,me,he){if(Y/=R,ce>=(F/=R)&&me<Y)return ee;if(me<F||ce>=Y)return null;for(var le=[],ge=0;ge<ee.length;ge++){var Ce=ee[ge],Oe=Ce.geometry,Pe=Ce.type,rt=J===0?Ce.minX:Ce.minY,lt=J===0?Ce.maxX:Ce.maxY;if(rt>=F&&lt<Y)le.push(Ce);else if(!(lt<F||rt>=Y)){var Ye=[];if(Pe==="Point"||Pe==="MultiPoint")os(Oe,Ye,F,Y,J);else if(Pe==="LineString")He(Oe,Ye,F,Y,J,!1,he.lineMetrics);else if(Pe==="MultiLineString")It(Oe,Ye,F,Y,J,!1);else if(Pe==="Polygon")It(Oe,Ye,F,Y,J,!0);else if(Pe==="MultiPolygon")for(var gt=0;gt<Oe.length;gt++){var dt=[];It(Oe[gt],dt,F,Y,J,!0),dt.length&&Ye.push(dt)}if(Ye.length){if(he.lineMetrics&&Pe==="LineString"){for(gt=0;gt<Ye.length;gt++)le.push(vr(Ce.id,Pe,Ye[gt],Ce.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(Ye.length===1?(Pe="LineString",Ye=Ye[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=Ye.length===3?"Point":"MultiPoint"),le.push(vr(Ce.id,Pe,Ye,Ce.tags))}}}return le.length?le:null}function os(ee,R,F,Y,J){for(var ce=0;ce<ee.length;ce+=3){var me=ee[ce+J];me>=F&&me<=Y&&(R.push(ee[ce]),R.push(ee[ce+1]),R.push(ee[ce+2]))}}function He(ee,R,F,Y,J,ce,me){for(var he,le,ge=Mt(ee),Ce=J===0?zr:Ct,Oe=ee.start,Pe=0;Pe<ee.length-3;Pe+=3){var rt=ee[Pe],lt=ee[Pe+1],Ye=ee[Pe+2],gt=ee[Pe+3],dt=ee[Pe+4],Rt=J===0?rt:lt,vt=J===0?gt:dt,At=!1;me&&(he=Math.sqrt(Math.pow(rt-gt,2)+Math.pow(lt-dt,2))),Rt<F?vt>F&&(le=Ce(ge,rt,lt,gt,dt,F),me&&(ge.start=Oe+he*le)):Rt>Y?vt<Y&&(le=Ce(ge,rt,lt,gt,dt,Y),me&&(ge.start=Oe+he*le)):Kn(ge,rt,lt,Ye),vt<F&&Rt>=F&&(le=Ce(ge,rt,lt,gt,dt,F),At=!0),vt>Y&&Rt<=Y&&(le=Ce(ge,rt,lt,gt,dt,Y),At=!0),!ce&&At&&(me&&(ge.end=Oe+he*le),R.push(ge),ge=Mt(ee)),me&&(Oe+=he)}var Ft=ee.length-3;rt=ee[Ft],lt=ee[Ft+1],Ye=ee[Ft+2],(Rt=J===0?rt:lt)>=F&&Rt<=Y&&Kn(ge,rt,lt,Ye),Ft=ge.length-3,ce&&Ft>=3&&(ge[Ft]!==ge[0]||ge[Ft+1]!==ge[1])&&Kn(ge,ge[0],ge[1],ge[2]),ge.length&&R.push(ge)}function Mt(ee){var R=[];return R.size=ee.size,R.start=ee.start,R.end=ee.end,R}function It(ee,R,F,Y,J,ce){for(var me=0;me<ee.length;me++)He(ee[me],R,F,Y,J,ce,!1)}function Kn(ee,R,F,Y){ee.push(R),ee.push(F),ee.push(Y)}function zr(ee,R,F,Y,J,ce){var me=(ce-R)/(Y-R);return ee.push(ce),ee.push(F+(J-F)*me),ee.push(1),me}function Ct(ee,R,F,Y,J,ce){var me=(ce-F)/(J-F);return ee.push(R+(Y-R)*me),ee.push(ce),ee.push(1),me}function rr(ee,R){for(var F=[],Y=0;Y<ee.length;Y++){var J,ce=ee[Y],me=ce.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")J=Wn(ce.geometry,R);else if(me==="MultiLineString"||me==="Polygon"){J=[];for(var he=0;he<ce.geometry.length;he++)J.push(Wn(ce.geometry[he],R))}else if(me==="MultiPolygon")for(J=[],he=0;he<ce.geometry.length;he++){for(var le=[],ge=0;ge<ce.geometry[he].length;ge++)le.push(Wn(ce.geometry[he][ge],R));J.push(le)}F.push(vr(ce.id,me,J,ce.tags))}return F}function Wn(ee,R){var F=[];F.size=ee.size,ee.start!==void 0&&(F.start=ee.start,F.end=ee.end);for(var Y=0;Y<ee.length;Y+=3)F.push(ee[Y]+R,ee[Y+1],ee[Y+2]);return F}function Gs(ee,R){if(ee.transformed)return ee;var F,Y,J,ce=1<<ee.z,me=ee.x,he=ee.y;for(F=0;F<ee.features.length;F++){var le=ee.features[F],ge=le.geometry,Ce=le.type;if(le.geometry=[],Ce===1)for(Y=0;Y<ge.length;Y+=2)le.geometry.push(Ln(ge[Y],ge[Y+1],R,ce,me,he));else for(Y=0;Y<ge.length;Y++){var Oe=[];for(J=0;J<ge[Y].length;J+=2)Oe.push(Ln(ge[Y][J],ge[Y][J+1],R,ce,me,he));le.geometry.push(Oe)}}return ee.transformed=!0,ee}function Ln(ee,R,F,Y,J,ce){return[Math.round(F*(ee*Y-J)),Math.round(F*(R*Y-ce))]}function si(ee,R,F,Y,J){for(var ce=R===J.maxZoom?0:J.tolerance/((1<<R)*J.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:Y,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<ee.length;he++){me.numFeatures++,en(me,ee[he],ce,J);var le=ee[he].minX,ge=ee[he].minY,Ce=ee[he].maxX,Oe=ee[he].maxY;le<me.minX&&(me.minX=le),ge<me.minY&&(me.minY=ge),Ce>me.maxX&&(me.maxX=Ce),Oe>me.maxY&&(me.maxY=Oe)}return me}function en(ee,R,F,Y){var J=R.geometry,ce=R.type,me=[];if(ce==="Point"||ce==="MultiPoint")for(var he=0;he<J.length;he+=3)me.push(J[he]),me.push(J[he+1]),ee.numPoints++,ee.numSimplified++;else if(ce==="LineString")Ws(me,J,ee,F,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(he=0;he<J.length;he++)Ws(me,J[he],ee,F,ce==="Polygon",he===0);else if(ce==="MultiPolygon")for(var le=0;le<J.length;le++){var ge=J[le];for(he=0;he<ge.length;he++)Ws(me,ge[he],ee,F,!0,he===0)}if(me.length){var Ce=R.tags||null;if(ce==="LineString"&&Y.lineMetrics){for(var Oe in Ce={},R.tags)Ce[Oe]=R.tags[Oe];Ce.mapbox_clip_start=J.start/J.size,Ce.mapbox_clip_end=J.end/J.size}var Pe={geometry:me,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Ce};R.id!==null&&(Pe.id=R.id),ee.features.push(Pe)}}function Ws(ee,R,F,Y,J,ce){var me=Y*Y;if(Y>0&&R.size<(J?me:Y))F.numPoints+=R.length/3;else{for(var he=[],le=0;le<R.length;le+=3)(Y===0||R[le+2]>me)&&(F.numSimplified++,he.push(R[le]),he.push(R[le+1])),F.numPoints++;J&&function(ge,Ce){for(var Oe=0,Pe=0,rt=ge.length,lt=rt-2;Pe<rt;lt=Pe,Pe+=2)Oe+=(ge[Pe]-ge[lt])*(ge[Pe+1]+ge[lt+1]);if(Oe>0===Ce)for(Pe=0,rt=ge.length;Pe<rt/2;Pe+=2){var Ye=ge[Pe],gt=ge[Pe+1];ge[Pe]=ge[rt-2-Pe],ge[Pe+1]=ge[rt-1-Pe],ge[rt-2-Pe]=Ye,ge[rt-1-Pe]=gt}}(he,ce),ee.push(he)}}function xr(ee,R){var F=(R=this.options=function(J,ce){for(var me in ce)J[me]=ce[me];return J}(Object.create(this.options),R)).debug;if(F&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(J,ce){var me=[];if(J.type==="FeatureCollection")for(var he=0;he<J.features.length;he++)$e(me,J.features[he],ce,he);else $e(me,J.type==="Feature"?J:{geometry:J},ce);return me}(ee,R);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(J,ce){var me=ce.buffer/ce.extent,he=J,le=zi(J,1,-1-me,me,0,-1,2,ce),ge=zi(J,1,1-me,2+me,0,-1,2,ce);return(le||ge)&&(he=zi(J,1,-me,1+me,0,-1,2,ce)||[],le&&(he=rr(le,1).concat(he)),ge&&(he=he.concat(rr(ge,-1)))),he}(Y,R),Y.length&&this.splitTile(Y,0,0,0),F&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function br(ee,R,F){return 32*((1<<ee)*F+R)+ee}function ws(ee,R){const F=ee.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const Y=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!Y)return R(null,null);const J=new be(Y.features);let ce=Re.exports(J);ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),R(null,{vectorTile:J,rawData:ce.buffer})}xr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xr.prototype.splitTile=function(ee,R,F,Y,J,ce,me){for(var he=[ee,R,F,Y],le=this.options,ge=le.debug;he.length;){Y=he.pop(),F=he.pop(),R=he.pop(),ee=he.pop();var Ce=1<<R,Oe=br(R,F,Y),Pe=this.tiles[Oe];if(!Pe&&(ge>1&&console.time("creation"),Pe=this.tiles[Oe]=si(ee,R,F,Y,le),this.tileCoords.push({z:R,x:F,y:Y}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,F,Y,Pe.numFeatures,Pe.numPoints,Pe.numSimplified),console.timeEnd("creation"));var rt="z"+R;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}if(Pe.source=ee,J){if(R===le.maxZoom||R===J)continue;var lt=1<<J-R;if(F!==Math.floor(ce/lt)||Y!==Math.floor(me/lt))continue}else if(R===le.indexMaxZoom||Pe.numPoints<=le.indexMaxPoints)continue;if(Pe.source=null,ee.length!==0){ge>1&&console.time("clipping");var Ye,gt,dt,Rt,vt,At,Ft=.5*le.buffer/le.extent,Vt=.5-Ft,dn=.5+Ft,fn=1+Ft;Ye=gt=dt=Rt=null,vt=zi(ee,Ce,F-Ft,F+dn,0,Pe.minX,Pe.maxX,le),At=zi(ee,Ce,F+Vt,F+fn,0,Pe.minX,Pe.maxX,le),ee=null,vt&&(Ye=zi(vt,Ce,Y-Ft,Y+dn,1,Pe.minY,Pe.maxY,le),gt=zi(vt,Ce,Y+Vt,Y+fn,1,Pe.minY,Pe.maxY,le),vt=null),At&&(dt=zi(At,Ce,Y-Ft,Y+dn,1,Pe.minY,Pe.maxY,le),Rt=zi(At,Ce,Y+Vt,Y+fn,1,Pe.minY,Pe.maxY,le),At=null),ge>1&&console.timeEnd("clipping"),he.push(Ye||[],R+1,2*F,2*Y),he.push(gt||[],R+1,2*F,2*Y+1),he.push(dt||[],R+1,2*F+1,2*Y),he.push(Rt||[],R+1,2*F+1,2*Y+1)}}},xr.prototype.getTile=function(ee,R,F){var Y=this.options,J=Y.extent,ce=Y.debug;if(ee<0||ee>24)return null;var me=1<<ee,he=br(ee,R=(R%me+me)%me,F);if(this.tiles[he])return Gs(this.tiles[he],J);ce>1&&console.log("drilling down to z%d-%d-%d",ee,R,F);for(var le,ge=ee,Ce=R,Oe=F;!le&&ge>0;)ge--,Ce=Math.floor(Ce/2),Oe=Math.floor(Oe/2),le=this.tiles[br(ge,Ce,Oe)];return le&&le.source?(ce>1&&console.log("found parent tile z%d-%d-%d",ge,Ce,Oe),ce>1&&console.time("drilling down"),this.splitTile(le.source,ge,Ce,Oe,ee,R,F),ce>1&&console.timeEnd("drilling down"),this.tiles[he]?Gs(this.tiles[he],J):null):null};class Hs extends K{constructor(R,F,Y,J){super(R,F,Y,ws),J&&(this.loadGeoJSON=J)}loadData(R,F){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(R,(ce,me)=>{if(delete this._pendingCallback,delete this._pendingRequest,ce||!me)return F(ce);if(typeof me!="object")return F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Z(me,!0);try{if(R.filter){const le=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ce=>le.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=R.cluster?new Lr(function({superclusterOptions:le,clusterProperties:ge}){if(!ge||!le)return le;const Ce={},Oe={},Pe={accumulated:null,zoom:0},rt={properties:null},lt=Object.keys(ge);for(const Ye of lt){const[gt,dt]=ge[Ye],Rt=l.createExpression(dt),vt=l.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",Ye]]:gt);Ce[Ye]=Rt.value,Oe[Ye]=vt.value}return le.map=Ye=>{rt.properties=Ye;const gt={};for(const dt of lt)gt[dt]=Ce[dt].evaluate(Pe,rt);return gt},le.reduce=(Ye,gt)=>{rt.properties=gt;for(const dt of lt)Pe.accumulated=Ye[dt],Ye[dt]=Oe[dt].evaluate(Pe,rt)},le}(R)).load(me.features):function(le,ge){return new xr(le,ge)}(me,R.geojsonVtOptions)}catch(le){return F(le)}this.loaded={};const he={};if(J){const le=J.finish();le&&(he.resourceTiming={},he.resourceTiming[R.source]=JSON.parse(JSON.stringify(le)))}F(null,he)}})}reloadTile(R,F){const Y=this.loaded;return Y&&Y[R.uid]?super.reloadTile(R,F):this.loadTile(R,F)}loadGeoJSON(R,F){if(R.request)return l.getJSON(R.request,F);if(typeof R.data=="string")try{F(null,JSON.parse(R.data))}catch{F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(R,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(Y){F(Y)}}getClusterChildren(R,F){try{F(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(Y){F(Y)}}getClusterLeaves(R,F){try{F(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(Y){F(Y)}}}class as{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:K,geojson:Hs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,Y)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=Y},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(R,F){this.referrer=F}setImages(R,F,Y){this.availableImages[R]=F;for(const J in this.workerSources[R]){const ce=this.workerSources[R][J];for(const me in ce)ce[me].availableImages=F}Y()}setLayers(R,F,Y){this.getLayerIndex(R).replace(F),Y()}updateLayers(R,F,Y){this.getLayerIndex(R).update(F.layers,F.removedIds),Y()}loadTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).loadTile(F,Y)}loadDEMTile(R,F,Y){this.getDEMWorkerSource(R,F.source).loadTile(F,Y)}reloadTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).reloadTile(F,Y)}abortTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).abortTile(F,Y)}removeTile(R,F,Y){this.getWorkerSource(R,F.type,F.source).removeTile(F,Y)}removeDEMTile(R,F){this.getDEMWorkerSource(R,F.source).removeTile(F)}removeSource(R,F,Y){if(!this.workerSources[R]||!this.workerSources[R][F.type]||!this.workerSources[R][F.type][F.source])return;const J=this.workerSources[R][F.type][F.source];delete this.workerSources[R][F.type][F.source],J.removeSource!==void 0?J.removeSource(F,Y):Y()}loadWorkerSource(R,F,Y){try{this.self.importScripts(F.url),Y()}catch(J){Y(J.toString())}}syncRTLPluginState(R,F,Y){try{l.plugin.setState(F);const J=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&J!=null){this.self.importScripts(J);const ce=l.plugin.isParsed();Y(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),ce)}}catch(J){Y(J.toString())}}getAvailableImages(R){let F=this.availableImages[R];return F||(F=[]),F}getLayerIndex(R){let F=this.layerIndexes[R];return F||(F=this.layerIndexes[R]=new S),F}getWorkerSource(R,F,Y){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][F]||(this.workerSources[R][F]={}),!this.workerSources[R][F][Y]){const J={send:(ce,me,he)=>{this.actor.send(ce,me,he,R)}};this.workerSources[R][F][Y]=new this.workerSourceTypes[F](J,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][F][Y]}getDEMWorkerSource(R,F){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][F]||(this.demWorkerSources[R][F]=new de),this.demWorkerSources[R][F]}enforceCacheSizeLimit(R,F){l.enforceCacheSizeLimit(F)}}return l.isWorker()&&(self.worker=new as(self)),as}),c(["./shared"],function(l){var y=w;function w(m){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()?(S[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(S[h]=function(p){var _,x=function(E){var C=document.createElement("canvas"),M=Object.create(w.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,C.getContext("webgl",M)||C.getContext("experimental-webgl",M)}(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(h)),S[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var S={};function I(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let h=0;h<m.length;h++)if(!I(m[h],o[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&o!==null){if(typeof o!="object"||Object.keys(m).length!==Object.keys(o).length)return!1;for(const h in m)if(!I(m[h],o[h]))return!1;return!0}return m===o}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class P{static testProp(o){if(!P.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in P.docStyle)return o[h];return o[0]}static create(o,h,p){const _=window.document.createElement(o);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(o,h){o.style[P.transformProp]=h}static addEventListener(o,h,p,_={}){o.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(o,h,p,_={}){o.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static mousePos(o,h){const p=o.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-o.clientLeft,h.clientY-p.top-o.clientTop)}static touchPos(o,h){const p=o.getBoundingClientRect(),_=[];for(let x=0;x<h.length;x++)_.push(new l.pointGeometry(h[x].clientX-p.left-o.clientLeft,h[x].clientY-p.top-o.clientTop));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);class B{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const _=function(x){const E=x.match(G);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return _.path+=`${h}${p}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(_)}setTransformRequest(o){this._transformRequestFn=o}}const G=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class K{constructor(o,h,p,_){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,_)}update(o,h,p){const{width:_,height:x}=o,E=!(this.size&&this.size[0]===_&&this.size[1]===x||p),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[_,x],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,_,x,0,this.format,M.UNSIGNED_BYTE,o.data);else{const{x:k,y:D}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?M.texSubImage2D(M.TEXTURE_2D,0,k,D,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,k,D,_,x,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(o,h,p){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),o!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function de(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class Z extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const _ of o){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){const p=this.images[o];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let p=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const p={};for(const _ of o){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.ImagePosition(_,p);this.patterns[o]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new K(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:h,h:p}=l.potpack(o),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],C=E.x+1,M=E.y+1,k=this.images[x].data,D=k.width,N=k.height;l.RGBAImage.copy(k,_,{x:0,y:0},{x:C,y:M},{width:D,height:N}),l.RGBAImage.copy(k,_,{x:0,y:N-1},{x:C,y:M-1},{width:D,height:1}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:C,y:M+N},{width:D,height:1}),l.RGBAImage.copy(k,_,{x:D-1,y:0},{x:C-1,y:M},{width:1,height:N}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:C+D,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),de(p)&&this.updateImage(h,p)}}}const j=1e20;function q(m,o,h,p,_,x,E,C,M){for(let k=o;k<o+p;k++)se(m,h*x+k,x,_,E,C,M);for(let k=h;k<h+_;k++)se(m,k*x+o,1,p,E,C,M)}function se(m,o,h,p,_,x,E){x[0]=0,E[0]=-j,E[1]=j,_[0]=m[o];for(let C=1,M=0,k=0;C<p;C++){_[C]=m[o+C*h];const D=C*C;do{const N=x[M];k=(_[C]-_[N]+D-N*N)/(C-N)/2}while(k<=E[M]&&--M>-1);M++,x[M]=C,E[M]=k,E[M+1]=j}for(let C=0,M=0;C<p;C++){for(;E[M+1]<C;)M++;const k=x[M],D=C-k;m[o+C*h]=_[k]+D*D}}class pe{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o,h){const p=[];for(const _ in o)for(const x of o[_])p.push({stack:_,id:x});l.asyncAll(p,({stack:_,id:x},E)=>{let C=this.entries[_];C||(C=this.entries[_]={glyphs:{},requests:{},ranges:{}});let M=C.glyphs[x];if(M!==void 0)return void E(null,{stack:_,id:x,glyph:M});if(M=this._tinySDF(C,_,x),M)return C.glyphs[x]=M,void E(null,{stack:_,id:x,glyph:M});const k=Math.floor(x/256);if(256*k>65535)return void E(new Error("glyphs > 65535 not supported"));if(C.ranges[k])return void E(null,{stack:_,id:x,glyph:M});let D=C.requests[k];D||(D=C.requests[k]=[],pe.loadGlyphRange(_,k,this.url,this.requestManager,(N,W)=>{if(W){for(const ie in W)this._doesCharSupportLocalGlyph(+ie)||(C.glyphs[+ie]=W[+ie]);C.ranges[k]=!0}for(const ie of D)ie(N,W);delete C.requests[k]})),D.push((N,W)=>{N?E(N):W&&E(null,{stack:_,id:x,glyph:W[x]||null})})},(_,x)=>{if(_)h(_);else if(x){const E={};for(const{stack:C,id:M,glyph:k}of x)(E[C]||(E[C]={}))[M]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};h(null,E)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](o)||l.unicodeBlockLookup["Hangul Syllables"](o)||l.unicodeBlockLookup.Hiragana(o)||l.unicodeBlockLookup.Katakana(o))}_tinySDF(o,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let x=o.tinySDF;if(!x){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),x=o.tinySDF=new pe.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:C})}const E=x.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}pe.loadGlyphRange=function(m,o,h,p,_){const x=256*o,E=x+255,C=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${x}-${E}`),l.ResourceType.Glyphs);l.getArrayBuffer(C,(M,k)=>{if(M)_(M);else if(k){const D={};for(const N of l.parseGlyphPbf(k))D[N.id]=N;_(null,D)}})},pe.TinySDF=class{constructor({fontSize:m=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const C=this.size=m+4*o,M=this._createCanvas(C),k=this.ctx=M.getContext("2d",{willReadFrequently:!0});k.font=`${E} ${x} ${m}px ${_}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(m){const o=document.createElement("canvas");return o.width=o.height=m,o}draw(m){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:x}=this.ctx.measureText(m),E=Math.ceil(h),C=Math.min(this.size-this.buffer,Math.ceil(x-_)),M=Math.min(this.size-this.buffer,E+Math.ceil(p)),k=C+2*this.buffer,D=M+2*this.buffer,N=Math.max(k*D,0),W=new Uint8ClampedArray(N),ie={data:W,width:k,height:D,glyphWidth:C,glyphHeight:M,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(C===0||M===0)return ie;const{ctx:te,buffer:ne,gridInner:fe,gridOuter:_e}=this;te.clearRect(ne,ne,C,M),te.fillText(m,ne,ne+E);const xe=te.getImageData(ne,ne,C,M);_e.fill(j,0,N),fe.fill(0,0,N);for(let re=0;re<M;re++)for(let Te=0;Te<C;Te++){const we=xe.data[4*(re*C+Te)+3]/255;if(we===0)continue;const Le=(re+ne)*k+Te+ne;if(we===1)_e[Le]=0,fe[Le]=j;else{const ke=.5-we;_e[Le]=ke>0?ke*ke:0,fe[Le]=ke<0?ke*ke:0}}q(_e,0,0,k,D,k,this.f,this.v,this.z),q(fe,ne,ne,C,M,k,this.f,this.v,this.z);for(let re=0;re<N;re++){const Te=Math.sqrt(_e[re])-Math.sqrt(fe[re]);W[re]=Math.round(255-255*(Te/this.radius+this.cutoff))}return ie}};const be=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,o){return l.sphericalToCartesian(m.expression.evaluate(o))}interpolate(m,o,h){return{x:l.number(m.x,o.x,h),y:l.number(m.y,o.y,h),z:l.number(m.z,o.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Re="-transition";class Fe extends l.Evented{constructor(o){super(),this._transitionable=new l.Transitionable(be),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(l.validateLight,o,h))for(const p in o){const _=o[p];p.endsWith(Re)?this._transitionable.setTransition(p.slice(0,-Re.length),_):this._transitionable.setValue(p,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,o.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Ve{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const _=[];let x=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,C=!0;_.push({left:x,right:E,isDash:C,zeroLength:o[0]===0});let M=o[0];for(let k=1;k<o.length;k++){C=!C;const D=o[k];x=M*p,M+=D,E=M*p,_.push({left:x,right:E,isDash:C,zeroLength:D===0})}return _}addRoundDash(o,h,p){const _=h/2;for(let x=-p;x<=p;x++){const E=this.width*(this.nextRow+p+x);let C=0,M=o[C];for(let k=0;k<this.width;k++){k/M.right>1&&(M=o[++C]);const D=Math.abs(k-M.left),N=Math.abs(k-M.right),W=Math.min(D,N);let ie;const te=x/p*(_+1);if(M.isDash){const ne=_-Math.abs(te);ie=Math.sqrt(W*W+ne*ne)}else ie=_-Math.sqrt(W*W+te*te);this.data[E+k]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(o){for(let C=o.length-1;C>=0;--C){const M=o[C],k=o[C+1];M.zeroLength?o.splice(C,1):k&&k.isDash===M.isDash&&(k.left=M.left,o.splice(C,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,E=o[x];for(let C=0;C<this.width;C++){C/E.right>1&&(E=o[++x]);const M=Math.abs(C-E.left),k=Math.abs(C-E.right),D=Math.min(M,k);this.data[_+C]=Math.max(0,Math.min(255,(E.isDash?D:-D)+128))}}addDash(o,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let x=0;for(let C=0;C<o.length;C++)x+=o[C];if(x!==0){const C=this.width/x,M=this.getDashRanges(o,this.width,C);h?this.addRoundDash(M,C,p):this.addRegularDash(M)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=_,this.dirty=!0,E}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class je{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new je.Actor(p[_],h,this.id);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h,p){l.asyncAll(this.actors,(_,x)=>{_.send(o,h,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pt(m,o,h){const p=function(_,x){if(_)return h(_);if(x){const E=l.pick(l.extend(x,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(C=>C.id)),h(null,E)}};return m.url?l.getJSON(o.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}je.Actor=l.Actor;class bt{constructor(o,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=p&&o.x<x&&o.y>=_&&o.y<E}}class St extends l.Evented{constructor(o,h,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pt(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new l.ErrorEvent(o)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new bt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(E,C){return delete o.request,o.aborted?h(null):E&&E.status!==404?h(E):(C&&C.resourceTiming&&(o.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&o.setExpiryData(C),o.loadVectorData(C,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",_,x.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",_,x.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class kt extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pt(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new l.ErrorEvent(o)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new bt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,x,E)=>{if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(_)o.state="errored",h(_);else if(x){this.map._refreshExpiredTiles&&o.setExpiryData(E);const C=this.map.painter.context,M=C.gl;o.texture=this.map.painter.getTileTexture(x.width),o.texture?o.texture.update(x,{useMipmap:!0}):(o.texture=new K(C,x,M.RGBA,{useMipmap:!0}),o.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax)),o.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let Gn;class xt extends kt{constructor(o,h,p,_){super(o,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,h){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(x,E){x&&(o.state="errored",h(x)),E&&(o.dem=E,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",h(null))}o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(x,E){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(x)o.state="errored",h(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData(E),delete E.cacheControl,delete E.expires;const C=l.isImageBitmap(E)&&(Gn==null&&(Gn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Gn)?E:l.exported.getImageData(E,1),M={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:C,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",M,_.bind(this)))}}).bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,x=h.x===0?o.wrap-1:o.wrap,E=(h.x+1+p)%p,C=h.x+1===p?o.wrap+1:o.wrap,M={};return M[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,C,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(M[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y-1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,C,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(M[new l.OverscaledTileID(o.overscaledZ,x,h.z,_,h.y+1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new l.OverscaledTileID(o.overscaledZ,C,h.z,E,h.y+1).key]={backfilled:!1}),M}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class xi extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*x,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*x,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this}getClusterChildren(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this}getClusterLeaves(o,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:p},_),this}_updateWorkerData(o){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:o}));let E=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E=x.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const C={dataType:"source",sourceDataType:o};this._collectResourceTiming&&E&&E.length>0&&l.extend(C,{resourceTiming:E}),this.fire(new l.Event("data",C))})}loaded(){return this._pendingLoads===0}loadTile(o,h){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,_,(x,E)=>(delete o.request,o.unloadVectorData(),o.aborted?h(null):x?h(x):(o.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tt=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Et extends l.Evented{constructor(o,h,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(o,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,o&&(this.coordinates=o),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const h=o.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let x=1/0,E=1/0,C=-1/0,M=-1/0;for(const W of _)x=Math.min(x,W.x),E=Math.min(E,W.y),C=Math.max(C,W.x),M=Math.max(M,W.y);const k=Math.max(C-x,M-E),D=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),N=Math.pow(2,D);return new l.CanonicalTileID(D,Math.floor((x+C)/2*N),Math.floor((E+M)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new K(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Pt extends Et{constructor(o,h,p,_){super(o,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new K(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nn extends Et{constructor(o,h,p,_){super(o,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new K(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const rn={vector:St,raster:kt,"raster-dem":xt,geojson:xi,video:Pt,image:Et,canvas:nn};function ir(m,o){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(o.toUnwrapped()))}function ii(m,o,h,p,_,x){const E=function(N,W,ie){if(N)for(const te of N){const ne=W[te];if(ne&&ne.source===ie&&ne.type==="fill-extrusion")return!0}else for(const te in W){const ne=W[te];if(ne.source===ie&&ne.type==="fill-extrusion")return!0}return!1}(_&&_.layers,o,m.id),C=x.maxPitchScaleFactor(),M=m.tilesIn(p,C,E);M.sort(bi);const k=[];for(const N of M)k.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,h,m._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,_,x,C,ir(m.transform,N.tileID))});const D=function(N){const W={},ie={};for(const te of N){const ne=te.queryResults,fe=te.wrappedTileID,_e=ie[fe]=ie[fe]||{};for(const xe in ne){const re=ne[xe],Te=_e[xe]=_e[xe]||{},we=W[xe]=W[xe]||[];for(const Le of re)Te[Le.featureIndex]||(Te[Le.featureIndex]=!0,we.push(Le))}}return W}(k);for(const N in D)D[N].forEach(W=>{const ie=W.feature,te=m.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=te});return D}function bi(m,o){const h=m.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class ri{constructor(o,h){this.tileID=o,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(h=>o.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,x){const E={};if(!x)return E;for(const C of _){const M=C.layerIds.map(k=>x.getLayer(k)).filter(Boolean);if(M.length!==0){C.layers=M,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(k=>M.filter(D=>D.id===k)[0]));for(const k of M)E[k.id]=C}}return E}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(x))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new K(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new K(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,_,x,E,C,M,k,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:D,transform:M,params:C,queryPadding:this.queryPadding*k},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=h?h.sourceLayer:"",E=_._geojsonTileLayer||_[x];if(!E)return;const C=l.createFilter(h&&h.filter),{z:M,x:k,y:D}=this.tileID.canonical,N={z:M,x:k,y:D};for(let W=0;W<E.length;W++){const ie=E.feature(W);if(C.needGeometry){const fe=l.toEvaluationFeature(ie,!0);if(!C.filter(new l.EvaluationParameters(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!C.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ie))continue;const te=p.getId(ie,x),ne=new l.GeoJSONFeature(ie,M,k,D,te);ne.tile=N,o.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=l.parseCacheControl(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const x=this.expirationTime-h;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const x=this.buckets[_],E=x.layers[0].sourceLayer||"_geojsonTileLayer",C=p[E],M=o[E];if(!C||!M||Object.keys(M).length===0)continue;x.update(M,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=h&&h.style&&h.style.getLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=l.exported.now()+o}setDependencies(o,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const _=this.dependencies[p];if(_){for(const x of h)if(_[x])return!0}}return!1}}class un{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:h,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(o,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const _ of this.data[p])o(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class wi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const _=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},l.extend(this.stateChanges[o][_],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const x in this.state[o])x!==_&&(this.deletedStates[o][x]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(const x in this.state[o][_])p[x]||(this.deletedStates[o][_][x]=null)}else for(const x in p)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][x]===null&&delete this.deletedStates[o][_][x]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const _=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(p in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][p]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),_=l.extend({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const x=this.deletedStates[o][h];if(x===null)return{};for(const E in x)delete _[E]}return _}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),l.extend(this.state[_][E],this.stateChanges[_][E]),x[E]=this.state[_][E];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const E in this.state[_])x[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const C of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][C];x[E]=this.state[_][E]}p[_]=p[_]||{},l.extend(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in o)o[_].setFeatureState(p,h)}}class qt extends l.Evented{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,x,E,C){const M=new rn[x.type](_,x,E,C);if(M.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${M.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],M),M}(o,h,p,this),this._tiles={},this._cache=new un(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new wi}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h){return this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new l.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Dn).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,_)=>{const x=p.tileID,E=_.tileID,C=new l.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new l.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||M.y-C.y||M.x-C.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(Dn).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,o,h)))}_tileLoaded(o,h,p,_){if(_)return o.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=l.exported.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const x=h[_];if(o.neighboringTiles&&o.neighboringTiles[x]){const E=this.getTileByID(x);p(o,E),p(E,o)}}function p(_,x){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let E=x.tileID.canonical.x-_.tileID.canonical.x;const C=x.tileID.canonical.y-_.tileID.canonical.y,M=Math.pow(2,_.tileID.canonical.z),k=x.tileID.key;E===0&&C===0||Math.abs(C)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,E,C),_.neighboringTiles&&_.neighboringTiles[k]&&(_.neighboringTiles[k].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,_){for(const x in this._tiles){let E=this._tiles[x];if(_[x]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let C=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const k=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[k.key],E&&E.hasData()&&(C=k)}let M=C;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){_[C.key]=C;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const _=o.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,_=Math.floor(h*p*5),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+h),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(o,h){if(this.transform=o,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(k=>this._source.hasTile(k)))):p=[];const _=o.coveringZoomLevel(this._source),x=Math.max(_-qt.maxOverzooming,this._source.minzoom),E=Math.max(_+qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const D of p)if(D.canonical.z>this._source.minzoom){const N=D.scaledTo(D.canonical.z-1);k[N.key]=N;const W=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));k[W.key]=W}p=p.concat(Object.values(k))}const C=this._updateRetainedTiles(p,_);if(is(this._source.type)){const k={},D={},N=Object.keys(C);for(const W of N){const ie=C[W],te=this._tiles[W];if(!te||te.fadeEndTime&&te.fadeEndTime<=l.exported.now())continue;const ne=this.findLoadedParent(ie,x);ne&&(this._addTile(ne.tileID),k[ne.tileID.key]=ne.tileID),D[W]=ie}this._retainLoadedChildren(D,_,E,C);for(const W in k)C[W]||(this._coveredTiles[W]=!0,C[W]=k[W]);if(h){const W={},ie={};for(const te of p)this._tiles[te.key].hasData()?W[te.key]=te:ie[te.key]=te;for(const te in ie){const ne=ie[te].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(W[ne[0].key]=C[ne[0].key]=ne[0],W[ne[1].key]=C[ne[1].key]=ne[1],W[ne[2].key]=C[ne[2].key]=ne[2],W[ne[3].key]=C[ne[3].key]=ne[3],delete ie[te])}for(const te in ie){const ne=this.findLoadedParent(ie[te],this._source.minzoom);if(ne){W[ne.tileID.key]=C[ne.tileID.key]=ne.tileID;for(const fe in W)W[fe].isChildOf(ne.tileID)&&delete W[fe]}}for(const te in this._tiles)W[te]||(this._coveredTiles[te]=!0)}}for(const k in C)this._tiles[k].clearFadeHold();const M=l.keysDifference(this._tiles,C);for(const k of M){const D=this._tiles[k];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},_={},x=Math.max(h-qt.maxOverzooming,this._source.minzoom),E=Math.max(h+qt.maxUnderzooming,this._source.minzoom),C={};for(const M of o){const k=this._addTile(M);p[M.key]=M,k.hasData()||h<this._source.maxzoom&&(C[M.key]=M)}this._retainLoadedChildren(C,h,E,p);for(const M of o){let k=this._tiles[M.key];if(k.hasData())continue;if(h+1>this._source.maxzoom){const N=M.children(this._source.maxzoom)[0],W=this.getTile(N);if(W&&W.hasData()){p[N.key]=N;continue}}else{const N=M.children(this._source.maxzoom);if(p[N[0].key]&&p[N[1].key]&&p[N[2].key]&&p[N[3].key])continue}let D=k.wasRequested();for(let N=M.overscaledZ-1;N>=x;--N){const W=M.scaledTo(N);if(_[W.key]||(_[W.key]=!0,k=this.getTile(W),!k&&D&&(k=this._addTile(W)),k&&(p[W.key]=W,D=k.wasRequested(),k.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of h)this._loadedParentTiles[x]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new ri(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const _=[],x=this.transform;if(!x)return _;const E=p?x.getCameraQueryGeometry(o):o,C=o.map(te=>x.pointCoordinate(te,this.terrain)),M=E.map(te=>x.pointCoordinate(te,this.terrain)),k=this.getIds();let D=1/0,N=1/0,W=-1/0,ie=-1/0;for(const te of M)D=Math.min(D,te.x),N=Math.min(N,te.y),W=Math.max(W,te.x),ie=Math.max(ie,te.y);for(let te=0;te<k.length;te++){const ne=this._tiles[k[te]];if(ne.holdingForFade())continue;const fe=ne.tileID,_e=Math.pow(2,x.zoom-ne.tileID.overscaledZ),xe=h*ne.queryPadding*l.EXTENT/ne.tileSize/_e,re=[fe.getTilePoint(new l.MercatorCoordinate(D,N)),fe.getTilePoint(new l.MercatorCoordinate(W,ie))];if(re[0].x-xe<l.EXTENT&&re[0].y-xe<l.EXTENT&&re[1].x+xe>=0&&re[1].y+xe>=0){const Te=C.map(Le=>fe.getTilePoint(Le)),we=M.map(Le=>fe.getTilePoint(Le));_.push({tile:ne,tileID:fe,queryGeometry:Te,cameraQueryGeometry:we,scale:_e})}}return _}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(is(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const _=this._tiles[o];_&&_.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function Dn(m,o){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||p-h||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function is(m){return m==="raster"||m==="image"||m==="video"}qt.maxOverzooming=10,qt.maxUnderzooming=3;const Li="mapboxgl_preloaded_worker_pool";class Yn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Yn.workerCount;)this.workers.push(new Worker(wo.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Li]}numActive(){return Object.keys(this.active).length}}const Lr=Math.floor(l.exported.hardwareConcurrency/2);let ji;function di(){return ji||(ji=new Yn),ji}function Gi(m,o){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in o&&(h[p]=o[p])}),h}function Vs(m){m=m.slice();const o=Object.create(null);for(let h=0;h<m.length;h++)o[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Gi(m[h],o[m[h].ref]));return m}Yn.workerCount=Math.max(Math.min(Lr,6),1);const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ki(m,o,h){h.push({command:Gt.addSource,args:[m,o[m]]})}function On(m,o,h){o.push({command:Gt.removeSource,args:[m]}),h[m]=!0}function rs(m,o,h,p){On(m,h,p),ki(m,o,h)}function go(m,o,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!I(m[h][p],o[h][p]))return!1;for(p in o[h])if(Object.prototype.hasOwnProperty.call(o[h],p)&&p!=="data"&&!I(m[h][p],o[h][p]))return!1;return!0}function kr(m,o,h,p,_,x){let E;for(E in o=o||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(I(m[E],o[E])||h.push({command:x,args:[p,E,o[E],_]}));for(E in o)Object.prototype.hasOwnProperty.call(o,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(I(m[E],o[E])||h.push({command:x,args:[p,E,o[E],_]}))}function Rr(m){return m.id}function js(m,o){return m[o.id]=o,m}class vr{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.clamp(o,0,1);let h=1,p=this._distances[h];const _=o*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const x=h-1,E=this._distances[x],C=p-E,M=C>0?(_-E)/C:0;return this.points[x].mult(1-M).add(this.points[h].mult(M))}}function Me(m,o){let h=!0;return m==="always"||m!=="never"&&o!=="never"||(h=!1),h}class $e{constructor(o,h,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,_,x){this._forEachCell(h,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(o,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,h,p,_,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,h,p,_,x,E){this.circleCells[x].push(E)}_query(o,h,p,_,x,E,C){if(p<0||o>this.width||_<0||h>this.height)return[];const M=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=_){if(x)return[{key:null,x1:o,y1:h,x2:p,y2:_}];for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const D=this.circles[3*k],N=this.circles[3*k+1],W=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:D-W,y1:N-W,x2:D+W,y2:N+W})}}else this._forEachCell(o,h,p,_,this._queryCell,M,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},C);return M}query(o,h,p,_){return this._query(o,h,p,_,!1,null)}hitTest(o,h,p,_,x,E){return this._query(o,h,p,_,!0,x,E).length>0}hitTestCircle(o,h,p,_,x){const E=o-p,C=o+p,M=h-p,k=h+p;if(C<0||E>this.width||k<0||M>this.height)return!1;const D=[];return this._forEachCell(E,M,C,k,this._queryCellCircle,D,{hitTest:!0,overlapMode:_,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},x),D.length>0}_queryCell(o,h,p,_,x,E,C,M){const{seenUids:k,hitTest:D,overlapMode:N}=C,W=this.boxCells[x];if(W!==null){const te=this.bboxes;for(const ne of W)if(!k.box[ne]){k.box[ne]=!0;const fe=4*ne,_e=this.boxKeys[ne];if(o<=te[fe+2]&&h<=te[fe+3]&&p>=te[fe+0]&&_>=te[fe+1]&&(!M||M(_e))&&(!D||!Me(N,_e.overlapMode))&&(E.push({key:_e,x1:te[fe],y1:te[fe+1],x2:te[fe+2],y2:te[fe+3]}),D))return!0}}const ie=this.circleCells[x];if(ie!==null){const te=this.circles;for(const ne of ie)if(!k.circle[ne]){k.circle[ne]=!0;const fe=3*ne,_e=this.circleKeys[ne];if(this._circleAndRectCollide(te[fe],te[fe+1],te[fe+2],o,h,p,_)&&(!M||M(_e))&&(!D||!Me(N,_e.overlapMode))){const xe=te[fe],re=te[fe+1],Te=te[fe+2];if(E.push({key:_e,x1:xe-Te,y1:re-Te,x2:xe+Te,y2:re+Te}),D)return!0}}}return!1}_queryCellCircle(o,h,p,_,x,E,C,M){const{circle:k,seenUids:D,overlapMode:N}=C,W=this.boxCells[x];if(W!==null){const te=this.bboxes;for(const ne of W)if(!D.box[ne]){D.box[ne]=!0;const fe=4*ne,_e=this.boxKeys[ne];if(this._circleAndRectCollide(k.x,k.y,k.radius,te[fe+0],te[fe+1],te[fe+2],te[fe+3])&&(!M||M(_e))&&!Me(N,_e.overlapMode))return E.push(!0),!0}}const ie=this.circleCells[x];if(ie!==null){const te=this.circles;for(const ne of ie)if(!D.circle[ne]){D.circle[ne]=!0;const fe=3*ne,_e=this.circleKeys[ne];if(this._circlesCollide(te[fe],te[fe+1],te[fe+2],k.x,k.y,k.radius)&&(!M||M(_e))&&!Me(N,_e.overlapMode))return E.push(!0),!0}}}_forEachCell(o,h,p,_,x,E,C,M){const k=this._convertToXCellCoord(o),D=this._convertToYCellCoord(h),N=this._convertToXCellCoord(p),W=this._convertToYCellCoord(_);for(let ie=k;ie<=N;ie++)for(let te=D;te<=W;te++)if(x.call(this,o,h,p,_,this.xCellCount*te+ie,E,C,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,_,x,E){const C=_-o,M=x-h,k=p+E;return k*k>C*C+M*M}_circleAndRectCollide(o,h,p,_,x,E,C){const M=(E-_)/2,k=Math.abs(o-(_+M));if(k>M+p)return!1;const D=(C-x)/2,N=Math.abs(h-(x+D));if(N>D+p)return!1;if(k<=M||N<=D)return!0;const W=k-M,ie=N-D;return W*W+ie*ie<=p*p}}function ss(m,o,h,p,_){const x=l.create();return o?(l.scale(x,x,[1/_,1/_,1]),h||l.rotateZ(x,x,p.angle)):l.multiply(x,p.labelPlaneMatrix,m),x}function Ei(m,o,h,p,_){if(o){const x=l.clone(m);return l.scale(x,x,[_,_,1]),h||l.rotateZ(x,x,-p.angle),x}return p.glCoordMatrix}function Ut(m,o,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,o)):(p=[m.x,m.y,0,1],rr(p,p,o));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Wi(m,o){return .5+m/o*.5}function Ri(m,o){const h=m[0]/m[3],p=m[1]/m[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function zi(m,o,h,p,_,x,E,C,M,k){const D=p?m.textSizeData:m.iconSizeData,N=l.evaluateSizeForZoom(D,h.transform.zoom),W=[256/h.width*2+1,256/h.height*2+1],ie=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ie.clear();const te=m.lineVertexArray,ne=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let _e=!1;for(let xe=0;xe<ne.length;xe++){const re=ne.get(xe);if(re.hidden||re.writingMode===l.WritingMode.vertical&&!_e){Ct(re.numGlyphs,ie);continue}let Te;if(_e=!1,k?(Te=[re.anchorX,re.anchorY,k(re.anchorX,re.anchorY),1],l.transformMat4(Te,Te,o)):(Te=[re.anchorX,re.anchorY,0,1],rr(Te,Te,o)),!Ri(Te,W)){Ct(re.numGlyphs,ie);continue}const we=Wi(h.transform.cameraToCenterDistance,Te[3]),Le=l.evaluateSizeForFeature(D,N,re),ke=E?Le/we:Le*we,Be=new l.pointGeometry(re.anchorX,re.anchorY),Ie=Ut(Be,_,k).point,et={},qe=Mt(re,ke,!1,C,o,_,x,m.glyphOffsetArray,te,ie,Ie,Be,et,fe,M,k);_e=qe.useVertical,(qe.notEnoughRoom||_e||qe.needsFlipping&&Mt(re,ke,!0,C,o,_,x,m.glyphOffsetArray,te,ie,Ie,Be,et,fe,M,k).notEnoughRoom)&&Ct(re.numGlyphs,ie)}p?m.text.dynamicLayoutVertexBuffer.updateData(ie):m.icon.dynamicLayoutVertexBuffer.updateData(ie)}function os(m,o,h,p,_,x,E,C,M,k,D,N,W){const ie=C.glyphStartIndex+C.numGlyphs,te=C.lineStartIndex,ne=C.lineStartIndex+C.lineLength,fe=o.getoffsetX(C.glyphStartIndex),_e=o.getoffsetX(ie-1),xe=Kn(m*fe,h,p,_,x,E,C.segment,te,ne,M,k,D,N,W);if(!xe)return null;const re=Kn(m*_e,h,p,_,x,E,C.segment,te,ne,M,k,D,N,W);return re?{first:xe,last:re}:null}function He(m,o,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Mt(m,o,h,p,_,x,E,C,M,k,D,N,W,ie,te,ne){const fe=o/24,_e=m.lineOffsetX*fe,xe=m.lineOffsetY*fe;let re;if(m.numGlyphs>1){const Te=m.glyphStartIndex+m.numGlyphs,we=m.lineStartIndex,Le=m.lineStartIndex+m.lineLength,ke=os(fe,C,_e,xe,h,D,N,m,M,x,W,te,ne);if(!ke)return{notEnoughRoom:!0};const Be=Ut(ke.first.point,E,ne).point,Ie=Ut(ke.last.point,E,ne).point;if(p&&!h){const et=He(m.writingMode,Be,Ie,ie);if(et)return et}re=[ke.first];for(let et=m.glyphStartIndex+1;et<Te-1;et++)re.push(Kn(fe*C.getoffsetX(et),_e,xe,h,D,N,m.segment,we,Le,M,x,W,te,ne));re.push(ke.last)}else{if(p&&!h){const we=Ut(N,_,ne).point,Le=m.lineStartIndex+m.segment+1,ke=new l.pointGeometry(M.getx(Le),M.gety(Le)),Be=Ut(ke,_,ne),Ie=Be.signedDistanceFromCamera>0?Be.point:It(N,ke,we,1,_,ne),et=He(m.writingMode,we,Ie,ie);if(et)return et}const Te=Kn(fe*C.getoffsetX(m.glyphStartIndex),_e,xe,h,D,N,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,M,x,W,te,ne);if(!Te)return{notEnoughRoom:!0};re=[Te]}for(const Te of re)l.addDynamicAttributes(k,Te.point,Te.angle);return{}}function It(m,o,h,p,_,x){const E=Ut(m.add(m.sub(o)._unit()),_,x).point,C=h.sub(E);return h.add(C._mult(p/C.mag()))}function Kn(m,o,h,p,_,x,E,C,M,k,D,N,W,ie){const te=p?m-o:m+o;let ne=te>0?1:-1,fe=0;p&&(ne*=-1,fe=Math.PI),ne<0&&(fe+=Math.PI);let _e=ne>0?C+E:C+E+1,xe=_,re=_,Te=0,we=0;const Le=Math.abs(te),ke=[];for(;Te+we<=Le;){if(_e+=ne,_e<C||_e>=M)return null;if(re=xe,ke.push(xe),xe=N[_e],xe===void 0){const nt=new l.pointGeometry(k.getx(_e),k.gety(_e)),Lt=Ut(nt,D,ie);if(Lt.signedDistanceFromCamera>0)xe=N[_e]=Lt.point;else{const Dt=_e-ne;xe=It(Te===0?x:new l.pointGeometry(k.getx(Dt),k.gety(Dt)),nt,re,Le-Te+1,D,ie)}}Te+=we,we=re.dist(xe)}const Be=(Le-Te)/we,Ie=xe.sub(re),et=Ie.mult(Be)._add(re);et._add(Ie._unit()._perp()._mult(h*ne));const qe=fe+Math.atan2(xe.y-re.y,xe.x-re.x);return ke.push(et),{point:et,angle:W?qe:0,path:ke}}const zr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(m,o){for(let h=0;h<m;h++){const p=o.length;o.resize(p+4),o.float32.set(zr,3*p)}}function rr(m,o,h){const p=o[0],_=o[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const Wn=100;class Gs{constructor(o,h=new $e(o.width+200,o.height+200,25),p=new $e(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Wn,this.screenBottomBoundary=o.height+Wn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,_,x,E){const C=this.projectAndGetPerspectiveRatio(_,o.anchorPointX,o.anchorPointY,E),M=p*C.perspectiveRatio,k=o.x1*M+C.point.x,D=o.y1*M+C.point.y,N=o.x2*M+C.point.x,W=o.y2*M+C.point.y;return!this.isInsideGrid(k,D,N,W)||h!=="always"&&this.grid.hitTest(k,D,N,W,h,x)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,D,N,W],offscreen:this.isOffscreen(k,D,N,W)}}placeCollisionCircles(o,h,p,_,x,E,C,M,k,D,N,W,ie,te){const ne=[],fe=new l.pointGeometry(h.anchorX,h.anchorY),_e=Ut(fe,E,te),xe=Wi(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),re=(D?x/xe:x*xe)/l.ONE_EM,Te=Ut(fe,C,te).point,we=os(re,_,h.lineOffsetX*re,h.lineOffsetY*re,!1,Te,fe,h,p,C,{},!1,te);let Le=!1,ke=!1,Be=!0;if(we){const Ie=.5*W*xe+ie,et=new l.pointGeometry(-100,-100),qe=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),nt=new vr,Lt=we.first,Dt=we.last;let _t=[];for(let Ht=Lt.path.length-1;Ht>=1;Ht--)_t.push(Lt.path[Ht]);for(let Ht=1;Ht<Dt.path.length;Ht++)_t.push(Dt.path[Ht]);const sn=2.5*Ie;if(M){const Ht=_t.map($t=>Ut($t,M,te));_t=Ht.some($t=>$t.signedDistanceFromCamera<=0)?[]:Ht.map($t=>$t.point)}let on=[];if(_t.length>0){const Ht=_t[0].clone(),$t=_t[0].clone();for(let ln=1;ln<_t.length;ln++)Ht.x=Math.min(Ht.x,_t[ln].x),Ht.y=Math.min(Ht.y,_t[ln].y),$t.x=Math.max($t.x,_t[ln].x),$t.y=Math.max($t.y,_t[ln].y);on=Ht.x>=et.x&&$t.x<=qe.x&&Ht.y>=et.y&&$t.y<=qe.y?[_t]:$t.x<et.x||Ht.x>qe.x||$t.y<et.y||Ht.y>qe.y?[]:l.clipLine([_t],et.x,et.y,qe.x,qe.y)}for(const Ht of on){nt.reset(Ht,.25*Ie);let $t=0;$t=nt.length<=.5*Ie?1:Math.ceil(nt.paddedLength/sn)+1;for(let ln=0;ln<$t;ln++){const oi=ln/Math.max($t-1,1),us=nt.lerp(oi),Br=us.x+Wn,hs=us.y+Wn;ne.push(Br,hs,Ie,0);const Qs=Br-Ie,Er=hs-Ie,$i=Br+Ie,As=hs+Ie;if(Be=Be&&this.isOffscreen(Qs,Er,$i,As),ke=ke||this.isInsideGrid(Qs,Er,$i,As),o!=="always"&&this.grid.hitTestCircle(Br,hs,Ie,o,N)&&(Le=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!k&&Le||!ke||xe<this.perspectiveRatioCutoff?[]:ne,offscreen:Be,collisionDetected:Le}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,x=-1/0,E=-1/0;for(const D of o){const N=new l.pointGeometry(D.x+Wn,D.y+Wn);p=Math.min(p,N.x),_=Math.min(_,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y),h.push(N)}const C=this.grid.query(p,_,x,E).concat(this.ignoredGrid.query(p,_,x,E)),M={},k={};for(const D of C){const N=D.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;const W=[new l.pointGeometry(D.x1,D.y1),new l.pointGeometry(D.x2,D.y1),new l.pointGeometry(D.x2,D.y2),new l.pointGeometry(D.x1,D.y2)];l.polygonIntersectsPolygon(h,W)&&(M[N.bucketInstanceId][N.featureIndex]=!0,k[N.bucketInstanceId]===void 0&&(k[N.bucketInstanceId]=[]),k[N.bucketInstanceId].push(N.featureIndex))}return k}insertCollisionBox(o,h,p,_,x,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,_,x,E){const C=p?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h};for(let k=0;k<o.length;k+=4)C.insertCircle(M,o[k],o[k+1],o[k+2])}projectAndGetPerspectiveRatio(o,h,p,_){let x;return _?(x=[h,p,_(h,p),1],l.transformMat4(x,x,o)):(x=[h,p,0,1],rr(x,x,o)),{point:new l.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+Wn,(-x[1]/x[3]+1)/2*this.transform.height+Wn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(o,h,p,_){return p<Wn||o>=this.screenRightBoundary||_<Wn||h>this.screenBottomBoundary}isInsideGrid(o,h,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=l.identity([]);return l.translate(o,o,[-100,-100,0]),o}}function Ln(m,o,h){return o*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class si{constructor(o,h,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class en{constructor(o,h,p,_,x){this.text=new si(o?o.text:null,h,p,x),this.icon=new si(o?o.icon:null,h,_,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ws{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class xr{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class br{constructor(o,h,p,_,x){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class ws{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function Hs(m,o,h,p,_){const{horizontalAlign:x,verticalAlign:E}=l.getAnchorAlignment(m),C=-(x-.5)*o,M=-(E-.5)*h,k=l.evaluateVariableOffset(m,p);return new l.pointGeometry(C+k[0]*_,M+k[1]*_)}function as(m,o,h,p,_,x){const{x1:E,x2:C,y1:M,y2:k,anchorPointX:D,anchorPointY:N}=m,W=new l.pointGeometry(o,h);return p&&W._rotate(_?x:-x),{x1:E+W.x,y1:M+W.y,x2:C+W.x,y2:k+W.y,anchorPointX:D,anchorPointY:N}}class ee{constructor(o,h,p,_,x){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new Gs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new ws(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,_){const x=p.getBucket(h),E=p.latestFeatureIndex;if(!x||!E||h.id!==x.layerIds[0])return;const C=p.collisionBoxArray,M=x.layers[0].layout,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/l.EXTENT,N=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),W=M.get("text-pitch-alignment")==="map",ie=M.get("text-rotation-alignment")==="map",te=Ln(p,1,this.transform.zoom),ne=ss(N,W,ie,this.transform,te);let fe=null;if(W){const xe=Ei(N,W,ie,this.transform,te);fe=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[x.bucketInstanceId]=new br(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,p.tileID);const _e={bucket:x,layout:M,posMatrix:N,textLabelPlaneMatrix:ne,labelToScreenMatrix:fe,scale:k,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const xe of x.sortKeyRanges){const{sortKey:re,symbolInstanceStart:Te,symbolInstanceEnd:we}=xe;o.push({sortKey:re,symbolInstanceStart:Te,symbolInstanceEnd:we,parameters:_e})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(o,h,p,_,x,E,C,M,k,D,N,W,ie,te,ne,fe){const _e=[W.textOffset0,W.textOffset1],xe=Hs(o,p,_,_e,x),re=this.collisionIndex.placeCollisionBox(as(h,xe.x,xe.y,E,C,this.transform.angle),N,M,k,D.predicate,fe);if((!ne||this.collisionIndex.placeCollisionBox(as(ne,xe.x,xe.y,E,C,this.transform.angle),N,M,k,D.predicate,fe).box.length!==0)&&re.box.length>0){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:_e,width:p,height:_,anchor:o,textBoxScale:x,prevAnchor:Te},this.markUsedJustification(ie,o,W,te),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,te,W),this.placedOrientations[W.crossTileID]=te),{shift:xe,placedGlyphBoxes:re}}}placeLayerBucketPart(o,h,p){const{bucket:_,layout:x,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:M,textPixelRatio:k,holdingForFade:D,collisionBoxArray:N,partiallyEvaluatedTextSize:W,collisionGroup:ie}=o.parameters,te=x.get("text-optional"),ne=x.get("icon-optional"),fe=l.getOverlapMode(x,"text-overlap","text-allow-overlap"),_e=fe==="always",xe=l.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),re=xe==="always",Te=x.get("text-rotation-alignment")==="map",we=x.get("text-pitch-alignment")==="map",Le=x.get("icon-text-fit")!=="none",ke=x.get("symbol-z-order")==="viewport-y",Be=_e&&(re||!_.hasIconData()||ne),Ie=re&&(_e||!_.hasTextData()||te);!_.collisionArrays&&N&&_.deserializeCollisionBoxes(N);const et=(qe,nt)=>{if(h[qe.crossTileID])return;if(D)return void(this.placements[qe.crossTileID]=new Ws(!1,!1,!1));let Lt=!1,Dt=!1,_t=!0,sn=null,on={box:null,offscreen:null},Ht={box:null,offscreen:null},$t=null,ln=null,oi=null,us=0,Br=0,hs=0;nt.textFeatureIndex?us=nt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(us=qe.featureIndex),nt.verticalTextFeatureIndex&&(Br=nt.verticalTextFeatureIndex);const Qs=this.retainedQueryData[_.bucketInstanceId].tileID,Er=this.terrain?(Qn,Nt)=>this.terrain.getElevation(Qs,Qn,Nt):null;for(const Qn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Nt=nt[Qn];Nt&&(Nt.elevation=Er?Er(Nt.anchorPointX,Nt.anchorPointY):0)}const $i=nt.textBox;if($i){const Qn=tn=>{let ai=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!tn&&this.prevPlacement){const li=this.prevPlacement.placedOrientations[qe.crossTileID];li&&(this.placedOrientations[qe.crossTileID]=li,ai=li,this.markUsedOrientation(_,ai,qe))}return ai},Nt=(tn,ai)=>{if(_.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&nt.verticalTextBox){for(const li of _.writingModes)if(li===l.WritingMode.vertical?(on=ai(),Ht=on):on=tn(),on&&on.box&&on.box.length)break}else on=tn()};if(x.get("text-variable-anchor")){let tn=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe.crossTileID]){const bn=this.prevPlacement.variableOffsets[qe.crossTileID];tn.indexOf(bn.anchor)>0&&(tn=tn.filter(Tr=>Tr!==bn.anchor),tn.unshift(bn.anchor))}const ai=(bn,Tr,Eo)=>{const Yu=bn.x2-bn.x1,ha=bn.y2-bn.y1,bf=qe.textBoxScale,Ku=Le&&xe==="never"?Tr:null;let eo={box:[],offscreen:!1};const To=fe!=="never"?2*tn.length:tn.length;for(let So=0;So<To;++So){const fc=this.attemptAnchorPlacement(tn[So%tn.length],bn,Yu,ha,bf,Te,we,k,E,ie,So>=tn.length?fe:"never",qe,_,Eo,Ku,Er);if(fc&&(eo=fc.placedGlyphBoxes,eo&&eo.box&&eo.box.length)){Lt=!0,sn=fc.shift;break}}return eo};Nt(()=>ai($i,nt.iconBox,l.WritingMode.horizontal),()=>{const bn=nt.verticalTextBox;return _.allowVerticalPlacement&&!(on&&on.box&&on.box.length)&&qe.numVerticalGlyphVertices>0&&bn?ai(bn,nt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),on&&(Lt=on.box,_t=on.offscreen);const li=Qn(on&&on.box);if(!Lt&&this.prevPlacement){const bn=this.prevPlacement.variableOffsets[qe.crossTileID];bn&&(this.variableOffsets[qe.crossTileID]=bn,this.markUsedJustification(_,bn.anchor,qe,li))}}else{const tn=(ai,li)=>{const bn=this.collisionIndex.placeCollisionBox(ai,fe,k,E,ie.predicate,Er);return bn&&bn.box&&bn.box.length&&(this.markUsedOrientation(_,li,qe),this.placedOrientations[qe.crossTileID]=li),bn};Nt(()=>tn($i,l.WritingMode.horizontal),()=>{const ai=nt.verticalTextBox;return _.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&ai?tn(ai,l.WritingMode.vertical):{box:null,offscreen:null}}),Qn(on&&on.box&&on.box.length)}}if($t=on,Lt=$t&&$t.box&&$t.box.length>0,_t=$t&&$t.offscreen,qe.useRuntimeCollisionCircles){const Qn=_.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Nt=l.evaluateSizeForFeature(_.textSizeData,W,Qn),tn=x.get("text-padding");ln=this.collisionIndex.placeCollisionCircles(fe,Qn,_.lineVertexArray,_.glyphOffsetArray,Nt,E,C,M,p,we,ie.predicate,qe.collisionCircleDiameter,tn,Er),ln.circles.length&&ln.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Lt=_e||ln.circles.length>0&&!ln.collisionDetected,_t=_t&&ln.offscreen}if(nt.iconFeatureIndex&&(hs=nt.iconFeatureIndex),nt.iconBox){const Qn=Nt=>{const tn=Le&&sn?as(Nt,sn.x,sn.y,Te,we,this.transform.angle):Nt;return this.collisionIndex.placeCollisionBox(tn,xe,k,E,ie.predicate,Er)};Ht&&Ht.box&&Ht.box.length&&nt.verticalIconBox?(oi=Qn(nt.verticalIconBox),Dt=oi.box.length>0):(oi=Qn(nt.iconBox),Dt=oi.box.length>0),_t=_t&&oi.offscreen}const As=te||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,dc=ne||qe.numIconVertices===0;if(As||dc?dc?As||(Dt=Dt&&Lt):Lt=Dt&&Lt:Dt=Lt=Dt&&Lt,Lt&&$t&&$t.box&&this.collisionIndex.insertCollisionBox($t.box,fe,x.get("text-ignore-placement"),_.bucketInstanceId,Ht&&Ht.box&&Br?Br:us,ie.ID),Dt&&oi&&this.collisionIndex.insertCollisionBox(oi.box,xe,x.get("icon-ignore-placement"),_.bucketInstanceId,hs,ie.ID),ln&&(Lt&&this.collisionIndex.insertCollisionCircles(ln.circles,fe,x.get("text-ignore-placement"),_.bucketInstanceId,us,ie.ID),p)){const Qn=_.bucketInstanceId;let Nt=this.collisionCircleArrays[Qn];Nt===void 0&&(Nt=this.collisionCircleArrays[Qn]=new xr);for(let tn=0;tn<ln.circles.length;tn+=4)Nt.circles.push(ln.circles[tn+0]),Nt.circles.push(ln.circles[tn+1]),Nt.circles.push(ln.circles[tn+2]),Nt.circles.push(ln.collisionDetected?1:0)}if(qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new Ws(Lt||Be,Dt||Ie,_t||_.justReloaded),h[qe.crossTileID]=!0};if(ke){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=_.getSortedSymbolIndexes(this.transform.angle);for(let nt=qe.length-1;nt>=0;--nt){const Lt=qe[nt];et(_.symbolInstances.get(Lt),_.collisionArrays[Lt])}}else for(let qe=o.symbolInstanceStart;qe<o.symbolInstanceEnd;qe++)et(_.symbolInstances.get(qe),_.collisionArrays[qe]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[_.bucketInstanceId];l.invert(qe.invProjMatrix,E),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(o,h,p,_){let x;x=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:p.crossTileID)}markUsedOrientation(o,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,x=h===l.WritingMode.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of E)o.text.placedSymbolArray.get(C).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(o):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const M in this.placements){const k=this.placements[M],D=x[M];D?(this.opacities[M]=new en(D,_,k.text,k.icon),p=p||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[M]=new en(null,_,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const M in x){const k=x[M];if(!this.opacities[M]){const D=new en(k,_,!1,!1);D.isHidden()||(this.opacities[M]=D,p=p||k.text.placed||k.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const _ of h){const x=_.getBucket(o);x&&_.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,x=new en(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),M=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",D=_.get("text-pitch-alignment")==="map",N=_.get("icon-text-fit")!=="none",W=new en(null,0,E&&(C||!o.hasIconData()||_.get("icon-optional")),C&&(E||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const ie=(te,ne,fe)=>{for(let _e=0;_e<ne/4;_e++)te.opacityVertexArray.emplaceBack(fe)};for(let te=0;te<o.symbolInstances.length;te++){const ne=o.symbolInstances.get(te),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:_e,crossTileID:xe}=ne;let re=this.opacities[xe];h[xe]?re=x:re||(re=W,this.opacities[xe]=re),h[xe]=!0;const Te=ne.numIconVertices>0,we=this.placedOrientations[ne.crossTileID],Le=we===l.WritingMode.vertical,ke=we===l.WritingMode.horizontal||we===l.WritingMode.horizontalOnly;if(fe>0||_e>0){const Be=ge(re.text);ie(o.text,fe,Le?Ce:Be),ie(o.text,_e,ke?Ce:Be);const Ie=re.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(nt=>{nt>=0&&(o.text.placedSymbolArray.get(nt).hidden=Ie||Le?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Ie||ke?1:0);const et=this.variableOffsets[ne.crossTileID];et&&this.markUsedJustification(o,et.anchor,ne,we);const qe=this.placedOrientations[ne.crossTileID];qe&&(this.markUsedJustification(o,"left",ne,qe),this.markUsedOrientation(o,qe,ne))}if(Te){const Be=ge(re.icon),Ie=!(N&&ne.verticalPlacedIconSymbolIndex&&Le);ne.placedIconSymbolIndex>=0&&(ie(o.icon,ne.numIconVertices,Ie?Be:Ce),o.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=re.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(ie(o.icon,ne.numVerticalIconVertices,Ie?Ce:Be),o.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Be=o.collisionArrays[te];if(Be){let Ie=new l.pointGeometry(0,0);if(Be.textBox||Be.verticalTextBox){let qe=!0;if(M){const nt=this.variableOffsets[xe];nt?(Ie=Hs(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),k&&Ie._rotate(D?this.transform.angle:-this.transform.angle)):qe=!1}Be.textBox&&R(o.textCollisionBox.collisionVertexArray,re.text.placed,!qe||Le,Ie.x,Ie.y),Be.verticalTextBox&&R(o.textCollisionBox.collisionVertexArray,re.text.placed,!qe||ke,Ie.x,Ie.y)}const et=!!(!ke&&Be.verticalIconBox);Be.iconBox&&R(o.iconCollisionBox.collisionVertexArray,re.icon.placed,et,N?Ie.x:0,N?Ie.y:0),Be.verticalIconBox&&R(o.iconCollisionBox.collisionVertexArray,re.icon.placed,!et,N?Ie.x:0,N?Ie.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=te.invProjMatrix,o.placementViewportMatrix=te.viewportMatrix,o.collisionCircleArray=te.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function R(m,o,h,p,_){m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0),m.emplaceBack(o?1:0,h?1:0,p||0,_||0)}const F=Math.pow(2,25),Y=Math.pow(2,24),J=Math.pow(2,17),ce=Math.pow(2,16),me=Math.pow(2,9),he=Math.pow(2,8),le=Math.pow(2,1);function ge(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,h=Math.floor(127*m.opacity);return h*F+o*Y+h*J+o*ce+h*me+o*he+h*le+o}const Ce=0;class Oe{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,_,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(E,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class Pe{constructor(o,h,p,_,x,E,C,M){this.placement=new ee(o,h,E,C,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const _=l.exported.now(),x=()=>{const E=l.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const rt=512/l.EXTENT/2;class lt{constructor(o,h,p){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const x=h.get(_),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,h){const p=rt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+o.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+o.anchorY)*p)}}findMatches(o,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const C=this.indexedSymbolInstances[E.key];if(!C)continue;const M=this.getScaledCoordinates(E,h);for(const k of C)if(Math.abs(k.coord.x-M.x)<=_&&Math.abs(k.coord.y-M.y)<=_&&!p[k.crossTileID]){p[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class Ye{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const E in _){const C=_[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),x[C.tileID.key]=C}this.indexes[p]=x}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const _=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const C in E){const M=E[C];M.tileID.isChildOf(o)&&M.findMatches(h.symbolInstances,o,_)}else{const C=E[o.scaledTo(Number(x)).key];C&&C.findMatches(h.symbolInstances,o,_)}}for(let x=0;x<h.symbolInstances.length;x++){const E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new lt(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[o][_.crossTileID]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)o[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],h=!0)}return h}}class dt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ye,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let _=this.layerIndexes[o.id];_===void 0&&(_=this.layerIndexes[o.id]=new gt);let x=!1;const E={};_.handleWrapJump(p);for(const C of h){const M=C.getBucket(o);M&&o.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,M,this.crossTileIDs)&&(x=!0),E[M.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Rt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class vt extends l.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const h=this._tiles[o];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];for(const p of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new ri(p,this.tileSize))}removeOutdated(o){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(o),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16),l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=x}else if(_.canonical.isChildOf(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=_.canonical.z-o.canonical.z,C=_.canonical.x-(_.canonical.x>>E<<E),M=_.canonical.y-(_.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,k,0,k,0,1),l.translate(x.posMatrix,x.posMatrix,[-C*k,-M*k,0]),h[p]=x}else if(o.canonical.isChildOf(_.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const E=o.canonical.z-_.canonical.z,C=o.canonical.x-(o.canonical.x>>E<<E),M=o.canonical.y-(o.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(x.posMatrix,x.posMatrix,[C*k,M*k,0]),l.scale(x.posMatrix,x.posMatrix,[1/2**E,1/2**E,0]),h[p]=x}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let _=o.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(_).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!x||!x.dem)&&h)for(;_>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(o.scaledTo(_--).key);return x}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=o)}}class At{constructor(o,h,p){this.style=o,this.sourceCache=new vt(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let x=0;const E=this.getTerrainData(o);if(E.tile&&E.tile.dem){const C=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],E.u_terrain_matrix),M=[C[0]*E.tile.dem.dim,C[1]*E.tile.dem.dim],k=[Math.floor(M[0]),Math.floor(M[1])],D=E.tile.dem.get(k[0],k[1]),N=E.tile.dem.get(k[0],k[1]+1),W=E.tile.dem.get(k[0]+1,k[1]),ie=E.tile.dem.get(k[0]+1,k[1]+1);x=l.number(l.number(D,N,M[0]-k[0]),l.number(W,ie,M[0]-k[0]),M[1]-k[1])}return x}rememberForRerender(o,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(o===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][_.tileID.key]=!0)}}needsRerender(o,h){return this._rerender[o]&&this._rerender[o][h.key]}clearRerenderCache(){this._rerender={}}getElevation(o,h,p,_=l.EXTENT){return(this.getDEMElevation(o,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const _=this.style.map.painter.context,x=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new K(_,x,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new K(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new K(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let x=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=_?x=o.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>x<<x),C=o.canonical.y-(o.canonical.y>>x<<x),M=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<x),1/(l.EXTENT<<x),0]);l.translate(M,M,[E*l.EXTENT,C*l.EXTENT,0]),this._demMatrixCache[o.key]={matrix:M,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(o){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new K(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new K(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,E=0;x<this._coordsTextureSize;x++)for(let C=0;C<this._coordsTextureSize;C++,E+=4)h[E+0]=255&C,h[E+1]=255&x,h[E+2]=C>>8<<4|x>>8,h[E+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new K(o,p,o.gl.RGBA,{premultiply:!1});return _.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(o){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,x=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(o.x,p.height/devicePixelRatio-o.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const E=h[0]+(h[2]>>4<<8),C=h[1]+((15&h[2])<<8),M=this.coordsIndex[255-h[3]],k=M&&this.sourceCache.getTileByID(M);if(!k)return null;const D=this._coordsTextureSize,N=(1<<k.tileID.canonical.z)*D;return new l.MercatorCoordinate((k.tileID.canonical.x*D+E)/N,(k.tileID.canonical.y*D+C)/N,this.getElevation(k.tileID,E,C,D))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,x=l.EXTENT/_,E=_*_;for(let C=0;C<=_;C++)for(let M=0;M<=_;M++)h.emplaceBack(M*x,C*x);for(let C=0;C<E;C+=_+1)for(let M=0;M<_;M++)p.emplaceBack(M+C,_+M+C+1,_+M+C+2),p.emplaceBack(M+C,_+M+C+2,M+C+1);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,Rt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ft=(m,o)=>l.emitValidationErrors(m,o&&o.filter(h=>h.identifier!=="source.canvas")),Vt=l.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),dn=l.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),fn=function(){const m={},o=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?o:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class Jn extends l.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new je(di(),this),this.imageManager=new Z,this.imageManager.setEventedParent(this),this.glyphManager=new pe(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new dt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Jn.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,E)=>{if(l.triggerPluginCompletionEvent(x),E&&E.every(C=>C))for(const C in p.sourceCaches)p.sourceCaches[C].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.sourceCaches[_.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===E.id&&this._validateLayer(M)}})}loadURL(o,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(o,l.ResourceType.Style);this._request=l.getJSON(_,(x,E)=>{this._request=null,x?this.fire(new l.ErrorEvent(x)):E&&this._load(E,p)})}loadJSON(o,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(fn,!1)}_load(o,h){if(h&&Ft(this,l.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const p=Vs(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Fe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(h,p,_,x){let E,C,M;const k=_>1?"@2x":"";let D=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(ie,te)=>{D=null,M||(M=ie,E=te,W())}),N=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(ie,te)=>{N=null,M||(M=ie,C=te,W())});function W(){if(M)x(M);else if(E&&C){const ie=l.exported.getImageData(C),te={};for(const ne in E){const{width:fe,height:_e,x:xe,y:re,sdf:Te,pixelRatio:we,stretchX:Le,stretchY:ke,content:Be}=E[ne],Ie=new l.RGBAImage({width:fe,height:_e});l.RGBAImage.copy(ie,Ie,{x:xe,y:re},{x:0,y:0},{width:fe,height:_e}),te[ne]={data:Ie,pixelRatio:we,sdf:Te,stretchX:Le,stretchY:ke,content:Be}}x(null,te)}}return{cancel(){D&&(D.cancel(),D=null),N&&(N.cancel(),N=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const p of o){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const E in this._updatedSources){const C=this._updatedSources[E];if(C==="reload")this._reloadSource(E);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(E)}}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const x=this.sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const _ in p){const x=this.sourceCaches[_];p[_]!==x.used&&x.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const h=this.sourceCaches[o.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new At(this,h,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),Ft(this,l.validateStyle(o)))return!1;(o=l.clone$1(o)).layers=Vs(o.layers);const h=function(_,x){if(!_)return[{command:Gt.setStyle,args:[x]}];let E=[];try{if(!I(_.version,x.version))return[{command:Gt.setStyle,args:[x]}];I(_.center,x.center)||E.push({command:Gt.setCenter,args:[x.center]}),I(_.zoom,x.zoom)||E.push({command:Gt.setZoom,args:[x.zoom]}),I(_.bearing,x.bearing)||E.push({command:Gt.setBearing,args:[x.bearing]}),I(_.pitch,x.pitch)||E.push({command:Gt.setPitch,args:[x.pitch]}),I(_.sprite,x.sprite)||E.push({command:Gt.setSprite,args:[x.sprite]}),I(_.glyphs,x.glyphs)||E.push({command:Gt.setGlyphs,args:[x.glyphs]}),I(_.transition,x.transition)||E.push({command:Gt.setTransition,args:[x.transition]}),I(_.light,x.light)||E.push({command:Gt.setLight,args:[x.light]});const C={},M=[];(function(D,N,W,ie){let te;for(te in N=N||{},D=D||{})Object.prototype.hasOwnProperty.call(D,te)&&(Object.prototype.hasOwnProperty.call(N,te)||On(te,W,ie));for(te in N)Object.prototype.hasOwnProperty.call(N,te)&&(Object.prototype.hasOwnProperty.call(D,te)?I(D[te],N[te])||(D[te].type==="geojson"&&N[te].type==="geojson"&&go(D,N,te)?W.push({command:Gt.setGeoJSONSourceData,args:[te,N[te].data]}):rs(te,N,W,ie)):ki(te,N,W))})(_.sources,x.sources,M,C);const k=[];_.layers&&_.layers.forEach(D=>{C[D.source]?E.push({command:Gt.removeLayer,args:[D.id]}):k.push(D)}),E=E.concat(M),function(D,N,W){N=N||[];const ie=(D=D||[]).map(Rr),te=N.map(Rr),ne=D.reduce(js,{}),fe=N.reduce(js,{}),_e=ie.slice(),xe=Object.create(null);let re,Te,we,Le,ke,Be,Ie;for(re=0,Te=0;re<ie.length;re++)we=ie[re],Object.prototype.hasOwnProperty.call(fe,we)?Te++:(W.push({command:Gt.removeLayer,args:[we]}),_e.splice(_e.indexOf(we,Te),1));for(re=0,Te=0;re<te.length;re++)we=te[te.length-1-re],_e[_e.length-1-re]!==we&&(Object.prototype.hasOwnProperty.call(ne,we)?(W.push({command:Gt.removeLayer,args:[we]}),_e.splice(_e.lastIndexOf(we,_e.length-Te),1)):Te++,Be=_e[_e.length-re],W.push({command:Gt.addLayer,args:[fe[we],Be]}),_e.splice(_e.length-re,0,we),xe[we]=!0);for(re=0;re<te.length;re++)if(we=te[re],Le=ne[we],ke=fe[we],!xe[we]&&!I(Le,ke))if(I(Le.source,ke.source)&&I(Le["source-layer"],ke["source-layer"])&&I(Le.type,ke.type)){for(Ie in kr(Le.layout,ke.layout,W,we,null,Gt.setLayoutProperty),kr(Le.paint,ke.paint,W,we,null,Gt.setPaintProperty),I(Le.filter,ke.filter)||W.push({command:Gt.setFilter,args:[we,ke.filter]}),I(Le.minzoom,ke.minzoom)&&I(Le.maxzoom,ke.maxzoom)||W.push({command:Gt.setLayerZoomRange,args:[we,ke.minzoom,ke.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?kr(Le[Ie],ke[Ie],W,we,Ie.slice(6),Gt.setPaintProperty):I(Le[Ie],ke[Ie])||W.push({command:Gt.setLayerProperty,args:[we,Ie,ke[Ie]]}));for(Ie in ke)Object.prototype.hasOwnProperty.call(ke,Ie)&&!Object.prototype.hasOwnProperty.call(Le,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?kr(Le[Ie],ke[Ie],W,we,Ie.slice(6),Gt.setPaintProperty):I(Le[Ie],ke[Ie])||W.push({command:Gt.setLayerProperty,args:[we,Ie,ke[Ie]]}))}else W.push({command:Gt.removeLayer,args:[we]}),Be=_e[_e.lastIndexOf(we)+1],W.push({command:Gt.addLayer,args:[ke,Be]})}(k,x.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Gt.setStyle,args:[x]}]}return E}(this.serialize(),o).filter(_=>!(_.command in dn));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Vt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,!0}addImage(o,h){if(this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[o]=new qt(o,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:o})),_.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new l.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let x;if(o.type==="custom"){if(Ft(this,l.validateCustomStyleLayer(o)))return;x=l.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=l.clone$1(o),o=l.extend(o,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,o,{arrayIndex:-1},p))return;x=l.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=x,this._removedLayers[_]&&x.source&&x.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!I(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,h,p,_={}){this._checkLoaded();const x=this.getLayer(o);x?I(x.getLayoutProperty(h),p)||(x.setLayoutProperty(h,p,_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,_={}){this._checkLoaded();const x=this.getLayer(o);x?I(x.getPaintProperty(h),p)||(x.setPaintProperty(h,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,_=o.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(_,o.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.getSource().type,E=x==="vector"?o.sourceLayer:void 0;x!=="vector"||E?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,o.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,o.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C)){p[C]=E;for(const M of o){const k=M[C];if(k)for(const D of k)_.push(D)}}}_.sort((E,C)=>C.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C))for(let M=_.length-1;M>=0;M--){const k=_[M].feature;if(p[k.layer.id]<E)break;x.push(k),_.pop()}else for(const M of o){const k=M[C];if(k)for(const D of k)x.push(D.feature)}}return x}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const C=this._layers[E];if(!C)return this.fire(new l.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];_[C.source]=!0}}const x=[];h.availableImages=this._availableImages;for(const E in this.sourceCaches)h.layers&&!_[E]||x.push(ii(this.sourceCaches[E],this._layers,this._serializedLayers,o,h,p));return this.placement&&x.push(function(E,C,M,k,D,N,W){const ie={},te=N.queryRenderedSymbols(k),ne=[];for(const fe of Object.keys(te).map(Number))ne.push(W[fe]);ne.sort(bi);for(const fe of ne){const _e=fe.featureIndex.lookupSymbolFeatures(te[fe.bucketInstanceId],C,fe.bucketIndex,fe.sourceLayerIndex,D.filter,D.layers,D.availableImages,E);for(const xe in _e){const re=ie[xe]=ie[xe]||[],Te=_e[xe];Te.sort((we,Le)=>{const ke=fe.featureSortOrder;if(ke){const Be=ke.indexOf(we.featureIndex);return ke.indexOf(Le.featureIndex)-Be}return Le.featureIndex-we.featureIndex});for(const we of Te)re.push(we)}}for(const fe in ie)ie[fe].forEach(_e=>{const xe=_e.feature,re=M[E[fe].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=re});return ie}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(_,x){const E=_.getRenderableIds().map(k=>_.getTileByID(k)),C=[],M={};for(let k=0;k<E.length;k++){const D=E[k],N=D.tileID.canonical.key;M[N]||(M[N]=!0,D.querySourceFeatures(C,x))}return C}(p,h):[]}addSourceType(o,h,p){return Jn.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(Jn.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in o)if(!I(o[E],p[E])){_=!0;break}if(!_)return;const x={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(x)}_validate(o,h,p,_,x={}){return(!x||x.validate!==!1)&&Ft(this,o.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,_,x=!1){let E=!1,C=!1;const M={};for(const k of this._order){const D=this._layers[k];if(D.type!=="symbol")continue;if(!M[D.source]){const W=this.sourceCaches[D.source];M[D.source]=W.getRenderableIds(!0).map(ie=>W.getTileByID(ie)).sort((ie,te)=>te.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(te.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(D,M[D.source],o.center.lng);E=E||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),o.zoom))&&(this.pauseablePlacement=new Pe(o,this.terrain,this._order,x,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const k of this._order){const D=this._layers[k];D.type==="symbol"&&this.placement.updateLayerOpacities(D,M[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(o,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(o,h,p){return l.makeRequest(h,p)}}Jn.getSourceType=function(m){return rn[m]},Jn.setSourceType=function(m,o){rn[m]=o},Jn.registerForPluginStateChange=l.registerForPluginStateChange;var Dr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const fi={prelude:Xt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Xt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Xt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Xt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Xt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Xt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Xt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Xt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Dr),terrainDepth:Xt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Dr),terrainCoords:Xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Dr)};function Xt(m,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(_):_,C={};return{fragmentSource:m=m.replace(h,(M,k,D,N,W)=>(C[W]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${D} ${N} ${W};
#else
uniform ${D} ${N} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${D} ${N} ${W} = u_${W};
#endif
`)),vertexSource:o=o.replace(h,(M,k,D,N,W)=>{const ie=N==="float"?"vec2":"vec4",te=W.match(/color/)?"color":ie;return C[W]?k==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${D} ${ie} a_${W};
varying ${D} ${N} ${W};
#else
uniform ${D} ${N} u_${W};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${D} ${N} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${te}(a_${W}, u_${W}_t);
#else
    ${D} ${N} ${W} = u_${W};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${D} ${ie} a_${W};
#else
uniform ${D} ${N} u_${W};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${D} ${N} ${W} = a_${W};
#else
    ${D} ${N} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${D} ${N} ${W} = unpack_mix_${te}(a_${W}, u_${W}_t);
#else
    ${D} ${N} ${W} = u_${W};
#endif
`}),staticAttributes:p,staticUniforms:E}}class _o{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,_,x,E,C,M,k){this.context=o;let D=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!D&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(D=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!D&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===M&&this.boundDynamicVertexBuffer3===k?(o.bindVertexArrayOES.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),M&&M.bind(),k&&k.bind()):this.freshBind(h,p,_,x,E,C,M,k)}freshBind(o,h,p,_,x,E,C,M){let k;const D=o.numAttributes,N=this.context,W=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=M;else{k=N.currentNumAttributes||0;for(let ie=D;ie<k;ie++)W.disableVertexAttribArray(ie)}h.enableAttributes(W,o);for(const ie of p)ie.enableAttributes(W,o);E&&E.enableAttributes(W,o),C&&C.enableAttributes(W,o),M&&M.enableAttributes(W,o),h.bind(),h.setVertexAttribPointers(W,o,x);for(const ie of p)ie.bind(),ie.setVertexAttribPointers(W,o,x);E&&(E.bind(),E.setVertexAttribPointers(W,o,x)),_&&_.bind(),C&&(C.bind(),C.setVertexAttribPointers(W,o,x)),M&&(M.bind(),M.setVertexAttribPointers(W,o,x)),N.currentNumAttributes=D}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yo(m){const o=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");o.push(p.pop())}return o}class Ko{constructor(o,h,p,_,x,E,C){const M=o.gl;this.program=M.createProgram();const k=yo(p.staticAttributes),D=_?_.getBinderAttributes():[],N=k.concat(D),W=fi.prelude.staticUniforms?yo(fi.prelude.staticUniforms):[],ie=p.staticUniforms?yo(p.staticUniforms):[],te=_?_.getBinderUniforms():[],ne=W.concat(ie).concat(te),fe=[];for(const ke of ne)fe.indexOf(ke)<0&&fe.push(ke);const _e=_?_.defines():[];E&&_e.push("#define OVERDRAW_INSPECTOR;"),C&&_e.push("#define TERRAIN3D;");const xe=_e.concat(fi.prelude.fragmentSource,p.fragmentSource).join(`
`),re=_e.concat(fi.prelude.vertexSource,p.vertexSource).join(`
`),Te=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Te,xe),M.compileShader(Te),M.attachShader(this.program,Te);const we=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(we,re),M.compileShader(we),M.attachShader(this.program,we),this.attributes={};const Le={};this.numAttributes=N.length;for(let ke=0;ke<this.numAttributes;ke++)N[ke]&&(M.bindAttribLocation(this.program,ke,N[ke]),this.attributes[N[ke]]=ke);M.linkProgram(this.program),M.deleteShader(we),M.deleteShader(Te);for(let ke=0;ke<fe.length;ke++){const Be=fe[ke];if(Be&&!Le[Be]){const Ie=M.getUniformLocation(this.program,Be);Ie&&(Le[Be]=Ie)}}this.fixedUniforms=x(o,Le),this.terrainUniforms=((ke,Be)=>({u_depth:new l.Uniform1i(ke,Be.u_depth),u_terrain:new l.Uniform1i(ke,Be.u_terrain),u_terrain_dim:new l.Uniform1f(ke,Be.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(ke,Be.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(ke,Be.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(ke,Be.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(ke,Be.u_terrain_exaggeration)}))(o,Le),this.binderUniforms=_?_.getUniforms(o,Le):[]}draw(o,h,p,_,x,E,C,M,k,D,N,W,ie,te,ne,fe,_e,xe){const re=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(_),o.setColorMode(x),o.setCullFace(E),M){o.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,M.depthTexture),o.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,M.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(M[we])}for(const we in this.fixedUniforms)this.fixedUniforms[we].set(C[we]);ne&&ne.setUniforms(o,this.binderUniforms,ie,{zoom:te});let Te=0;switch(h){case re.LINES:Te=2;break;case re.TRIANGLES:Te=3;break;case re.LINE_STRIP:Te=1}for(const we of W.get()){const Le=we.vaos||(we.vaos={});(Le[k]||(Le[k]=new _o)).bind(o,this,D,ne?ne.getPaintVertexBuffers():[],N,we.vertexOffset,fe,_e,xe),re.drawElements(h,we.primitiveLength*Te,re.UNSIGNED_SHORT,we.primitiveOffset*Te*2)}}}function Jo(m,o,h){const p=1/Ln(h,1,o.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),x=h.tileSize*Math.pow(2,o.transform.tileZoom)/_,E=x*(h.tileID.canonical.x+h.tileID.wrap*_),C=x*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const $s=(m,o,h,p)=>{const _=o.style.light,x=_.properties.get("position"),E=[x.x,x.y,x.z],C=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(C,-o.transform.angle),l.transformMat3(E,E,C);const M=_.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:p}},Or=(m,o,h,p,_,x,E)=>l.extend($s(m,o,h,p),Jo(x,o,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),Qo=m=>({u_matrix:m}),ea=(m,o,h,p)=>l.extend(Qo(m),Jo(h,o,p)),ta=(m,o)=>({u_matrix:m,u_world:o}),Za=(m,o,h,p,_)=>l.extend(ea(m,o,h,p),{u_world:_}),Yl=(m,o,h,p)=>{const _=m.transform;let x,E;if(p.paint.get("circle-pitch-alignment")==="map"){const C=Ln(h,1,_.zoom);x=!0,E=[C,C]}else x=!1,E=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},Es=(m,o,h)=>{const p=Ln(h,1,o.zoom),_=Math.pow(2,o.zoom-h.tileID.overscaledZ),x=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*_),o.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:x}},H=(m,o,h=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:h}),Q=m=>({u_matrix:m}),ue=(m,o,h,p)=>({u_matrix:m,u_extrude_scale:Ln(o,1,h),u_intensity:p});function Ae(m,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const Ne=(m,o,h,p)=>{const _=m.transform;return{u_matrix:Fn(m,o,h,p),u_ratio:1/Ln(o,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ot=(m,o,h,p,_)=>l.extend(Ne(m,o,h,_),{u_image:0,u_image_height:p}),Bt=(m,o,h,p,_)=>{const x=m.transform,E=zt(o,x);return{u_matrix:Fn(m,o,h,_),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Ln(o,1,x.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},En=(m,o,h,p,_,x)=>{const E=m.lineAtlas,C=zt(o,m.transform),M=h.layout.get("line-cap")==="round",k=E.getDash(p.from,M),D=E.getDash(p.to,M),N=k.width*_.fromScale,W=D.width*_.toScale;return l.extend(Ne(m,o,h,x),{u_patternscale_a:[C/N,-k.height/2],u_patternscale_b:[C/W,-D.height/2],u_sdfgamma:E.width/(256*Math.min(N,W)*m.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:D.y,u_mix:_.t})};function zt(m,o){return 1/Ln(m,1,o.tileZoom)}function Fn(m,o,h,p){return m.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const sr=(m,o,h,p,_)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=_.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:jd(_.paint.get("raster-hue-rotate"))};var x,E};function jd(m){m*=Math.PI/180;const o=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Eu=(m,o,h,p,_,x,E,C,M,k)=>{const D=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:D.width/D.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+p,u_texsize:k,u_texture:0}},Kl=(m,o,h,p,_,x,E,C,M,k,D)=>{const N=_.transform;return l.extend(Eu(m,o,h,p,_,x,E,C,M,k),{u_gamma_scale:p?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+D})},Gd=(m,o,h,p,_,x,E,C,M,k)=>l.extend(Kl(m,o,h,p,_,x,E,C,!0,M,!0),{u_texsize_icon:k,u_texture_icon:1}),ug=(m,o,h)=>({u_matrix:m,u_opacity:o,u_color:h}),hg=(m,o,h,p,_,x)=>l.extend(function(E,C,M,k){const D=M.imageManager.getPattern(E.from.toString()),N=M.imageManager.getPattern(E.to.toString()),{width:W,height:ie}=M.imageManager.getPixelSize(),te=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,M.transform.tileZoom)/te,fe=ne*(k.tileID.canonical.x+k.tileID.wrap*te),_e=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[W,ie],u_mix:C.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Ln(k,1,M.transform.tileZoom),u_pixel_coord_upper:[fe>>16,_e>>16],u_pixel_coord_lower:[65535&fe,65535&_e]}}(p,x,h,_),{u_matrix:m,u_opacity:o}),Tu={fillExtrusion:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,o.u_height_factor),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,o.u_overscale_factor)}),collisionCircle:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new l.UniformColor(m,o.u_color),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_overlay:new l.Uniform1i(m,o.u_overlay),u_overlay_scale:new l.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new l.Uniform1f(m,o.u_extrude_scale),u_intensity:new l.Uniform1f(m,o.u_intensity),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_color_ramp:new l.Uniform1i(m,o.u_color_ramp),u_opacity:new l.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_latrange:new l.Uniform2f(m,o.u_latrange),u_light:new l.Uniform2f(m,o.u_light),u_shadow:new l.UniformColor(m,o.u_shadow),u_highlight:new l.UniformColor(m,o.u_highlight),u_accent:new l.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_dimension:new l.Uniform2f(m,o.u_dimension),u_zoom:new l.Uniform1f(m,o.u_zoom),u_unpack:new l.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels)}),lineGradient:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_image:new l.Uniform1i(m,o.u_image),u_image_height:new l.Uniform1f(m,o.u_image_height)}),linePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texsize:new l.Uniform2f(m,o.u_texsize),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_image:new l.Uniform1i(m,o.u_image),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),lineSDF:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,o.u_sdfgamma),u_image:new l.Uniform1i(m,o.u_image),u_tex_y_a:new l.Uniform1f(m,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,o.u_tex_y_b),u_mix:new l.Uniform1f(m,o.u_mix)}),raster:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new l.Uniform2f(m,o.u_tl_parent),u_scale_parent:new l.Uniform1f(m,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,o.u_buffer_scale),u_fade_t:new l.Uniform1f(m,o.u_fade_t),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image0:new l.Uniform1i(m,o.u_image0),u_image1:new l.Uniform1i(m,o.u_image1),u_brightness_low:new l.Uniform1f(m,o.u_brightness_low),u_brightness_high:new l.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,o.u_spin_weights)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texsize_icon:new l.Uniform2f(m,o.u_texsize_icon),u_texture:new l.Uniform1i(m,o.u_texture),u_texture_icon:new l.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_color:new l.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image:new l.Uniform1i(m,o.u_image),u_pattern_tl_a:new l.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,o.u_pattern_br_b),u_texsize:new l.Uniform2f(m,o.u_texsize),u_mix:new l.Uniform1f(m,o.u_mix),u_pattern_size_a:new l.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,o.u_scale_a),u_scale_b:new l.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,o.u_tile_units_to_pixels)}),terrain:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture)}),terrainDepth:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),terrainCoords:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture),u_terrain_coords_id:new l.Uniform1f(m,o.u_terrain_coords_id)})};class Su{constructor(o,h,p){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Au={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Pu{constructor(o,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,h,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],E=h.attributes[x.name];E!==void 0&&o.vertexAttribPointer(E,x.components,o[Au[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wd extends Jt{getDefault(){return l.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class dg extends Jt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Xa extends Jt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ya extends Jt{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Hd extends Jt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class or extends Jt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Cu extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Jl extends Jt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ql extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Iu extends Jt{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Mu extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class ec extends Jt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Lu extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class ku extends Jt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class tc extends Jt{getDefault(){return l.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class $d extends Jt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class qd extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class na extends Jt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class fg extends Jt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class pg extends Jt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class mg extends Jt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class gg extends Jt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _g extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class yg extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ru extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class nc extends Jt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class zu extends Jt{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Du extends Jt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class ia extends Jt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Zd extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Xd extends Jt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ic extends Jt{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class vo extends ic{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Yd extends ic{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ra{constructor(o,h,p,_){this.context=o,this.width=h,this.height=p;const x=o.gl,E=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new vo(o,E),_&&(this.depthAttachment=new Yd(o,E)),x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class gn{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}gn.Replace=[1,0],gn.disabled=new gn(gn.Replace,l.Color.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,l.Color.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Kd{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Wd(this),this.clearDepth=new dg(this),this.clearStencil=new Xa(this),this.colorMask=new Ya(this),this.depthMask=new Hd(this),this.stencilMask=new or(this),this.stencilFunc=new Cu(this),this.stencilOp=new Jl(this),this.stencilTest=new Ql(this),this.depthRange=new Iu(this),this.depthTest=new Mu(this),this.depthFunc=new ec(this),this.blend=new Lu(this),this.blendFunc=new ku(this),this.blendColor=new tc(this),this.blendEquation=new $d(this),this.cullFace=new qd(this),this.cullFaceSide=new na(this),this.frontFace=new fg(this),this.program=new pg(this),this.activeTexture=new mg(this),this.viewport=new gg(this),this.bindFramebuffer=new _g(this),this.bindRenderbuffer=new yg(this),this.bindTexture=new Ru(this),this.bindVertexBuffer=new nc(this),this.bindElementBuffer=new zu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Du(this),this.pixelStoreUnpack=new ia(this),this.pixelStoreUnpackPremultiplyAlpha=new Zd(this),this.pixelStoreUnpackFlipY=new Xd(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Su(this,o,h)}createVertexBuffer(o,h,p){return new Pu(this,o,h,p)}createRenderbuffer(o,h,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),x}createFramebuffer(o,h,p){return new ra(this,o,h,p)}clear({color:o,depth:h}){const p=this.gl;let _=0;o&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){I(o.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Wt{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const Qt=7680;class pn{constructor(o,h,p,_,x,E){this.test=o,this.ref=h,this.mask=p,this.fail=_,this.depthFail=x,this.pass=E}}pn.disabled=new pn({func:519,mask:0},0,0,Qt,Qt,Qt);class vn{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let Ka;function sa(m,o,h,p,_,x,E){const C=m.context,M=C.gl,k=m.useProgram("collisionBox"),D=[];let N=0,W=0;for(let re=0;re<p.length;re++){const Te=p[re],we=o.getTile(Te),Le=we.getBucket(h);if(!Le)continue;let ke=Te.posMatrix;_[0]===0&&_[1]===0||(ke=m.translatePosMatrix(Te.posMatrix,we,_,x));const Be=E?Le.textCollisionBox:Le.iconCollisionBox,Ie=Le.collisionCircleArray;if(Ie.length>0){const et=l.create(),qe=ke;l.mul(et,Le.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(et,et,Le.placementViewportMatrix),D.push({circleArray:Ie,circleOffset:W,transform:qe,invTransform:et,coord:Te}),N+=Ie.length/4,W=N}Be&&k.draw(C,M.LINES,Wt.disabled,pn.disabled,m.colorModeForRenderPass(),vn.disabled,Es(ke,m.transform,we),m.style.terrain&&m.style.terrain.getTerrainData(Te),h.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,m.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!E||!D.length)return;const ie=m.useProgram("collisionCircle"),te=new l.CollisionCircleLayoutArray;te.resize(4*N),te._trim();let ne=0;for(const re of D)for(let Te=0;Te<re.circleArray.length/4;Te++){const we=4*Te,Le=re.circleArray[we+0],ke=re.circleArray[we+1],Be=re.circleArray[we+2],Ie=re.circleArray[we+3];te.emplace(ne++,Le,ke,Be,Ie,0),te.emplace(ne++,Le,ke,Be,Ie,1),te.emplace(ne++,Le,ke,Be,Ie,2),te.emplace(ne++,Le,ke,Be,Ie,3)}(!Ka||Ka.length<2*N)&&(Ka=function(re){const Te=2*re,we=new l.QuadTriangleArray;we.resize(Te),we._trim();for(let Le=0;Le<Te;Le++){const ke=6*Le;we.uint16[ke+0]=4*Le+0,we.uint16[ke+1]=4*Le+1,we.uint16[ke+2]=4*Le+2,we.uint16[ke+3]=4*Le+2,we.uint16[ke+4]=4*Le+3,we.uint16[ke+5]=4*Le+0}return we}(N));const fe=C.createIndexBuffer(Ka,!0),_e=C.createVertexBuffer(te,l.collisionCircleLayout.members,!0);for(const re of D){const Te={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};ie.draw(C,M.TRIANGLES,Wt.disabled,pn.disabled,m.colorModeForRenderPass(),vn.disabled,Te,m.style.terrain&&m.style.terrain.getTerrainData(re.coord),h.id,_e,fe,l.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;_e.destroy(),fe.destroy()}vn.disabled=new vn(!1,1029,2305),vn.backCCW=new vn(!0,1029,2305);const vg=l.identity(new Float32Array(16));function xg(m,o,h,p,_,x){const{horizontalAlign:E,verticalAlign:C}=l.getAnchorAlignment(m),M=-(E-.5)*o,k=-(C-.5)*h,D=l.evaluateVariableOffset(m,p);return new l.pointGeometry((M/_+D[0])*x,(k/_+D[1])*x)}function Jd(m,o,h,p,_,x,E,C,M,k,D){const N=m.text.placedSymbolArray,W=m.text.dynamicLayoutVertexArray,ie=m.icon.dynamicLayoutVertexArray,te={};W.clear();for(let ne=0;ne<N.length;ne++){const fe=N.get(ne),_e=m.allowVerticalPlacement&&!fe.placedOrientation,xe=fe.hidden||!fe.crossTileID||_e?null:p[fe.crossTileID];if(xe){const re=new l.pointGeometry(fe.anchorX,fe.anchorY),Te=Ut(re,h?E:x,D),we=Wi(_.cameraToCenterDistance,Te.signedDistanceFromCamera);let Le=l.evaluateSizeForFeature(m.textSizeData,M,fe)*we/l.ONE_EM;h&&(Le*=m.tilePixelRatio/C);const{width:ke,height:Be,anchor:Ie,textOffset:et,textBoxScale:qe}=xe,nt=xg(Ie,ke,Be,et,qe,Le),Lt=h?Ut(re.add(nt),x,D).point:Te.point.add(o?nt.rotate(-_.angle):nt),Dt=m.allowVerticalPlacement&&fe.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<fe.numGlyphs;_t++)l.addDynamicAttributes(W,Lt,Dt);k&&fe.associatedIconIndex>=0&&(te[fe.associatedIconIndex]={shiftedAnchor:Lt,angle:Dt})}else Ct(fe.numGlyphs,W)}if(k){ie.clear();const ne=m.icon.placedSymbolArray;for(let fe=0;fe<ne.length;fe++){const _e=ne.get(fe);if(_e.hidden)Ct(_e.numGlyphs,ie);else{const xe=te[fe];if(xe)for(let re=0;re<_e.numGlyphs;re++)l.addDynamicAttributes(ie,xe.shiftedAnchor,xe.angle);else Ct(_e.numGlyphs,ie)}}m.icon.dynamicLayoutVertexBuffer.updateData(ie)}m.text.dynamicLayoutVertexBuffer.updateData(W)}function bg(m,o,h){return h.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function rc(m,o,h,p,_,x,E,C,M,k,D,N){const W=m.context,ie=W.gl,te=m.transform,ne=C==="map",fe=M==="map",_e=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",xe=ne&&!fe&&!_e,re=!h.layout.get("symbol-sort-key").isConstant();let Te=!1;const we=m.depthModeForSublayer(0,Wt.ReadOnly),Le=h.layout.get("text-variable-anchor"),ke=[];for(const Be of p){const Ie=o.getTile(Be),et=Ie.getBucket(h);if(!et)continue;const qe=_?et.text:et.icon;if(!qe||!qe.segments.get().length)continue;const nt=qe.programConfigurations.get(h.id),Lt=_||et.sdfIcons,Dt=_?et.textSizeData:et.iconSizeData,_t=fe||te.pitch!==0,sn=m.useProgram(bg(Lt,_,et),nt),on=l.evaluateSizeForZoom(Dt,te.zoom),Ht=m.style.terrain&&m.style.terrain.getTerrainData(Be);let $t,ln,oi,us,Br=[0,0],hs=null;if(_){if(ln=Ie.glyphAtlasTexture,oi=ie.LINEAR,$t=Ie.glyphAtlasTexture.size,et.iconsInText){Br=Ie.imageAtlasTexture.size,hs=Ie.imageAtlasTexture;const Tr=Dt.kind==="composite"||Dt.kind==="camera";us=_t||m.options.rotating||m.options.zooming||Tr?ie.LINEAR:ie.NEAREST}}else{const Tr=h.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;ln=Ie.imageAtlasTexture,oi=Lt||m.options.rotating||m.options.zooming||Tr||_t?ie.LINEAR:ie.NEAREST,$t=Ie.imageAtlasTexture.size}const Qs=Ln(Ie,1,m.transform.zoom),Er=ss(Be.posMatrix,fe,ne,m.transform,Qs),$i=Ei(Be.posMatrix,fe,ne,m.transform,Qs),As=Le&&et.hasTextData(),dc=h.layout.get("icon-text-fit")!=="none"&&As&&et.hasIconData();if(_e){const Tr=m.style.terrain?(Yu,ha)=>m.style.terrain.getElevation(Be,Yu,ha):null,Eo=h.layout.get("text-rotation-alignment")==="map";zi(et,Be.posMatrix,m,_,Er,$i,fe,k,Eo,Tr)}const Qn=m.translatePosMatrix(Be.posMatrix,Ie,x,E),Nt=_e||_&&Le||dc?vg:Er,tn=m.translatePosMatrix($i,Ie,x,E,!0),ai=Lt&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let li;li=Lt?et.iconsInText?Gd(Dt.kind,on,xe,fe,m,Qn,Nt,tn,$t,Br):Kl(Dt.kind,on,xe,fe,m,Qn,Nt,tn,_,$t,!0):Eu(Dt.kind,on,xe,fe,m,Qn,Nt,tn,_,$t);const bn={program:sn,buffers:qe,uniformValues:li,atlasTexture:ln,atlasTextureIcon:hs,atlasInterpolation:oi,atlasInterpolationIcon:us,isSDF:Lt,hasHalo:ai};if(re&&et.canOverlap){Te=!0;const Tr=qe.segments.get();for(const Eo of Tr)ke.push({segments:new l.SegmentVector([Eo]),sortKey:Eo.sortKey,state:bn,terrainData:Ht})}else ke.push({segments:qe.segments,sortKey:0,state:bn,terrainData:Ht})}Te&&ke.sort((Be,Ie)=>Be.sortKey-Ie.sortKey);for(const Be of ke){const Ie=Be.state;if(W.activeTexture.set(ie.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,ie.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(W.activeTexture.set(ie.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Ie.isSDF){const et=Ie.uniformValues;Ie.hasHalo&&(et.u_is_halo=1,Ja(Ie.buffers,Be.segments,h,m,Ie.program,we,D,N,et,Be.terrainData)),et.u_is_halo=0}Ja(Ie.buffers,Be.segments,h,m,Ie.program,we,D,N,Ie.uniformValues,Be.terrainData)}}function Ja(m,o,h,p,_,x,E,C,M,k){const D=p.context;_.draw(D,D.gl.TRIANGLES,x,E,C,vn.disabled,M,k,h.id,m.layoutVertexBuffer,m.indexBuffer,o,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Qa(m,o,h,p,_,x,E){const C=m.context.gl,M=h.paint.get("fill-pattern"),k=M&&M.constantOr(1),D=h.getCrossfadeParameters();let N,W,ie,te,ne;E?(W=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=C.LINES):(W=k?"fillPattern":"fill",N=C.TRIANGLES);for(const fe of p){const _e=o.getTile(fe);if(k&&!_e.patternsLoaded())continue;const xe=_e.getBucket(h);if(!xe)continue;const re=xe.programConfigurations.get(h.id),Te=m.useProgram(W,re),we=m.style.terrain&&m.style.terrain.getTerrainData(fe);k&&(m.context.activeTexture.set(C.TEXTURE0),_e.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),re.updatePaintBuffers(D));const Le=M.constantOr(null);if(Le&&_e.imageAtlas){const Ie=_e.imageAtlas,et=Ie.patternPositions[Le.to.toString()],qe=Ie.patternPositions[Le.from.toString()];et&&qe&&re.setConstantPatternPositions(et,qe)}const ke=we?fe:null,Be=m.translatePosMatrix(ke?ke.posMatrix:fe.posMatrix,_e,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){te=xe.indexBuffer2,ne=xe.segments2;const Ie=[C.drawingBufferWidth,C.drawingBufferHeight];ie=W==="fillOutlinePattern"&&k?Za(Be,m,D,_e,Ie):ta(Be,Ie)}else te=xe.indexBuffer,ne=xe.segments,ie=k?ea(Be,m,D,_e):Qo(Be);Te.draw(m.context,N,_,m.stencilModeForClipping(fe),x,vn.disabled,ie,we,h.id,xe.layoutVertexBuffer,te,ne,h.paint,m.transform.zoom,re)}}function el(m,o,h,p,_,x,E){const C=m.context,M=C.gl,k=h.paint.get("fill-extrusion-pattern"),D=k.constantOr(1),N=h.getCrossfadeParameters(),W=h.paint.get("fill-extrusion-opacity");for(const ie of p){const te=o.getTile(ie),ne=te.getBucket(h);if(!ne)continue;const fe=m.style.terrain&&m.style.terrain.getTerrainData(ie),_e=ne.programConfigurations.get(h.id),xe=m.useProgram(D?"fillExtrusionPattern":"fillExtrusion",_e);D&&(m.context.activeTexture.set(M.TEXTURE0),te.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),_e.updatePaintBuffers(N));const re=k.constantOr(null);if(re&&te.imageAtlas){const ke=te.imageAtlas,Be=ke.patternPositions[re.to.toString()],Ie=ke.patternPositions[re.from.toString()];Be&&Ie&&_e.setConstantPatternPositions(Be,Ie)}const Te=m.translatePosMatrix(ie.posMatrix,te,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),we=h.paint.get("fill-extrusion-vertical-gradient"),Le=D?Or(Te,m,we,W,ie,N,te):$s(Te,m,we,W);xe.draw(C,C.gl.TRIANGLES,_,x,E,vn.backCCW,Le,fe,h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,h.paint,m.transform.zoom,_e,m.style.terrain&&ne.centroidVertexBuffer)}}function Ou(m,o,h,p,_,x,E){const C=m.context,M=C.gl,k=h.fbo;if(!k)return;const D=m.useProgram("hillshade"),N=m.style.terrain&&m.style.terrain.getTerrainData(o);C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),D.draw(C,M.TRIANGLES,_,x,E,vn.disabled,((W,ie,te,ne)=>{const fe=te.paint.get("hillshade-shadow-color"),_e=te.paint.get("hillshade-highlight-color"),xe=te.paint.get("hillshade-accent-color");let re=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=W.transform.angle);const Te=!W.options.moving;return{u_matrix:ne?ne.posMatrix:W.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Te),u_image:0,u_latrange:Ae(0,ie.tileID),u_light:[te.paint.get("hillshade-exaggeration"),re],u_shadow:fe,u_highlight:_e,u_accent:xe}})(m,h,p,N?o:null),N,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Qd(m,o,h,p,_,x){const E=m.context,C=E.gl,M=o.dem;if(M&&M.data){const k=M.dim,D=M.stride,N=M.getPixels();if(E.activeTexture.set(C.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(D),o.demTexture){const ie=o.demTexture;ie.update(N,{premultiply:!1}),ie.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else o.demTexture=new K(E,N,C.RGBA,{premultiply:!1}),o.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);E.activeTexture.set(C.TEXTURE0);let W=o.fbo;if(!W){const ie=new K(E,{width:k,height:k,data:null},C.RGBA);ie.bind(C.LINEAR,C.CLAMP_TO_EDGE),W=o.fbo=E.createFramebuffer(k,k,!0),W.colorAttachment.set(ie.texture)}E.bindFramebuffer.set(W.framebuffer),E.viewport.set([0,0,k,k]),m.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,p,_,x,vn.disabled,((ie,te)=>{const ne=te.stride,fe=l.create();return l.ortho(fe,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(fe,fe,[0,-l.EXTENT,0]),{u_matrix:fe,u_image:1,u_dimension:[ne,ne],u_zoom:ie.overscaledZ,u_unpack:te.getUnpackVector()}})(o.tileID,M),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function sc(m,o,h,p,_,x){const E=p.paint.get("raster-fade-duration");if(!x&&E>0){const C=l.exported.now(),M=(C-m.timeAdded)/E,k=o?(C-o.timeAdded)/E:-1,D=h.getSource(),N=_.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),W=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),ie=W&&m.refreshedUponExpiration?1:l.clamp(W?M:1-k,0,1);return m.refreshedUponExpiration&&M>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const oc=new l.Color(1,0,0,1),Fr=new l.Color(0,1,0,1),ef=new l.Color(0,0,1,1),Fu=new l.Color(1,0,1,1),tf=new l.Color(0,1,1,1);function xo(m,o,h,p){oa(m,0,o+h/2,m.transform.width,h,p)}function tl(m,o,h,p){oa(m,o-h/2,0,h,m.transform.height,p)}function oa(m,o,h,p,_,x){const E=m.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}function wg(m,o,h){const p=m.context,_=p.gl,x=h.posMatrix,E=m.useProgram("debug"),C=Wt.disabled,M=pn.disabled,k=m.colorModeForRenderPass(),D="$debug",N=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const W=o.getTileByID(h.key).latestRawTileData,ie=Math.floor((W&&W.byteLength||0)/1024),te=o.getTile(h).tileSize,ne=512/Math.min(te,512)*(h.overscaledZ/m.transform.zoom)*.5;let fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(fe+=` => ${h.overscaledZ}`),function(_e,xe){_e.initDebugOverlayCanvas();const re=_e.debugOverlayCanvas,Te=_e.context.gl,we=_e.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,re.width,re.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(xe,5,5),we.strokeText(xe,5,5),_e.debugOverlayTexture.update(re),_e.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(m,`${fe} ${ie}kB`),E.draw(p,_.TRIANGLES,C,M,gn.alphaBlended,vn.disabled,H(x,l.Color.transparent,ne),null,D,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),E.draw(p,_.LINE_STRIP,C,M,k,vn.disabled,H(x,l.Color.red),N,D,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function ac(m,o,h){const p=m.context,_=p.gl,x=m.colorModeForRenderPass(),E=new Wt(_.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),C=m.useProgram("terrain"),M=o.getTerrainMesh(),k=o.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const D=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());C.draw(p,_.TRIANGLES,E,pn.disabled,x,vn.backCCW,{u_matrix:D,u_texture:0},k,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}function nf(m,o,h,p){const _=m.context,x=h.tileSize*o.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(x)||new K(_,{width:x,height:x,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&o.sourceCache.renderHistory.unshift(h.tileID.key));const E=o.getRTTFramebuffer();E.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,x,x])}class rf{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,h=o.terrain;for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const _=o.sourceCaches[p].getVisibleCoordinates();for(const x of _){const E=h.sourceCache.getTerrainCoords(x);for(const C in E)this._coordsDescendingInv[p][C]||(this._coordsDescendingInv[p][C]=[]),this._coordsDescendingInv[p][C].push(E[C])}}for(const p of o._order){const _=o._layers[p],x=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const E in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][E]=this._coordsDescendingInv[x][E].map(C=>C.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[_][p.tileID.key];x&&x!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const h=o.type,p=this.painter,_=p.style._order,x=p.currentLayer,E=x+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[x]),!E))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&E){this._prevType=h;const C=this._stacks.length-1,M=this._stacks[C]||[];for(const k of this._renderableTiles){if(nf(p,p.style.terrain,k,C),this._rerender[k.tileID.key]){p.context.clear({color:l.Color.transparent});for(let D=0;D<M.length;D++){const N=p.style._layers[M[D]],W=N.source?this._coordsDescendingInv[N.source][k.tileID.key]:[k.tileID];p._renderTileClippingMasks(N,W),p.renderLayer(p,p.style.sourceCaches[N.source],N,W),N.source&&(k.textureCoords[N.source]=this._coordsDescendingInvStr[N.source][k.tileID.key])}}ac(p,p.style.terrain,k)}if(h==="hillshade"){this._stacks.push([_[x]]);for(const k of this._renderableTiles){const D=this._coordsDescendingInv[o.source][k.tileID.key];nf(p,p.style.terrain,k,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(o,D),p.renderLayer(p,p.style.sourceCaches[o.source],o,D),ac(p,p.style.terrain,k)}return!0}return this._renderToTexture[h]}return!1}}const nl={symbol:function(m,o,h,p,_){if(m.renderPass!=="translucent")return;const x=pn.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(C,M,k,D,N,W,ie){const te=M.transform,ne=N==="map",fe=W==="map";for(const _e of C){const xe=D.getTile(_e),re=xe.getBucket(k);if(!re||!re.text||!re.text.segments.get().length)continue;const Te=l.evaluateSizeForZoom(re.textSizeData,te.zoom),we=Ln(xe,1,M.transform.zoom),Le=ss(_e.posMatrix,fe,ne,M.transform,we),ke=k.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(Te){const Be=Math.pow(2,te.zoom-xe.tileID.overscaledZ);Jd(re,ne,fe,ie,te,Le,_e.posMatrix,Be,Te,ke,M.style.terrain?(Ie,et)=>M.style.terrain.getElevation(_e,Ie,et):null)}}}(p,m,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&rc(m,o,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,E),h.paint.get("text-opacity").constantOr(1)!==0&&rc(m,o,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,E),o.map.showCollisionBoxes&&(sa(m,o,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),sa(m,o,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),C=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;const M=m.context,k=M.gl,D=m.depthModeForSublayer(0,Wt.ReadOnly),N=pn.disabled,W=m.colorModeForRenderPass(),ie=[];for(let te=0;te<p.length;te++){const ne=p[te],fe=o.getTile(ne),_e=fe.getBucket(h);if(!_e)continue;const xe=_e.programConfigurations.get(h.id),re=m.useProgram("circle",xe),Te=_e.layoutVertexBuffer,we=_e.indexBuffer,Le=m.style.terrain&&m.style.terrain.getTerrainData(ne),ke={programConfiguration:xe,program:re,layoutVertexBuffer:Te,indexBuffer:we,uniformValues:Yl(m,ne,fe,h),terrainData:Le};if(C){const Be=_e.segments.get();for(const Ie of Be)ie.push({segments:new l.SegmentVector([Ie]),sortKey:Ie.sortKey,state:ke})}else ie.push({segments:_e.segments,sortKey:0,state:ke})}C&&ie.sort((te,ne)=>te.sortKey-ne.sortKey);for(const te of ie){const{programConfiguration:ne,program:fe,layoutVertexBuffer:_e,indexBuffer:xe,uniformValues:re,terrainData:Te}=te.state;fe.draw(M,k.TRIANGLES,D,N,W,vn.disabled,re,Te,h.id,_e,xe,te.segments,h.paint,m.transform.zoom,ne)}},heatmap:function(m,o,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,x=_.gl,E=pn.disabled,C=new gn([x.ONE,x.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(M,k,D){const N=M.gl;M.activeTexture.set(N.TEXTURE1),M.viewport.set([0,0,k.width/4,k.height/4]);let W=D.heatmapFbo;if(W)N.bindTexture(N.TEXTURE_2D,W.colorAttachment.get()),M.bindFramebuffer.set(W.framebuffer);else{const ie=N.createTexture();N.bindTexture(N.TEXTURE_2D,ie),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),W=D.heatmapFbo=M.createFramebuffer(k.width/4,k.height/4,!1),function(te,ne,fe,_e){const xe=te.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,ne.width/4,ne.height/4,0,xe.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),_e.colorAttachment.set(fe)}(M,k,ie,W)}})(_,m,h),_.clear({color:l.Color.transparent});for(let M=0;M<p.length;M++){const k=p[M];if(o.hasRenderableParent(k))continue;const D=o.getTile(k),N=D.getBucket(h);if(!N)continue;const W=N.programConfigurations.get(h.id),ie=m.useProgram("heatmap",W),{zoom:te}=m.transform;ie.draw(_,x.TRIANGLES,Wt.disabled,E,C,vn.disabled,ue(k.posMatrix,D,te,h.paint.get("heatmap-intensity")),null,h.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,h.paint,m.transform.zoom,W)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,x){const E=_.context,C=E.gl,M=x.heatmapFbo;if(!M)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new K(E,x.colorRamp,C.RGBA)),k.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,C.TRIANGLES,Wt.disabled,pn.disabled,_.colorModeForRenderPass(),vn.disabled,((D,N,W,ie)=>{const te=l.create();l.ortho(te,0,D.width,D.height,0,0,1);const ne=D.context.gl;return{u_matrix:te,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(_,x),null,x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(m,h))},line:function(m,o,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,Wt.ReadOnly),C=m.colorModeForRenderPass(),M=h.paint.get("line-dasharray"),k=h.paint.get("line-pattern"),D=k.constantOr(1),N=h.paint.get("line-gradient"),W=h.getCrossfadeParameters(),ie=D?"linePattern":M?"lineSDF":N?"lineGradient":"line",te=m.context,ne=te.gl;let fe=!0;for(const _e of p){const xe=o.getTile(_e);if(D&&!xe.patternsLoaded())continue;const re=xe.getBucket(h);if(!re)continue;const Te=re.programConfigurations.get(h.id),we=m.context.program.get(),Le=m.useProgram(ie,Te),ke=fe||Le.program!==we,Be=m.style.terrain&&m.style.terrain.getTerrainData(_e),Ie=k.constantOr(null);if(Ie&&xe.imageAtlas){const nt=xe.imageAtlas,Lt=nt.patternPositions[Ie.to.toString()],Dt=nt.patternPositions[Ie.from.toString()];Lt&&Dt&&Te.setConstantPatternPositions(Lt,Dt)}const et=Be?_e:null,qe=D?Bt(m,xe,h,W,et):M?En(m,xe,h,M,W,et):N?ot(m,xe,h,re.lineClipsArray.length,et):Ne(m,xe,h,et);if(D)te.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Te.updatePaintBuffers(W);else if(M&&(ke||m.lineAtlas.dirty))te.activeTexture.set(ne.TEXTURE0),m.lineAtlas.bind(te);else if(N){const nt=re.gradients[h.id];let Lt=nt.texture;if(h.gradientVersion!==nt.version){let Dt=256;if(h.stepInterpolant){const _t=o.getSource().maxzoom,sn=_e.canonical.z===_t?Math.ceil(1<<m.transform.maxZoom-_e.canonical.z):1;Dt=l.clamp(l.nextPowerOfTwo(re.maxLineLength/l.EXTENT*1024*sn),256,te.maxTextureSize)}nt.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:nt.gradient||void 0,clips:re.lineClipsArray}),nt.texture?nt.texture.update(nt.gradient):nt.texture=new K(te,nt.gradient,ne.RGBA),nt.version=h.gradientVersion,Lt=nt.texture}te.activeTexture.set(ne.TEXTURE0),Lt.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Le.draw(te,ne.TRIANGLES,E,m.stencilModeForClipping(_e),C,vn.disabled,qe,Be,h.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,h.paint,m.transform.zoom,Te,re.layoutVertexBuffer2),fe=!1}},fill:function(m,o,h,p){const _=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),C=h.paint.get("fill-pattern"),M=m.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===M){const k=m.depthModeForSublayer(1,m.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);Qa(m,o,h,p,k,E,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const k=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);Qa(m,o,h,p,k,E,!0)}},"fill-extrusion":function(m,o,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const x=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))el(m,o,h,p,x,pn.disabled,gn.disabled),el(m,o,h,p,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();el(m,o,h,p,x,pn.disabled,E)}}},hillshade:function(m,o,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,x=m.depthModeForSublayer(0,Wt.ReadOnly),E=m.colorModeForRenderPass(),[C,M]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const k of M){const D=o.getTile(k);D.needsHillshadePrepare!==void 0&&D.needsHillshadePrepare&&m.renderPass==="offscreen"?Qd(m,D,h,x,pn.disabled,E):m.renderPass==="translucent"&&Ou(m,k,D,h,x,C[k.overscaledZ],E)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,o,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,x=_.gl,E=o.getSource(),C=m.useProgram("raster"),M=m.colorModeForRenderPass(),[k,D]=E instanceof Et?[{},p]:m.stencilConfigForOverlap(p),N=D[D.length-1].overscaledZ,W=!m.options.moving;for(const ie of D){const te=m.depthModeForSublayer(ie.overscaledZ-N,h.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,x.LESS),ne=o.getTile(ie);ne.registerFadeDuration(h.paint.get("raster-fade-duration"));const fe=o.findLoadedParent(ie,0),_e=sc(ne,fe,o,h,m.transform,m.style.terrain);let xe,re;const Te=h.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;_.activeTexture.set(x.TEXTURE0),ne.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(x.TEXTURE1),fe?(fe.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,fe.tileID.overscaledZ-ne.tileID.overscaledZ),re=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Te,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const we=m.style.terrain&&m.style.terrain.getTerrainData(ie),Le=we?ie:null,ke=Le?Le.posMatrix:m.transform.calculatePosMatrix(ie.toUnwrapped(),W),Be=sr(ke,re||[0,0],xe||1,_e,h);E instanceof Et?C.draw(_,x.TRIANGLES,te,pn.disabled,M,vn.disabled,Be,we,h.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):C.draw(_,x.TRIANGLES,te,k[ie.overscaledZ],M,vn.disabled,Be,we,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,o,h,p){const _=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x===0)return;const E=m.context,C=E.gl,M=m.transform,k=M.tileSize,D=h.paint.get("background-pattern");if(m.isPatternMissing(D))return;const N=!D&&_.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==N)return;const W=pn.disabled,ie=m.depthModeForSublayer(0,N==="opaque"?Wt.ReadWrite:Wt.ReadOnly),te=m.colorModeForRenderPass(),ne=m.useProgram(D?"backgroundPattern":"background"),fe=p||M.coveringTiles({tileSize:k,terrain:m.style.terrain});D&&(E.activeTexture.set(C.TEXTURE0),m.imageManager.bind(m.context));const _e=h.getCrossfadeParameters();for(const xe of fe){const re=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Te=D?hg(re,x,m,D,{tileID:xe,tileSize:k},_e):ug(re,x,_),we=m.style.terrain&&m.style.terrain.getTerrainData(xe);ne.draw(E,C.TRIANGLES,ie,W,te,vn.disabled,Te,we,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,o,h){for(let p=0;p<h.length;p++)wg(m,o,h[p])},custom:function(m,o,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const x=_.prerender;x&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),x.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(pn.disabled);const x=_.renderingMode==="3d"?new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Wt.ReadOnly);p.setDepthMode(x),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class Bu{constructor(o,h){this.context=new Kd(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=qt.maxUnderzooming+qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dt,this.gpuTimers={}}resize(o,h,p){if(this.width=o*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const o=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,Rt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=o.createVertexBuffer(p,Rt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(_,tt.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,Rt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const C=new l.TriangleIndexArray;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(C),this.emptyTexture=new K(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const M=this.context.gl;this.stencilClearMode=new pn({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,Wt.disabled,this.stencilClearMode,gn.disabled,vn.disabled,Q(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(gn.disabled),p.setDepthMode(Wt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const C=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,M=this.style.terrain&&this.style.terrain.getTerrainData(E);x.draw(p,_.TRIANGLES,Wt.disabled,new pn({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),gn.disabled,vn.disabled,Q(E.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new pn({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new pn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((E,C)=>C.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let C=0;C<x;C++)E[C+_]=new pn({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,p]}return[{[_]:pn.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new gn([o.CONSTANT_COLOR,o.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Wt(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,x=this.style.terrain&&new rf(this);for(const k in _){const D=_[k];D.used&&D.prepare(this.context)}const E={},C={},M={};for(const k in _){const D=_[k];E[k]=D.getVisibleCoordinates(),C[k]=E[k].slice().reverse(),M[k]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<p.length;k++)if(this.style._layers[p[k]].is3D()){this.opaquePassCutoff=k;break}if(x){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(D,N){const W=D.context,ie=W.gl,te=gn.unblended,ne=new Wt(ie.LEQUAL,Wt.ReadWrite,[0,1]),fe=N.getTerrainMesh(),_e=N.sourceCache.getRenderableTiles(),xe=D.useProgram("terrainDepth");W.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),W.viewport.set([0,0,D.width/devicePixelRatio,D.height/devicePixelRatio]),W.clear({color:l.Color.transparent,depth:1});for(const re of _e){const Te=N.getTerrainData(re.tileID),we=D.transform.calculatePosMatrix(re.tileID.toUnwrapped());xe.draw(W,ie.TRIANGLES,ne,pn.disabled,te,vn.backCCW,{u_matrix:we},Te,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments)}W.bindFramebuffer.set(null),W.viewport.set([0,0,D.width,D.height])}(this,this.style.terrain),function(D,N){const W=D.context,ie=W.gl,te=gn.unblended,ne=new Wt(ie.LEQUAL,Wt.ReadWrite,[0,1]),fe=N.getTerrainMesh(),_e=N.getCoordsTexture(),xe=N.sourceCache.getRenderableTiles(),re=D.useProgram("terrainCoords");W.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),W.viewport.set([0,0,D.width/devicePixelRatio,D.height/devicePixelRatio]),W.clear({color:l.Color.transparent,depth:1}),N.coordsIndex=[];for(const Te of xe){const we=N.getTerrainData(Te.tileID);W.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,_e.texture);const Le=D.transform.calculatePosMatrix(Te.tileID.toUnwrapped());re.draw(W,ie.TRIANGLES,ne,pn.disabled,te,vn.backCCW,{u_matrix:Le,u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0},we,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments),N.coordsIndex.push(Te.tileID.key)}W.bindFramebuffer.set(null),W.viewport.set([0,0,D.width,D.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of p){const D=this.style._layers[k];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const N=C[D.source];(D.type==="custom"||N.length)&&this.renderLayer(this,_[D.source],D,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!x)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[p[this.currentLayer]],D=_[k.source],N=E[k.source];this._renderTileClippingMasks(k,N),this.renderLayer(this,D,k,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const k=this.style._layers[p[this.currentLayer]],D=_[k.source];if(x&&x.renderLayer(k))continue;const N=(k.type==="symbol"?M:C)[k.source];this._renderTileClippingMasks(k,E[k.source]),this.renderLayer(this,D,k,N)}if(this.options.showTileBoundaries){let k,D;Object.values(this.style._layers).forEach(N=>{N.source&&!N.isHidden(this.transform.zoom)&&(N.source!==(D&&D.id)&&(D=this.style.sourceCaches[N.source]),(!k||k.getSource().maxzoom<D.getSource().maxzoom)&&(k=D))}),k&&nl.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const D=k.transform.padding;xo(k,k.transform.height-(D.top||0),3,oc),xo(k,D.bottom||0,3,Fr),tl(k,D.left||0,3,ef),tl(k,k.transform.width-(D.right||0),3,Fu);const N=k.transform.centerPoint;(function(W,ie,te,ne){oa(W,ie-1,te-10,2,20,ne),oa(W,ie-10,te-1,20,2,ne)})(k,N.x,k.transform.height-N.y,tf)}(this),this.context.setDefault()}renderLayer(o,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),nl[p.type](o,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[o.id];p||(p=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const h={};for(const p in o){const _=o[p],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),h[p]=E}return h}translatePosMatrix(o,h,p,_,x){if(!p[0]&&!p[1])return o;const E=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const k=Math.sin(E),D=Math.cos(E);p=[p[0]*D-p[1]*k,p[0]*k+p[1]*D]}const C=[x?p[0]:Ln(h,p[0],this.transform.zoom),x?p[1]:Ln(h,p[1],this.transform.zoom),0],M=new Float32Array(16);return l.translate(M,o,C),M}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Ko(this.context,o,fi[o],h,Tu[o],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new K(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class lc{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const _=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const M=1/(C=l.transformMat4([],C,o))[3]/h*_;return l.mul$1(C,C,[M,M,1/C[3],M])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const M=l.sub([],x[C[0]],x[C[1]]),k=l.sub([],x[C[2]],x[C[1]]),D=l.normalize([],l.cross([],M,k)),N=-l.dot(D,x[C[1]]);return D.concat(N)});return new lc(x,E)}}class il{constructor(o,h){this.min=o,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(o){const h=[o%2==0,o<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let x=0;x<h.length;x++)p[x]=h[x]?this.min[x]:this.center[x],_[x]=h[x]?this.center[x]:this.max[x];return _[2]=this.max[2],new il(p,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<o.planes.length;_++){const x=o.planes[_];let E=0;for(let C=0;C<h.length;C++)l.dot$1(x,h[C])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let C=0;C<o.points.length;C++){const M=o.points[C][_]-this.min[_];x=Math.min(x,M),E=Math.max(E,M)}if(E<0||x>this.max[_]-this.min[_])return 0}return 1}}class aa{constructor(o=0,h=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=_}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=l.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=l.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=l.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=l.number(o.right,h.right,p)),this}getCenter(o,h){const p=l.clamp((this.left+o-this.right)/2,0,o),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class rl{constructor(o,h,p,_,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=x===void 0||!!x,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new aa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new rl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-l.wrap(o,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,x,E){var C=x[0],M=x[1],k=x[2],D=x[3],N=Math.sin(E),W=Math.cos(E);_[0]=C*W+k*N,_[1]=M*W+D*N,_[2]=C*-N+k*W,_[3]=M*-N+D*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=l.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new l.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),x=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new l.pointGeometry(0,this.height)),C=Math.floor(Math.min(p.x,_.x,x.x,E.x)),M=Math.floor(Math.max(p.x,_.x,x.x,E.x)),k=1;for(let D=C-k;D<=M+k;D++)D!==0&&h.push(new l.UnwrappedTileID(D,o))}return h}coveringTiles(o){var h,p;let _=this.coveringZoomLevel(o);const x=_;if(o.minzoom!==void 0&&_<o.minzoom)return[];o.maxzoom!==void 0&&_>o.maxzoom&&(_=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),C=l.MercatorCoordinate.fromLngLat(this.center),M=Math.pow(2,_),k=[M*E.x,M*E.y,0],D=[M*C.x,M*C.y,0],N=lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let W=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=_);const ie=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,te=re=>({aabb:new il([re*M,0,0],[(re+1)*M,M,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ne=[],fe=[],_e=_,xe=o.reparseOverscaled?x:_;if(this._renderWorldCopies)for(let re=1;re<=3;re++)ne.push(te(-re)),ne.push(te(re));for(ne.push(te(0));ne.length>0;){const re=ne.pop(),Te=re.x,we=re.y;let Le=re.fullyVisible;if(!Le){const nt=re.aabb.intersects(N);if(nt===0)continue;Le=nt===2}const ke=o.terrain?k:D,Be=re.aabb.distanceX(ke),Ie=re.aabb.distanceY(ke),et=Math.max(Math.abs(Be),Math.abs(Ie)),qe=ie+(1<<_e-re.zoom)-2;if(re.zoom===_e||et>qe&&re.zoom>=W){const nt=_e-re.zoom,Lt=k[0]-.5-(Te<<nt),Dt=k[1]-.5-(we<<nt);fe.push({tileID:new l.OverscaledTileID(re.zoom===_e?xe:re.zoom,re.wrap,re.zoom,Te,we),distanceSq:l.sqrLen([D[0]-.5-Te,D[1]-.5-we]),tileDistanceToCamera:Math.sqrt(Lt*Lt+Dt*Dt)})}else for(let nt=0;nt<4;nt++){const Lt=(Te<<1)+nt%2,Dt=(we<<1)+(nt>>1),_t=re.zoom+1;let sn=re.aabb.quadrant(nt);if(o.terrain){const on=new l.OverscaledTileID(_t,re.wrap,_t,Lt,Dt),Ht=o.terrain.getMinMaxElevation(on),$t=(h=Ht.minElevation)!==null&&h!==void 0?h:this.elevation,ln=(p=Ht.maxElevation)!==null&&p!==void 0?p:this.elevation;sn=new il([sn.min[0],sn.min[1],$t],[sn.max[0],sn.max[1],ln])}ne.push({aabb:sn,zoom:_t,x:Lt,y:Dt,wrap:re.wrap,fullyVisible:Le})}}return fe.sort((re,Te)=>re.distanceSq-Te.distanceSq).map(re=>re.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=l.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(o.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(o){return new l.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,h){const p=l.MercatorCoordinate.fromLngLat(o),_=(1<<this.tileZoom)*l.EXTENT,x=p.x*_,E=p.y*_,C=Math.floor(x/l.EXTENT),M=Math.floor(E/l.EXTENT),k=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,C,M);return h.getElevation(k,x%l.EXTENT,E%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.pointLocation(this.centerPoint,o),p=this.getElevation(h,o);if(!(this.elevation-p))return;const _=this.getCameraPosition(),x=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),E=l.MercatorCoordinate.fromLngLat(h,p),C=x.x-E.x,M=x.y-E.y,k=x.z-E.z,D=Math.sqrt(C*C+M*M+k*k),N=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=p,this._center=h,this.zoom=N}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o),E=new l.MercatorCoordinate(x.x-(p.x-_.x),x.y-(p.y-_.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return l.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const W=h.pointCoordinate(o);if(W!=null)return W}const p=[o.x,o.y,0,1],_=[o.x,o.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const x=p[3],E=_[3],C=p[1]/x,M=_[1]/E,k=p[2]/x,D=_[2]/E,N=k===D?0:(0-k)/(D-k);return new l.MercatorCoordinate(l.number(p[0]/x,_[0]/E,N)/this.worldSize,l.number(C,M,N)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const _=[o.x*this.worldSize,o.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,o))).extend(this.pointLocation(new l.pointGeometry(this.width,o))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,h=!1){const p=o.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const x=o.canonical,E=this.worldSize/this.zoomScale(x.z),C=x.x+Math.pow(2,x.z)*o.wrap,M=l.identity(new Float64Array(16));return l.translate(M,M,[C*E,x.y*E,0]),l.scale(M,M,[E/l.EXTENT,E/l.EXTENT,1]),l.multiply(M,h?this.alignedProjMatrix:this.projMatrix,M),_[p]=new Float32Array(M),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,h,p,_,x=-90,E=90,C=-180,M=180;const k=this.size,D=this._unmodified;if(this.latRange){const ie=this.latRange;x=l.mercatorYfromLat(ie[1])*this.worldSize,E=l.mercatorYfromLat(ie[0])*this.worldSize,o=E-x<k.y?k.y/(E-x):0}if(this.lngRange){const ie=this.lngRange;C=l.wrap(l.mercatorXfromLng(ie[0])*this.worldSize,0,this.worldSize),M=l.wrap(l.mercatorXfromLng(ie[1])*this.worldSize,0,this.worldSize),M<C&&(M+=this.worldSize),h=M-C<k.x?k.x/(M-C):0}const N=this.point,W=Math.max(h||0,o||0);if(W)return this.center=this.unproject(new l.pointGeometry(h?(M+C)/2:N.x,o?(E+x)/2:N.y)),this.zoom+=this.scaleZoom(W),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const ie=N.y,te=k.y/2;ie-te<x&&(_=x+te),ie+te>E&&(_=E-te)}if(this.lngRange){const ie=(C+M)/2,te=l.wrap(N.x,ie-this.worldSize/2,ie+this.worldSize/2),ne=k.x/2;te-ne<C&&(p=C+ne),te+ne>M&&(p=M-ne)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:N.x,_!==void 0?_:N.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=Math.PI/2+this._pitch,E=this._fov*(.5+o.y/this.height),C=Math.sin(E)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-E,.01,Math.PI-.01)),M=this.getHorizon(),k=2*Math.atan(M/this.cameraToCenterDistance)*(.5+o.y/(2*M)),D=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-k,.01,Math.PI-.01)),N=Math.cos(Math.PI/2-this._pitch)*C+this.cameraToSeaLevelDistance,W=Math.cos(Math.PI/2-this._pitch)*D+this.cameraToSeaLevelDistance,ie=1.01*Math.min(N,W),te=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,te,ie),_[8]=2*-o.x/this.width,_[9]=2*o.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ne=this.width%2/2,fe=this.height%2/2,_e=Math.cos(this.angle),xe=Math.sin(this.angle),re=h-Math.round(h)+_e*ne+xe*fe,Te=p-Math.round(p)+_e*fe+xe*ne,we=new Float64Array(_);if(l.translate(we,we,[re>.5?re-1:re,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=we,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.pointGeometry(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,_=h.y,x=h.x,E=h.y;for(const C of o)p=Math.min(p,C.x),_=Math.min(_,C.y),x=Math.max(x,C.x),E=Math.max(E,C.y);return[new l.pointGeometry(p,_),new l.pointGeometry(x,_),new l.pointGeometry(x,E),new l.pointGeometry(p,E),new l.pointGeometry(p,_)]}}}class sf{constructor(o){this._hashName=o&&encodeURIComponent(o),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,x=null;const E=()=>{x=null,_&&(h(),x=setTimeout(E,300),_=!1)};return()=>(_=!0,x||E(),x)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),E=Math.round(h.lng*x)/x,C=Math.round(h.lat*x)/x,M=this._map.getBearing(),k=this._map.getPitch();let D="";if(D+=o?`/${E}/${C}/${p}`:`${p}/${C}/${E}`,(M||k)&&(D+="/"+Math.round(10*M)/10),k&&(D+=`/${Math.round(k)}`),this._hashName){const N=this._hashName;let W=!1;const ie=window.location.hash.slice(1).split("&").map(te=>{const ne=te.split("=")[0];return ne===N?(W=!0,`${ne}=${D}`):te}).filter(te=>te);return W||ie.push(`${N}=${D}`),`#${ie.join("&")}`}return`#${D}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const sl={linearity:.3,easing:l.bezier(0,0,.3,1)},of=l.extend({deceleration:2500,maxSpeed:1400},sl),af=l.extend({deceleration:20,maxSpeed:1400},sl),lf=l.extend({deceleration:1e3,maxSpeed:360},sl),la=l.extend({deceleration:1e3,maxSpeed:90},sl);class cf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=l.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const x=al(h.pan.mag(),p,l.extend({},of,o||{}));_.offset=h.pan.mult(x.amount/h.pan.mag()),_.center=this._map.transform.center,ol(_,x)}if(h.zoom){const x=al(h.zoom,p,af);_.zoom=this._map.transform.zoom+x.amount,ol(_,x)}if(h.bearing){const x=al(h.bearing,p,lf);_.bearing=this._map.transform.bearing+l.clamp(x.amount,-179,179),ol(_,x)}if(h.pitch){const x=al(h.pitch,p,la);_.pitch=this._map.transform.pitch+x.amount,ol(_,x)}if(_.zoom||_.bearing){const x=h.pinchAround===void 0?h.around:h.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function ol(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function al(m,o,h){const{maxSpeed:p,linearity:_,deceleration:x}=h,E=l.clamp(m*_/(o/1e3),-p,p),C=Math.abs(E)/(x*_);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class ar extends l.Event{constructor(o,h,p,_={}){const x=P.mousePos(h.getCanvasContainer(),p),E=h.unproject(x);super(o,l.extend({point:x,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ll extends l.Event{constructor(o,h,p){const _=o==="touchend"?p.changedTouches:p.touches,x=P.touchPos(h.getCanvasContainer(),_),E=x.map(M=>h.unproject(M)),C=x.reduce((M,k,D,N)=>M.add(k.div(N.length)),new l.pointGeometry(0,0));super(o,{points:x,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class lr extends l.Event{constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Eg{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new lr(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new ar(o.type,this._map,o))}mouseup(o){this._map.fire(new ar(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new ar(o.type,this._map,o))}dblclick(o){return this._firePreventable(new ar(o.type,this._map,o))}mouseover(o){this._map.fire(new ar(o.type,this._map,o))}mouseout(o){this._map.fire(new ar(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ll(o.type,this._map,o))}touchmove(o){this._map.fire(new ll(o.type,this._map,o))}touchend(o){this._map.fire(new ll(o.type,this._map,o))}touchcancel(o){this._map.fire(new ll(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qs{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ar(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new ar(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uf{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(P.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=P.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(_.x,p.x),E=Math.max(_.x,p.x),C=Math.min(_.y,p.y),M=Math.max(_.y,p.y);P.setTransform(this._box,`translate(${x}px,${C}px)`),this._box.style.width=E-x+"px",this._box.style.height=M-C+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,_=h;if(this.reset(),P.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new l.Event(o,{originalEvent:h}))}}function Ts(m,o){if(m.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${o.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=o[p];return h}class cl{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new l.pointGeometry(0,0);for(const E of _)x._add(E);return x.div(_.length)}(h),this.touches=Ts(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const _=Ts(p,h);for(const x in this.touches){const E=this.touches[x],C=_[x];(!C||C.dist(E)>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Nu{constructor(o){this.singleTap=new cl(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const _=this.singleTap.touchend(o,h,p);if(_){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Tg{constructor(){this._zoomIn=new Nu({numTouches:1,numTaps:2}),this._zoomOut=new Nu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const _=this._zoomIn.touchend(o,h,p),x=this._zoomOut.touchend(o,h,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Sg={0:1,2:2};class cc{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const p=P.mouseButton(o);this._correctButton(o,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(o,h){const p=this._lastPoint;if(p){if(o.preventDefault(),function(_,x){const E=Sg[x];return _.buttons===void 0||(_.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(o){this._lastPoint&&P.mouseButton(o)===this._eventButton&&(this._moved&&P.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ul extends cc{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class Ss extends cc{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const p=.8*(h.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class st extends cc{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const p=-.5*(h.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class hf{constructor(o,h){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const _=Ts(p,h),x=new l.pointGeometry(0,0),E=new l.pointGeometry(0,0);let C=0;for(const k in _){const D=_[k],N=this._touches[k];N&&(x._add(D),E._add(D.sub(N)),C++,_[k]=D)}if(this._touches=_,C<this._minTouches||!E.mag())return;const M=E.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,h,p){return{}}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[_,x]=this._firstTwoTouches,E=Zs(p,h,_),C=Zs(p,h,x);if(!E||!C)return;const M=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],M,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,E=Zs(p,h,_),C=Zs(p,h,x);E&&C||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zs(m,o,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return o[p]}function Uu(m,o){return Math.log(m/o)/Math.LN2}class Ke extends bo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Uu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uu(this._distance,p),pinchAround:h}}}function uc(m,o){return 180*m.angleWith(o)/Math.PI}class Ag extends bo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:uc(this._vector,p),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=uc(o,this._startVector);return Math.abs(p)<h}}function Vu(m){return Math.abs(m.y)>Math.abs(m.x)}class ju extends bo{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Vu(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,x,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,x=h.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==h.y>0;return Vu(o)&&Vu(h)&&E}}const df={panStep:100,bearingStep:15,pitchStep:10};class ff{constructor(){const o=df;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,_=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{const M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Pg,zoom:h?Math.round(M)+h*(o.shiftKey?2:1):M,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pg(m){return m*(2-m)}const pf=4.000244140625;class Gu{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%pf==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=P.mousePos(this._el,o);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>pf?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&M!==0&&(M=1/M);const k=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(k*M))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,_=this._easing;let x,E=!1;if(this._type==="wheel"&&p&&_){const C=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),M=_(C);x=l.number(p,h,M),C<1?this._frameId||(this._frameId=!0):E=!0}else x=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=l.bezier(E,C,.25,1)}return this._prevEase={start:l.exported.now(),duration:o,easing:h},h}reset(){this._active=!1}}class Wu{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hu{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $u{constructor(){this._tap=new Nu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,h,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,h,p))}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,h,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hi{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xs{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mf{constructor(o,h,p,_){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ca=m=>m.zoom||m.drag||m.pitch||m.rotate;class qu extends l.Event{}function hl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class gf{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cf(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,E]of this._listeners)P.addEventListener(_,x,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,h,p]of this._listeners)P.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Eg(h,o));const _=h.boxZoom=new uf(h,o);this._add("boxZoom",_);const x=new Tg,E=new Hu;h.doubleClickZoom=new Wu(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const C=new $u;this._add("tapDragZoom",C);const M=h.touchPitch=new ju(h);this._add("touchPitch",M);const k=new Ss(o),D=new st(o);h.dragRotate=new Xs(o,k,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const N=new ul(o),W=new hf(o,h);h.dragPan=new Hi(p,N,W),this._add("mousePan",N),this._add("touchPan",W,["touchZoom","touchRotate"]);const ie=new Ag,te=new Ke;h.touchZoomRotate=new mf(p,te,ie,C),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);const ne=h.scrollZoom=new Gu(h,this);this._add("scrollZoom",ne,["mousePan"]);const fe=h.keyboard=new ff;this._add("keyboard",fe),this._add("blockableMapEvent",new qs(h));for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[_e]&&h[_e].enable(o[_e])}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ca(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const _ in o)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}handleEvent(o,h){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=o.type==="renderFrame"?void 0:o,_={needsRenderFrame:!1},x={},E={},C=o.touches,M=C?this._getMapTouches(C):void 0,k=M?P.touchPos(this._el,M):P.mousePos(this._el,o);for(const{handlerName:W,handler:ie,allowed:te}of this._handlers){if(!ie.isEnabled())continue;let ne;this._blockedByActive(E,te,W)?ie.reset():ie[h||o.type]&&(ne=ie[h||o.type](o,k,M),this.mergeHandlerResult(_,x,ne,W,p),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||ie.isActive())&&(E[W]=ie)}const D={};for(const W in this._previousActiveHandlers)E[W]||(D[W]=p);this._previousActiveHandlers=E,(Object.keys(D).length||hl(_))&&(this._changes.push([_,x,D]),this._triggerRenderFrame()),(Object.keys(E).length||hl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=_;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(o,h,p,_,x){if(!p)return;l.extend(o,p);const E={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const o={},h={},p={};for(const[_,x,E]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),l.extend(h,x),l.extend(p,E);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const _=this._map,x=_.transform,E=_.style&&_.style.terrain;if(!(hl(o)||E&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:C,zoomDelta:M,bearingDelta:k,pitchDelta:D,around:N,pinchAround:W}=o;W!==void 0&&(N=W),_._stop(!0),N=N||_.transform.centerPoint;const ie=x.pointLocation(C?N.sub(C):N);k&&(x.bearing+=k),D&&(x.pitch+=D),M&&(x.zoom+=M),E?h.drag&&!this._drag?(this._drag={center:x.centerPoint,lngLat:x.pointLocation(N),point:N,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(x.center=x.pointLocation(x.centerPoint.sub(C))):x.setLocationAtPoint(ie,N),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const _=ca(this._eventsInProgress),x=ca(o),E={};for(const D in o){const{originalEvent:N}=o[D];this._eventsInProgress[D]||(E[`${D}start`]=N),this._eventsInProgress[D]=o[D]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const D in E)this._fireEvent(D,E[D]);x&&this._fireEvent("move",x.originalEvent);for(const D in o){const{originalEvent:N}=o[D];this._fireEvent(D,N)}const C={};let M;for(const D in this._eventsInProgress){const{handlerName:N,originalEvent:W}=this._eventsInProgress[D];this._handlersById[N].isActive()||(delete this._eventsInProgress[D],M=h[N]||W,C[`${D}end`]=M)}for(const D in C)this._fireEvent(D,C[D]);const k=ca(this._eventsInProgress);if(p&&(_||x)&&!k){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;D?(N(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:M})):(this._map.fire(new l.Event("moveend",{originalEvent:M})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new l.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new qu("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wr={extend:(m,...o)=>l.extend(m,...o),run(m){m()},logToElement(m,o=!1,h="log"){const p=window.document.getElementById(h);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class xn extends l.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=l.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,l.extend({offset:o},h),p)}panTo(o,h,p){return this.easeTo(l.extend({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(l.extend({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(l.extend({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,l.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=l.LngLatBounds.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,_){const x={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const we=_.padding;_.padding={top:we,bottom:we,right:we,left:we}}_.padding=l.extend(x,_.padding);const E=this.transform,C=E.padding,M=E.project(l.LngLat.convert(o)),k=E.project(l.LngLat.convert(h)),D=M.rotate(-p*Math.PI/180),N=k.rotate(-p*Math.PI/180),W=new l.pointGeometry(Math.max(D.x,N.x),Math.max(D.y,N.y)),ie=new l.pointGeometry(Math.min(D.x,N.x),Math.min(D.y,N.y)),te=W.sub(ie),ne=(E.width-(C.left+C.right+_.padding.left+_.padding.right))/te.x,fe=(E.height-(C.top+C.bottom+_.padding.top+_.padding.bottom))/te.y;if(fe<0||ne<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _e=Math.min(E.scaleZoom(E.scale*Math.min(ne,fe)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),re=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Te=xe.add(re).mult(E.scale/E.zoomScale(_e));return{center:E.unproject(M.add(k).div(2).sub(Te)),zoom:_e,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,_,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(o)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,x)}_fitInternal(o,h,p){return o?(delete(h=l.extend(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this.transform;let _=!1,x=!1,E=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=l.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(x=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(E=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),x&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),E&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(o,h,p,_=0){const x=l.MercatorCoordinate.fromLngLat(o,h),E=l.MercatorCoordinate.fromLngLat(p,_),C=E.x-x.x,M=E.y-x.y,k=E.z-x.z,D=Math.hypot(C,M,k);if(D===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(C,M),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),ie=180*Math.atan2(C,-M)/Math.PI;let te=180*Math.acos(N/D)/Math.PI;return te=k<0?90-te:90+te,{center:E.toLngLat(),zoom:W,pitch:te,bearing:ie}}easeTo(o,h){this._stop(!1,o.easeId),((o=l.extend({offset:[0,0],duration:500,easing:l.ease},o)).animate===!1||!o.essential&&l.exported.prefersReducedMotion)&&(o.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in o?+o.zoom:_,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,D="pitch"in o?+o.pitch:E,N="padding"in o?o.padding:p.padding,W=l.pointGeometry.convert(o.offset);let ie=p.centerPoint.add(W);const te=p.pointLocation(ie),ne=l.LngLat.convert(o.center||te);this._normalizeCenter(ne);const fe=p.project(te),_e=p.project(ne).sub(fe),xe=p.zoomScale(M-_);let re,Te;o.around&&(re=l.LngLat.convert(o.around),Te=p.locationPoint(re));const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==_,this._rotating=this._rotating||x!==k,this._pitching=this._pitching||D!==E,this._padding=!p.isPaddingEqual(N),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,we),this._ease(Le=>{if(this._zooming&&(p.zoom=l.number(_,M,Le)),this._rotating&&(p.bearing=l.number(x,k,Le)),this._pitching&&(p.pitch=l.number(E,D,Le)),this._padding&&(p.interpolatePadding(C,N,Le),ie=p.centerPoint.add(W)),re)p.setLocationAtPoint(re,Te);else{const ke=p.zoomScale(p.zoom-_),Be=M>_?Math.min(2,xe):Math.max(.5,xe),Ie=Math.pow(Be,1-Le),et=p.unproject(fe.add(_e.mult(Le*Ie)).mult(ke));p.setLocationAtPoint(p.renderWorldCopies?et.wrap():et,ie)}this._fireMoveEvents(h)},Le=>{this._afterEase(h,Le)},o),this}_prepareEase(o,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new l.Event("move",o)),this._zooming&&this.fire(new l.Event("zoom",o)),this._rotating&&this.fire(new l.Event("rotate",o)),this._pitching&&this.fire(new l.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",o)),_&&this.fire(new l.Event("rotateend",o)),x&&this.fire(new l.Event("pitchend",o)),this.fire(new l.Event("moveend",o))}flyTo(o,h){if(!o.essential&&l.exported.prefersReducedMotion){const _t=l.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_t,h)}this.stop(),o=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},o);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in o?l.clamp(+o.zoom,p.minZoom,p.maxZoom):_,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,D="pitch"in o?+o.pitch:E,N="padding"in o?o.padding:p.padding,W=p.zoomScale(M-_),ie=l.pointGeometry.convert(o.offset);let te=p.centerPoint.add(ie);const ne=p.pointLocation(te),fe=l.LngLat.convert(o.center||ne);this._normalizeCenter(fe);const _e=p.project(ne),xe=p.project(fe).sub(_e);let re=o.curve;const Te=Math.max(p.width,p.height),we=Te/W,Le=xe.mag();if("minZoom"in o){const _t=l.clamp(Math.min(o.minZoom,_,M),p.minZoom,p.maxZoom),sn=Te/p.zoomScale(_t-_);re=Math.sqrt(sn/Le*2)}const ke=re*re;function Be(_t){const sn=(we*we-Te*Te+(_t?-1:1)*ke*ke*Le*Le)/(2*(_t?we:Te)*ke*Le);return Math.log(Math.sqrt(sn*sn+1)-sn)}function Ie(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function et(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const qe=Be(0);let nt=function(_t){return et(qe)/et(qe+re*_t)},Lt=function(_t){return Te*((et(qe)*(Ie(sn=qe+re*_t)/et(sn))-Ie(qe))/ke)/Le;var sn},Dt=(Be(1)-qe)/re;if(Math.abs(Le)<1e-6||!isFinite(Dt)){if(Math.abs(Te-we)<1e-6)return this.easeTo(o,h);const _t=we<Te?-1:1;Dt=Math.abs(Math.log(we/Te))/re,Lt=function(){return 0},nt=function(sn){return Math.exp(_t*re*sn)}}return o.duration="duration"in o?+o.duration:1e3*Dt/("screenSpeed"in o?+o.screenSpeed/re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=x!==k,this._pitching=D!==E,this._padding=!p.isPaddingEqual(N),this._prepareEase(h,!1),this._ease(_t=>{const sn=_t*Dt,on=1/nt(sn);p.zoom=_t===1?M:_+p.scaleZoom(on),this._rotating&&(p.bearing=l.number(x,k,_t)),this._pitching&&(p.pitch=l.number(E,D,_t)),this._padding&&(p.interpolatePadding(C,N,_t),te=p.centerPoint.add(ie));const Ht=_t===1?fe:p.unproject(_e.add(xe.mult(Lt(sn))).mult(on));p.setLocationAtPoint(p.renderWorldCopies?Ht.wrap():Ht,te),this._fireMoveEvents(h)},()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=l.wrap(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}}class dl{constructor(o={}){this.options=o,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const x=h[_];if(x.used||x.usedForTerrain){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(_=>String(_).trim()),o.sort((_,x)=>_.length-x.length),o=o.filter((_,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(_)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class hc{constructor(o={}){this.options=o,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=P.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class _f{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const yf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},vf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Cg={showCompass:!0,showZoom:!0,visualizePitch:!1};class ls{constructor(o,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Ss({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new st({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),P.addEventListener(h,"mousedown",this.mousedown),P.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(h,"touchmove",this.touchmove),P.addEventListener(h,"touchend",this.touchend),P.addEventListener(h,"touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),P.disableDrag()}move(o,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(o,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,h);x&&x.pitchDelta&&p.setPitch(p.getPitch()+x.pitchDelta)}}off(){const o=this.element;P.removeEventListener(o,"mousedown",this.mousedown),P.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(o,"touchmove",this.touchmove),P.removeEventListener(o,"touchend",this.touchend),P.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(l.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),P.mousePos(this.element,o)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,P.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function fl(m,o,h){if(m=new l.LngLat(m.lng,m.lat),o){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),x=h.locationPoint(m).distSqr(o);h.locationPoint(p).distSqr(o)<x?m=p:h.locationPoint(_).distSqr(o)<x&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const ht={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wt(m,o,h){const p=m.classList;for(const _ in ht)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${o}`,`mapboxgl-${h}-anchor-${o}`)}class ua extends l.Evented{constructor(o,h){if(super(),(o instanceof HTMLElement||h)&&(o=l.extend({element:o},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=l.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const p=P.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${x}px`),p.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const E=P.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const C=P.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const M=P.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of k){const re=P.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",xe.rx),re.setAttributeNS(null,"ry",xe.ry),M.appendChild(re)}const D=P.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const N=P.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(N);const W=P.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const ie=P.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(ie);const te=P.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ne=P.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const fe=P.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#000000"),fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962");const _e=P.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),ne.appendChild(fe),ne.appendChild(_e),C.appendChild(M),C.appendChild(D),C.appendChild(W),C.appendChild(te),C.appendChild(ne),p.appendChild(C),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),wt(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const h=o.code,p=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=fl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${ht[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=l.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Zu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ys,pi=0,Ks=!1;const cs={maxWidth:100,unit:"metric"};function xf(m,o,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,x=m.unproject([0,_]),E=m.unproject([p,_]),C=x.distanceTo(E);if(h&&h.unit==="imperial"){const M=3.2808*C;M>5280?Js(o,p,M/5280,m._getUIString("ScaleControl.Miles")):Js(o,p,M,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Js(o,p,C/1852,m._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Js(o,p,C/1e3,m._getUIString("ScaleControl.Kilometers")):Js(o,p,C,m._getUIString("ScaleControl.Meters"))}function Js(m,o,h,p){const _=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const k=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*k)/k}(C),E*C}(h);m.style.width=o*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xu(m){if(m){if(typeof m=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(o,o),"top-right":new l.pointGeometry(-o,o),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(o,-o),"bottom-right":new l.pointGeometry(-o,-o),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const o=l.pointGeometry.convert(m);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return Xu(new l.pointGeometry(0,0))}const wo={supported:y,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends xn{constructor(m){var o;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},vf,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new _f,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},yf,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(o=m.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new B(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gf(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new sf(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new dl({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new hc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,o,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,o,h,p)}resize(m){const o=this._containerDimensions(),h=o[0],p=o[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[o,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(o,h,m),this.painter.resize(o,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,o,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:x=>{const E=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];E.length?p||(p=!0,h.call(this,new ar(m,this,x.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new ar(m,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new ar(m,this,E.originalEvent)))}}}}{const p=_=>{const x=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];x.length&&(_.features=x,h.call(this,_),delete _.features)};return{layer:o,listener:h,delegates:{[m]:p}}}}on(m,o,h){if(h===void 0)return super.on(m,o);const p=this._createDelegatedListener(m,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,o,h){if(h===void 0)return super.once(m,o);const p=this._createDelegatedListener(m,o,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,o,h){return h===void 0?super.off(m,o):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let x=0;x<_.length;x++){const E=_[x];if(E.layer===o&&E.listener===h){for(const C in E.delegates)this.off(C,E.delegates[C]);return _.splice(x,1),this}}})(),this)}queryRenderedFeatures(m,o){if(!this.style)return[];let h;if(o!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(o=m,m=void 0),o=o||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}setStyle(m,o){return(o=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(m,o))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Jn(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Jn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,o)})}else typeof m=="object"&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style.sourceCaches[m];if(o!==void 0)return o.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const o in m){const h=m[o]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,o,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||l.isImageBitmap(o)){const{width:C,height:M,data:k}=l.exported.getImageData(o);this.style.addImage(m,{data:new l.RGBAImage({width:C,height:M},k),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:M,data:k}=o,D=o;this.style.addImage(m,{data:new l.RGBAImage({width:C,height:M},new Uint8Array(k)),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0,userImage:D}),D.onAdd&&D.onAdd(this,m)}}}updateImage(m,o){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||l.isImageBitmap(o)?l.exported.getImageData(o):o,{width:_,height:x,data:E}=p;if(_===void 0||x===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||x!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(o instanceof HTMLImageElement||l.isImageBitmap(o));h.data.replace(E,C),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,h){return this.style.setLayerZoomRange(m,o,h),this._update(!0)}setFilter(m,o,h={}){return this.style.setFilter(m,o,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,h,p={}){return this.style.setPaintProperty(m,o,h,p),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,h,p={}){return this.style.setLayoutProperty(m,o,h,p),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,o=0;return this._container&&(m=this._container.clientWidth||400,o=this._container.clientHeight||300),[m,o]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=P.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=P.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=P.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=P.create("div","maplibregl-cooperative-gesture-screen",m);let o="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,o,h){this._canvas.width=h*m,this._canvas.height=h*o,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const m=l.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(this.painter=new Bu(o,this.transform),l.exported$1.testSupport(o)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,o,h){return!o&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let o,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,o),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,C=l.exported.now();this.style.zoomHistory.update(E,C);const M=new l.EvaluationParameters(E,{now:C,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=M.crossFadingFactor();k===1&&k===this._crossFadingFactor||(_=!0,this._crossFadingFactor=k),this.style.update(M)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,o),setTimeout(()=>{const C=p.getQueryObjectEXT(o,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(o),this.fire(new l.Event("gpu-timing-frame",{cpuTime:E,gpuTime:C}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(E);this.fire(new l.Event("gpu-timing-layer",{layerTimes:C}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._cooperativeGestures&&P.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){l.setCacheLimits(m,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},Cg,m),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ls(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const h=P.create("button",m,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(m,o){const h=this._map._getUIString(`NavigationControl.${o}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},Zu,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var o;return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,Ys!==void 0?o(Ys):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ys=h.state!=="denied",o(Ys)}):(Ys=!!window.navigator.geolocation,o(Ys)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pi=0,Ks=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),h=m.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,o=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=o.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Ks)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ua(this._dotElement),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ua({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pi--,Ks=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pi++,pi>1?(m={maximumAge:6e5,timeout:0},Ks=!0):(m=this.options.positionOptions,Ks=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dl,LogoControl:hc,ScaleControl:class{constructor(m){this.options=l.extend({},cs,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){xf(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,xf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(kn),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=P.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=Xu(this.options.offset);if(!h){const x=this._container.offsetWidth,E=this._container.offsetHeight;let C;C=o.y+p.bottom.y<E?["top"]:o.y>this._map.transform.height-E?["bottom"]:[],o.x<x/2?C.push("left"):o.x>this._map.transform.width-x/2&&C.push("right"),h=C.length===0?"bottom":C.join("-")}const _=o.add(p[h]).round();P.setTransform(this._container,`${ht[h]} translate(${_.x}px,${_.y}px)`),wt(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Hn);m&&m.focus()}_onClose(){this.remove()}},Marker:ua,Style:Jn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:nn,GeoJSONSource:xi,ImageSource:Et,RasterDEMTileSource:xt,RasterTileSource:kt,VectorTileSource:St,VideoSource:Pt,prewarm:function(){di().acquire(Li)},clearPrewarmedResources:function(){const m=ji;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Li),ji=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Yn.workerCount},set workerCount(m){Yn.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,o){l.config.REGISTERED_PROTOCOLS[m]=o},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return wr.extend(wo,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),wo});var d=s;return d})})(VS);var Ck=VS.exports;const Ik=Om(Ck);function _m(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Wv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),mw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);mw&&parseFloat(mw[1]);const Mk="3.4.15";function Wo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Op=typeof process!="object"||String(process)!=="[object process]"||process.browser,Lk=typeof window<"u"&&typeof window.orientation<"u",gw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);gw&&parseFloat(gw[1]);function fd(t){"@babel/helpers - typeof";return fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fd(t)}function kk(t,e){if(fd(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(fd(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Rk(t){var e=kk(t,"string");return fd(e)=="symbol"?e:String(e)}function U(t,e,n){return e=Rk(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class zk{constructor(e,n){U(this,"name",void 0),U(this,"workerThread",void 0),U(this,"isRunning",!0),U(this,"result",void 0),U(this,"_resolve",()=>{}),U(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Wo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Wo(this.isRunning),this.isRunning=!1,this._reject(e)}}let U_=class{terminate(){}};const V_=new Map;function Dk(t){Wo(t.source&&!t.url||!t.source&&t.url);let e=V_.get(t.source||t.url);return e||(t.url&&(e=Ok(t.url),V_.set(t.url,e)),t.source&&(e=GS(t.source),V_.set(t.source,e))),Wo(e),e}function Ok(t){if(!t.startsWith("http"))return t;const e=Fk(t);return GS(e)}function GS(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Fk(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function WS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(_w(t))i.add(t);else if(_w(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)WS(t[s],e,i)}}return n===void 0?Array.from(i):[]}function _w(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const j_=()=>{};class p0{static isSupported(){return typeof Worker<"u"&&Op||typeof U_<"u"&&!Op}constructor(e){U(this,"name",void 0),U(this,"source",void 0),U(this,"url",void 0),U(this,"terminated",!1),U(this,"worker",void 0),U(this,"onMessage",void 0),U(this,"onError",void 0),U(this,"_loadableURL","");const{name:n,source:i,url:s}=e;Wo(i||s),this.name=n,this.source=i,this.url=s,this.onMessage=j_,this.onError=c=>console.log(c),this.worker=Op?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=j_,this.onError=j_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||WS(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=Dk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new U_(i,{eval:!1})}else if(this.source)e=new U_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Bk{static isSupported(){return p0.isSupported()}constructor(e){U(this,"name","unnamed"),U(this,"source",void 0),U(this,"url",void 0),U(this,"maxConcurrency",1),U(this,"maxMobileConcurrency",1),U(this,"onDebug",()=>{}),U(this,"reuseWorkers",!0),U(this,"props",{}),U(this,"jobQueue",[]),U(this,"idleQueue",[]),U(this,"count",0),U(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(c,d,l)=>c.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(c,d)=>c.error(d);const s=new Promise(c=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:c}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new zk(n.name,e);e.onMessage=s=>n.onMessage(i,s.type,s.payload),e.onError=s=>n.onError(i,s),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new p0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Lk?this.maxMobileConcurrency:this.maxConcurrency}}const Nk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Oo{static isSupported(){return p0.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Oo._workerFarm=Oo._workerFarm||new Oo({}),Oo._workerFarm.setProps(e),Oo._workerFarm}constructor(e){U(this,"props",void 0),U(this,"workerPools",new Map),this.props={...Nk},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:s}=e;let c=this.workerPools.get(n);return c||(c=new Bk({name:n,source:i,url:s}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}U(Oo,"_workerFarm",void 0);const Uk="latest";function Vk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(s="modules/".concat(t.module,"/dist/").concat(i)),!s){let c=t.version;c==="latest"&&(c=Uk);const d=c?"@".concat(c):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(d,"/dist/").concat(i)}return Wo(s),s}function jk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mk;Wo(t,"no worker provided");const n=t.version;return!(!e||!n)}function Gk(t,e){return!Oo.isSupported()||!Op&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Wk(t,e,n,i,s){const c=t.id,d=Vk(t,n),y=Oo.getWorkerFarm(n).getWorkerPool({name:c,url:d});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const w=await y.startJob("process-on-worker",Hk.bind(null,s));return w.postMessage("process",{input:e,options:n,context:i}),await(await w.result).result}async function Hk(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:c,options:d}=i;try{const l=await t(c,d);e.postMessage("done",{id:s,result:l})}catch(l){const y=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:s,error:y})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function $k(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),s=new Uint8Array(e);for(let c=0;c<i.length;++c)if(i[c]!==s[c])return!1;return!0}function qk(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),s=i.reduce((l,y)=>l+y.byteLength,0),c=new Uint8Array(s);let d=0;for(const l of i)c.set(l,d),d+=l.byteLength;return c.buffer}async function Zk(t){const e=[];for await(const n of t)e.push(n);return qk(...e)}function yw(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class vw{constructor(e,n){U(this,"name",void 0),U(this,"type",void 0),U(this,"sampleSize",1),U(this,"time",void 0),U(this,"count",void 0),U(this,"samples",void 0),U(this,"lastTiming",void 0),U(this,"lastSampleTime",void 0),U(this,"lastSampleCount",void 0),U(this,"_count",0),U(this,"_time",0),U(this,"_samples",0),U(this,"_startTime",0),U(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=yw(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(yw()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Hv{constructor(e){U(this,"id",void 0),U(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof vw?this.stats[n]=e:this.stats[n]=new vw(n,i)),this.stats[n]}}let Xk="";const xw={};function Yk(t){for(const e in xw)if(t.startsWith(e)){const n=xw[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Xk).concat(t)),t}function Kk(t){return t&&typeof t=="object"&&t.isBuffer}function HS(t){if(Kk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function $S(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Jk(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Qk=t=>typeof t=="boolean",$h=t=>typeof t=="function",Id=t=>t!==null&&typeof t=="object",bw=t=>Id(t)&&t.constructor==={}.constructor,e3=t=>t&&typeof t[Symbol.iterator]=="function",t3=t=>t&&typeof t[Symbol.asyncIterator]=="function",ql=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Zl=t=>typeof Blob<"u"&&t instanceof Blob,n3=t=>t&&typeof t=="object"&&t.isBuffer,i3=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Id(t)&&$h(t.tee)&&$h(t.cancel)&&$h(t.getReader),r3=t=>Id(t)&&$h(t.read)&&$h(t.pipe)&&Qk(t.readable),qS=t=>i3(t)||r3(t),s3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,o3=/^([-\w.]+\/[-\w.+]+)/;function a3(t){const e=o3.exec(t);return e?e[1]:t}function ww(t){const e=s3.exec(t);return e?e[1]:""}const ZS=/\?.*/;function l3(t){const e=t.match(ZS);return e&&e[0]}function $v(t){return t.replace(ZS,"")}function Qm(t){return ql(t)?t.url:Zl(t)?t.name||"":typeof t=="string"?t:""}function qv(t){if(ql(t)){const e=t,n=e.headers.get("content-type")||"",i=$v(e.url);return a3(n)||ww(i)}return Zl(t)?t.type||"":typeof t=="string"?ww(t):""}function c3(t){return ql(t)?t.headers["content-length"]||-1:Zl(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function XS(t){if(ql(t))return t;const e={},n=c3(t);n>=0&&(e["content-length"]=String(n));const i=Qm(t),s=qv(t);s&&(e["content-type"]=s);const c=await d3(t);c&&(e["x-first-bytes"]=c),typeof t=="string"&&(t=new TextEncoder().encode(t));const d=new Response(t,{headers:e});return Object.defineProperty(d,"url",{value:i}),d}async function u3(t){if(!t.ok){const e=await h3(t);throw new Error(e)}}async function h3(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function d3(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=c=>{var d;return i(c==null||(d=c.target)===null||d===void 0?void 0:d.result)},s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=f3(n);return"data:base64,".concat(i)}return null}function f3(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function Ew(t,e){if(typeof t=="string"){t=Yk(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await XS(t)}function YS(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Zo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||YS()}const Fp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},ap=Fp.window||Fp.self||Fp.global,Eh=Fp.process||{},KS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Zo();const G_=globalThis;function JS(t){if(!t&&!Zo())return"Node";if(YS(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s?"IE":G_.chrome?"Chrome":G_.safari?"Safari":G_.mozInnerScreenX?"Firefox":"Unknown"}function p3(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class m3{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";U(this,"storage",void 0),U(this,"id",void 0),U(this,"config",void 0),this.storage=p3(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function g3(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function _3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function W_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(s,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let ym;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ym||(ym={}));function Tw(t){return typeof t=="string"?ym[t.toUpperCase()]||ym.WHITE:t}function y3(t,e,n){return!Zo&&typeof t=="string"&&(e&&(e=Tw(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=Tw(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function v3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const s of i)typeof t[s]=="function"&&(e.find(c=>s===c)||(t[s]=t[s].bind(t)))}function vm(t,e){if(!t)throw new Error(e||"Assertion failed")}function Tc(){let t;if(Zo&&"performance"in ap){var e,n;t=ap==null||(e=ap.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Eh){var i;const s=Eh==null||(i=Eh.hrtime)===null||i===void 0?void 0:i.call(Eh);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Sc={debug:Zo&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},x3={enabled:!0,level:0};function ps(){}const Sw={},Aw={once:!0};class Md{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};U(this,"id",void 0),U(this,"VERSION",KS),U(this,"_startTs",Tc()),U(this,"_deltaTs",Tc()),U(this,"_storage",void 0),U(this,"userData",{}),U(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new m3("__probe-".concat(this.id,"__"),x3),this.timeStamp("".concat(this.id," started")),v3(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Tc()-this._startTs).toPrecision(10))}getDelta(){return Number((Tc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){vm(e,n)}warn(e){return this._getLogFunction(0,e,Sc.warn,arguments,Aw)}error(e){return this._getLogFunction(0,e,Sc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Sc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Sc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return this._getLogFunction(e,n,Sc.debug||Sc.info,arguments,Aw)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ps,i&&[i],{tag:T3(n)}):ps}image(e){let{logLevel:n,priority:i,image:s,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?Zo?E3({image:s,message:c,scale:d}):w3():ps}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ps)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=Pw({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return s.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ps)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=QS(e)}_getLogFunction(e,n,i,s,c){if(this._shouldLog(e)){c=Pw({logLevel:e,message:n,args:s,opts:c}),i=i||c.method,vm(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Tc();const d=c.tag||c.message;if(c.once)if(!Sw[d])Sw[d]=Tc();else return ps;return n=b3(this.id,c.message,c),i.bind(console,n,...c.args)}return ps}}U(Md,"VERSION",KS);function QS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return vm(Number.isFinite(e)&&e>=0),e}function Pw(t){const{logLevel:e,message:n}=t;t.logLevel=QS(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return vm(s==="string"||s==="object"),Object.assign(t,{args:i},t.opts)}function b3(t,e,n){if(typeof e=="string"){const i=n.time?_3(g3(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=y3(e,n.color,n.background)}return e}function w3(t){return console.warn("removed"),ps}function E3(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=W_(c,n,i);console.log(...d)},c.src=e,ps}const s=e.nodeName||"";if(s.toLowerCase()==="img")return console.log(...W_(e,n,i)),ps;if(s.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...W_(c,n,i)),c.src=e.toDataURL(),ps}return ps}function T3(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Cw=new Md({id:"loaders.gl"});class S3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class A3{constructor(){U(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const eA={fetch:null,mimeType:void 0,nothrow:!1,log:new A3,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Wv,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},P3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function tA(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const nA=()=>{const t=tA();return t.globalOptions=t.globalOptions||{...eA},t.globalOptions};function C3(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],I3(t,n),L3(e,t,i)}function I3(t,e){Iw(t,null,eA,P3,e);for(const n of e){const i=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},c=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Iw(i,n.id,s,c,e)}}function Iw(t,e,n,i,s){const c=e||"Top level",d=e?"".concat(e,"."):"";for(const l in t){const y=!e&&Id(t[l]),w=l==="baseUri"&&!e,S=l==="workerUrl"&&e;if(!(l in n)&&!w&&!S){if(l in i)Cw.warn("".concat(c," loader option '").concat(d).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!y){const I=M3(l,s);Cw.warn("".concat(c," loader option '").concat(d).concat(l,"' not recognized. ").concat(I))()}}}}function M3(t,e){const n=t.toLowerCase();let i="";for(const s of e)for(const c in s.options){if(t===c)return"Did you mean '".concat(s.id,".").concat(c,"'?");const d=c.toLowerCase();(n.startsWith(d)||d.startsWith(n))&&(i=i||"Did you mean '".concat(s.id,".").concat(c,"'?"))}return i}function L3(t,e,n){const s={...t.options||{}};return k3(s,n),s.log===null&&(s.log=new S3),Mw(s,nA()),Mw(s,e),s}function Mw(t,e){for(const n in e)if(n in e){const i=e[n];bw(i)&&bw(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function k3(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Zv(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Xv(t){var e,n;_m(t,"null loader"),_m(Zv(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const iA=()=>{const t=tA();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function R3(t){const e=iA();t=Array.isArray(t)?t:[t];for(const n of t){const i=Xv(n);e.find(s=>i===s)||e.unshift(i)}}function z3(){return iA()}const D3=new Md({id:"loaders.gl"}),O3=/\.([^.]+)$/;async function F3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!rA(t))return null;let s=Lw(t,e,{...n,nothrow:!0},i);if(s)return s;if(Zl(t)&&(t=await t.slice(0,10).arrayBuffer(),s=Lw(t,e,n,i)),!s&&!(n!=null&&n.nothrow))throw new Error(sA(t));return s}function Lw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!rA(t))return null;if(e&&!Array.isArray(e))return Xv(e);let s=[];e&&(s=s.concat(e)),n!=null&&n.ignoreRegisteredLoaders||s.push(...z3()),N3(s);const c=B3(t,s,n,i);if(!c&&!(n!=null&&n.nothrow))throw new Error(sA(t));return c}function B3(t,e,n,i){const s=Qm(t),c=qv(t),d=$v(s)||(i==null?void 0:i.url);let l=null,y="";if(n!=null&&n.mimeType&&(l=H_(e,n==null?void 0:n.mimeType),y="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||U3(e,d),y=y||(l?"matched url ".concat(d):""),l=l||H_(e,c),y=y||(l?"matched MIME type ".concat(c):""),l=l||j3(e,t),y=y||(l?"matched initial data ".concat(oA(t)):""),l=l||H_(e,n==null?void 0:n.fallbackMimeType),y=y||(l?"matched fallback MIME type ".concat(c):""),y){var w;D3.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(y,"."))}return l}function rA(t){return!(t instanceof Response&&t.status===204)}function sA(t){const e=Qm(t),n=qv(t);let i="No valid loader found (";i+=e?"".concat($S(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=t?oA(t):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function N3(t){for(const e of t)Xv(e)}function U3(t,e){const n=e&&O3.exec(e),i=n&&n[1];return i?V3(t,i):null}function V3(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function H_(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function j3(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(G3(e,n))return n}else if(ArrayBuffer.isView(e)){if(kw(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&kw(e,0,n))return n;return null}function G3(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function kw(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>W3(t,e,n,s))}function W3(t,e,n,i){if(i instanceof ArrayBuffer)return $k(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const s=m0(t,e,i.length);return i===s;default:return!1}}function oA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?m0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?m0(t,0,e):""}function m0(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let s="";for(let c=0;c<n;c++)s+=String.fromCharCode(i.getUint8(e+c));return s}const H3=256*1024;function*$3(t,e){const n=(e==null?void 0:e.chunkSize)||H3;let i=0;const s=new TextEncoder;for(;i<t.length;){const c=Math.min(t.length-i,n),d=t.slice(i,i+c);i+=c,yield s.encode(d)}}const q3=256*1024;function Z3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=q3}=e;let i=0;for(;i<t.byteLength;){const s=Math.min(t.byteLength-i,n),c=new ArrayBuffer(s),d=new Uint8Array(t,i,s);new Uint8Array(c).set(d),i+=s,yield c}}()}const X3=1024*1024;async function*Y3(t,e){const n=(e==null?void 0:e.chunkSize)||X3;let i=0;for(;i<t.size;){const s=i+n,c=await t.slice(i,s).arrayBuffer();i=s,yield c}}function Rw(t,e){return Wv?K3(t,e):J3(t)}async function*K3(t,e){const n=t.getReader();let i;try{for(;;){const s=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:c,value:d}=await s;if(c)return;yield HS(d)}}catch{n.releaseLock()}}async function*J3(t,e){for await(const n of t)yield HS(n)}function Q3(t,e){if(typeof t=="string")return $3(t,e);if(t instanceof ArrayBuffer)return Z3(t,e);if(Zl(t))return Y3(t,e);if(qS(t))return Rw(t,e);if(ql(t))return Rw(t.body,e);throw new Error("makeIterator")}const aA="Cannot convert supplied data type";function eR(t,e,n){if(e.text&&typeof t=="string")return t;if(n3(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+s)),i}throw new Error(aA)}async function tR(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return eR(t,e);if(Zl(t)&&(t=await XS(t)),ql(t)){const s=t;return await u3(s),e.binary?await s.arrayBuffer():await s.text()}if(qS(t)&&(t=Q3(t,n)),e3(t)||t3(t))return Zk(t);throw new Error(aA)}function lA(t,e){const n=nA(),i=t||n;return typeof i.fetch=="function"?i.fetch:Id(i.fetch)?s=>Ew(s,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Ew}function nR(t,e,n){if(n)return n;const i={fetch:lA(e,t),...t};if(i.url){const s=$v(i.url);i.baseUrl=s,i.queryString=l3(i.url),i.filename=$S(s),i.baseUrl=Jk(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function iR(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Yv(t,e,n,i){Wo(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Zv(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const s=Qm(t),d=iR(e,i),l=await F3(t,d,n);return l?(n=C3(n,l,d,s),i=nR({url:s,parse:Yv,loaders:d},n,i||null),await rR(l,t,n,i)):null}async function rR(t,e,n,i){if(jk(t),ql(e)){const s=e,{ok:c,redirected:d,status:l,statusText:y,type:w,url:S}=s,I=Object.fromEntries(s.headers.entries());i.response={headers:I,ok:c,redirected:d,status:l,statusText:y,type:w,url:S}}if(e=await tR(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(Gk(t,n))return await Wk(t,e,n,i,Yv);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Wo(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function xm(t,e,n,i){!Array.isArray(e)&&!Zv(e)&&(n=e,e=void 0);const s=lA(n);let c=t;return typeof t=="string"&&(c=await s(t)),Zl(t)&&(c=await s(t)),await Yv(c,e,n)}const sR="3.4.15",{_parseImageNode:oR}=globalThis,g0=typeof Image<"u",_0=typeof ImageBitmap<"u",aR=!!oR,y0=Wv?!0:aR;function lR(t){switch(t){case"auto":return _0||g0||y0;case"imagebitmap":return _0;case"image":return g0;case"data":return y0;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function cR(){if(_0)return"imagebitmap";if(g0)return"image";if(y0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function uR(t){const e=dR(t);if(!e)throw new Error("Not an image");return e}function hR(t){switch(uR(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function dR(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const fR=/^data:image\/svg\+xml/,pR=/\.svg((\?|#).*)?$/;function Kv(t){return t&&(fR.test(t)||pR.test(t))}function mR(t,e){if(Kv(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(c){throw new Error(c.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return cA(t,e)}function cA(t,e){if(Kv(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function uA(t,e,n){const i=mR(t,n),s=self.URL||self.webkitURL,c=typeof i!="string"&&s.createObjectURL(i);try{return await gR(c||i,e)}finally{c&&s.revokeObjectURL(c)}}async function gR(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,s)=>{try{n.onload=()=>i(n),n.onerror=c=>s(new Error("Could not load image ".concat(t,": ").concat(c)))}catch(c){s(c)}})}const _R={};let zw=!0;async function yR(t,e,n){let i;Kv(n)?i=await uA(t,e,n):i=cA(t,n);const s=e&&e.imagebitmap;return await vR(i,s)}async function vR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((xR(e)||!zw)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),zw=!1}return await createImageBitmap(t)}function xR(t){for(const e in t||_R)return!1;return!0}function bR(t){return!SR(t,"ftyp",4)||!(t[8]&96)?null:wR(t)}function wR(t){switch(ER(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function ER(t,e,n){return String.fromCharCode(...t.slice(e,n))}function TR(t){return[...t].map(e=>e.charCodeAt(0))}function SR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=TR(e);for(let s=0;s<i.length;++s)if(i[s]!==t[s+n])return!1;return!0}const lo=!1,qh=!0;function hA(t){const e=Ld(t);return PR(e)||MR(e)||CR(e)||IR(e)||AR(e)}function AR(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=bR(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function PR(t){const e=Ld(t);return e.byteLength>=24&&e.getUint32(0,lo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,lo),height:e.getUint32(20,lo)}:null}function CR(t){const e=Ld(t);return e.byteLength>=10&&e.getUint32(0,lo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,qh),height:e.getUint16(8,qh)}:null}function IR(t){const e=Ld(t);return e.byteLength>=14&&e.getUint16(0,lo)===16973&&e.getUint32(2,qh)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,qh),height:e.getUint32(22,qh)}:null}function MR(t){const e=Ld(t);if(!(e.byteLength>=3&&e.getUint16(0,lo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=LR();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,lo);if(s.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,lo),width:e.getUint16(c+7,lo)};if(!i.has(d))return null;c+=2,c+=e.getUint16(c,lo)}return null}function LR(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ld(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function kR(t,e){const{mimeType:n}=hA(t)||{},i=globalThis._parseImageNode;return _m(i),await i(t,n)}async function RR(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:c}=n||{},d=zR(s);let l;switch(d){case"imagebitmap":l=await yR(t,e,c);break;case"image":l=await uA(t,e,c);break;case"data":l=await kR(t);break;default:_m(!1)}return s==="data"&&(l=hR(l)),l}function zR(t){switch(t){case"auto":case"data":return cR();default:return lR(t),t}}const DR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],OR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],FR={image:{type:"auto",decode:!0}},BR={id:"image",module:"images",name:"Images",version:sR,mimeTypes:OR,extensions:DR,parse:RR,tests:[t=>!!hA(new DataView(t))],options:FR},Zt=new Md({id:"deck"});let v0={};function NR(t){v0=t}function Qi(t,e,n,i){Zt.level>0&&v0[t]&&v0[t].call(null,e,n,i)}function UR(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const VR={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:UR,parseTextSync:JSON.parse};function jR(){const t="8.9.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(Zt.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Zt,_registerLoggers:NR},R3([VR,[BR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const GR=jR(),cn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(cn,"IDENTITY",{get:()=>(Zt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const co={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Bl={common:0,meters:1,pixels:2},Dw={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Tt=new Md({id:"luma.gl"});function mr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const WR="Invalid WebGLRenderingContext",HR="Requires WebGL2";function eg(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Yt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function $R(t){return Yt(t)?t:null}function tg(t){return mr(eg(t),WR),t}function tr(t){return mr(Yt(t),HR),t}const zh={};function qR(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function ZR(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function XR(t,e){zh[t]=!0,e!==void 0&&qR(e)}function YR(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(zh[i]=!0);while(i!==0);for(i in zh)if(zh[i])return delete zh[i],parseInt(i,10);return 0}}const kd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const s=new t.VertexAttrib(n);this.attribs[i]=s}this.maxAttrib=0};kd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};kd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Xl=function(e){const n=this;this.gl=e,YR(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(c){return c===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(c,d){switch(c){case 34962:n.currentArrayBuffer=d;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=d;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(c,d){const y=n.currentVertexArrayObject.attribs[c];switch(d){case 34975:return y.buffer;case 34338:return y.enabled;case 34339:return y.size;case 34340:return y.stride;case 34341:return y.type;case 34922:return y.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(c,d,l,y,w,S){const I=n.currentVertexArrayObject;I.maxAttrib=Math.max(I.maxAttrib,c);const P=I.attribs[c];return P.buffer=n.currentArrayBuffer,P.size=d,P.type=l,P.normalized=y,P.stride=w,P.offset=S,P.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{ZR("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Xl.prototype.VERTEX_ARRAY_BINDING_OES=34229;Xl.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new kd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Xl.prototype.createVertexArrayOES=function(){const e=new kd(this);return this.vertexArrayObjects.push(e),e};Xl.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Xl.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof kd&&e.hasBeenBound&&e.ext===this)};Xl.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){XR(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,s=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const c=this.currentVertexArrayObject;if(s===c)return;(!s||c.elementArrayBuffer!==s.elementArrayBuffer)&&i.bindBuffer.call(n,34963,c.elementArrayBuffer);let d=this.currentArrayBuffer;const l=Math.max(s?s.maxAttrib:0,c.maxAttrib);for(let y=0;y<=l;y++){const w=c.attribs[y],S=s?s.attribs[y]:null;if((!s||w.enabled!==S.enabled)&&(w.enabled?i.enableVertexAttribArray.call(n,y):i.disableVertexAttribArray.call(n,y)),w.enabled){let I=!1;(!s||w.buffer!==S.buffer)&&(d!==w.buffer&&(i.bindBuffer.call(n,34962,w.buffer),d=w.buffer),I=!0),(I||w.cached!==S.cached)&&i.vertexAttribPointer.call(n,y,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==d&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function KR(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=e.call(this)||[];return s.indexOf("OES_vertex_array_object")<0&&s.push("OES_vertex_array_object"),s};const n=t.getExtension;t.getExtension=function(s){const c=n.call(this,s);return c||(s!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Xl(this)),this.__OESVertexArrayObject))}}const Ow="OES_element_index",Fw="WEBGL_draw_buffers",JR="EXT_disjoint_timer_query",QR="EXT_disjoint_timer_query_webgl2",ez="EXT_texture_filter_anisotropic",Bw="WEBGL_debug_renderer_info",tz=35723,nz=4352,iz=36795,rz=34047,sz=37445,oz=37446,Sn=t=>Yt(t)?void 0:0,az={3074:t=>Yt(t)?void 0:36064,[tz]:t=>Yt(t)?void 0:nz,35977:Sn,32937:Sn,[iz]:(t,e)=>{const n=Yt(t)?t.getExtension(QR):t.getExtension(JR);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[sz]:(t,e)=>{const n=t.getExtension(Bw);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[oz]:(t,e)=>{const n=t.getExtension(Bw);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[rz]:(t,e)=>{const n=t.luma.extensions[ez];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Sn,35071:Sn,37447:Sn,36063:(t,e)=>{if(!Yt(t)){const n=t.getExtension(Fw);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Sn,35374:Sn,35377:Sn,34852:t=>{if(!Yt(t)){const e=t.getExtension(Fw);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(Ow)?2147483647:65535,33001:t=>t.getExtension(Ow)?16777216:65535,33e3:t=>16777216,37157:Sn,35373:Sn,35657:Sn,36183:Sn,37137:Sn,34045:Sn,35978:Sn,35979:Sn,35968:Sn,35376:Sn,35375:Sn,35659:Sn,37154:Sn,35371:Sn,35658:Sn,35076:Sn,35077:Sn,35380:Sn};function lz(t,e,n){const i=az[n],s=typeof i=="function"?i(t,e,n):i;return s!==void 0?s:e(n)}const cz="OES_vertex_array_object",dA="ANGLE_instanced_arrays",uz="WEBGL_draw_buffers",hz="EXT_disjoint_timer_query",dz="EXT_texture_filter_anisotropic",fz="VertexArray requires WebGL2 or OES_vertex_array_object extension";function pz(t,e){return{webgl2:Yt(t),ext:t.getExtension(e)}}const fA={[cz]:{meta:{suffix:"OES"},createVertexArray:()=>{mr(!1,fz)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[dA]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){mr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[uz]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{mr(!1)}},[hz]:{meta:{suffix:"EXT"},createQuery:()=>{mr(!1)},deleteQuery:()=>{mr(!1)},beginQuery:()=>{mr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},$_={readBuffer:(t,e,n)=>{Yt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:s,ext:c}=pz(t,dA);let d;switch(i){case 35069:d=s?void 0:!1;break;case 35070:d=!s&&!c?0:void 0;break}return d!==void 0?d:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Yt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,s)=>{if(!Yt(t))switch(s){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,s)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:s}=t.luma,c=s[dz];i=c&&c.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:lz,hint(t,e,n,i){return e(n,i)}};function mz(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(KR(t),gz(t),yz(t,fA),_z(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=mz;function gz(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function _z(t,e){let{target:n,target2:i}=e;Object.keys($_).forEach(s=>{if(typeof $_[s]=="function"){const c=t[s]?t[s].bind(t):()=>{},d=$_[s].bind(null,t,c);n[s]=d,i[s]=d}})}function yz(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&vz(t,{extension:n,target:t.luma,target2:t})}function vz(t,e){let{extension:n,target:i,target2:s}=e;const c=fA[n];mr(c);const{meta:d={}}=c,{suffix:l=""}=d,y=t.getExtension(n);for(const w of Object.keys(c)){const S="".concat(w).concat(l);let I=null;w==="meta"||typeof t[w]=="function"||(y&&typeof y[S]=="function"?I=function(){return y[S](...arguments)}:typeof c[w]=="function"&&(I=c[w].bind(i))),I&&(i[w]=I,s[w]=I)}}const Jv={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ya=(t,e,n)=>e?t.enable(n):t.disable(n),Nw=(t,e,n)=>t.hint(n,e),Gr=(t,e,n)=>t.pixelStorei(n,e),xz=(t,e)=>{const n=Yt(t)?36009:36160;return t.bindFramebuffer(n,e)},bz=(t,e)=>t.bindFramebuffer(36008,e);function Th(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const wz={3042:ya,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ya,2885:(t,e)=>t.cullFace(e),2929:ya,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ya,35723:Nw,36006:xz,2886:(t,e)=>t.frontFace(e),33170:Nw,2849:(t,e)=>t.lineWidth(e),32823:ya,32824:"polygonOffset",10752:"polygonOffset",35977:ya,32938:"sampleCoverage",32939:"sampleCoverage",3089:ya,3088:(t,e)=>t.scissor(...e),2960:ya,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:Gr,3317:Gr,37440:Gr,37441:Gr,37443:Gr,3330:Gr,3332:Gr,3331:Gr,36010:bz,3314:Gr,32878:Gr,3316:Gr,3315:Gr,32877:Gr,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Th(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Th(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Th(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Th(e)&&e.length===3?[...e,...e]:e;const[n,i,s,c,d,l]=e;t.stencilFuncSeparate(1028,n,i,s),t.stencilFuncSeparate(1029,c,d,l)},stencilOp:(t,e)=>{e=Th(e)&&e.length===3?[...e,...e]:e;const[n,i,s,c,d,l]=e;t.stencilOpSeparate(1028,n,i,s),t.stencilOpSeparate(1029,c,d,l)},viewport:(t,e)=>t.viewport(...e)};function Zn(t,e,n){return e[t]!==void 0?e[t]:n[t]}const Ez={blendEquation:(t,e,n)=>t.blendEquationSeparate(Zn(32777,e,n),Zn(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Zn(32969,e,n),Zn(32968,e,n),Zn(32971,e,n),Zn(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Zn(32824,e,n),Zn(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Zn(32938,e,n),Zn(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Zn(2962,e,n),Zn(2967,e,n),Zn(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Zn(34816,e,n),Zn(36003,e,n),Zn(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Zn(2964,e,n),Zn(2965,e,n),Zn(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Zn(34817,e,n),Zn(34818,e,n),Zn(34819,e,n))},Uw={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,s)=>t({32773:new Float32Array([e,n,i,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,s)=>t({32969:e,32968:n,32971:i,32970:s}),clearColor:(t,e,n,i,s)=>t({3106:new Float32Array([e,n,i,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,s)=>t({3107:[e,n,i,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,s)=>t({3088:new Int32Array([e,n,i,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,s)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,s)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(t,e,n,i,s)=>t({2978:[e,n,i,s]})},io=(t,e)=>t.isEnabled(e),Vw={3042:io,2884:io,2929:io,3024:io,32823:io,32926:io,32928:io,3089:io,2960:io,35977:io};function pA(t){for(const e in t)return!1;return!0}function Tz(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}function jw(t,e){const n=t[e].bind(t);t[e]=function(){const s=arguments.length<=0?void 0:arguments[0];return s in t.state.cache?t.state.enable?t.state.cache[s]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function Sz(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];const{valueChanged:y,oldValue:w}=n(t.state._updateCache,...d);return y&&i(...d),w},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function Az(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class Pz{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?Iz(e):Object.assign({},Jv),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){mr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Ho(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const c in e){mr(c!==void 0);const d=e[c],l=this.cache[c];Tz(d,l)||(n=!0,i=l,s&&!(c in s)&&(s[c]=l),this.cache[c]=d)}return{valueChanged:n,oldValue:i}}}function mA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(mr(i!==void 0),!t.state){const{polyfillContext:s}=globalThis;s&&s(t),t.state=new Pz(t,{copyState:i}),Az(t);for(const c in Uw){const d=Uw[c];Sz(t,c,d)}jw(t,"getParameter"),jw(t,"isEnabled")}return t.state.enable=n,t}function Cz(t){t.state||mA(t,{copyState:!1}),t.state.push()}function Gw(t){mr(t.state),t.state.pop()}function Ho(t,e){if(mr(eg(t),"setParameters requires a WebGL context"),pA(e))return;const n={};for(const s in e){const c=Number(s),d=wz[s];d&&(typeof d=="string"?n[d]=!0:d(t,e[s],c))}const i=t.state&&t.state.cache;if(i)for(const s in n){const c=Ez[s];c(t,e,i)}}function Iz(t,e){if(e=e||Jv,typeof e=="number"){const s=e,c=Vw[s];return c?c(t,s):t.getParameter(s)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const s of n){const c=Vw[s];i[s]=c?c(t,Number(s)):t.getParameter(Number(s))}return i}function Mz(t){Ho(t,Jv)}function Ns(t,e,n){if(pA(e))return n(t);const{nocatch:i=!0}=e;Cz(t),Ho(t,e);let s;if(i)s=n(t),Gw(t);else try{s=n(t)}finally{Gw(t)}return s}function cu(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function q_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=cu(t),s=t.drawingBufferWidth,c=t.drawingBufferHeight;return kz(e,i,s,c,n)}function Lz(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function kz(t,e,n,i,s){const c=Ww(t[0],e,n);let d=Hw(t[1],e,i,s),l=Ww(t[0]+1,e,n);const y=l===n-1?l:l-1;l=Hw(t[1]+1,e,i,s);let w;return s?(l=l===0?l:l+1,w=d,d=l):w=l===i-1?l:l-1,{x:c,y:d,width:Math.max(y-c+1,1),height:Math.max(w-d+1,1)}}function Ww(t,e,n){return Math.min(Math.round(t*e),n-1)}function Hw(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Qv=Zo(),Rz=Qv&&typeof document<"u",gA={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function _A(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mr(Qv,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},gA,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let s;const{canvas:c}=t,d=Fz({canvas:c,width:e,height:n,onError:i});return s=Oz(d,t),s?(s=ex(s,t),Bz(s),s):null}function ex(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||Nz(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},gA,e);const{manageState:n,debug:i}=e;return n&&mA(t,{copyState:!1,log:function(){for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return Tt.log(1,...c)()}}),Qv&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Tt.level=Math.max(Tt.level,1)):Tt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function zz(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),s=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),c=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||e,renderer:c||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function Dz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=Lz(e.useDevicePixels);Uz(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function Oz(t,e){const{onError:n}=e;let i=null;const s=y=>i=y.statusMessage||i;t.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:c=!0,webgl2:d=!0}=e;let l=null;return d&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),c&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",s,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(d&&!c?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function Fz(t){let{canvas:e,width:n=800,height:i=600,onError:s}=t,c;return typeof e=="string"?(Rz&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(e,"' before page was loaded")),c=document.getElementById(e)):e?c=e:(c=document.createElement("canvas"),c.id="lumagl-canvas",c.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",c.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(c,document.body.firstChild)),c}function Bz(t){const e=Yt(t)?"WebGL2":"WebGL1",n=zz(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",s=t.debug?" debug":"";Tt.info(1,"".concat(e).concat(s," context ").concat(i))()}function Nz(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function Uz(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,s="height"in n?n.height:t.canvas.clientHeight;(!i||!s)&&(Tt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,s=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const c=t.luma.canvasSizeInfo;if(c.clientWidth!==i||c.clientHeight!==s||c.devicePixelRatio!==e){let d=e;const l=Math.floor(i*d),y=Math.floor(s*d);t.canvas.width=l,t.canvas.height=y,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==y)&&(Tt.warn("Device pixel ratio clamped")(),d=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/s),t.canvas.width=Math.floor(i*d),t.canvas.height=Math.floor(s*d)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:s,devicePixelRatio:e})}}const Zh="8.5.21",Vz="set luma.log.level=1 (or higher) to trace rendering";class jz{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Hv({id:e})),this.stats.get(e)}}const Il=new jz;if(globalThis.luma&&globalThis.luma.VERSION!==Zh)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Zh));globalThis.luma||(Zo()&&Tt.log(1,"luma.gl ".concat(Zh," - ").concat(Vz))(),globalThis.luma=globalThis.luma||{VERSION:Zh,version:Zh,log:Tt,stats:Il,globals:{modules:{},nodeIO:{}}});function Gz(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Wz(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ut(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Z_(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ut(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Ua(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const X_={};function Wa(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";X_[t]=X_[t]||1;const e=X_[t]++;return"".concat(t,"-").concat(e)}function $w(t){return ut(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function uu(t){let e=!0;for(const n in t){e=!1;break}return e}function yA(t,e,n,i){const s="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),c=Object.getPrototypeOf(t);i.forEach(d=>{c.methodName||(c[d]=()=>{throw Tt.removed("Calling removed method ".concat(e,".").concat(d,": "),s)(),new Error(d)})})}const Ac="Resource subclass must define virtual methods";let Xo=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tg(e);const{id:i,userData:s={}}=n;this.gl=e,this.gl2=e,this.id=i||Wa(this[Symbol.toStringTag]),this.userData=s,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Z_(this.gl,e),ut(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const c=Yt(this.gl);if(!((!("webgl2"in s)||c)&&(!("extension"in s)||this.gl.getExtension(s.extension)))){const l=s.webgl1,y="webgl2"in s?s.webgl2:s.webgl1;return c?y:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,s=this.constructor.PARAMETERS||{},c=Yt(this.gl),d={},l=n||Object.keys(s);for(const y of l){const w=s[y];if(w&&(!("webgl2"in w)||c)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const I=i?Ua(this.gl,y):y;d[I]=this.getParameter(y,e),i&&w.type==="GLenum"&&(d[I]=Ua(this.gl,d[I]))}}return d}setParameter(e,n){e=Z_(this.gl,e),ut(e);const s=(this.constructor.PARAMETERS||{})[e];if(s){const c=Yt(this.gl);if(!((!("webgl2"in s)||c)&&(!("extension"in s)||this.gl.getExtension(s.extension))))throw new Error("Parameter not available on this platform");s.type==="GLenum"&&(n=Z_(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return yA(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Ac)}_deleteHandle(){throw new Error(Ac)}_bindHandle(e){throw new Error(Ac)}_getOptsFromHandle(){throw new Error(Ac)}_getParameter(e,n){throw new Error(Ac)}_setParameter(e,n){throw new Error(Ac)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Il.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Il.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const s=Il.get("Memory Usage".concat(i));s.get("GPU Memory").addCount(e),s.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Il.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const Hz="Failed to deduce GL constant from typed array";function x0(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Hz)}}function pd(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function $z(t){let{data:e,width:n,height:i,bytesPerPixel:s=4,temp:c}=t;const d=n*s;c=c||new Uint8Array(d);for(let l=0;l<i/2;++l){const y=l*d,w=(i-l-1)*d;c.set(e.subarray(y,y+d)),e.copyWithin(y,w,w+d),e.set(c,w)}}function qz(t){let{data:e,width:n,height:i}=t;const s=Math.round(n/2),c=Math.round(i/2),d=new Uint8Array(s*c*4);for(let l=0;l<c;l++)for(let y=0;y<s;y++)for(let w=0;w<4;w++)d[(l*s+y)*4+w]=e[(l*2*n+y*2)*4+w];return{data:d,width:s,height:c}}function b0(t,e,n){const{removedProps:i={},deprecatedProps:s={},replacedProps:c={}}=n;for(const l in i)if(l in e){const w=i[l]?"".concat(t,".").concat(i[l]):"N/A";Tt.removed("".concat(t,".").concat(l),w)()}for(const l in s)if(l in e){const y=s[l];Tt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))()}let d=null;for(const l in c)if(l in e){const y=c[l];Tt.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))(),d=d||Object.assign({},e),d[y]=e[l],delete d[l]}return d||e}const Zz={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Xz={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Zr{static getBytesPerElement(e){return pd(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ut(e.size),pd(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Zr(Zz,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Zr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Zr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=b0("Accessor",e,Xz),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const qw=10,vA={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Yz={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:vA},Kz={removedProps:vA};class yn extends Xo{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Zr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Zr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=b0("Buffer",e,Yz),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=b0("Buffer",e,Kz),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Zr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:s=0}=e,c=e.byteLength||e.length;ut(n);const d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),s!==0||c!==void 0?(tr(this.gl),this.gl.bufferSubData(this.target,i,n,s,c)):this.gl.bufferSubData(d,i,n),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:s=0,size:c}=e;const{gl:d}=this;return tr(d),d.bindBuffer(36662,n.handle),d.bindBuffer(36663,this.handle),d.copyBufferSubData(36662,36663,i,s,c),d.bindBuffer(36662,null),d.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:s=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};tr(this.gl);const c=pd(this.accessor.type||5126,{clamped:!1}),d=this._getAvailableElementCount(n),l=i;let y,w;e?(w=e.length,y=w-l):(y=Math.min(d,s||d),w=l+y);const S=Math.min(d,y);return s=s||S,ut(s<=S),e=e||new c(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,s),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?s!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,s):(ut(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(qw,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ut(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const s=this._getTarget();this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.usage),this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=e.slice(0,qw),this.bytesUsed=i,this._trackAllocatedMemory(i);const c=x0(e);return ut(c),this.setAccessor(new Zr(this.accessor,{type:c})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ut(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const s=this._getTarget();return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,n),this.gl.bindBuffer(s,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=pd(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Zr(this.accessor,{type:x0(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Tt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Tt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Tt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Tt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Zr(this.accessor,e),this}}const tx={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},xA={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},bA={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Jz(t,e){const n=tx[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Yt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function Qz(t,e){const n=tx[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const eD=[9729,9728],Zw=globalThis.WebGLBuffer||function(){};class Nl extends Xo{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:s}=n;let c=!0;return i&&(c=c&&Jz(e,i),c=c&&(!s||Qz(e,i))),c}constructor(e,n){const{id:i=Wa("texture"),handle:s,target:c}=n;super(e,{id:i,handle:s}),this.target=c,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(j=>this.initialize(Object.assign({},e,{pixels:j,data:j}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:s=null,format:c=6408,border:d=0,recreate:l=!1,parameters:y={},pixelStore:w={},textureUnit:S=void 0}=e;n||(n=s);let{width:I,height:P,dataFormat:B,type:G,compressed:K=!1,mipmaps:de=!0}=e;const{depth:Z=0}=e;return{width:I,height:P,compressed:K,dataFormat:B,type:G}=this._deduceParameters({format:c,type:G,dataFormat:B,compressed:K,data:n,width:I,height:P}),this.width=I,this.height=P,this.depth=Z,this.format=c,this.type=G,this.dataFormat=B,this.border=d,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),de&&this._isNPOT()&&(Tt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),de=!1,this._updateForNPOT(y)),this.mipmaps=de,this.setImageData({data:n,width:I,height:P,depth:Z,format:c,type:G,dataFormat:B,border:d,mipmaps:de,parameters:w,compressed:K}),de&&this.generateMipmap(),this.setParameters(y),l&&(this.data=n),i&&(this._video={video:n,parameters:y,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:s=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Tt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ns(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:s=0,format:c=this.format,border:d=this.border,offset:l=0,parameters:y={}}=e;let{data:w=null,type:S=this.type,width:I=this.width,height:P=this.height,dataFormat:B=this.dataFormat,compressed:G=!1}=e;w||(w=i),{type:S,dataFormat:B,compressed:G,width:I,height:P}=this._deduceParameters({format:c,type:S,dataFormat:B,compressed:G,data:w,width:I,height:P});const{gl:K}=this;K.bindTexture(this.target,this.handle);let de=null;({data:w,dataType:de}=this._getDataType({data:w,compressed:G}));let Z,j=0;if(Ns(this.gl,y,()=>{switch(de){case"null":K.texImage2D(n,s,c,I,P,d,B,S,w);break;case"typed-array":K.texImage2D(n,s,c,I,P,d,B,S,w,l);break;case"buffer":Z=tr(K),Z.bindBuffer(35052,w.handle||w),Z.texImage2D(n,s,c,I,P,d,B,S,l),Z.bindBuffer(35052,null);break;case"browser-object":Yt(K)?K.texImage2D(n,s,c,I,P,d,B,S,w):K.texImage2D(n,s,c,B,S,w);break;case"compressed":for(const[q,se]of w.entries())K.compressedTexImage2D(n,q,se.format,se.width,se.height,d,se.data),j+=se.levelSize;break;default:ut(!1,"Unknown image data type")}}),de==="compressed")this._trackAllocatedMemory(j,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const q=xA[this.dataFormat]||4,se=bA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*q*se,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:s=null,x:c=0,y:d=0,width:l=this.width,height:y=this.height,level:w=0,format:S=this.format,type:I=this.type,dataFormat:P=this.dataFormat,compressed:B=!1,offset:G=0,border:K=this.border,parameters:de={}}=e;if({type:I,dataFormat:P,compressed:B,width:l,height:y}=this._deduceParameters({format:S,type:I,dataFormat:P,compressed:B,data:s,width:l,height:y}),ut(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=i),s&&s.data){const Z=s;s=Z.data,l=Z.shape[0],y=Z.shape[1]}s instanceof yn&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Ns(this.gl,de,()=>{if(B)this.gl.compressedTexSubImage2D(n,w,c,d,l,y,S,s);else if(s===null)this.gl.texSubImage2D(n,w,c,d,l,y,P,I,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(n,w,c,d,l,y,P,I,s,G);else if(s instanceof Zw){const Z=tr(this.gl);Z.bindBuffer(35052,s),Z.texSubImage2D(n,w,c,d,l,y,P,I,G),Z.bindBuffer(35052,null)}else Yt(this.gl)?tr(this.gl).texSubImage2D(n,w,c,d,l,y,P,I,s):this.gl.texSubImage2D(n,w,c,d,P,I,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Tt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof yn?{data:n.handle,dataType:"buffer"}:n instanceof Zw?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:s,height:c,dataFormat:d,type:l,compressed:y}=e;const w=tx[n];return d=d||w&&w.dataFormat,l=l||w&&w.types[0],y=y||w&&w.compressed,{width:s,height:c}=this._deduceImageSize(i,s,c),{dataFormat:d,type:l,compressed:y,width:s,height:c,format:n,data:i}}_deduceImageSize(e,n,i){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:n,height:i}:s={width:n>=0?n:1,height:i>=0?i:1},ut(s,"Could not deduced texture size"),ut(n===void 0||s.width===n,"Deduced texture width does not match supplied width"),ut(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ut(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Yt(this.gl)||!this.width||!this.height?!1:!$w(this.width)||!$w(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:eD.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let tD="";function nD(t,e){return ut(typeof t=="string"),t=tD+t,new Promise((n,i)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),s.crossOrigin=e&&e.crossOrigin||"anonymous",s.src=t}catch(s){i(s)}})}class es extends Nl{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Nl.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tg(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:nD(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const w0=[34069,34070,34071,34072,34073,34074];class wA extends Nl{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tg(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:s=0,y:c=0,mipmapLevel:d=0}=e;return this._subImage({target:n,data:i,x:s,y:c,mipmapLevel:d})}async setCubeMapImageData(e){let{width:n,height:i,pixels:s,data:c,border:d=0,format:l=6408,type:y=5121}=e;const{gl:w}=this,S=s||c,I=await Promise.all(w0.map(P=>{const B=S[P];return Promise.all(Array.isArray(B)?B:[B])}));this.bind(),w0.forEach((P,B)=>{I[B].length>1&&this.opts.mipmaps!==!1&&Tt.warn("".concat(this.id," has mipmap and multiple LODs."))(),I[B].forEach((G,K)=>{n&&i?w.texImage2D(P,K,l,n,i,d,l,y,G):w.texImage2D(P,K,l,l,y,G)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:s,pixels:c,data:d,border:l=0,format:y=6408,type:w=5121}=e,{gl:S}=this,I=c||d;return this.bind(),I instanceof Promise?I.then(P=>this.setImageDataForFace(Object.assign({},e,{face:n,data:P,pixels:P}))):this.width||this.height?S.texImage2D(n,0,y,i,s,l,y,w,I):S.texImage2D(n,0,y,y,w,I),this}}wA.FACES=w0;class iD extends Nl{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tr(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:s,height:c,depth:d=1,border:l=0,format:y,type:w=5121,offset:S=0,data:I,parameters:P={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ns(this.gl,P,()=>{ArrayBuffer.isView(I)&&this.gl.texImage3D(this.target,n,i,s,c,d,l,y,w,I),I instanceof yn&&(this.gl.bindBuffer(35052,I.handle),this.gl.texImage3D(this.target,n,i,s,c,d,l,y,w,S))}),I&&I.byteLength)this._trackAllocatedMemory(I.byteLength,"Texture");else{const B=xA[this.dataFormat]||4,G=bA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*B*G,"Texture")}return this.loaded=!0,this}}const xl="EXT_color_buffer_float",Xw={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:xl,bpp:2},33327:{gl2:xl,bpp:4},34842:{gl2:xl,bpp:8},33326:{gl2:xl,bpp:4},33328:{gl2:xl,bpp:8},34836:{gl2:xl,bpp:16},35898:{gl2:xl,bpp:4}};function rD(t,e,n){const i=n[e];if(!i)return!1;const s=Yt(t)&&i.gl2||i.gl1;return typeof s=="string"?t.getExtension(s):s}class Gc extends Xo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||rD(e,n,Xw)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:s=1,samples:c=0}=e;return ut(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),c!==0&&Yt(this.gl)?this.gl.renderbufferStorageMultisample(36161,c,n,i,s):this.gl.renderbufferStorage(36161,n,i,s),this.format=n,this.width=i,this.height=s,this.samples=c,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Xw[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const sD=256,oD=1024,aD=16384,Yw=6144,Kw=6145,Jw=6146,Qw=34041,EA="clear: bad arguments";function nx(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c={};e&&(c.framebuffer=e);let d=0;n&&(d|=aD,n!==!0&&(c.clearColor=n)),i&&(d|=sD,i!==!0&&(c.clearDepth=i)),s&&(d|=oD,i!==!0&&(c.clearStencil=i)),ut(d!==0,EA),Ns(t,c,()=>{t.clear(d)})}function lD(t){let{framebuffer:e=null,buffer:n=Yw,drawBuffer:i=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tr(t),Ns(t,{framebuffer:e},()=>{switch(n){case Yw:switch(s.constructor){case Int32Array:t.clearBufferiv(n,i,s);break;case Uint32Array:t.clearBufferuiv(n,i,s);break;case Float32Array:default:t.clearBufferfv(n,i,s)}break;case Kw:t.clearBufferfv(Kw,0,[s]);break;case Jw:t.clearBufferiv(Jw,0,[s]);break;case Qw:const[c,d]=s;t.clearBufferfi(Qw,0,c,d);break;default:ut(!1,EA)}})}function cD(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ut(!1),0}}function ng(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:s=6408}=e;let{sourceAttachment:c=36064,target:d=null,sourceWidth:l,sourceHeight:y,sourceType:w}=e;const{framebuffer:S,deleteFramebuffer:I}=TA(t);ut(S);const{gl:P,handle:B,attachments:G}=S;l=l||S.width,y=y||S.height,c===36064&&B===null&&(c=1028),ut(G[c]),w=w||G[c].type,d=hD(d,w,s,l,y),w=w||x0(d);const K=P.bindFramebuffer(36160,B);return P.readPixels(n,i,l,y,s,w,d),P.bindFramebuffer(36160,K||null),I&&S.delete(),d}function eE(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=ng(t,{sourceAttachment:e}),{width:s,height:c}=t;for(;c>n;)({data:i,width:s,height:c}=qz({data:i,width:s,height:c}));$z({data:i,width:s,height:c});const d=document.createElement("canvas");d.width=s,d.height=c;const l=d.getContext("2d"),y=l.createImageData(s,c);return y.data.set(i),l.putImageData(y,0,0),d.toDataURL()}function uD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:s=0,targetMipmaplevel:c=0,targetInternalFormat:d=6408}=n;let{targetX:l,targetY:y,targetZ:w,width:S,height:I}=n;const{framebuffer:P,deleteFramebuffer:B}=TA(t);ut(P);const{gl:G,handle:K}=P,de=typeof l<"u"||typeof y<"u"||typeof w<"u";l=l||0,y=y||0,w=w||0;const Z=G.bindFramebuffer(36160,K);ut(e);let j=null;if(e instanceof Nl&&(j=e,S=Number.isFinite(S)?S:j.width,I=Number.isFinite(I)?I:j.height,j.bind(0),e=j.target),!de)G.copyTexImage2D(e,c,d,i,s,S,I,0);else switch(e){case 3553:case 34067:G.copyTexSubImage2D(e,c,l,y,i,s,S,I);break;case 35866:case 32879:tr(G).copyTexSubImage3D(e,c,l,y,w,i,s,S,I);break}return j&&j.unbind(),G.bindFramebuffer(36160,Z||null),B&&P.delete(),j}function TA(t){return t instanceof vi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:bD(t),deleteFramebuffer:!0}}function hD(t,e,n,i,s){if(t)return t;e=e||5121;const c=pd(e,{clamped:!1}),d=cD(n);return new c(i*s*d)}const In={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function dD(t){const e=new es(t,{format:6408,type:5126,dataFormat:6408}),n=new vi(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const SA={[In.WEBGL2]:[!1,!0],[In.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[In.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[In.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[In.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[In.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[In.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[In.FLOAT_BLEND]:["EXT_float_blend"],[In.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[In.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[In.TEXTURE_FLOAT]:["OES_texture_float",!0],[In.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[In.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[In.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[In.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[In.COLOR_ATTACHMENT_RGBA32F]:[dD,"EXT_color_buffer_float"],[In.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[In.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[In.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[In.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[In.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[In.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},fD=2;function pD(t,e){return ix(t,e)}function ix(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>AA(t,n))}function mD(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in SA)t.luma.caps[e]===void 0&&(t.luma.caps[e]=AA(t,e));return t.luma.caps}function AA(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=gD(t,e)),t.luma.caps[e]||Tt.log(fD,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function gD(t,e){const n=SA[e];ut(n,e);let i;const s=Yt(t)&&n[1]||n[0];if(typeof s=="function")i=s(t);else if(Array.isArray(s)){i=!0;for(const c of s)i=i&&!!t.getExtension(c)}else typeof s=="string"?i=!!t.getExtension(s):typeof s=="boolean"?i=s:ut(!1);return i}const tE="Multiple render targets not supported";class vi extends Xo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:s}=n;let c=!0;return i&&(c=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),s&&(c=c&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),c}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new vi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=tr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=tr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:s=null,color:c=!0,depth:d=!0,stencil:l=!1,check:y=!0,readBuffer:w=void 0,drawBuffers:S=void 0}=e;if(ut(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,s)for(const I in s){const P=s[I];(Array.isArray(P)?P[0]:P).resize({width:n,height:i})}else s=this._createDefaultAttachments(c,d,l,n,i);this.update({clearAttachments:!0,attachments:s,readBuffer:w,drawBuffers:S}),s&&y&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:s,clearAttachments:c=!1,resizeAttachments:d=!0}=e;this.attach(n,{clearAttachments:c,resizeAttachments:d});const{gl:l}=this,y=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),s&&this._setDrawBuffers(s),l.bindFramebuffer(36160,y||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ut(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Tt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const s in this.attachments)this.attachments[s].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};n&&Object.keys(this.attachments).forEach(d=>{s[d]=null}),Object.assign(s,e);const c=this.gl.bindFramebuffer(36160,this.handle);for(const d in s){ut(d!==void 0,"Misspelled framebuffer binding point?");const l=Number(d),y=s[l];let w=y;if(!w)this._unattach(l);else if(w instanceof Gc)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(y)){const[S,I=0,P=0]=y;w=S,this._attachTexture({attachment:l,texture:S,layer:I,level:P})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});i&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,c||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(d=>!this.attachments[d]).forEach(d=>{delete this.attachments[d]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(yD(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:s,drawBuffers:c=[]}=e,d=this.gl.bindFramebuffer(36160,this.handle);return(n||i||s)&&nx(this.gl,{color:n,depth:i,stencil:s}),c.forEach((l,y)=>{lD(this.gl,{drawBuffer:y,value:l})}),this.gl.bindFramebuffer(36160,d||null),this}readPixels(){return Tt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Tt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Tt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Tt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Tt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Tt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:s=0,width:c,height:d}=e;const l=tr(this.gl),y=l.bindFramebuffer(36008,this.handle);return i===0&&s===0&&c===void 0&&d===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,s,c,d),l.bindFramebuffer(36008,y),this}getAttachmentParameter(e,n,i){let s=this._getAttachmentParameterFallback(n);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&s>1e3&&(s=Ua(this.gl,s)),s}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const s={};for(const c of i){const d=n?Ua(this.gl,c):c;s[d]=this.getAttachmentParameter(e,c,n)}return s}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const s of n){const c=Number(s),d=e?Ua(this.gl,c):c;i[d]=this.getAttachmentParameters(c,e)}return i}show(){return typeof window<"u"&&window.open(eE(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Tt.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=eE(this,{targetMaxHeight:100});return Tt.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,s,c){let d=null;return e&&(d=d||{},d[36064]=new es(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:c,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(d[36064])),n&&i?(d=d||{},d[33306]=new Gc(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(d[33306])):n?(d=d||{},d[36096]=new Gc(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:c}),this.ownResources.push(d[36096])):i&&ut(!1),d}_unattach(e){const n=this.attachments[e];n&&(n instanceof Gc?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:s}=this;s.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:s,level:c}=e;const{gl:d}=this;switch(d.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:tr(d).framebufferTextureLayer(36160,n,i.target,c,s);break;case 34067:const y=_D(s);d.framebufferTexture2D(36160,n,y,i.handle,c);break;case 3553:d.framebufferTexture2D(36160,n,3553,i.handle,c);break;default:ut(!1,"Illegal texture type")}d.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=$R(this.gl);n?n.readBuffer(e):ut(e===36064||e===1029,tE),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=tr(n);if(i)i.drawBuffers(e);else{const s=n.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(e):ut(e.length===1&&(e[0]===36064||e[0]===1029),tE)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=mD(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function _D(t){return t<34069?t+34069:t}function yD(t){return(vi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const vD=[36049,36048,33296,33298,33299,33300,33301,33302,33303];vi.ATTACHMENT_PARAMETERS=vD;function xD(t,e){ut(t instanceof es||t instanceof wA||t instanceof iD);const n=t.constructor,{gl:i,width:s,height:c,format:d,type:l,dataFormat:y,border:w,mipmaps:S}=t,I=Object.assign({width:s,height:c,format:d,type:l,dataFormat:y,border:w,mipmaps:S},e);return new n(i,I)}function bD(t,e){const{gl:n,width:i,height:s,id:c}=t;return new vi(n,Object.assign({},e,{id:"framebuffer-for-".concat(c),width:i,height:s,attachments:{36064:t}}))}function Bp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const wD=35632,ED=35633;function TD(t){switch(t){case wD:return"fragment";case ED:return"vertex";default:return"unknown type"}}function SD(t,e,n,i){const s=t.split(/\r?\n/),c={},d={},l=i||Bp(e)||"(unnamed)",y="".concat(TD(n)," shader ").concat(l);for(let S=0;S<s.length;S++){const I=s[S];if(I.length<=1)continue;const P=I.split(":"),B=P[0],G=parseInt(P[2],10);if(isNaN(G))throw new Error("GLSL compilation error in ".concat(y,": ").concat(t));B!=="WARNING"?c[G]=I:d[G]=I}const w=AD(e);return{shaderName:y,errors:nE(c,w),warnings:nE(d,w)}}function nE(t,e){let n="";for(let i=0;i<e.length;i++){const s=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(s,`
`),t[i+1])){const c=t[i+1],d=c.split(":",3),l=d[0],y=parseInt(d[1],10)||0,w=c.substring(d.join(":").length+1).trim();n+=PA("^^^ ".concat(l,": ").concat(w,`

`),y)}}return n}function AD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),s=String(i.length+e-1).length;return i.map((c,d)=>{const l=String(d+e),y=l.length;return PA(l,s-y)+n+c})}function PA(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function CA(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const PD="Shader: GLSL source code must be a JavaScript string";class md extends Xo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ut(!1),"unknown"}}constructor(e,n){tg(e),ut(typeof n.source=="string",PD);const i=Bp(n.source,null)||n.id||Wa("unnamed ".concat(md.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=Bp(n,null);i&&(this.id=Wa(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(md.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Bp(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:s,errors:c,warnings:d}=SD(i,this.source,this.shaderType,this.id);throw Tt.error("GLSL compilation errors in ".concat(s,`
`).concat(c))(),Tt.warn("GLSL compilation warnings in ".concat(s,`
`).concat(d))(),new Error("GLSL compilation errors in ".concat(s))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Y_ extends md{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class K_ extends md{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const CD={5126:Pn.bind(null,"uniform1fv",Wr,1,Ji),35664:Pn.bind(null,"uniform2fv",Wr,2,Ji),35665:Pn.bind(null,"uniform3fv",Wr,3,Ji),35666:Pn.bind(null,"uniform4fv",Wr,4,Ji),5124:Pn.bind(null,"uniform1iv",va,1,Ji),35667:Pn.bind(null,"uniform2iv",va,2,Ji),35668:Pn.bind(null,"uniform3iv",va,3,Ji),35669:Pn.bind(null,"uniform4iv",va,4,Ji),35670:Pn.bind(null,"uniform1iv",va,1,Ji),35671:Pn.bind(null,"uniform2iv",va,2,Ji),35672:Pn.bind(null,"uniform3iv",va,3,Ji),35673:Pn.bind(null,"uniform4iv",va,4,Ji),35674:Pn.bind(null,"uniformMatrix2fv",Wr,4,ko),35675:Pn.bind(null,"uniformMatrix3fv",Wr,9,ko),35676:Pn.bind(null,"uniformMatrix4fv",Wr,16,ko),35678:Bi,35680:Bi,5125:Pn.bind(null,"uniform1uiv",lp,1,Ji),36294:Pn.bind(null,"uniform2uiv",lp,2,Ji),36295:Pn.bind(null,"uniform3uiv",lp,3,Ji),36296:Pn.bind(null,"uniform4uiv",lp,4,Ji),35685:Pn.bind(null,"uniformMatrix2x3fv",Wr,6,ko),35686:Pn.bind(null,"uniformMatrix2x4fv",Wr,8,ko),35687:Pn.bind(null,"uniformMatrix3x2fv",Wr,6,ko),35688:Pn.bind(null,"uniformMatrix3x4fv",Wr,12,ko),35689:Pn.bind(null,"uniformMatrix4x2fv",Wr,8,ko),35690:Pn.bind(null,"uniformMatrix4x3fv",Wr,12,ko),35678:Bi,35680:Bi,35679:Bi,35682:Bi,36289:Bi,36292:Bi,36293:Bi,36298:Bi,36299:Bi,36300:Bi,36303:Bi,36306:Bi,36307:Bi,36308:Bi,36311:Bi},ID={},MD={},LD={},iE=[0];function rx(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(iE[0]=t,t=iE);const s=t.length;if(s%e&&Tt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let c=i[s];c||(c=new n(s),i[s]=c);for(let d=0;d<s;d++)c[d]=t[d];return c}function Wr(t,e){return rx(t,e,Float32Array,ID)}function va(t,e){return rx(t,e,Int32Array,MD)}function lp(t,e){return rx(t,e,Uint32Array,LD)}function rE(t,e,n){const i=CD[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function kD(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function RD(t,e,n){for(const i in t){const s=t[i];if((!n||!!n[i])&&!zD(s))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),s),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function zD(t){return Array.isArray(t)||ArrayBuffer.isView(t)?OD(t):isFinite(t)||t===!0||t===!1||t instanceof Nl||t instanceof Gc?!0:t instanceof vi?!!t.texture:!1}function DD(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let s=0,c=n.length;s<c;++s)i[s]=n[s]}else t[e]=n.slice();else t[e]=n}function OD(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Bi(){let t=null;return(e,n,i)=>{const s=t!==i;return s&&(e.uniform1i(n,i),t=i),s}}function Pn(t,e,n,i){let s=null,c=null;return(d,l,y)=>{const w=e(y,n),S=w.length;let I=!1;if(s===null)s=new Float32Array(S),c=S,I=!0;else{ut(c===S,"Uniform length cannot change.");for(let P=0;P<S;++P)if(w[P]!==s[P]){I=!0;break}}return I&&(i(d,t,l,w),s.set(w)),I}}function Ji(t,e,n,i){t[e](n,i)}function ko(t,e,n,i){t[e](n,!1,i)}const FD=5120,BD=5121,ND=5122,UD=5123,sE=0,cp=1,VD=2,jD=3,up=4,GD=5,WD=6,gi=5126,HD=35664,$D=35665,qD=35666,Sh=5124,ZD=35667,XD=35668,YD=35669,Ah=5125,KD=36294,JD=36295,QD=36296,eO=35670,tO=35671,nO=35672,iO=35673,rO=35674,sO=35675,oO=35676,aO=35685,lO=35686,cO=35687,uO=35688,hO=35689,dO=35690,E0={[gi]:[gi,1,"float"],[HD]:[gi,2,"vec2"],[$D]:[gi,3,"vec3"],[qD]:[gi,4,"vec4"],[Sh]:[Sh,1,"int"],[ZD]:[Sh,2,"ivec2"],[XD]:[Sh,3,"ivec3"],[YD]:[Sh,4,"ivec4"],[Ah]:[Ah,1,"uint"],[KD]:[Ah,2,"uvec2"],[JD]:[Ah,3,"uvec3"],[QD]:[Ah,4,"uvec4"],[eO]:[gi,1,"bool"],[tO]:[gi,2,"bvec2"],[nO]:[gi,3,"bvec3"],[iO]:[gi,4,"bvec4"],[rO]:[gi,8,"mat2"],[aO]:[gi,8,"mat2x3"],[lO]:[gi,8,"mat2x4"],[sO]:[gi,12,"mat3"],[cO]:[gi,12,"mat3x2"],[uO]:[gi,12,"mat3x4"],[oO]:[gi,16,"mat4"],[hO]:[gi,16,"mat4x2"],[dO]:[gi,16,"mat4x3"]};function fO(t){switch(t){case sE:return sE;case cp:return cp;case jD:return cp;case VD:return cp;case up:return up;case GD:return up;case WD:return up;default:return ut(!1),0}}function oE(t){const e=E0[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function IA(t,e){switch(t){case FD:case BD:case ND:case UD:t=gi;break}for(const n in E0){const[i,s,c]=E0[n];if(i===t&&s===e)return{glType:n,name:c}}return null}class pO{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let s=0;s<i;s++){const{name:c,type:d,size:l}=n.getActiveAttrib(e.handle,s),y=n.getAttribLocation(e.handle,c);y>=0&&this._addAttribute(y,c,d,l)}this.attributeInfos.sort((s,c)=>s.location-c.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Yt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let s=0;s<i;s++){const{name:c,type:d,size:l}=n.getTransformFeedbackVarying(e.handle,s);this._addVarying(s,c,d,l)}this.varyingInfos.sort((s,c)=>s.location-c.location)}_addAttribute(e,n,i,s){const{type:c,components:d}=oE(i),l={type:c,size:s*d};this._inferProperties(e,n,l);const y={location:e,name:n,accessor:new Zr(l)};this.attributeInfos.push(y),this.attributeInfosByLocation[e]=y,this.attributeInfosByName[y.name]=y}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,s){const{type:c,components:d}=oE(i),l=new Zr({type:c,size:s*d}),y={location:e,name:n,accessor:l};this.varyingInfos.push(y),this.varyingInfosByName[y.name]=y}}const aE=4,mO=35981,gO=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class MA extends Xo{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",gO),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:s,varyings:c,bufferMode:d=mO}=e;return this.hash=n||"",this.vs=typeof i=="string"?new Y_(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof s=="string"?new K_(this.gl,{id:"".concat(e.id,"-fs"),source:s}):s,ut(this.vs instanceof Y_),ut(this.fs instanceof K_),this.uniforms={},this._textureUniforms={},c&&c.length>0&&(tr(this.gl),this.varyings=c,this.gl2.transformFeedbackVaryings(this.handle,c,d)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new pO(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:s,offset:c=0,start:d,end:l,isIndexed:y=!1,indexType:w=5123,instanceCount:S=0,isInstanced:I=S>0,vertexArray:P=null,transformFeedback:B,framebuffer:G,parameters:K={},uniforms:de,samplers:Z}=e;if((de||Z)&&(Tt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(de||{})),Tt.priority>=n){const j=G?G.id:"default",q="mode=".concat(Ua(this.gl,i)," verts=").concat(s," ")+"instances=".concat(S," indexType=").concat(Ua(this.gl,w)," ")+"isInstanced=".concat(I," isIndexed=").concat(y," ")+"Framebuffer=".concat(j);Tt.log(n,q)()}return ut(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||I&&S===0?!1:(P.bindForDraw(s,S,()=>{if(G!==void 0&&(K=Object.assign({},K,{framebuffer:G})),B){const j=fO(i);B.begin(j)}this._bindTextures(),Ns(this.gl,K,()=>{y&&I?this.gl2.drawElementsInstanced(i,s,w,c,S):y&&Yt(this.gl)&&!isNaN(d)&&!isNaN(l)?this.gl2.drawRangeElements(i,d,l,s,w,c):y?this.gl.drawElements(i,s,w,c):I?this.gl2.drawArraysInstanced(i,c,s,S):this.gl.drawArrays(i,c,s)}),B&&B.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tt.priority>=2&&RD(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],s=this._uniformSetters[n];if(s){let c=i,d=!1;if(c instanceof vi&&(c=c.texture),c instanceof Nl)if(d=this.uniforms[n]!==i,d){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const l=c,{textureIndex:y}=s;l.bind(y),c=y,this._textureUniforms[n]=l}else c=s.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(s(c)||d)&&DD(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const s of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Y_({handle:s});break;case 35632:i.fs=new K_({handle:s});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Wa(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Tt.time(aE,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Tt.timeEnd(aE,"linkProgram for ".concat(this._getName()))(),e.debug||Tt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:s}=kD(i.name);let c=e.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=rE(e,c,i),i.size>1)for(let d=0;d<i.size;d++)c=e.getUniformLocation(this.handle,"".concat(s,"[").concat(d,"]")),this._uniformSetters["".concat(s,"[").concat(d,"]")]=rE(e,c,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const _O=34918,yO=34919,vO=35007,xO=36795,bO=35976,wO=35887,EO=36202;class bm extends Xo{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Yt(e),s=ix(e,In.TIMER_QUERY);let c=i||s;for(const d of n)switch(d){case"queries":c=c&&i;break;case"timers":c=c&&s;break;default:ut(!1)}return c}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(vO)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?EO:wO)}beginTransformFeedbackQuery(){return this.begin(bO)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,yO);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(xO)}getResult(){return this.gl2.getQueryParameter(this.handle,_O)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,s)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}_createHandle(){return bm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class LA extends Xo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tr(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,uu(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:s,byteSize:c,byteOffset:d}=this._getBufferParams(n);return i<0?(this.unused[e]=s,Tt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,s,d,c),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,s;return e instanceof yn?s=e:(s=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||s.byteLength-n),{buffer:s,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:s}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,s,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const c=n&&n.handle;return!c||s===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,i,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let hp=null;function TO(t){return(!hp||hp.byteLength<t)&&(hp=new ArrayBuffer(t)),hp}function SO(t,e){const n=TO(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function AO(t){let{target:e,source:n,start:i=0,count:s=1}=t;const c=n.length,d=s*c;let l=0;for(let y=i;l<c;l++)e[y++]=n[l];for(;l<d;)l<d-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+d-l),l=d);return e}const PO="elements must be GL.ELEMENT_ARRAY_BUFFER";class Hr extends Xo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Yt(e)||JS()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Hr(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Hr.MAX_ATTRIBUTES=Hr.MAX_ATTRIBUTES||e.getParameter(34921),Hr.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Hr._setConstantFloatArray(e,n,i);break;case Int32Array:Hr._setConstantIntArray(e,n,i);break;case Uint32Array:Hr._setConstantUintArray(e,n,i);break;default:ut(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Hr.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ut(!e||e.target===34963,PO),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:s,type:c,stride:d,offset:l,normalized:y,integer:w,divisor:S}=i,{gl:I,gl2:P}=this;return e=Number(e),this.bind(()=>{I.bindBuffer(34962,n.handle),w?(ut(Yt(I)),P.vertexAttribIPointer(e,s,c,d,l)):I.vertexAttribPointer(e,s,c,y,d,l),I.enableVertexAttribArray(e),P.vertexAttribDivisor(e,S||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Hr.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),s=i.byteLength*e,c=i.length*e;let d=!this.buffer;if(this.buffer=this.buffer||new yn(this.gl,s),d=d||this.buffer.reallocate(s),d=d||!this._compareConstantArrayValues(i,this.bufferValue),d){const l=SO(n.constructor,c);AO({target:l,source:i,start:0,count:c}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ut(!1)}}static _setConstantIntArray(e,n,i){switch(ut(Yt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ut(!1)}}static _setConstantUintArray(e,n,i){switch(ut(Yt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ut(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ut(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const CO="VertexArray: attributes must be Buffers or constants (i.e. typed array)",IO=/^(.+)__LOCATION_([0-9]+)$/,MO=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class LO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Hr(e),yA(this,"VertexArray","v6.0",MO),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:s,accessor:c}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return s>=0&&(this.values[s]=n,this.accessors[s]=c,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,n,c)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:s,accessor:c}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return s>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[s]=n,this.accessors[s]=c,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new yn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof yn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof yn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),s=i()}),s}_resolveLocationAndAccessor(e,n,i,s){const c={location:-1,accessor:null},{location:d,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(d)||d<0)return this.unused[e]=n,Tt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),c;const y=this._getAttributeInfo(l||d);if(!y)return c;const w=this.accessors[d]||{},S=Zr.resolve(y.accessor,w,i,s),{size:I,type:P}=S;return ut(Number.isFinite(I)&&Number.isFinite(P)),{location:d,accessor:S}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=IO.exec(e),s=i?i[1]:e,c=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+c,name:s}:{location:-1}}_setAttribute(e,n){if(n instanceof yn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof yn){const i=n[0],s=n[1];this.setBuffer(e,i,s)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof yn){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(CO)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,i);for(let c=1;c<this.vertexArrayObject.MAX_ATTRIBUTES;c++)s=this.values[c],ArrayBuffer.isView(s)&&this._setConstantAttribute(c,s)}_setConstantAttributeZero(e,n){if(Hr.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Hr.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],s=this.accessors[n];if(!i)return;const{divisor:c}=s,d=c>0;if(e.isInstanced=e.isInstanced||d,i instanceof yn){const l=i;if(d){const y=l.getVertexCount(s);e.instanceCount=Math.min(e.instanceCount,y)}else{const y=l.getVertexCount(s);e.vertexCount=Math.min(e.vertexCount,y)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Tt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function kO(t,e){const{maxElts:n=16,size:i=1}=e;let s="[";for(let d=0;d<t.length&&d<n;++d)d>0&&(s+=",".concat(d%i===0?" ":"")),s+=gd(t[d],e);const c=t.length>n?"...":"]";return"".concat(s).concat(c)}function gd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return kO(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const s=t.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function lE(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:s=!1}=t;ut(n);const c=".*_.*",d=".*Matrix",l=n._uniformSetters,y={},w=Object.keys(l).sort();let S=0;for(const B of w)!B.match(c)&&!B.match(d)&&J_({table:y,header:e,uniforms:i,uniformName:B,undefinedOnly:s})&&S++;for(const B of w)B.match(d)&&J_({table:y,header:e,uniforms:i,uniformName:B,undefinedOnly:s})&&S++;for(const B of w)y[B]||J_({table:y,header:e,uniforms:i,uniformName:B,undefinedOnly:s})&&S++;let I=0;const P={};if(!s)for(const B in i){const G=i[B];y[B]||(I++,P[B]={Type:"NOT USED: ".concat(G),[e]:gd(G)})}return{table:y,count:S,unusedTable:P,unusedCount:I}}function J_(t){let{table:e,header:n,uniforms:i,uniformName:s,undefinedOnly:c}=t;const d=i[s],l=RO(d);return!c||!l?(e[s]={[n]:l?gd(d):"N/A","Uniform Type":l?d:"NOT PROVIDED"},!0):!1}function RO(t){return t!=null}function zO(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=cE(e,e.elements,null,n));const s=e.values;for(const c in s){const d=e._getAttributeInfo(c);if(d){let l="".concat(c,": ").concat(d.name);const y=e.accessors[d.location];y&&(l="".concat(c,": ").concat(DO(d.name,y))),i[l]=cE(e,s[c],y,n)}}return i}function cE(t,e,n,i){const{gl:s}=t;if(!e)return{[i]:"null","Format ":"N/A"};let c="NOT PROVIDED",d=1,l=0,y=0,w,S,I;if(n&&(c=n.type,d=n.size,c=String(c).replace("Array",""),w=c.indexOf("nt")!==-1),e instanceof yn){const P=e,{data:B,changed:G}=P.getDebugData();S=G?"*":"",I=B,y=P.byteLength,l=y/B.BYTES_PER_ELEMENT/d;let K;if(n){const de=n.divisor>0;K="".concat(de?"I ":"P "," ").concat(l," (x").concat(d,"=").concat(y," bytes ").concat(Ua(s,c),")")}else w=!0,K="".concat(y," bytes");return{[i]:"".concat(S).concat(gd(I,{size:d,isInteger:w})),"Format ":K}}return I=e,d=e.length,c=String(e.constructor.name).replace("Array",""),w=c.indexOf("nt")!==-1,{[i]:"".concat(gd(I,{size:d,isInteger:w})," (constant)"),"Format ":"".concat(d,"x").concat(c," (constant)")}}function DO(t,e){const{type:n,size:i}=e,s=IA(n,i);return s?"".concat(t," (").concat(s.name,")"):t}function OO(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const s=uE(i);e["in ".concat(s)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const s=uE(i);e["out ".concat(s)]={[n]:JSON.stringify(i.accessor)}}return e}function uE(t){const{type:e,size:n}=t.accessor,i=IA(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const hE=Zo()&&typeof document<"u";let FO=0;class BO{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=de=>_A(de),onAddHTML:i=null,onInitialize:s=()=>{},onRender:c=()=>{},onFinalize:d=()=>{},onError:l,gl:y=null,glOptions:w={},debug:S=!1,createFramebuffer:I=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:B=!0,stats:G=Il.get("animation-loop-".concat(FO++))}=e;let{useDevicePixels:K=!0}=e;"useDevicePixelRatio"in e&&(Tt.deprecated("useDevicePixelRatio","useDevicePixels")(),K=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:s,onRender:c,onFinalize:d,onError:l,gl:y,glOptions:w,debug:S,createFramebuffer:I},this.gl=y,this.needsRedraw=null,this.timeline=null,this.stats=G,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:B,useDevicePixels:K}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ut(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=bm.isSupported(this.gl,["timers"])?new bm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Tt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=hE?new Promise((e,n)=>{if(hE&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):Wz(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):Gz(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?ex(this.props.gl,e):this.onCreateContext(e),!eg(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Mz(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:s}=this.gl;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&Dz(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new vi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Rd="vs",sx="fs";function Jr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Q_={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function NO(t){const e={};for(const n in t){const i=t[n],s=UO(i);e[n]=s}return e}function UO(t){let e=dE(t);return e==="object"?t?"type"in t?Object.assign({},t,Q_[t.type]):"value"in t?(e=dE(t.value),Object.assign({type:e},t,Q_[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Q_[e])}function dE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const VO="vs",jO="fs";class fE{constructor(e){let{name:n,vs:i,fs:s,dependencies:c=[],uniforms:d,getUniforms:l,deprecations:y=[],defines:w={},inject:S={},vertexShader:I,fragmentShader:P}=e;Jr(typeof n=="string"),this.name=n,this.vs=i||I,this.fs=s||P,this.getModuleUniforms=l,this.dependencies=c,this.deprecations=this._parseDeprecationDefinitions(y),this.defines=w,this.injections=GO(S),d&&(this.uniforms=NO(d))}getModuleSource(e){let n;switch(e){case VO:n=this.vs||"";break;case jO:n=this.fs||"";break;default:Jr(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const s in i){const c=i[s];s in e&&!c.private?(c.validate&&Jr(c.validate(e[s],c),"".concat(this.name,": invalid ").concat(s)),n[s]=e[s]):n[s]=c.value}return n}}function GO(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const s=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[s][n]=i}return e}function WO(t){return HO(RA(t))}function HO(t){const e={},n={};return kA({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i])}function kA(t){let{modules:e,level:n,moduleMap:i,moduleDepth:s}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)i[c.name]=c,(s[c.name]===void 0||s[c.name]<n)&&(s[c.name]=n);for(const c of e)c.dependencies&&kA({modules:c.dependencies,level:n+1,moduleMap:i,moduleDepth:s})}function RA(t,e){return t.map(n=>(n instanceof fE||(Jr(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Jr(n.name,"shader module has no name"),n=new fE(n),n.dependencies=RA(n.dependencies)),n))}function $O(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,s=n.indexOf("Trident/")!==-1;return i||s}const qO=7936,ZO=7937,XO=7938,YO=35724,ox={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Sl={};Object.keys(ox).forEach(t=>{Sl[t]=t});function KO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function JO(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||qO),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||ZO);return{gpuVendor:QO(n,i),vendor:n,renderer:i,version:t.getParameter(XO),shadingLanguageVersion:t.getParameter(YO)}}function QO(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const ey={};function pE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=ox[e];if(Jr(i,e),!$O(n))return!0;if(e in ey)return ey[e];const s=i[0],c=n.behavior||"enable",d="#extension GL_".concat(s," : ").concat(c,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,d),t.compileShader(l);const y=t.getShaderParameter(l,35713);return t.deleteShader(l),ey[e]=y,y}function eF(t,e){const n=ox[e];Jr(n,e);const i=KO(t)&&n[1]||n[0],s=typeof i=="string"?!!t.getExtension(i):i;return Jr(s===!1||s===!0),s}function dp(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>eF(t,n))}function tF(t){switch(JO(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function nF(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return dp(t,Sl.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),dp(t,Sl.GLSL_DERIVATIVES)&&pE(t,Sl.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),dp(t,Sl.GLSL_FRAG_DATA)&&pE(t,Sl.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),dp(t,Sl.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const iF=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,rF=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,sF={[Rd]:iF,[sx]:rF},Np="__LUMA_INJECT_DECLARATIONS__",mE=/void\s+main\s*\([^)]*\)\s*\{\n?/,gE=/}\n?[^{}]*$/,ty=[];function _E(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=e===Rd;for(const c in n){const d=n[c];d.sort((y,w)=>y.order-w.order),ty.length=d.length;for(let y=0,w=d.length;y<w;++y)ty[y]=d[y].injection;const l="".concat(ty.join(`
`),`
`);switch(c){case"vs:#decl":s&&(t=t.replace(Np,l));break;case"vs:#main-start":s&&(t=t.replace(mE,y=>y+l));break;case"vs:#main-end":s&&(t=t.replace(gE,y=>l+y));break;case"fs:#decl":s||(t=t.replace(Np,l));break;case"fs:#main-start":s||(t=t.replace(mE,y=>y+l));break;case"fs:#main-end":s||(t=t.replace(gE,y=>l+y));break;default:t=t.replace(c,y=>y+l)}}return t=t.replace(Np,""),i&&(t=t.replace(/\}\s*$/,c=>c+sF[e])),t}function T0(t){const e={};return Jr(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function hu(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const zA=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],oF=[...zA,[hu("attribute"),"in $1"],[hu("varying"),"out $1"]],aF=[...zA,[hu("varying"),"in $1"]],DA=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],lF=[...DA,[hu("in"),"attribute $1"],[hu("out"),"varying $1"]],cF=[...DA,[hu("in"),"varying $1"]],S0="gl_FragColor",A0=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,uF=/void\s+main\s*\([^)]*\)\s*\{\n?/;function hF(t,e,n){switch(e){case 300:return n?wm(t,oF):dF(t);case 100:return n?wm(t,lF):fF(t);default:throw new Error("unknown GLSL version ".concat(e))}}function wm(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function dF(t){t=wm(t,aF);const e=t.match(A0);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(S0,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(uF,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(S0,"\\b"),"g"),n)}return t}function fF(t){t=wm(t,cF);const e=t.match(A0);if(e){const n=e[1];t=t.replace(A0,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),S0)}return t}const pF=`

`.concat(Np,`

`),OA={[Rd]:"vertex",[sx]:"fragment"},mF=`precision highp float;

`;function gF(t,e){const{vs:n,fs:i}=e,s=WO(e.modules||[]);return{gl:t,vs:yE(t,Object.assign({},e,{source:n,type:Rd,modules:s})),fs:yE(t,Object.assign({},e,{source:i,type:sx,modules:s})),getUniforms:_F(s)}}function yE(t,e){let{id:n,source:i,type:s,modules:c,defines:d={},hookFunctions:l=[],inject:y={},transpileToGLSL100:w=!1,prologue:S=!0,log:I}=e;Jr(typeof i=="string","shader source must be a string");const P=s===Rd,B=i.split(`
`);let G=100,K="",de=i;B[0].indexOf("#version ")===0?(G=300,K=B[0],de=B.slice(1).join(`
`)):K="#version ".concat(G);const Z={};c.forEach(Re=>{Object.assign(Z,Re.getDefines())}),Object.assign(Z,d);let j=S?"".concat(K,`
`).concat(vF({id:n,source:i,type:s}),`
`).concat(yF({type:s}),`
`).concat(tF(t),`
`).concat(nF(t),`
`).concat(xF(Z),`
`).concat(P?"":mF,`
`):"".concat(K,`
`);const q=wF(l),se={},pe={},be={};for(const Re in y){const Fe=typeof y[Re]=="string"?{injection:y[Re],order:0}:y[Re],Ve=Re.match(/^(v|f)s:(#)?([\w-]+)$/);if(Ve){const je=Ve[2],pt=Ve[3];je?pt==="decl"?pe[Re]=[Fe]:be[Re]=[Fe]:se[Re]=[Fe]}else be[Re]=[Fe]}for(const Re of c){I&&Re.checkDeprecations(de,I);const Fe=Re.getModuleSource(s,G);j+=Fe;const Ve=Re.injections[s];for(const je in Ve){const pt=je.match(/^(v|f)s:#([\w-]+)$/);if(pt){const St=pt[2]==="decl"?pe:be;St[je]=St[je]||[],St[je].push(Ve[je])}else se[je]=se[je]||[],se[je].push(Ve[je])}}return j+=pF,j=_E(j,s,pe),j+=bF(q[s],se),j+=de,j=_E(j,s,be),j=hF(j,w?100:G,P),j}function _F(t){return function(n){const i={};for(const s of t){const c=s.getUniforms(n,i);Object.assign(i,c)}return i}}function yF(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(OA[e].toUpperCase(),`
`)}function vF(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(OA[i],`

`):""}function xF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const s=t[i];(s||Number.isFinite(s))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function bF(t,e){let n="";for(const i in t){const s=t[i];if(n+="void ".concat(s.signature,` {
`),s.header&&(n+="  ".concat(s.header)),e[i]){const c=e[i];c.sort((d,l)=>d.order-l.order);for(const d of c)n+="  ".concat(d.injection,`
`)}s.footer&&(n+="  ".concat(s.footer)),n+=`}
`}return n}function wF(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[s,c]=n.split(":"),d=n.replace(/\(.+/,"");e[s][d]=Object.assign(i,{signature:c})}),e}const EF="void main() {gl_FragColor = vec4(0);}",FA=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,TF=`#version 300 es
`.concat(FA);function BA(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,s,c]=n;if(!e.includes(i)||!s||!c)return null;const d=c.split(";")[0];return{qualifier:i,type:s,name:d}}function NA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:s}=t;if(!n)return e===300?TF:e>300?"#version ".concat(e,`
`).concat(FA):EF;const c=PF(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(c,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(c,`;
}`)}function SF(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Jr(!1),null}}function AF(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Jr(!1),null}}function PF(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Jr(!1),null}}const CF=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,IF={name:"fp32",vs:CF,fs:null};function vE(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Yr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function MF(t,{precision:e=Yr.precision}={}){return t=LF(t),"".concat(parseFloat(t.toPrecision(e)))}function du(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ia(t,e,n){return RF(t,i=>Math.max(e,Math.min(n,i)))}function Em(t,e,n){return du(t)?t.map((i,s)=>Em(i,e[s],n)):n*e+(1-n)*t}function _d(t,e,n){const i=Yr.EPSILON;n&&(Yr.EPSILON=n);try{if(t===e)return!0;if(du(t)&&du(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!_d(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Yr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Yr.EPSILON=i}}function LF(t){return Math.round(t/Yr.EPSILON)*Yr.EPSILON}function kF(t){return t.clone?t.clone():new Array(t.length)}function RF(t,e,n){if(du(t)){const i=t;n=n||kF(i);for(let s=0;s<n.length&&s<i.length;++s)n[s]=e(t[s],s,n);return n}return e(t)}function zF(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class UA extends zF(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:du(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Yr)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+MF(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!_d(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const c=e[s];this[s]=c+i*(n[s]-c)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Yr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function DF(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function qr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function ny(t,e,n=""){if(Yr.debug&&!DF(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class OF extends UA{get x(){return this[0]}set x(e){this[0]=qr(e)}get y(){return this[1]}set y(e){this[1]=qr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];n+=s*s}return qr(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return qr(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return vE(e>=0&&e<this.ELEMENTS,"index is out of range"),qr(this[e])}setComponent(e,n){return vE(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Up=1e-6,fu=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function FF(){var t=new fu(2);return fu!=Float32Array&&(t[0]=0,t[1]=0),t}function xE(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function BF(t,e){return t[0]=-e[0],t[1]=-e[1],t}function VA(t,e,n,i){var s=e[0],c=e[1];return t[0]=s+i*(n[0]-s),t[1]=c+i*(n[1]-c),t}function NF(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t}(function(){var t=FF();return function(e,n,i,s,c,d){var l,y;for(n||(n=2),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],c(t,t,d),e[l]=t[0],e[l+1]=t[1];return e}})();function UF(t,e,n){const i=e[0],s=e[1],c=n[3]*i+n[7]*s||1;return t[0]=(n[0]*i+n[4]*s)/c,t[1]=(n[1]*i+n[5]*s)/c,t}function jA(t,e,n){const i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c||1;return t[0]=(n[0]*i+n[4]*s+n[8]*c)/d,t[1]=(n[1]*i+n[5]*s+n[9]*c)/d,t[2]=(n[2]*i+n[6]*s+n[10]*c)/d,t}function VF(t,e,n){const i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t[2]=e[2],t}function jF(){var t=new fu(3);return fu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function GF(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function WF(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function HF(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $F(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[0],l=n[1],y=n[2];return t[0]=s*y-c*l,t[1]=c*d-i*y,t[2]=i*l-s*d,t}function GA(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c+n[15];return d=d||1,t[0]=(n[0]*i+n[4]*s+n[8]*c+n[12])/d,t[1]=(n[1]*i+n[5]*s+n[9]*c+n[13])/d,t[2]=(n[2]*i+n[6]*s+n[10]*c+n[14])/d,t}function qF(t,e,n){var i=e[0],s=e[1],c=e[2];return t[0]=i*n[0]+s*n[3]+c*n[6],t[1]=i*n[1]+s*n[4]+c*n[7],t[2]=i*n[2]+s*n[5]+c*n[8],t}function ZF(t,e,n){var i=n[0],s=n[1],c=n[2],d=n[3],l=e[0],y=e[1],w=e[2],S=s*w-c*y,I=c*l-i*w,P=i*y-s*l,B=s*P-c*I,G=c*S-i*P,K=i*I-s*S,de=d*2;return S*=de,I*=de,P*=de,B*=2,G*=2,K*=2,t[0]=l+S+B,t[1]=y+I+G,t[2]=w+P+K,t}function XF(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0],c[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),c[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function YF(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),c[1]=s[1],c[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function KF(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),c[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),c[2]=s[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function JF(t,e){var n=t[0],i=t[1],s=t[2],c=e[0],d=e[1],l=e[2],y=Math.sqrt(n*n+i*i+s*s),w=Math.sqrt(c*c+d*d+l*l),S=y*w,I=S&&HF(t,e)/S;return Math.acos(Math.min(Math.max(I,-1),1))}var QF=GF;(function(){var t=jF();return function(e,n,i,s,c,d){var l,y;for(n||(n=3),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const iy=[0,0,0];let fp;class po extends OF{static get ZERO(){return fp||(fp=new po(0,0,0),Object.freeze(fp)),fp}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&du(e)?this.copy(e):(Yr.debug&&(qr(e),qr(n),qr(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Yr.debug&&(qr(e.x),qr(e.y),qr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=qr(e)}angle(e){return JF(this,e)}cross(e){return $F(this,this,e),this.check()}rotateX({radians:e,origin:n=iy}){return XF(this,this,n,e),this.check()}rotateY({radians:e,origin:n=iy}){return YF(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=iy}){return KF(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return GA(this,this,e),this.check()}transformAsVector(e){return jA(this,this,e),this.check()}transformByMatrix3(e){return qF(this,this,e),this.check()}transformByMatrix2(e){return VF(this,this,e),this.check()}transformByQuaternion(e){return ZF(this,this,e),this.check()}}class e4 extends UA{toString(){let e="[";if(Yr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=qr(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[i+s];return n}setColumn(e,n){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=n[s];return this}}function t4(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n4(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],c=e[6],d=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=c,t[11]=e[14],t[12]=s,t[13]=d,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function P0(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],l=e[5],y=e[6],w=e[7],S=e[8],I=e[9],P=e[10],B=e[11],G=e[12],K=e[13],de=e[14],Z=e[15],j=n*l-i*d,q=n*y-s*d,se=n*w-c*d,pe=i*y-s*l,be=i*w-c*l,Re=s*w-c*y,Fe=S*K-I*G,Ve=S*de-P*G,je=S*Z-B*G,pt=I*de-P*K,bt=I*Z-B*K,St=P*Z-B*de,kt=j*St-q*bt+se*pt+pe*je-be*Ve+Re*Fe;return kt?(kt=1/kt,t[0]=(l*St-y*bt+w*pt)*kt,t[1]=(s*bt-i*St-c*pt)*kt,t[2]=(K*Re-de*be+Z*pe)*kt,t[3]=(P*be-I*Re-B*pe)*kt,t[4]=(y*je-d*St-w*Ve)*kt,t[5]=(n*St-s*je+c*Ve)*kt,t[6]=(de*se-G*Re-Z*q)*kt,t[7]=(S*Re-P*se+B*q)*kt,t[8]=(d*bt-l*je+w*Fe)*kt,t[9]=(i*je-n*bt-c*Fe)*kt,t[10]=(G*be-K*se+Z*j)*kt,t[11]=(I*se-S*be-B*j)*kt,t[12]=(l*Ve-d*pt-y*Fe)*kt,t[13]=(n*pt-i*Ve+s*Fe)*kt,t[14]=(K*q-G*pe-de*j)*kt,t[15]=(S*pe-I*q+P*j)*kt,t):null}function i4(t){var e=t[0],n=t[1],i=t[2],s=t[3],c=t[4],d=t[5],l=t[6],y=t[7],w=t[8],S=t[9],I=t[10],P=t[11],B=t[12],G=t[13],K=t[14],de=t[15],Z=e*d-n*c,j=e*l-i*c,q=e*y-s*c,se=n*l-i*d,pe=n*y-s*d,be=i*y-s*l,Re=w*G-S*B,Fe=w*K-I*B,Ve=w*de-P*B,je=S*K-I*G,pt=S*de-P*G,bt=I*de-P*K;return Z*bt-j*pt+q*je+se*Ve-pe*Fe+be*Re}function kl(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],l=e[4],y=e[5],w=e[6],S=e[7],I=e[8],P=e[9],B=e[10],G=e[11],K=e[12],de=e[13],Z=e[14],j=e[15],q=n[0],se=n[1],pe=n[2],be=n[3];return t[0]=q*i+se*l+pe*I+be*K,t[1]=q*s+se*y+pe*P+be*de,t[2]=q*c+se*w+pe*B+be*Z,t[3]=q*d+se*S+pe*G+be*j,q=n[4],se=n[5],pe=n[6],be=n[7],t[4]=q*i+se*l+pe*I+be*K,t[5]=q*s+se*y+pe*P+be*de,t[6]=q*c+se*w+pe*B+be*Z,t[7]=q*d+se*S+pe*G+be*j,q=n[8],se=n[9],pe=n[10],be=n[11],t[8]=q*i+se*l+pe*I+be*K,t[9]=q*s+se*y+pe*P+be*de,t[10]=q*c+se*w+pe*B+be*Z,t[11]=q*d+se*S+pe*G+be*j,q=n[12],se=n[13],pe=n[14],be=n[15],t[12]=q*i+se*l+pe*I+be*K,t[13]=q*s+se*y+pe*P+be*de,t[14]=q*c+se*w+pe*B+be*Z,t[15]=q*d+se*S+pe*G+be*j,t}function Tm(t,e,n){var i=n[0],s=n[1],c=n[2],d,l,y,w,S,I,P,B,G,K,de,Z;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*c+e[12],t[13]=e[1]*i+e[5]*s+e[9]*c+e[13],t[14]=e[2]*i+e[6]*s+e[10]*c+e[14],t[15]=e[3]*i+e[7]*s+e[11]*c+e[15]):(d=e[0],l=e[1],y=e[2],w=e[3],S=e[4],I=e[5],P=e[6],B=e[7],G=e[8],K=e[9],de=e[10],Z=e[11],t[0]=d,t[1]=l,t[2]=y,t[3]=w,t[4]=S,t[5]=I,t[6]=P,t[7]=B,t[8]=G,t[9]=K,t[10]=de,t[11]=Z,t[12]=d*i+S*s+G*c+e[12],t[13]=l*i+I*s+K*c+e[13],t[14]=y*i+P*s+de*c+e[14],t[15]=w*i+B*s+Z*c+e[15]),t}function ax(t,e,n){var i=n[0],s=n[1],c=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function r4(t,e,n,i){var s=i[0],c=i[1],d=i[2],l=Math.hypot(s,c,d),y,w,S,I,P,B,G,K,de,Z,j,q,se,pe,be,Re,Fe,Ve,je,pt,bt,St,kt,Gn;return l<Up?null:(l=1/l,s*=l,c*=l,d*=l,y=Math.sin(n),w=Math.cos(n),S=1-w,I=e[0],P=e[1],B=e[2],G=e[3],K=e[4],de=e[5],Z=e[6],j=e[7],q=e[8],se=e[9],pe=e[10],be=e[11],Re=s*s*S+w,Fe=c*s*S+d*y,Ve=d*s*S-c*y,je=s*c*S-d*y,pt=c*c*S+w,bt=d*c*S+s*y,St=s*d*S+c*y,kt=c*d*S-s*y,Gn=d*d*S+w,t[0]=I*Re+K*Fe+q*Ve,t[1]=P*Re+de*Fe+se*Ve,t[2]=B*Re+Z*Fe+pe*Ve,t[3]=G*Re+j*Fe+be*Ve,t[4]=I*je+K*pt+q*bt,t[5]=P*je+de*pt+se*bt,t[6]=B*je+Z*pt+pe*bt,t[7]=G*je+j*pt+be*bt,t[8]=I*St+K*kt+q*Gn,t[9]=P*St+de*kt+se*Gn,t[10]=B*St+Z*kt+pe*Gn,t[11]=G*St+j*kt+be*Gn,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function WA(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[4],d=e[5],l=e[6],y=e[7],w=e[8],S=e[9],I=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*s+w*i,t[5]=d*s+S*i,t[6]=l*s+I*i,t[7]=y*s+P*i,t[8]=w*s-c*i,t[9]=S*s-d*i,t[10]=I*s-l*i,t[11]=P*s-y*i,t}function s4(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],l=e[2],y=e[3],w=e[8],S=e[9],I=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s-w*i,t[1]=d*s-S*i,t[2]=l*s-I*i,t[3]=y*s-P*i,t[8]=c*i+w*s,t[9]=d*i+S*s,t[10]=l*i+I*s,t[11]=y*i+P*s,t}function HA(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],l=e[2],y=e[3],w=e[4],S=e[5],I=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s+w*i,t[1]=d*s+S*i,t[2]=l*s+I*i,t[3]=y*s+P*i,t[4]=w*s-c*i,t[5]=S*s-d*i,t[6]=I*s-l*i,t[7]=P*s-y*i,t}function o4(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n+n,l=i+i,y=s+s,w=n*d,S=i*d,I=i*l,P=s*d,B=s*l,G=s*y,K=c*d,de=c*l,Z=c*y;return t[0]=1-I-G,t[1]=S+Z,t[2]=P-de,t[3]=0,t[4]=S-Z,t[5]=1-w-G,t[6]=B+K,t[7]=0,t[8]=P+de,t[9]=B-K,t[10]=1-w-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function a4(t,e,n,i,s,c,d){var l=1/(n-e),y=1/(s-i),w=1/(c-d);return t[0]=c*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c*2*y,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(s+i)*y,t[10]=(d+c)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*w,t[15]=0,t}function l4(t,e,n,i,s){var c=1/Math.tan(e/2),d;return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(d=1/(i-s),t[10]=(s+i)*d,t[14]=2*s*i*d):(t[10]=-1,t[14]=-2*i),t}var c4=l4;function u4(t,e,n,i,s,c,d){var l=1/(e-n),y=1/(i-s),w=1/(c-d);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*l,t[13]=(s+i)*y,t[14]=(d+c)*w,t[15]=1,t}var h4=u4;function d4(t,e,n,i){var s,c,d,l,y,w,S,I,P,B,G=e[0],K=e[1],de=e[2],Z=i[0],j=i[1],q=i[2],se=n[0],pe=n[1],be=n[2];return Math.abs(G-se)<Up&&Math.abs(K-pe)<Up&&Math.abs(de-be)<Up?t4(t):(S=G-se,I=K-pe,P=de-be,B=1/Math.hypot(S,I,P),S*=B,I*=B,P*=B,s=j*P-q*I,c=q*S-Z*P,d=Z*I-j*S,B=Math.hypot(s,c,d),B?(B=1/B,s*=B,c*=B,d*=B):(s=0,c=0,d=0),l=I*d-P*c,y=P*s-S*d,w=S*c-I*s,B=Math.hypot(l,y,w),B?(B=1/B,l*=B,y*=B,w*=B):(l=0,y=0,w=0),t[0]=s,t[1]=l,t[2]=S,t[3]=0,t[4]=c,t[5]=y,t[6]=I,t[7]=0,t[8]=d,t[9]=w,t[10]=P,t[11]=0,t[12]=-(s*G+c*K+d*de),t[13]=-(l*G+y*K+w*de),t[14]=-(S*G+I*K+P*de),t[15]=1,t)}function f4(){var t=new fu(4);return fu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function p4(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function zd(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*c+n[12]*d,t[1]=n[1]*i+n[5]*s+n[9]*c+n[13]*d,t[2]=n[2]*i+n[6]*s+n[10]*c+n[14]*d,t[3]=n[3]*i+n[7]*s+n[11]*c+n[15]*d,t}(function(){var t=f4();return function(e,n,i,s,c,d){var l,y;for(n||(n=4),i||(i=0),s?y=Math.min(s*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var C0;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(C0||(C0={}));const m4=45*Math.PI/180,g4=1,ry=.1,sy=500,_4=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class mo extends e4{static get IDENTITY(){return v4()}static get ZERO(){return y4()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return C0}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,s,c,d,l,y,w,S,I,P,B,G,K,de){return this[0]=e,this[1]=n,this[2]=i,this[3]=s,this[4]=c,this[5]=d,this[6]=l,this[7]=y,this[8]=w,this[9]=S,this[10]=I,this[11]=P,this[12]=B,this[13]=G,this[14]=K,this[15]=de,this.check()}setRowMajor(e,n,i,s,c,d,l,y,w,S,I,P,B,G,K,de){return this[0]=e,this[1]=c,this[2]=w,this[3]=B,this[4]=n,this[5]=d,this[6]=S,this[7]=G,this[8]=i,this[9]=l,this[10]=I,this[11]=K,this[12]=s,this[13]=y,this[14]=P,this[15]=de,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(_4)}fromObject(e){return this.check()}fromQuaternion(e){return o4(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:s,top:c,near:d=ry,far:l=sy}=e;return l===1/0?x4(this,n,i,s,c,d):a4(this,n,i,s,c,d,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:s=[0,1,0]}=e;return d4(this,n,i,s),this.check()}ortho(e){const{left:n,right:i,bottom:s,top:c,near:d=ry,far:l=sy}=e;return h4(this,n,i,s,c,d,l),this.check()}orthographic(e){const{fovy:n=m4,aspect:i=g4,focalDistance:s=1,near:c=ry,far:d=sy}=e;bE(n);const l=n/2,y=s*Math.tan(l),w=y*i;return this.ortho({left:-w,right:w,bottom:-y,top:y,near:c,far:d})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:s=.1,far:c=500}=e;return bE(n),c4(this,n,i,s,c),this.check()}determinant(){return i4(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*s,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*s,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return n4(this,this),this.check()}invert(){return P0(this,this),this.check()}multiplyLeft(e){return kl(this,e,this),this.check()}multiplyRight(e){return kl(this,this,e),this.check()}rotateX(e){return WA(this,this,e),this.check()}rotateY(e){return s4(this,this,e),this.check()}rotateZ(e){return HA(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return r4(this,this,e,n),this.check()}scale(e){return ax(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Tm(this,this,e),this.check()}transform(e,n){return e.length===4?(n=zd(n||[-0,-0,-0,-0],e,this),ny(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let s;switch(i){case 2:s=NF(n||[-0,-0],e,this);break;case 3:s=GA(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ny(s,e.length),s}transformAsVector(e,n){let i;switch(e.length){case 2:i=UF(n||[-0,-0],e,this);break;case 3:i=jA(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ny(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let pp,mp;function y4(){return pp||(pp=new mo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(pp)),pp}function v4(){return mp||(mp=new mo,Object.freeze(mp)),mp}function bE(t){if(t>Math.PI*2)throw Error("expected radians")}function x4(t,e,n,i,s,c){const d=2*c/(n-e),l=2*c/(s-i),y=(n+e)/(n-e),w=(s+i)/(s-i),S=-1,I=-1,P=-2*c;return t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=y,t[9]=w,t[10]=S,t[11]=I,t[12]=0,t[13]=0,t[14]=P,t[15]=0,t}const wE=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,b4={lightSources:{}};function oy(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function w4(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const s={};return e?s["lighting_uAmbientLight.color"]=oy(e):s["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((c,d)=>{s["lighting_uPointLight[".concat(d,"].color")]=oy(c),s["lighting_uPointLight[".concat(d,"].position")]=c.position,s["lighting_uPointLight[".concat(d,"].attenuation")]=c.attenuation||[1,0,0]}),s.lighting_uPointLightCount=n.length,i.forEach((c,d)=>{s["lighting_uDirectionalLight[".concat(d,"].color")]=oy(c),s["lighting_uDirectionalLight[".concat(d,"].direction")]=c.direction}),s.lighting_uDirectionalLightCount=i.length,s}function $A(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:b4;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},w4({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return $A({lightSources:e})}return{}}const E4={name:"lights",vs:wE,fs:wE,getUniforms:$A,defines:{MAX_LIGHTS:3}},T4=new Uint8Array([0,255,255,255]),S4={pickingSelectedColor:null,pickingHighlightColor:T4,pickingActive:!1,pickingAttribute:!1};function A4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:S4;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const P4=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,C4=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,I4={name:"picking",vs:P4,fs:C4,getUniforms:A4},M4=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,L4={};function k4(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:s.map(c=>c/255)}}function R4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:L4;if(!("material"in t))return{};const{material:e}=t;return e?k4(e):{lighting_uEnabled:!1}}const z4={name:"gouraud-lighting",dependencies:[E4],vs:M4,defines:{LIGHTING_VERTEX:1},getUniforms:R4},D4=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,O4={name:"transform",vs:D4,fs:null};class Dd{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Dd(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:s={},inject:c={},varyings:d=[],bufferMode:l=35981,transpileToGLSL100:y=!1}=e,w=this._getModuleList(e.modules),S=this._getHash(n),I=this._getHash(i),P=w.map(q=>this._getHash(q.name)).sort(),B=d.map(q=>this._getHash(q)),G=Object.keys(s).sort(),K=Object.keys(c).sort(),de=[],Z=[];for(const q of G)de.push(this._getHash(q)),de.push(this._getHash(s[q]));for(const q of K)Z.push(this._getHash(q)),Z.push(this._getHash(c[q]));const j="".concat(S,"/").concat(I,"D").concat(de.join("/"),"M").concat(P.join("/"),"I").concat(Z.join("/"),"V").concat(B.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(y?"T":"");if(!this._programCache[j]){const q=gF(this.gl,{vs:n,fs:i,modules:w,inject:c,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:y});this._programCache[j]=new MA(this.gl,{hash:j,vs:q.vs,fs:q.fs,varyings:d,bufferMode:l}),this._getUniforms[j]=q.getUniforms||(se=>{}),this._useCounts[j]=0}return this._useCounts[j]++,this._programCache[j]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const l=this._defaultModules[c],y=l.name;n[s++]=l,i[y]=!0}for(let c=0,d=e.length;c<d;++c){const l=e[c],y=l.name;i[y]||(n[s++]=l,i[y]=!0)}return n.length=s,n}}const F4={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function B4(t,e,n){const i={};let s=e.indices;for(const c in e.attributes){const d=e.attributes[c],l=N4(c,n);if(c==="indices")s=d;else if(d.constant)i[l]=d.value;else{const y=d.value,w={...d};delete w.value,i[l]=[new yn(t,y),w],U4(c,w)}}if(s){const c=s.value||s;ut(c instanceof Uint16Array||c instanceof Uint32Array,'attribute array for "indices" must be of integer type');const d={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};i.indices=[new yn(t,{data:c,target:34963}),d]}return i}function N4(t,e){const{attributeMap:n=F4}=e||{};return n&&n[t]||t}function U4(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ut(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Pc=2,V4=1e4,j4="Model needs drawMode and vertexCount",EE=()=>{},G4={};class Ul{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Wa("model")}=n;ut(eg(e)),this.id=i,this.gl=e,this.id=n.id||Wa("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Dd.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ut(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),j4)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=e;this.programProps={program:n,vs:i,fs:s,modules:c,defines:d,inject:l,varyings:y,bufferMode:w,transpileToGLSL100:S},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ut(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ut(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=B4(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(uu(e))return this;const n={};for(const i in e){const s=e[i];n[i]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return nx(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:s={},attributes:c={},transformFeedback:d=this.transformFeedback,parameters:l={},vertexArray:y=this.vertexArray}=e;this.setAttributes(c),this.updateModuleSettings(n),this.setUniforms(s);let w;Tt.priority>=Pc&&(w=this._logDrawCallStart(Pc));const S=this.vertexArray.getDrawParams(),{isIndexed:I=S.isIndexed,indexType:P=S.indexType,indexOffset:B=S.indexOffset,vertexArrayInstanced:G=S.isInstanced}=this.props;G&&!this.isInstanced&&Tt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:K,instanceCount:de}=this,{onBeforeRender:Z=EE,onAfterRender:j=EE}=this.props;Z(),this.program.setUniforms(this.uniforms);const q=this.program.draw(Object.assign(G4,e,{logPriority:w,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:y,transformFeedback:d,isIndexed:I,indexType:P,isInstanced:K,instanceCount:de,offset:I?B:0}));return j(),Tt.priority>=Pc&&this._logDrawCallEnd(w,y,i),q}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:s=[]}=e;let{parameters:c}=e;i&&this._setFeedbackBuffers(i),n&&(c=Object.assign({},c,{35977:n})),s.forEach(d=>d.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:c}))}finally{s.forEach(d=>d.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Tt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:s,modules:c,inject:d,defines:l,varyings:y,bufferMode:w,transpileToGLSL100:S}=this.programProps;n=this.programManager.get({vs:i,fs:s,modules:c,inject:d,defines:l,varyings:y,bufferMode:w,transpileToGLSL100:S}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ut(n instanceof MA,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new LO(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof yn&&n.delete()}}_setAnimationProps(e){this.animated&&ut(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(uu(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new LA(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:V4;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Tt.group(Pc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Tt.level<=2})(),e}_logDrawCallEnd(e,n,i,s){if(e===void 0)return;const c=zO({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:d,unusedTable:l,unusedCount:y}=lE({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:w,count:S}=lE({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});S>0&&Tt.log("MISSING UNIFORMS",Object.keys(w))(),y>0&&Tt.log("UNUSED UNIFORMS",Object.keys(l))();const I=OO(this.vertexArray.configuration);Tt.table(e,c)(),Tt.table(e,d)(),Tt.table(e+1,I)(),s&&s.log({logLevel:Pc,message:"Rendered to ".concat(s.id)}),Tt.groupEnd(Pc)()}}class W4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:s}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof yn?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ut(Yt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const c=this.feedbackMap[s];s in n&&(i[c]=s)}Object.assign(i,e.feedbackBuffers);for(const s in i){const c=i[s];if(typeof c=="string"){const d=n[c],{byteLength:l,usage:y,accessor:w}=d;i[s]=this._createNewBuffer(s,{byteLength:l,usage:y,accessor:w})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:s}=i;e.transformFeedback=new LA(this.gl,{program:s,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const s in this.feedbackMap){const c=this.feedbackMap[s];n[s]=e.feedbackBuffers[c],i[c]=e.sourceBuffers[s],ut(i[c]instanceof yn)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new yn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const H4="transform_uSampler_",Sm="transform_uSize_",TE="transform_position";function $4(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:s}=t,d=Object.keys(n).length,l=null;const y={};let w=e,S={};if(d>0||i){const I=w.split(`
`),P=I.slice();if(I.forEach((B,G,K)=>{if(d>0){const de=K4(B,n);if(de){const{updatedLine:Z,inject:j}=de;P[G]=Z,S=T0([S,j]),Object.assign(y,de.samplerTextureMap),d--}}i&&!l&&(l=Y4(B,i))}),i){ut(s);const B="".concat(Sm).concat(i),G="uniform vec2 ".concat(B,`;
`),K="     vec2 ".concat(TE," = transform_getPos(").concat(B,`);
     gl_Position = vec4(`).concat(TE,`, 0, 1.);
`);S=T0([S,{"vs:#decl":G,"vs:#main-start":K}])}w=P.join(`
`)}return{vs:w,targetTextureType:l,inject:S,samplerTextureMap:y}}function q4(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const s={};let c,d;n&&({width:c,height:d}=i,s["".concat(Sm).concat(n)]=[c,d]);for(const l in e)({width:c,height:d}=e[l]),s["".concat(Sm).concat(l)]=[c,d];return s}function Z4(t){return BA(t,["attribute","in"])}function X4(t){const e="".concat(H4).concat(t),n="".concat(Sm).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function Y4(t,e){const n=BA(t,["varying","out"]);return n&&n.name===e?n.type:null}function K4(t,e){const n={},i=Z4(t);if(!i)return null;const{type:s,name:c}=i;if(c&&e[c]){const d="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:y,uniformDeclerations:w}=X4(c),S=SF(s),I="  ".concat(s," ").concat(c," = transform_getInput(").concat(l,", ").concat(y,").").concat(S,`;
`);return n[l]=c,{updatedLine:d,inject:{"vs:#decl":w,"vs:#main-start":I},samplerTextureMap:n}}return null}const J4={10241:9728,10240:9728,10242:33071,10243:33071},Q4="transform_output";class eB{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:s,targetTexture:c}=this.bindings[this.currentIndex],d=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),y=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){d.transform_elementID=this.elementIDBuffer;for(const I in this.samplerTextureMap){const P=this.samplerTextureMap[I];l[I]=i[P]}this._setSourceTextureParameters();const S=q4({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:c});Object.assign(l,S)}return this.hasTargetTexture&&(w=!1,y.viewport=[0,0,s.width,s.height]),{attributes:d,framebuffer:s,uniforms:l,discard:w,parameters:y}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=ng(n);if(!e)return i;const s=i.constructor,c=AF(this.targetTextureType),d=new s(i.length*c/4);let l=0;for(let y=0;y<i.length;y+=4)for(let w=0;w<c;w++)d[l++]=i[y+w];return d}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof es)return i;const s=n[i];return s?(this._targetRefTexName=i,this._createNewTexture(s)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:s}=e,c=this._createTargetTexture({sourceTextures:i,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:c}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,s,c)=>{c[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new yn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:s,targetTexture:c}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,s),Object.assign(e.sourceBuffers,i),c){e.targetTexture=c;const{width:d,height:l}=c,{framebuffer:y}=e;y?(y.update({attachments:{36064:c},resizeAttachments:!1}),y.resize({width:d,height:l})):e.framebuffer=new vi(this.gl,{id:"transform-framebuffer",width:d,height:l,attachments:{36064:c}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(J4)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=xD(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:s,uniforms:c,targetTextureType:d,inject:l,samplerTextureMap:y}=$4({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),w=T0([e.inject||{},l]);this.targetTextureType=d,this.samplerTextureMap=y;const S=e._fs||NA({version:CA(s),input:this.targetTextureVarying,inputType:d,output:Q4}),I=this.hasSourceTextures||this.targetTextureVarying?[O4].concat(e.modules||[]):e.modules;return{vs:s,fs:S,modules:I,uniforms:c,inject:w}}}class lx{static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ut(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const s=i.getData(e);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Ul(n,Object.assign({},e,{fs:e.fs||NA({version:CA(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=s.updateModelProps(n);return n}_buildResourceTransforms(e,n){tB(n)&&(this.bufferTransform=new W4(e,n)),nB(n)&&(this.textureTransform=new eB(e,n)),ut(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of i)n=Object.assign(n,s.getDrawOptions(n));return n}}function tB(t){return!!(!uu(t.feedbackBuffers)||!uu(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function nB(t){return!!(!uu(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const SE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Od{static get DRAW_MODE(){return SE}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Wa("geometry"),drawMode:i=SE.TRIANGLES,attributes:s={},indices:c=null,vertexCount:d=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(s,c),this.vertexCount=d||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let s=e[i];s=ArrayBuffer.isView(s)?{value:s}:s,ut(ArrayBuffer.isView(s.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!s.size&&(s.size=3),i==="indices"?(ut(!this.indices),this.indices=s):this.attributes[i]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const s in e){const c=e[s],{value:d,size:l,constant:y}=c;!y&&d&&l>=1&&(i=Math.min(i,d.length/l))}return ut(Number.isFinite(i)),i}}let iB=1,rB=1;class qA{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:c=1}=e,d=iB++,l={time:0,delay:n,duration:i,rate:s,repeat:c};return this._setChannelTime(l,this.time),this.channels.set(d,l),d}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const s of n)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:c,channel:d}=s;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=rB++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const sB=[255,255,255],oB=1;let aB=0;class ZA{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","ambient");const{color:n=sB}=e,{intensity:i=oB}=e;this.id=e.id||"ambient-".concat(aB++),this.color=n,this.intensity=i}}const lB=[255,255,255],cB=1,uB=[0,0,-1];let hB=0;class I0{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","directional"),U(this,"direction",void 0),U(this,"shadow",void 0);const{color:n=lB}=e,{intensity:i=cB}=e,{direction:s=uB}=e,{_shadow:c=!1}=e;this.id=e.id||"directional-".concat(hB++),this.color=n,this.intensity=i,this.type="directional",this.direction=new po(s).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class dB{constructor(e,n={id:"pass"}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class cx extends dB{constructor(...e){super(...e),U(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Ho(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:s,views:c,onViewportActive:d,clearStack:l=!0,clearCanvas:y=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;y&&pB(w,n),l&&(this._lastRenderIndex=-1);const S=[];for(const I of s){const P=c&&c[I.id];d==null||d(I);const B=this._getDrawLayerParams(I,e),G=I.subViewports||[I];for(const K of G){const de=this._drawLayersInViewport(w,{target:n,moduleParameters:i,viewport:K,view:P,pass:e.pass,layers:e.layers},B);S.push(de)}}return S}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:s=!1,layerFilter:c,cullRect:d,effects:l,moduleParameters:y},w=!1){const S=[],I=XA(this._lastRenderIndex+1),P={layer:n[0],viewport:e,isPicking:s,renderPass:i,cullRect:d},B={};for(let G=0;G<n.length;G++){const K=n[G],de=this._shouldDrawLayer(K,P,c,B),Z={shouldDrawLayer:de};de&&!w&&(Z.layerRenderIndex=I(K,de),Z.moduleParameters=this._getModuleParameters(K,l,i,y),Z.layerParameters=this.getLayerParameters(K,G,e)),S[G]=Z}return S}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:s,target:c,viewport:d,view:l},y){const w=fB(e,{moduleParameters:i,target:c,viewport:d});if(l&&l.props.clear){const I=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Ns(e,{scissorTest:!0,scissor:w},()=>nx(e,I))}const S={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Ho(e,{viewport:w});for(let I=0;I<n.length;I++){const P=n[I],{shouldDrawLayer:B,layerRenderIndex:G,moduleParameters:K,layerParameters:de}=y[I];if(B&&P.props.pickable&&S.pickableCount++,P.isComposite)S.compositeCount++;else if(B){S.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,G),K.viewport=d;try{P._drawLayer({moduleParameters:K,uniforms:{layerIndex:G},parameters:de})}catch(Z){P.raiseError(Z,"drawing ".concat(P," to ").concat(s))}}}return S}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(n))return!1;n.layer=d,d=d.parent}if(i){const l=n.layer.id;if(l in s||(s[l]=i(n)),!s[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,s){var c;const d=Object.assign(Object.create(((c=e.internalState)===null||c===void 0?void 0:c.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:cu(this.gl)});if(n)for(const y of n){var l;Object.assign(d,(l=y.getModuleParameters)===null||l===void 0?void 0:l.call(y,e))}return Object.assign(d,this.getModuleParameters(e,n),s)}}function XA(t=0,e={}){const n={},i=(s,c)=>{const d=s.props._offset,l=s.id,y=s.parent&&s.parent.id;let w;if(y&&!(y in e)&&i(s.parent,!1),y in n){const S=n[y]=n[y]||XA(e[y],e);w=S(s,c),n[l]=S}else Number.isFinite(d)?(w=d+(e[y]||0),n[l]=null):w=t;return c&&w>=t&&(t=w+1),e[l]=w,w};return i}function fB(t,{moduleParameters:e,target:n,viewport:i}){const s=n&&n.id!=="default-framebuffer",c=e&&e.devicePixelRatio||cu(t),d=s?n.height:t.drawingBufferHeight,l=i;return[l.x*c,d-(l.y+l.height)*c,l.width*c,l.height*c]}function pB(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Ho(t,{viewport:[0,0,n,i]}),t.clear(16640)}class mB extends cx{constructor(e,n){super(e,n),U(this,"shadowMap",void 0),U(this,"depthBuffer",void 0),U(this,"fbo",void 0),this.shadowMap=new es(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Gc(e,{format:33189,width:1,height:1}),this.fbo=new vi(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Ns(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],s=cu(this.gl),c=i.width*s,d=i.height*s;(c!==n.width||d!==n.height)&&n.resize({width:c,height:d}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const YA="#define SMOOTH_EDGE_RADIUS 0.5",gB=`
`.concat(YA,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),_B=`
`.concat(YA,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),yB={name:"geometry",vs:gB,fs:_B},vB=Object.keys(cn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(cn[t],";")).join(""),xB=Object.keys(co).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(co[t],";")).join(""),bB=Object.keys(Bl).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Bl[t],";")).join(""),wB="".concat(vB,`
`).concat(xB,`
`).concat(bB,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function EB(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Fd(t){let e={},n;return i=>{for(const s in i)if(!EB(i[s],e[s])){n=t(i),e=i;break}return n}}const AE=[0,0,0,0],TB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],KA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SB=[0,0,0],JA=[0,0,0],AB=Fd(IB);function QA(t,e,n=JA){n.length<3&&(n=[n[0],n[1],0]);let i=n,s,c=!0;switch(e===cn.LNGLAT_OFFSETS||e===cn.METER_OFFSETS?s=n:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case co.WEB_MERCATOR:(e===cn.LNGLAT||e===cn.CARTESIAN)&&(s=[0,0,0],c=!1);break;case co.WEB_MERCATOR_AUTO_OFFSET:e===cn.LNGLAT?i=s:e===cn.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case co.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case co.GLOBE:c=!1,s=null;break;default:c=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:c}}function PB(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:s}=t;let{viewMatrix:c,viewProjectionMatrix:d}=t,l=AE,y=AE,w=t.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:I,offsetMode:P}=QA(t,e,n);return P&&(y=t.projectPosition(S||I),w=[w[0]-y[0],w[1]-y[1],w[2]-y[2]],y[3]=1,l=zd([],y,d),c=i||c,d=kl([],s,c),d=kl([],d,TB)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:l,originCommon:y,cameraPosCommon:w,shaderCoordinateOrigin:I,geospatialOrigin:S}}function CB({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=cn.DEFAULT,coordinateOrigin:s=JA,autoWrapLongitude:c=!1}){i===cn.DEFAULT&&(i=t.isGeospatial?cn.LNGLAT:cn.CARTESIAN);const d=AB({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return d.project_uWrapLongitude=c,d.project_uModelMatrix=n||KA,d}function IB({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:l,shaderCoordinateOrigin:y,geospatialOrigin:w}=PB(t,n,i),S=t.getDistanceScales(),I=[t.width*e,t.height*e],P=zd([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,B={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:d.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:I,project_uDevicePixelRatio:e,project_uFocalDistance:P,project_uCommonUnitsPerMeter:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:SB,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:KA,project_uCameraPosition:l};if(w){const G=t.getDistanceScales(w);switch(n){case cn.METER_OFFSETS:B.project_uCommonUnitsPerWorldUnit=G.unitsPerMeter,B.project_uCommonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case cn.LNGLAT:case cn.LNGLAT_OFFSETS:t._pseudoMeters||(B.project_uCommonUnitsPerMeter=G.unitsPerMeter),B.project_uCommonUnitsPerWorldUnit=G.unitsPerDegree,B.project_uCommonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case cn.CARTESIAN:B.project_uCommonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],B.project_uCommonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break}}return B}const MB={};function LB(t=MB){return"viewport"in t?CB(t):{}}const ux={name:"project",dependencies:[IF,yB],vs:wB,getUniforms:LB};function kB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jc(t,e){const n=zd([],e,t);return p4(n,n,1/n[3]),n}function PE(t,e){const n=t%e;return n<0?e+n:n}function M0(t,e,n){return t<e?e:t>n?n:t}function RB(t){return Math.log(t)*Math.LOG2E}const hx=Math.log2||RB;function $o(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ds=Math.PI,eP=Ds/4,vs=Ds/180,L0=180/Ds,pu=512,Am=4003e4,gp=85.051129,zB=1.5;function DB(t){return hx(t)}function Pm(t){const[e,n]=t;$o(Number.isFinite(e)),$o(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*vs,s=n*vs,c=pu*(i+Ds)/(2*Ds),d=pu*(Ds+Math.log(Math.tan(eP+s*.5)))/(2*Ds);return[c,d]}function mu(t){const[e,n]=t,i=e/pu*(2*Ds)-Ds,s=2*(Math.atan(Math.exp(n/pu*(2*Ds)-Ds))-eP);return[i*L0,s*L0]}function OB(t){const{latitude:e}=t;$o(Number.isFinite(e));const n=Math.cos(e*vs);return DB(Am*n)-9}function ay(t){const e=Math.cos(t*vs);return pu/Am/e}function k0(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;$o(Number.isFinite(e)&&Number.isFinite(n));const s=pu,c=Math.cos(e*vs),d=s/360,l=d/c,y=s/Am/c,w={unitsPerMeter:[y,y,y],metersPerUnit:[1/y,1/y,1/y],unitsPerDegree:[d,l,y],degreesPerUnit:[1/d,1/l,1/y]};if(i){const S=vs*Math.tan(e*vs)/c,I=d*S/2,P=s/Am*S,B=P/l*y;w.unitsPerDegree2=[0,I,P],w.unitsPerMeter2=[B,0,B]}return w}function tP(t,e){const[n,i,s]=t,[c,d,l]=e,{unitsPerMeter:y,unitsPerMeter2:w}=k0({longitude:n,latitude:i,highPrecision:!0}),S=Pm(t);S[0]+=c*(y[0]+w[0]*d),S[1]+=d*(y[1]+w[1]*d);const I=mu(S),P=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[I[0],I[1],P]:I}function FB(t){const{height:e,pitch:n,bearing:i,altitude:s,scale:c,center:d}=t,l=kB();Tm(l,l,[0,0,-s]),WA(l,l,-n*vs),HA(l,l,i*vs);const y=c/e;return ax(l,l,[y,y,y]),d&&Tm(l,l,WF([],d)),l}function BB(t){const{width:e,height:n,altitude:i,pitch:s=0,offset:c,center:d,scale:l,nearZMultiplier:y=1,farZMultiplier:w=1}=t;let{fovy:S=Cm(zB)}=t;i!==void 0&&(S=Cm(i));const I=S*vs,P=s*vs,B=nP(S);let G=B;d&&(G+=d[2]*l/Math.cos(P)/n);const K=I*(.5+(c?c[1]:0)/n),de=Math.sin(K)*G/Math.sin(M0(Math.PI/2-P-K,.01,Math.PI-.01)),Z=Math.sin(P)*de+G,j=G*10,q=Math.min(Z*w,j);return{fov:I,aspect:e/n,focalDistance:B,near:y,far:q}}function Cm(t){return 2*Math.atan(.5/t)*L0}function nP(t){return .5/Math.tan(.5*t*vs)}function iP(t,e){const[n,i,s=0]=t;return $o(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),Jc(e,[n,i,s,1])}function dx(t,e,n=0){const[i,s,c]=t;if($o(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(c))return Jc(e,[i,s,c,1]);const d=Jc(e,[i,s,0,1]),l=Jc(e,[i,s,1,1]),y=d[2],w=l[2],S=y===w?0:((n||0)-y)/(w-y);return VA([],d,l,S)}function NB(t){const{width:e,height:n,bounds:i,minExtent:s=0,maxZoom:c=24,offset:d=[0,0]}=t,[[l,y],[w,S]]=i,I=UB(t.padding),P=Pm([l,M0(S,-gp,gp)]),B=Pm([w,M0(y,-gp,gp)]),G=[Math.max(Math.abs(B[0]-P[0]),s),Math.max(Math.abs(B[1]-P[1]),s)],K=[e-I.left-I.right-Math.abs(d[0])*2,n-I.top-I.bottom-Math.abs(d[1])*2];$o(K[0]>0&&K[1]>0);const de=K[0]/G[0],Z=K[1]/G[1],j=(I.right-I.left)/2/de,q=(I.top-I.bottom)/2/Z,se=[(B[0]+P[0])/2+j,(B[1]+P[1])/2+q],pe=mu(se),be=Math.min(c,hx(Math.abs(Math.min(de,Z))));return $o(Number.isFinite(be)),{longitude:pe[0],latitude:pe[1],zoom:be}}function UB(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:($o(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const CE=Math.PI/180;function VB(t,e=0){const{width:n,height:i,unproject:s}=t,c={targetZ:e},d=s([0,i],c),l=s([n,i],c);let y,w;const S=t.fovy?.5*t.fovy*CE:Math.atan(.5/t.altitude),I=(90-t.pitch)*CE;return S>I-.01?(y=IE(t,0,e),w=IE(t,n,e)):(y=s([0,0],c),w=s([n,0],c)),[d,l,w,y]}function IE(t,e,n){const{pixelUnprojectionMatrix:i}=t,s=Jc(i,[e,0,1,1]),c=Jc(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-s[2])/(c[2]-s[2]),y=VA([],s,c,l),w=mu(y);return w.push(n),w}const ME=512;function jB(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:s,latitude:c,zoom:d,bearing:l=0}=t;(s<-180||s>180)&&(s=PE(s+180,360)-180),(l<-180||l>180)&&(l=PE(l+180,360)-180);const y=hx(n/ME);if(d<=y)d=y,c=0;else{const w=n/2/Math.pow(2,d),S=mu([0,w])[1];if(c<S)c=S;else{const I=mu([0,ME-w])[1];c>I&&(c=I)}}return{width:e,height:n,longitude:s,latitude:c,zoom:d,pitch:i,bearing:l}}const GB=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,WB=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,HB=Fd(YB),$B=Fd(KB),qB=[0,0,0,1],ZB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function XB(t,e){const[n,i,s]=t,c=dx([n,i,s],e);return Number.isFinite(s)?c:[c[0],c[1],0]}function YB({viewport:t,center:e}){return new mo(t.viewProjectionMatrix).invert().transform(e)}function KB({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,c=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(d=>XB(d,i));for(const d of e){const l=d.clone().translate(new po(t.center).negate()),y=c.map(S=>l.transform(S)),w=new mo().ortho({left:Math.min(...y.map(S=>S[0])),right:Math.max(...y.map(S=>S[0])),bottom:Math.min(...y.map(S=>S[1])),top:Math.max(...y.map(S=>S[1])),near:Math.min(...y.map(S=>-S[2])),far:Math.max(...y.map(S=>-S[2]))});n.push(w.multiplyRight(d))}return n}function JB(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||qB,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=HB({viewport:t.viewport,center:e.project_uCenter}),c=[],d=$B({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const y=d[l],w=y.clone().translate(new po(t.viewport.center).negate());e.project_uCoordinateSystem===cn.LNGLAT&&e.project_uProjectionMode===co.WEB_MERCATOR?(d[l]=w,c[l]=s):(d[l]=y.clone().multiplyRight(ZB),c[l]=w.transform(s))}for(let l=0;l<d.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=d[l],i["shadow_uProjectCenters[".concat(l,"]")]=c[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const ly={name:"shadow",dependencies:[ux],vs:GB,fs:WB,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?JB(t,e):{}},QB={color:[255,255,255],intensity:1},LE=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],eN=[0,0,0,200/255];class fx{constructor(e={}){U(this,"id","lighting-effect"),U(this,"props",void 0),U(this,"shadowColor",eN),U(this,"shadow",void 0),U(this,"ambientLight",void 0),U(this,"directionalLights",void 0),U(this,"pointLights",void 0),U(this,"shadowPasses",[]),U(this,"shadowMaps",[]),U(this,"dummyShadowMap",null),U(this,"programManager",void 0),U(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:s,onViewportActive:c,views:d}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Dd.getDefaultProgramManager(e),ly&&this.programManager.addDefaultModule(ly)),this.dummyShadowMap||(this.dummyShadowMap=new es(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:s,onViewportActive:c,views:d,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(ly),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new mo().lookAt({eye:new po(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new mB(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new ZA(QB),this.directionalLights.push(new I0(LE[0]),new I0(LE[1])))}}class tN{constructor(e={}){U(this,"_pool",[]),U(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:s,padding:c=0,copy:d=!1,initialize:l=!1,maxCount:y}){const w=s||e&&e.constructor||Float32Array,S=n*i+c;if(ArrayBuffer.isView(e)){if(S<=e.length)return e;if(S*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,S)}let I=1/0;y&&(I=y*i+c);const P=this._allocate(w,S,l,I);return e&&d?P.set(e):l||P.fill(0,0,4),this._release(e),P}release(e){this._release(e)}_allocate(e,n,i,s){let c=Math.max(Math.ceil(n*this.opts.overAlloc),1);c>s&&(c=s);const d=this._pool,l=e.BYTES_PER_ELEMENT*c,y=d.findIndex(w=>w.byteLength>=l);if(y>=0){const w=new e(d.splice(y,1)[0],0,c);return i&&w.fill(0),w}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:s}=i,c=n.findIndex(d=>d.byteLength>=s);c<0?n.push(i):(c>0||n.length<this.opts.poolSize)&&n.splice(c,0,i),n.length>this.opts.poolSize&&n.shift()}}const gu=new tN;function Dh(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function nN(t){return[t[12],t[13],t[14]]}function iN(t){return{left:Cc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Cc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Cc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Cc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Cc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Cc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const kE=new po;function Cc(t,e,n,i){kE.set(t,e,n);const s=kE.len();return{distance:i/s,normal:new po(-t/s,-e/s,-n/s)}}function rN(t){return t-Math.fround(t)}let Ph;function cy(t,e){const{size:n=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,c=(s-i)/n;Ph=gu.allocate(Ph,c,{type:Float32Array,size:n*2});let d=i,l=0;for(;d<s;){for(let y=0;y<n;y++){const w=t[d++];Ph[l+y]=w,Ph[l+y+n]=rN(w)}l+=n*2}return Ph.subarray(0,c*n*2)}function sN(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const oN=Math.PI/180,aN=Dh(),RE=[0,0,0],lN={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function cN({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:s,padding:c,near:d,far:l}){const y=t/e,w=n?new mo().orthographic({fovy:i,aspect:y,focalDistance:s,near:d,far:l}):new mo().perspective({fovy:i,aspect:y,near:d,far:l});if(c){const{left:S=0,right:I=0,top:P=0,bottom:B=0}=c,G=Ia((S+t-I)/2,0,t)-t/2,K=Ia((P+e-B)/2,0,e)-e/2;w[8]-=G*2/t,w[9]+=K*2/e}return w}class wu{constructor(e={}){U(this,"id",void 0),U(this,"x",void 0),U(this,"y",void 0),U(this,"width",void 0),U(this,"height",void 0),U(this,"padding",void 0),U(this,"isGeospatial",void 0),U(this,"zoom",void 0),U(this,"focalDistance",void 0),U(this,"position",void 0),U(this,"modelMatrix",void 0),U(this,"distanceScales",void 0),U(this,"scale",void 0),U(this,"center",void 0),U(this,"cameraPosition",void 0),U(this,"projectionMatrix",void 0),U(this,"viewMatrix",void 0),U(this,"viewMatrixUncentered",void 0),U(this,"viewMatrixInverse",void 0),U(this,"viewProjectionMatrix",void 0),U(this,"pixelProjectionMatrix",void 0),U(this,"pixelUnprojectionMatrix",void 0),U(this,"resolution",void 0),U(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||lN,this.focalDistance=e.focalDistance||1,this.position=e.position||RE,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?co.WEB_MERCATOR:co.WEB_MERCATOR_AUTO_OFFSET:co.IDENTITY}equals(e){return e instanceof wu?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&_d(e.projectionMatrix,this.projectionMatrix)&&_d(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),s=iP(i,this.pixelProjectionMatrix),[c,d]=s,l=n?d:this.height-d;return e.length===2?[c,l]:[c,l,s[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[s,c,d]=e,l=n?c:this.height-c,y=i&&i*this.distanceScales.unitsPerMeter[2],w=dx([s,l,d],this.pixelUnprojectionMatrix,y),[S,I,P]=this.unprojectPosition(w);return Number.isFinite(d)?[S,I,P]:Number.isFinite(i)?[S,I,i]:[S,I]}projectPosition(e){const[n,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,s]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,s]}projectFlat(e){if(this.isGeospatial){const n=Pm(e);return n[1]=Ia(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?mu(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),s=this.unproject([this.width,0],n),c=this.unproject([0,this.height],n),d=this.unproject([this.width,this.height],n);return[Math.min(i[0],s[0],c[0],d[0]),Math.min(i[1],s[1],c[1],d[1]),Math.max(i[0],s[0],c[0],d[0]),Math.max(i[1],s[1],c[1],d[1])]}getDistanceScales(e){return e?k0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,iN(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=OB({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||k0({latitude:i,longitude:n}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:c,modelMatrix:d}=e;let l=RE;if(c&&(l=d?new mo(d).transformAsVector(c,[]):c),this.isGeospatial){const y=this.projectPosition([n,i,0]);this.center=new po(l).scale(this.distanceScales.unitsPerMeter).add(y)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=aN,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:c,fovy:d=75,near:l=.1,far:y=1e3,padding:w=null,focalDistance:S=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new mo().multiplyRight(n).translate(new po(this.center).negate()),this.projectionMatrix=i||cN({width:this.width,height:this.height,orthographic:s,fovyRadians:c||d*oN,focalDistance:S,padding:w,near:l,far:y});const I=Dh();kl(I,I,this.projectionMatrix),kl(I,I,this.viewMatrix),this.viewProjectionMatrix=I,this.viewMatrixInverse=P0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=nN(this.viewMatrixInverse);const P=Dh(),B=Dh();ax(P,P,[this.width/2,-this.height/2,1]),Tm(P,P,[1,-1,0]),kl(B,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=P0(Dh(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Zt.warn("Pixel project matrix not invertible")()}}U(wu,"displayName","Viewport");class _u extends wu{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:s=0,pitch:c=0,bearing:d=0,nearZMultiplier:l=.1,farZMultiplier:y=1.01,nearZ:w,farZ:S,orthographic:I=!1,projectionMatrix:P,repeat:B=!1,worldOffset:G=0,position:K,padding:de,legacyMeterSizes:Z=!1}=e;let{width:j,height:q,altitude:se=1.5}=e;const pe=Math.pow(2,s);j=j||1,q=q||1;let be,Re=null;if(P)se=P[5]/2,be=Cm(se);else{e.fovy?(be=e.fovy,se=nP(be)):be=Cm(se);let Ve;if(de){const{top:je=0,bottom:pt=0}=de;Ve=[0,Ia((je+q-pt)/2,0,q)-q/2]}Re=BB({width:j,height:q,scale:pe,center:K&&[0,0,K[2]*ay(n)],offset:Ve,pitch:c,fovy:be,nearZMultiplier:l,farZMultiplier:y}),Number.isFinite(w)&&(Re.near=w),Number.isFinite(S)&&(Re.far=S)}let Fe=FB({height:q,pitch:c,bearing:d,scale:pe,altitude:se});G&&(Fe=new mo().translate([512*G,0,0]).multiplyLeft(Fe)),super({...e,width:j,height:q,viewMatrix:Fe,longitude:i,latitude:n,zoom:s,...Re,fovy:be,focalDistance:se}),U(this,"longitude",void 0),U(this,"latitude",void 0),U(this,"pitch",void 0),U(this,"bearing",void 0),U(this,"altitude",void 0),U(this,"fovy",void 0),U(this,"orthographic",void 0),U(this,"_subViewports",void 0),U(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=s,this.pitch=c,this.bearing=d,this.altitude=se,this.fovy=be,this.orthographic=I,this._subViewports=B?[]:null,this._pseudoMeters=Z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=n;s<=i;s++){const c=s?new _u({...this,worldOffset:s}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),s=(e[2]||0)*ay(e[1]);return[n,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),s=(e[2]||0)/ay(i);return[n,i,s]}addMetersToLngLat(e,n){return tP(e,n)}panByPosition(e,n){const i=dx(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),c=xE([],s,BF([],i)),d=xE([],this.center,c),[l,y]=this.unprojectFlat(d);return{longitude:l,latitude:y}}getBounds(e={}){const n=VB(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:s}=this,{longitude:c,latitude:d,zoom:l}=NB({width:i,height:s,bounds:e,...n});return new _u({width:i,height:s,longitude:c,latitude:d,zoom:l})}}U(_u,"displayName","WebMercatorViewport");const zE=[0,0,0];function uy(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof _u){const[s,c,d=0]=t,l=e.getDistanceScales([s,c]);i[2]=d*l.unitsPerMeter[2]}return i}function uN(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:s,fromCoordinateSystem:c,fromCoordinateOrigin:d}=t;return s===cn.DEFAULT&&(s=e.isGeospatial?cn.LNGLAT:cn.CARTESIAN),c===void 0&&(c=s),d===void 0&&(d=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function rP(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:s,offsetMode:c}){let[d,l,y=0]=t;switch(n&&([d,l,y]=zd([],[d,l,y,1],n)),i){case cn.LNGLAT:return uy([d,l,y],e,c);case cn.LNGLAT_OFFSETS:return uy([d+s[0],l+s[1],y+(s[2]||0)],e,c);case cn.METER_OFFSETS:return uy(tP(s,[d,l,y]),e,c);case cn.CARTESIAN:default:return e.isGeospatial?[d+s[0],l+s[1],y+s[2]]:e.projectPosition([d,l,y])}}function hN(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:s,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:l}=uN(e),{autoOffset:y=!0}=e,{geospatialOrigin:w=zE,shaderCoordinateOrigin:S=zE,offsetMode:I=!1}=y?QA(n,i,s):{},P=rP(t,{viewport:n,modelMatrix:c,coordinateSystem:d,coordinateOrigin:l,offsetMode:I});if(I){const B=n.projectPosition(w||S);QF(P,P,B)}return P}const Vl=Math.PI/180,dN=1e3*60*60*24,fN=2440588,pN=2451545,Im=Vl*23.4397,mN=357.5291,gN=.98560028,_N=280.147,yN=360.9856235;function vN(t,e,n){const i=Vl*-n,s=Vl*e,c=bN(t),d=IN(c),l=AN(c,i)-d.rightAscension;return{azimuth:TN(l,s,d.declination),altitude:SN(l,s,d.declination)}}function DE(t,e,n){const{azimuth:i,altitude:s}=vN(t,e,n);return[Math.sin(i)*Math.cos(s),Math.cos(i)*Math.cos(s),-Math.sin(s)]}function xN(t){return(typeof t=="number"?t:t.getTime())/dN-.5+fN}function bN(t){return xN(t)-pN}function wN(t,e){const n=t;return Math.atan2(Math.sin(n)*Math.cos(Im)-Math.tan(e)*Math.sin(Im),Math.cos(n))}function EN(t,e){const n=t;return Math.asin(Math.sin(e)*Math.cos(Im)+Math.cos(e)*Math.sin(Im)*Math.sin(n))}function TN(t,e,n){const i=t,s=e,c=n;return Math.atan2(Math.sin(i),Math.cos(i)*Math.sin(s)-Math.tan(c)*Math.cos(s))}function SN(t,e,n){const i=t,s=e,c=n;return Math.asin(Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos(i))}function AN(t,e){return Vl*(_N+yN*t)-e}function PN(t){return Vl*(mN+gN*t)}function CN(t){const e=t,n=Vl*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e)),i=Vl*102.9372;return e+n+i+Math.PI}function IN(t){const e=PN(t),n=CN(e);return{declination:EN(n,0),rightAscension:wN(n,0)}}class MN extends I0{constructor(e){super(e),U(this,"timestamp",void 0),this.timestamp=e.timestamp}getProjectedLight({layer:e}){const{viewport:n}=e.context;if(n.resolution&&n.resolution>0){const[s,c,d]=DE(this.timestamp,0,0);this.direction=[s,-d,c]}else{const{latitude:s,longitude:c}=n;this.direction=DE(this.timestamp,s,c)}return this}}const OE={blendFunc:[1,0,32771,0],blendEquation:32774};class sP extends cx{constructor(...e){super(...e),U(this,"pickZ",void 0),U(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:c,pickingFBO:d,deviceRect:{x:l,y,width:w,height:S},cullRect:I,effects:P,pass:B="picking",pickZ:G,moduleParameters:K}){const de=this.gl;this.pickZ=G;const Z=this._resetColorEncoder(G),j=Ns(de,{scissorTest:!0,scissor:[l,y,w,S],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...OE,blend:!G},()=>super.render({target:d,layers:e,layerFilter:n,views:i,viewports:s,onViewportActive:c,cullRect:I,effects:P==null?void 0:P.filter(se=>se.useInPicking),pass:B,isPicking:!0,moduleParameters:K}));return this._colorEncoderState=null,{decodePickingColor:Z&&kN.bind(null,Z),stats:j}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const s={...e.props.parameters},{pickable:c,operation:d}=e.props;return this._colorEncoderState?c&&d.includes("draw")&&(Object.assign(s,OE),s.blend=!0,s.blendColor=LN(this._colorEncoderState,e,i)):s.blend=!1,d.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function LN(t,e,n){const{byLayer:i,byAlpha:s}=t;let c,d=i.get(e);return d?(d.viewports.push(n),c=d.a):(c=i.size+1,c<=255?(d={a:c,layer:e,viewports:[n]},i.set(e,d),s[c]=d):(Zt.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function kN(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Mc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Mm=Symbol.for("component"),Va=Symbol.for("propTypes"),hy=Symbol.for("deprecatedProps"),Qc=Symbol.for("asyncPropDefaults"),jl=Symbol.for("asyncPropOriginal"),Ma=Symbol.for("asyncPropResolved");function px(t,e=()=>!0){return Array.isArray(t)?oP(t,e,[]):e(t)?[t]:[]}function oP(t,e,n){let i=-1;for(;++i<t.length;){const s=t[i];Array.isArray(s)?oP(s,e,n):e(s)&&n.push(s)}return n}function RN({target:t,source:e,start:n=0,count:i=1}){const s=e.length,c=i*s;let d=0;for(let l=n;d<s;d++)t[l++]=e[d];for(;d<c;)d<c-d?(t.copyWithin(n+d,n,n+d),d*=2):(t.copyWithin(n+d,n,n+c-d),d=c);return t}class zN{constructor(e,n,i){U(this,"id",void 0),U(this,"context",void 0),U(this,"isLoaded",void 0),U(this,"persistent",void 0),U(this,"_loadCount",0),U(this,"_subscribers",new Set),U(this,"_data",void 0),U(this,"_loader",void 0),U(this,"_error",void 0),U(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=xm(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class DN{constructor({gl:e,protocol:n}){U(this,"protocol",void 0),U(this,"_context",void 0),U(this,"_resources",void 0),U(this,"_consumers",void 0),U(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:s=!0}){let c=this._resources[e];c?c.setData(n,i):(c=new zN(e,n,this._context),this._resources[e]=c),c.persistent=s}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const s=n[i],c=this._resources[s.resourceId];c&&c.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:s="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=c[e];if(this._track(i,s,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,s){const c=this._consumers,d=c[e]=c[e]||{},l=d[n]||{},y=l.resourceId&&this._resources[l.resourceId];y&&(y.unsubscribe(l),this.prune()),i&&(d[n]=l,l.onChange=s,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const ON=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Bd={name:"project32",dependencies:[ux],vs:ON},Nd={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...I4},FN=[ux],BN=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function NN(t){const e=Dd.getDefaultProgramManager(t);for(const n of FN)e.addDefaultModule(n);for(const n of BN)e.addShaderHook(n);return e}const UN="layerManager.setLayers",VN="layerManager.activateViewport";class jN{constructor(e,{deck:n,stats:i,viewport:s,timeline:c}={}){U(this,"layers",void 0),U(this,"context",void 0),U(this,"resourceManager",void 0),U(this,"_lastRenderedLayers",[]),U(this,"_needsRedraw",!1),U(this,"_needsUpdate",!1),U(this,"_nextLayers",null),U(this,"_debug",!1),U(this,"activateViewport",d=>{Qi(VN,this,d),d&&(this.context.viewport=d)}),this.layers=[],this.resourceManager=new DN({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&NN(e),stats:i||new Hv({id:"deck.gl"}),viewport:s||new wu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new qA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);n=n||s}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Qi(UN,this,n,e),this._lastRenderedLayers=e;const i=px(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const d of e)i[d.id]?Zt.warn("Multiple old layers with same id ".concat(d.id))():i[d.id]=d;const s=[];this._updateSublayersRecursively(n,i,s),this._finalizeOldLayers(i);let c=!1;for(const d of s)if(d.hasUniformTransition()){c="Uniform transition in ".concat(d);break}this._needsUpdate=c,this.layers=s}_updateSublayersRecursively(e,n,i){for(const s of e){s.context=this.context;const c=n[s.id];c===null&&Zt.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;let d=null;try{this._debug&&c!==s&&s.validateProps(),c?(this._transferLayerState(c,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),d=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}d&&this._updateSublayersRecursively(d,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Mc.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Mc.MATCHED,n!==e&&(e.lifecycle=Mc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Mc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Mc.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function uo(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!uo(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!uo(t[c],e[c],n-1))return!1;return!0}return!1}class GN{constructor(e){U(this,"width",void 0),U(this,"height",void 0),U(this,"views",void 0),U(this,"viewState",void 0),U(this,"controllers",void 0),U(this,"timeline",void 0),U(this,"_viewports",void 0),U(this,"_viewportMap",void 0),U(this,"_isUpdating",void 0),U(this,"_needsRedraw",void 0),U(this,"_needsUpdate",void 0),U(this,"_eventManager",void 0),U(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let c=i.length-1;c>=0;--c){const d=i[c];if(d.containsPixel(s)){const l=e.slice();return l[0]-=d.x,l[1]-=d.y,d.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=px(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!uo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Zt.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>{var d;return(d=this.getView(e.id))===null||d===void 0?void 0:d.makeViewport({viewState:c,width:this.width,height:this.height})}})}_updateController(e,n,i,s){const c=e.controller;if(c&&i){const d={...n,...c,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==c.type)&&(s=this._createController(e,d)),s&&s.setProps(d),s}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const c=e[s],d=this.getViewState(c),l=c.makeViewport({viewState:d,width:this.width,height:this.height});let y=n[c.id];const w=!!c.controller;w&&!y&&(i=!0),(i||!w)&&y&&(y.finalize(),y=null),this.controllers[c.id]=this._updateController(c,d,l,y),l&&this._viewports.unshift(l)}for(const s in n){const c=n[s];c&&!this.controllers[s]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,s)=>!e[s].equals(n[s]))}}const WN=/([0-9]+\.?[0-9]*)(%|px)/;function xa(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=WN.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function ba(t,e){return t.relative?Math.round(t.position*e):t.position}function Ii(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class yu{constructor(e){U(this,"id",void 0),U(this,"viewportInstance",void 0),U(this,"_x",void 0),U(this,"_y",void 0),U(this,"_width",void 0),U(this,"_height",void 0),U(this,"_padding",void 0),U(this,"props",void 0);const{id:n,x:i=0,y:s=0,width:c="100%",height:d="100%",padding:l=null,viewportInstance:y}=e||{};Ii(!y||y instanceof wu),this.viewportInstance=y,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xa(i),this._y=xa(s),this._width=xa(c),this._height=xa(d),this._padding=l&&{left:xa(l.left||0),right:xa(l.right||0),top:xa(l.top||0),bottom:xa(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&uo(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:ba(this._x,e),y:ba(this._y,n),width:ba(this._width,e),height:ba(this._height,n)};return this._padding&&(i.padding={left:ba(this._padding.left,e),top:ba(this._padding.top,n),right:ba(this._padding.right,e),bottom:ba(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ud{constructor(e){U(this,"_inProgress",void 0),U(this,"_handle",void 0),U(this,"_timeline",void 0),U(this,"time",void 0),U(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const FE=()=>{},R0={BREAK:1,SNAP_TO_END:2,IGNORE:3},HN=t=>t,$N=R0.BREAK;class qN{constructor(e){U(this,"getControllerState",void 0),U(this,"props",void 0),U(this,"propsInTransition",void 0),U(this,"transition",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:s,startProps:c,endProps:d,duration:l,easing:y}}=n,w=y(i/l),S=s.interpolateProps(c,d,w);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ud(e.timeline),this.onViewStateChange=e.onViewStateChange||FE,this.onStateChange=e.onStateChange||FE}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;s={...i,...c===R0.SNAP_TO_END?d:this.propsInTransition||i}}this._triggerTransition(s,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===R0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),s=this.getControllerState(n).shortestPathFrom(i),c=n.transitionInterpolator,d=c.getDuration?c.getDuration(e,n):n.transitionDuration;if(d===0)return;const l=c.initializeProps(e,s);this.propsInTransition={};const y={duration:d,easing:n.transitionEasing||HN,interpolator:c,interruption:n.transitionInterruption||$N,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(y),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class ZN{constructor(e){U(this,"_propsToCompare",void 0),U(this,"_propsToExtract",void 0),U(this,"_requiredProps",void 0);const{compare:n,extract:i,required:s}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=s}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!_d(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},s={};for(const c of this._propsToExtract)(c in e||c in n)&&(i[c]=e[c],s[c]=n[c]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Ii(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const XN=["longitude","latitude","zoom","bearing","pitch"],YN=["longitude","latitude","zoom"];class aP extends ZN{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:XN,required:YN},super(i.transitionProps),U(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:s,around:c}=this.opts;if(s&&c){const d=s(e),l=s(n),y=d.unproject(c);i.start.around=c,Object.assign(i.end,{around:l.project(y),aroundPosition:y,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const s={};for(const c of this._propsToExtract)s[c]=Em(e[c]||0,n[c]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...n,...s});Object.assign(s,c.panByPosition(n.aroundPosition,Em(e.around,n.around,i)))}return s}}const wa={transitionDuration:0},KN=300,_p=t=>1-(1-t)*(1-t),Ic={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},bl={};class JN{constructor(e){U(this,"props",void 0),U(this,"state",{}),U(this,"transitionManager",void 0),U(this,"eventManager",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"makeViewport",void 0),U(this,"_controllerState",void 0),U(this,"_events",{}),U(this,"_interactionState",{isDragging:!1}),U(this,"_customEvents",[]),U(this,"_eventStartBlocked",null),U(this,"_panMove",!1),U(this,"invertPan",!1),U(this,"dragMode","rotate"),U(this,"inertia",0),U(this,"scrollZoom",!0),U(this,"dragPan",!0),U(this,"dragRotate",!0),U(this,"doubleClickZoom",!0),U(this,"touchZoom",!0),U(this,"touchRotate",!1),U(this,"keyboard",!0),this.transitionManager=new qN({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:s}=e;return[s.x-n,s.y-i]}isPointInBounds(e,n){const{width:i,height:s}=this.props;if(n&&n.handled)return!1;const c=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return c&&n&&n.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?KN:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:l=!0,touchRotate:y=!1,keyboard:w=!0}=e,S=!!this.onViewStateChange;this.toggleEvents(Ic.WHEEL,S&&i),this.toggleEvents(Ic.PAN,S),this.toggleEvents(Ic.PINCH,S&&(l||y)),this.toggleEvents(Ic.TRIPLE_PAN,S&&y),this.toggleEvents(Ic.DOUBLE_TAP,S&&d),this.toggleEvents(Ic.KEYBOARD,S&&w),this.scrollZoom=i,this.dragPan=s,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=l,this.touchRotate=y,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const s={...e.getViewportProps(),...n},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:d})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(s,wa,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,wa,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:_p},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wa,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:_p},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*i)));c<0&&d!==0&&(d=1/d);const l=this.controllerState.zoom({pos:n,scale:d});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,wa,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wa,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*n/2],c=this.controllerState.rotate({pos:s});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:_p},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return bl._startPinchRotation=e.rotation,bl._lastPinchEvent=e,this.updateViewport(i,wa,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);n=n.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:bl._startPinchRotation-i})}return this.updateViewport(n,wa,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),bl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=bl;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const s=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),l=(d-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),y=Math.pow(2,d+l*n/2);c=c.zoom({pos:s,scale:y}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:_p},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return bl._startPinchRotation=null,bl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let y;const w={};switch(e.srcEvent.code){case"Minus":y=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),w.isZooming=!0;break;case"Equal":y=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),w.isZooming=!0;break;case"ArrowLeft":n?(y=l.rotateLeft(c),w.isRotating=!0):(y=l.moveLeft(s),w.isPanning=!0);break;case"ArrowRight":n?(y=l.rotateRight(c),w.isRotating=!0):(y=l.moveRight(s),w.isPanning=!0);break;case"ArrowUp":n?(y=l.rotateUp(d),w.isRotating=!0):(y=l.moveUp(s),w.isPanning=!0);break;case"ArrowDown":n?(y=l.rotateDown(d),w.isRotating=!0):(y=l.moveDown(s),w.isPanning=!0);break;default:return!1}return this.updateViewport(y,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?wa:e?{...n,transitionInterpolator:new aP({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class QN{constructor(e,n){U(this,"_viewportProps",void 0),U(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const BE=5,e5=1.2;class t5 extends QN{constructor(e){const{width:n,height:i,latitude:s,longitude:c,zoom:d,bearing:l=0,pitch:y=0,altitude:w=1.5,position:S=[0,0,0],maxZoom:I=20,minZoom:P=0,maxPitch:B=60,minPitch:G=0,startPanLngLat:K,startZoomLngLat:de,startRotatePos:Z,startBearing:j,startPitch:q,startZoom:se,normalize:pe=!0}=e;Ii(Number.isFinite(c)),Ii(Number.isFinite(s)),Ii(Number.isFinite(d)),super({width:n,height:i,latitude:s,longitude:c,zoom:d,bearing:l,pitch:y,altitude:w,maxZoom:I,minZoom:P,maxPitch:B,minPitch:G,normalize:pe,position:S},{startPanLngLat:K,startZoomLngLat:de,startRotatePos:Z,startBearing:j,startPitch:q,startZoom:se}),U(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:c,startPitch:d}=this.getState();if(!s||c===void 0||d===void 0)return this;let l;return e?l=this._getNewRotation(e,s,d,c):l={bearing:c+n,pitch:d+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:s,startZoomLngLat:c}=this.getState();if(c||(s=this.getViewportProps().zoom,c=this._unproject(n)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:l}=this.getViewportProps();let y=s+Math.log2(i);y=Ia(y,l,d);const w=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...w.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:c}=i;return Math.abs(s-n.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(c-n.longitude)>180&&(i.longitude=c<0?c+360:c-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:s}=e;e.zoom=Ia(s,i,n);const{maxPitch:c,minPitch:d,pitch:l}=e;e.pitch=Ia(l,d,c);const{normalize:y=!0}=e;return y&&Object.assign(e,jB(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,s){const c=e[0]-n[0],d=e[1]-n[1],l=e[1],y=n[1],{width:w,height:S}=this.getViewportProps(),I=c/w;let P=0;d>0?Math.abs(S-y)>BE&&(P=d/(y-S)*e5):d<0&&y>BE&&(P=1-l/y),P=Ia(P,-1,1);const{minPitch:B,maxPitch:G}=this.getViewportProps(),K=s+180*I;let de=i;return P>0?de=i+P*(G-i):P<0&&(de=i-P*(B-i)),{pitch:de,bearing:K}}}class n5 extends JN{constructor(...e){super(...e),U(this,"ControllerState",t5),U(this,"transition",{transitionDuration:300,transitionInterpolator:new aP({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),U(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class lP extends yu{get ViewportType(){return _u}get ControllerType(){return n5}}U(lP,"displayName","MapView");const i5=new fx;function r5(t,e){var n,i;const s=(n=t.order)!==null&&n!==void 0?n:1/0,c=(i=e.order)!==null&&i!==void 0?i:1/0;return s-c}class s5{constructor(){U(this,"effects",void 0),U(this,"_resolvedEffects",[]),U(this,"_defaultEffects",[]),U(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(s=>r5(s,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(uo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const s of this.effects)n[s.id]=s;const i=[];for(const s of e){const c=n[s.id];c&&c!==s?c.setProps?(c.setProps(s.props),i.push(c)):(c.cleanup(),i.push(s)):i.push(s),delete n[s.id]}for(const s in n)n[s].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof fx)||this._resolvedEffects.push(i5),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class o5 extends cx{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const a5="deckRenderer.renderLayers";class l5{constructor(e){U(this,"gl",void 0),U(this,"layerFilter",void 0),U(this,"drawPickingColors",void 0),U(this,"drawLayersPass",void 0),U(this,"pickLayersPass",void 0),U(this,"renderCount",void 0),U(this,"_needsRedraw",void 0),U(this,"renderBuffers",void 0),U(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new o5(e),this.pickLayersPass=new sP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||vi.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,c=n.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,Qi(a5,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new vi(this.gl),new vi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,s={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const c of e)if(c.postRender){if(c.id===this.lastPostProcessEffect){s.target=n.target,c.postRender(this.gl,s);break}const d=c.postRender(this.gl,s);s.inputBuffer=d,s.swapBuffer=d===i[0]?i[1]:i[0]}}}const c5={pickedColor:null,pickedObjectIndex:-1};function u5({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:s,deviceRect:c}){const{x:d,y:l,width:y,height:w}=c;let S=s*s,I=-1,P=0;for(let B=0;B<w;B++){const G=B+l-i,K=G*G;if(K>S)P+=4*y;else for(let de=0;de<y;de++){if(t[P+3]-1>=0){const j=de+d-n,q=j*j+K;q<=S&&(S=q,I=P)}P+=4}}if(I>=0){const B=t.slice(I,I+4),G=e(B);if(G){const K=Math.floor(I/4/y),de=I/4-K*y;return{...G,pickedColor:B,pickedX:d+de,pickedY:l+K}}Zt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return c5}function h5({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const c=t.slice(i,i+4),d=c.join(",");if(!n.has(d)){const l=e(c);l?n.set(d,{...l,color:c}):Zt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function cP({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:s,z:c}){let d=e[0];e.length>1&&(d=f5((t==null?void 0:t.pickedViewports)||e,{x:i,y:s}));let l;if(d){const y=[i-d.x,s-d.y];c!==void 0&&(y[2]=c),l=d.unproject(y)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function d5(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:s}=t,{pickedColor:c,pickedLayer:d,pickedObjectIndex:l}=e,y=d?[d]:[];if(i==="hover"){const I=n.index,P=n.layerId,B=d?d.props.id:null;if(B!==P||l!==I){if(B!==P){const G=s.find(K=>K.props.id===P);G&&y.unshift(G)}n.layerId=B,n.index=l,n.info=null}}const w=cP(t),S=new Map;return S.set(null,w),y.forEach(I=>{let P={...w};I===d&&(P.color=c,P.index=l,P.picked=!0),P=uP({layer:I,info:P,mode:i});const B=P.layer;I===d&&i==="hover"&&(n.info=P),S.set(B.id,P),i==="hover"&&B.updateAutoHighlight(P)}),S}function uP({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function f5(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class p5{constructor(e){U(this,"gl",void 0),U(this,"pickingFBO",void 0),U(this,"depthFBO",void 0),U(this,"pickLayersPass",void 0),U(this,"layerFilter",void 0),U(this,"lastPickedInfo",void 0),U(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new sP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:s},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,l=c&&c.viewport&&c.viewport.id,y=d?i.find(P=>P.id===d):null,w=l&&s.find(P=>P.id===l)||s[0],S=w&&w.unproject([e-w.x,n-w.y]);return{...c,...{x:e,y:n,viewport:w,coordinate:S,layer:y}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new vi(i),vi.isSupported(i,{colorBufferFloat:!0}))){const s=new vi(i);s.attach({36064:new es(i,{format:Yt(i)?34836:6408,type:5126})}),this.depthFBO=s}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:s,y:c,radius:d=0,depth:l=1,mode:y="query",unproject3D:w,onViewportActive:S,effects:I}){const P=this._getPickable(e),B=cu(this.gl);if(!P)return{result:[],emptyInfo:cP({viewports:i,x:s,y:c,pixelRatio:B})};this._resizeBuffer();const G=q_(this.gl,[s,c],!0),K=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],de=Math.round(d*B),{width:Z,height:j}=this.pickingFBO,q=this._getPickingRect({deviceX:K[0],deviceY:K[1],deviceRadius:de,deviceWidth:Z,deviceHeight:j}),se={x:s-d,y:c-d,width:d*2+1,height:d*2+1};let pe;const be=[],Re=new Set;for(let Fe=0;Fe<l;Fe++){let Ve;if(q){const pt=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:S,deviceRect:q,cullRect:se,effects:I,pass:"picking:".concat(y)});Ve=u5({...pt,deviceX:K[0],deviceY:K[1],deviceRadius:de,deviceRect:q})}else Ve={pickedColor:null,pickedObjectIndex:-1};let je;if(Ve.pickedLayer&&w&&this.depthFBO){const{pickedColors:pt}=this._drawAndSample({layers:[Ve.pickedLayer],views:n,viewports:i,onViewportActive:S,deviceRect:{x:Ve.pickedX,y:Ve.pickedY,width:1,height:1},cullRect:se,effects:I,pass:"picking:".concat(y,":z")},!0);pt[3]&&(je=pt[0])}Ve.pickedLayer&&Fe+1<l&&(Re.add(Ve.pickedLayer),Ve.pickedLayer.disablePickingIndex(Ve.pickedObjectIndex)),pe=d5({pickInfo:Ve,lastPickedInfo:this.lastPickedInfo,mode:y,layers:P,viewports:i,x:s,y:c,z:je,pixelRatio:B});for(const pt of pe.values())pt.layer&&be.push(pt);if(!Ve.pickedColor)break}for(const Fe of Re)Fe.restorePickingColors();return{result:be,emptyInfo:pe.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:s,y:c,width:d=1,height:l=1,mode:y="query",maxObjects:w=null,onViewportActive:S,effects:I}){const P=this._getPickable(e);if(!P)return[];this._resizeBuffer();const B=cu(this.gl),G=q_(this.gl,[s,c],!0),K=G.x,de=G.y+G.height,Z=q_(this.gl,[s+d,c+l],!0),j=Z.x+Z.width,q=Z.y,se={x:K,y:q,width:j-K,height:de-q},pe=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:S,deviceRect:se,cullRect:{x:s,y:c,width:d,height:l},effects:I,pass:"picking:".concat(y)}),be=h5(pe),Re=new Map,Fe=Number.isFinite(w);for(let je=0;je<be.length;je++){var Ve;if(Fe&&w&&Re.size>=w)break;const pt=be[je];let bt={color:pt.pickedColor,layer:null,index:pt.pickedObjectIndex,picked:!0,x:s,y:c,pixelRatio:B};bt=uP({layer:pt.pickedLayer,info:bt,mode:y});const St=(Ve=bt.object)!==null&&Ve!==void 0?Ve:"".concat(bt.layer.id,"[").concat(bt.index,"]");Re.has(St)||Re.set(St,bt)}return Array.from(Re.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:s,deviceRect:c,cullRect:d,effects:l,pass:y},w=!1){const S=w?this.depthFBO:this.pickingFBO,I={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:s,pickingFBO:S,deviceRect:c,cullRect:d,effects:l,pass:y,pickZ:w,preRenderStats:{}};for(const j of l)j.useInPicking&&(I.preRenderStats[j.id]=j.preRender(this.gl,I));const{decodePickingColor:P}=this.pickLayersPass.render(I),{x:B,y:G,width:K,height:de}=c,Z=new(w?Float32Array:Uint8Array)(K*de*4);return ng(S,{sourceX:B,sourceY:G,sourceWidth:K,sourceHeight:de,target:Z}),{pickedColors:Z,decodePickingColor:P}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:s,deviceHeight:c}){const d=Math.max(0,e-i),l=Math.max(0,n-i),y=Math.min(s,e+i+1)-d,w=Math.min(c,n+i+1)-l;return y<=0||w<=0?null:{x:d,y:l,width:y,height:w}}}const m5={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class g5{constructor(e){U(this,"el",null),U(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,m5),n.appendChild(this.el))}setTooltip(e,n,i){const s=this.el;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var hP={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,s){var c=["","webkit","Moz","MS","ms","o"],d=n.createElement("div"),l="function",y=Math.round,w=Math.abs,S=Date.now;function I(H,Q,ue){return setTimeout(q(H,ue),Q)}function P(H,Q,ue){return Array.isArray(H)?(B(H,ue[Q],ue),!0):!1}function B(H,Q,ue){var Ae;if(H)if(H.forEach)H.forEach(Q,ue);else if(H.length!==s)for(Ae=0;Ae<H.length;)Q.call(ue,H[Ae],Ae,H),Ae++;else for(Ae in H)H.hasOwnProperty(Ae)&&Q.call(ue,H[Ae],Ae,H)}function G(H,Q,ue){var Ae="DEPRECATED METHOD: "+Q+`
`+ue+` AT 
`;return function(){var Ne=new Error("get-stack-trace"),ot=Ne&&Ne.stack?Ne.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Bt=e.console&&(e.console.warn||e.console.log);return Bt&&Bt.call(e.console,Ae,ot),H.apply(this,arguments)}}var K;typeof Object.assign!="function"?K=function(Q){if(Q===s||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var ue=Object(Q),Ae=1;Ae<arguments.length;Ae++){var Ne=arguments[Ae];if(Ne!==s&&Ne!==null)for(var ot in Ne)Ne.hasOwnProperty(ot)&&(ue[ot]=Ne[ot])}return ue}:K=Object.assign;var de=G(function(Q,ue,Ae){for(var Ne=Object.keys(ue),ot=0;ot<Ne.length;)(!Ae||Ae&&Q[Ne[ot]]===s)&&(Q[Ne[ot]]=ue[Ne[ot]]),ot++;return Q},"extend","Use `assign`."),Z=G(function(Q,ue){return de(Q,ue,!0)},"merge","Use `assign`.");function j(H,Q,ue){var Ae=Q.prototype,Ne;Ne=H.prototype=Object.create(Ae),Ne.constructor=H,Ne._super=Ae,ue&&K(Ne,ue)}function q(H,Q){return function(){return H.apply(Q,arguments)}}function se(H,Q){return typeof H==l?H.apply(Q&&Q[0]||s,Q):H}function pe(H,Q){return H===s?Q:H}function be(H,Q,ue){B(je(Q),function(Ae){H.addEventListener(Ae,ue,!1)})}function Re(H,Q,ue){B(je(Q),function(Ae){H.removeEventListener(Ae,ue,!1)})}function Fe(H,Q){for(;H;){if(H==Q)return!0;H=H.parentNode}return!1}function Ve(H,Q){return H.indexOf(Q)>-1}function je(H){return H.trim().split(/\s+/g)}function pt(H,Q,ue){if(H.indexOf&&!ue)return H.indexOf(Q);for(var Ae=0;Ae<H.length;){if(ue&&H[Ae][ue]==Q||!ue&&H[Ae]===Q)return Ae;Ae++}return-1}function bt(H){return Array.prototype.slice.call(H,0)}function St(H,Q,ue){for(var Ae=[],Ne=[],ot=0;ot<H.length;){var Bt=Q?H[ot][Q]:H[ot];pt(Ne,Bt)<0&&Ae.push(H[ot]),Ne[ot]=Bt,ot++}return ue&&(Q?Ae=Ae.sort(function(zt,Fn){return zt[Q]>Fn[Q]}):Ae=Ae.sort()),Ae}function kt(H,Q){for(var ue,Ae,Ne=Q[0].toUpperCase()+Q.slice(1),ot=0;ot<c.length;){if(ue=c[ot],Ae=ue?ue+Ne:Q,Ae in H)return Ae;ot++}return s}var Gn=1;function xt(){return Gn++}function xi(H){var Q=H.ownerDocument||H;return Q.defaultView||Q.parentWindow||e}var tt=/mobile|tablet|ip(ad|hone|od)|android/i,Et="ontouchstart"in e,Pt=kt(e,"PointerEvent")!==s,nn=Et&&tt.test(navigator.userAgent),rn="touch",ir="pen",ii="mouse",bi="kinect",ri=25,un=1,wi=2,qt=4,Dn=8,is=1,Li=2,Yn=4,Lr=8,ji=16,di=Li|Yn,Gi=Lr|ji,Vs=di|Gi,Gt=["x","y"],ki=["clientX","clientY"];function On(H,Q){var ue=this;this.manager=H,this.callback=Q,this.element=H.element,this.target=H.options.inputTarget,this.domHandler=function(Ae){se(H.options.enable,[H])&&ue.handler(Ae)},this.init()}On.prototype={handler:function(){},init:function(){this.evEl&&be(this.element,this.evEl,this.domHandler),this.evTarget&&be(this.target,this.evTarget,this.domHandler),this.evWin&&be(xi(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Re(this.element,this.evEl,this.domHandler),this.evTarget&&Re(this.target,this.evTarget,this.domHandler),this.evWin&&Re(xi(this.element),this.evWin,this.domHandler)}};function rs(H){var Q,ue=H.options.inputClass;return ue?Q=ue:Pt?Q=rr:nn?Q=br:Et?Q=ee:Q=Mt,new Q(H,go)}function go(H,Q,ue){var Ae=ue.pointers.length,Ne=ue.changedPointers.length,ot=Q&un&&Ae-Ne===0,Bt=Q&(qt|Dn)&&Ae-Ne===0;ue.isFirst=!!ot,ue.isFinal=!!Bt,ot&&(H.session={}),ue.eventType=Q,kr(H,ue),H.emit("hammer.input",ue),H.recognize(ue),H.session.prevInput=ue}function kr(H,Q){var ue=H.session,Ae=Q.pointers,Ne=Ae.length;ue.firstInput||(ue.firstInput=vr(Q)),Ne>1&&!ue.firstMultiple?ue.firstMultiple=vr(Q):Ne===1&&(ue.firstMultiple=!1);var ot=ue.firstInput,Bt=ue.firstMultiple,En=Bt?Bt.center:ot.center,zt=Q.center=Me(Ae);Q.timeStamp=S(),Q.deltaTime=Q.timeStamp-ot.timeStamp,Q.angle=Ut(En,zt),Q.distance=Ei(En,zt),Rr(ue,Q),Q.offsetDirection=ss(Q.deltaX,Q.deltaY);var Fn=$e(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=Fn.x,Q.overallVelocityY=Fn.y,Q.overallVelocity=w(Fn.x)>w(Fn.y)?Fn.x:Fn.y,Q.scale=Bt?Ri(Bt.pointers,Ae):1,Q.rotation=Bt?Wi(Bt.pointers,Ae):0,Q.maxPointers=ue.prevInput?Q.pointers.length>ue.prevInput.maxPointers?Q.pointers.length:ue.prevInput.maxPointers:Q.pointers.length,js(ue,Q);var sr=H.element;Fe(Q.srcEvent.target,sr)&&(sr=Q.srcEvent.target),Q.target=sr}function Rr(H,Q){var ue=Q.center,Ae=H.offsetDelta||{},Ne=H.prevDelta||{},ot=H.prevInput||{};(Q.eventType===un||ot.eventType===qt)&&(Ne=H.prevDelta={x:ot.deltaX||0,y:ot.deltaY||0},Ae=H.offsetDelta={x:ue.x,y:ue.y}),Q.deltaX=Ne.x+(ue.x-Ae.x),Q.deltaY=Ne.y+(ue.y-Ae.y)}function js(H,Q){var ue=H.lastInterval||Q,Ae=Q.timeStamp-ue.timeStamp,Ne,ot,Bt,En;if(Q.eventType!=Dn&&(Ae>ri||ue.velocity===s)){var zt=Q.deltaX-ue.deltaX,Fn=Q.deltaY-ue.deltaY,sr=$e(Ae,zt,Fn);ot=sr.x,Bt=sr.y,Ne=w(sr.x)>w(sr.y)?sr.x:sr.y,En=ss(zt,Fn),H.lastInterval=Q}else Ne=ue.velocity,ot=ue.velocityX,Bt=ue.velocityY,En=ue.direction;Q.velocity=Ne,Q.velocityX=ot,Q.velocityY=Bt,Q.direction=En}function vr(H){for(var Q=[],ue=0;ue<H.pointers.length;)Q[ue]={clientX:y(H.pointers[ue].clientX),clientY:y(H.pointers[ue].clientY)},ue++;return{timeStamp:S(),pointers:Q,center:Me(Q),deltaX:H.deltaX,deltaY:H.deltaY}}function Me(H){var Q=H.length;if(Q===1)return{x:y(H[0].clientX),y:y(H[0].clientY)};for(var ue=0,Ae=0,Ne=0;Ne<Q;)ue+=H[Ne].clientX,Ae+=H[Ne].clientY,Ne++;return{x:y(ue/Q),y:y(Ae/Q)}}function $e(H,Q,ue){return{x:Q/H||0,y:ue/H||0}}function ss(H,Q){return H===Q?is:w(H)>=w(Q)?H<0?Li:Yn:Q<0?Lr:ji}function Ei(H,Q,ue){ue||(ue=Gt);var Ae=Q[ue[0]]-H[ue[0]],Ne=Q[ue[1]]-H[ue[1]];return Math.sqrt(Ae*Ae+Ne*Ne)}function Ut(H,Q,ue){ue||(ue=Gt);var Ae=Q[ue[0]]-H[ue[0]],Ne=Q[ue[1]]-H[ue[1]];return Math.atan2(Ne,Ae)*180/Math.PI}function Wi(H,Q){return Ut(Q[1],Q[0],ki)+Ut(H[1],H[0],ki)}function Ri(H,Q){return Ei(Q[0],Q[1],ki)/Ei(H[0],H[1],ki)}var zi={mousedown:un,mousemove:wi,mouseup:qt},os="mousedown",He="mousemove mouseup";function Mt(){this.evEl=os,this.evWin=He,this.pressed=!1,On.apply(this,arguments)}j(Mt,On,{handler:function(Q){var ue=zi[Q.type];ue&un&&Q.button===0&&(this.pressed=!0),ue&wi&&Q.which!==1&&(ue=qt),this.pressed&&(ue&qt&&(this.pressed=!1),this.callback(this.manager,ue,{pointers:[Q],changedPointers:[Q],pointerType:ii,srcEvent:Q}))}});var It={pointerdown:un,pointermove:wi,pointerup:qt,pointercancel:Dn,pointerout:Dn},Kn={2:rn,3:ir,4:ii,5:bi},zr="pointerdown",Ct="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(zr="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel");function rr(){this.evEl=zr,this.evWin=Ct,On.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}j(rr,On,{handler:function(Q){var ue=this.store,Ae=!1,Ne=Q.type.toLowerCase().replace("ms",""),ot=It[Ne],Bt=Kn[Q.pointerType]||Q.pointerType,En=Bt==rn,zt=pt(ue,Q.pointerId,"pointerId");ot&un&&(Q.button===0||En)?zt<0&&(ue.push(Q),zt=ue.length-1):ot&(qt|Dn)&&(Ae=!0),!(zt<0)&&(ue[zt]=Q,this.callback(this.manager,ot,{pointers:ue,changedPointers:[Q],pointerType:Bt,srcEvent:Q}),Ae&&ue.splice(zt,1))}});var Wn={touchstart:un,touchmove:wi,touchend:qt,touchcancel:Dn},Gs="touchstart",Ln="touchstart touchmove touchend touchcancel";function si(){this.evTarget=Gs,this.evWin=Ln,this.started=!1,On.apply(this,arguments)}j(si,On,{handler:function(Q){var ue=Wn[Q.type];if(ue===un&&(this.started=!0),!!this.started){var Ae=en.call(this,Q,ue);ue&(qt|Dn)&&Ae[0].length-Ae[1].length===0&&(this.started=!1),this.callback(this.manager,ue,{pointers:Ae[0],changedPointers:Ae[1],pointerType:rn,srcEvent:Q})}}});function en(H,Q){var ue=bt(H.touches),Ae=bt(H.changedTouches);return Q&(qt|Dn)&&(ue=St(ue.concat(Ae),"identifier",!0)),[ue,Ae]}var Ws={touchstart:un,touchmove:wi,touchend:qt,touchcancel:Dn},xr="touchstart touchmove touchend touchcancel";function br(){this.evTarget=xr,this.targetIds={},On.apply(this,arguments)}j(br,On,{handler:function(Q){var ue=Ws[Q.type],Ae=ws.call(this,Q,ue);Ae&&this.callback(this.manager,ue,{pointers:Ae[0],changedPointers:Ae[1],pointerType:rn,srcEvent:Q})}});function ws(H,Q){var ue=bt(H.touches),Ae=this.targetIds;if(Q&(un|wi)&&ue.length===1)return Ae[ue[0].identifier]=!0,[ue,ue];var Ne,ot,Bt=bt(H.changedTouches),En=[],zt=this.target;if(ot=ue.filter(function(Fn){return Fe(Fn.target,zt)}),Q===un)for(Ne=0;Ne<ot.length;)Ae[ot[Ne].identifier]=!0,Ne++;for(Ne=0;Ne<Bt.length;)Ae[Bt[Ne].identifier]&&En.push(Bt[Ne]),Q&(qt|Dn)&&delete Ae[Bt[Ne].identifier],Ne++;if(En.length)return[St(ot.concat(En),"identifier",!0),En]}var Hs=2500,as=25;function ee(){On.apply(this,arguments);var H=q(this.handler,this);this.touch=new br(this.manager,H),this.mouse=new Mt(this.manager,H),this.primaryTouch=null,this.lastTouches=[]}j(ee,On,{handler:function(Q,ue,Ae){var Ne=Ae.pointerType==rn,ot=Ae.pointerType==ii;if(!(ot&&Ae.sourceCapabilities&&Ae.sourceCapabilities.firesTouchEvents)){if(Ne)R.call(this,ue,Ae);else if(ot&&Y.call(this,Ae))return;this.callback(Q,ue,Ae)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(H,Q){H&un?(this.primaryTouch=Q.changedPointers[0].identifier,F.call(this,Q)):H&(qt|Dn)&&F.call(this,Q)}function F(H){var Q=H.changedPointers[0];if(Q.identifier===this.primaryTouch){var ue={x:Q.clientX,y:Q.clientY};this.lastTouches.push(ue);var Ae=this.lastTouches,Ne=function(){var ot=Ae.indexOf(ue);ot>-1&&Ae.splice(ot,1)};setTimeout(Ne,Hs)}}function Y(H){for(var Q=H.srcEvent.clientX,ue=H.srcEvent.clientY,Ae=0;Ae<this.lastTouches.length;Ae++){var Ne=this.lastTouches[Ae],ot=Math.abs(Q-Ne.x),Bt=Math.abs(ue-Ne.y);if(ot<=as&&Bt<=as)return!0}return!1}var J=kt(d.style,"touchAction"),ce=J!==s,me="compute",he="auto",le="manipulation",ge="none",Ce="pan-x",Oe="pan-y",Pe=Ye();function rt(H,Q){this.manager=H,this.set(Q)}rt.prototype={set:function(H){H==me&&(H=this.compute()),ce&&this.manager.element.style&&Pe[H]&&(this.manager.element.style[J]=H),this.actions=H.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var H=[];return B(this.manager.recognizers,function(Q){se(Q.options.enable,[Q])&&(H=H.concat(Q.getTouchAction()))}),lt(H.join(" "))},preventDefaults:function(H){var Q=H.srcEvent,ue=H.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var Ae=this.actions,Ne=Ve(Ae,ge)&&!Pe[ge],ot=Ve(Ae,Oe)&&!Pe[Oe],Bt=Ve(Ae,Ce)&&!Pe[Ce];if(Ne){var En=H.pointers.length===1,zt=H.distance<2,Fn=H.deltaTime<250;if(En&&zt&&Fn)return}if(!(Bt&&ot)&&(Ne||ot&&ue&di||Bt&&ue&Gi))return this.preventSrc(Q)},preventSrc:function(H){this.manager.session.prevented=!0,H.preventDefault()}};function lt(H){if(Ve(H,ge))return ge;var Q=Ve(H,Ce),ue=Ve(H,Oe);return Q&&ue?ge:Q||ue?Q?Ce:Oe:Ve(H,le)?le:he}function Ye(){if(!ce)return!1;var H={},Q=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ue){H[ue]=Q?e.CSS.supports("touch-action",ue):!0}),H}var gt=1,dt=2,Rt=4,vt=8,At=vt,Ft=16,Vt=32;function dn(H){this.options=K({},this.defaults,H||{}),this.id=xt(),this.manager=null,this.options.enable=pe(this.options.enable,!0),this.state=gt,this.simultaneous={},this.requireFail=[]}dn.prototype={defaults:{},set:function(H){return K(this.options,H),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(H){if(P(H,"recognizeWith",this))return this;var Q=this.simultaneous;return H=Dr(H,this),Q[H.id]||(Q[H.id]=H,H.recognizeWith(this)),this},dropRecognizeWith:function(H){return P(H,"dropRecognizeWith",this)?this:(H=Dr(H,this),delete this.simultaneous[H.id],this)},requireFailure:function(H){if(P(H,"requireFailure",this))return this;var Q=this.requireFail;return H=Dr(H,this),pt(Q,H)===-1&&(Q.push(H),H.requireFailure(this)),this},dropRequireFailure:function(H){if(P(H,"dropRequireFailure",this))return this;H=Dr(H,this);var Q=pt(this.requireFail,H);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(H){return!!this.simultaneous[H.id]},emit:function(H){var Q=this,ue=this.state;function Ae(Ne){Q.manager.emit(Ne,H)}ue<vt&&Ae(Q.options.event+fn(ue)),Ae(Q.options.event),H.additionalEvent&&Ae(H.additionalEvent),ue>=vt&&Ae(Q.options.event+fn(ue))},tryEmit:function(H){if(this.canEmit())return this.emit(H);this.state=Vt},canEmit:function(){for(var H=0;H<this.requireFail.length;){if(!(this.requireFail[H].state&(Vt|gt)))return!1;H++}return!0},recognize:function(H){var Q=K({},H);if(!se(this.options.enable,[this,Q])){this.reset(),this.state=Vt;return}this.state&(At|Ft|Vt)&&(this.state=gt),this.state=this.process(Q),this.state&(dt|Rt|vt|Ft)&&this.tryEmit(Q)},process:function(H){},getTouchAction:function(){},reset:function(){}};function fn(H){return H&Ft?"cancel":H&vt?"end":H&Rt?"move":H&dt?"start":""}function Jn(H){return H==ji?"down":H==Lr?"up":H==Li?"left":H==Yn?"right":""}function Dr(H,Q){var ue=Q.manager;return ue?ue.get(H):H}function fi(){dn.apply(this,arguments)}j(fi,dn,{defaults:{pointers:1},attrTest:function(H){var Q=this.options.pointers;return Q===0||H.pointers.length===Q},process:function(H){var Q=this.state,ue=H.eventType,Ae=Q&(dt|Rt),Ne=this.attrTest(H);return Ae&&(ue&Dn||!Ne)?Q|Ft:Ae||Ne?ue&qt?Q|vt:Q&dt?Q|Rt:dt:Vt}});function Xt(){fi.apply(this,arguments),this.pX=null,this.pY=null}j(Xt,fi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Vs},getTouchAction:function(){var H=this.options.direction,Q=[];return H&di&&Q.push(Oe),H&Gi&&Q.push(Ce),Q},directionTest:function(H){var Q=this.options,ue=!0,Ae=H.distance,Ne=H.direction,ot=H.deltaX,Bt=H.deltaY;return Ne&Q.direction||(Q.direction&di?(Ne=ot===0?is:ot<0?Li:Yn,ue=ot!=this.pX,Ae=Math.abs(H.deltaX)):(Ne=Bt===0?is:Bt<0?Lr:ji,ue=Bt!=this.pY,Ae=Math.abs(H.deltaY))),H.direction=Ne,ue&&Ae>Q.threshold&&Ne&Q.direction},attrTest:function(H){return fi.prototype.attrTest.call(this,H)&&(this.state&dt||!(this.state&dt)&&this.directionTest(H))},emit:function(H){this.pX=H.deltaX,this.pY=H.deltaY;var Q=Jn(H.direction);Q&&(H.additionalEvent=this.options.event+Q),this._super.emit.call(this,H)}});function _o(){fi.apply(this,arguments)}j(_o,fi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ge]},attrTest:function(H){return this._super.attrTest.call(this,H)&&(Math.abs(H.scale-1)>this.options.threshold||this.state&dt)},emit:function(H){if(H.scale!==1){var Q=H.scale<1?"in":"out";H.additionalEvent=this.options.event+Q}this._super.emit.call(this,H)}});function yo(){dn.apply(this,arguments),this._timer=null,this._input=null}j(yo,dn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(H){var Q=this.options,ue=H.pointers.length===Q.pointers,Ae=H.distance<Q.threshold,Ne=H.deltaTime>Q.time;if(this._input=H,!Ae||!ue||H.eventType&(qt|Dn)&&!Ne)this.reset();else if(H.eventType&un)this.reset(),this._timer=I(function(){this.state=At,this.tryEmit()},Q.time,this);else if(H.eventType&qt)return At;return Vt},reset:function(){clearTimeout(this._timer)},emit:function(H){this.state===At&&(H&&H.eventType&qt?this.manager.emit(this.options.event+"up",H):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function Ko(){fi.apply(this,arguments)}j(Ko,fi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ge]},attrTest:function(H){return this._super.attrTest.call(this,H)&&(Math.abs(H.rotation)>this.options.threshold||this.state&dt)}});function Jo(){fi.apply(this,arguments)}j(Jo,fi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:di|Gi,pointers:1},getTouchAction:function(){return Xt.prototype.getTouchAction.call(this)},attrTest:function(H){var Q=this.options.direction,ue;return Q&(di|Gi)?ue=H.overallVelocity:Q&di?ue=H.overallVelocityX:Q&Gi&&(ue=H.overallVelocityY),this._super.attrTest.call(this,H)&&Q&H.offsetDirection&&H.distance>this.options.threshold&&H.maxPointers==this.options.pointers&&w(ue)>this.options.velocity&&H.eventType&qt},emit:function(H){var Q=Jn(H.offsetDirection);Q&&this.manager.emit(this.options.event+Q,H),this.manager.emit(this.options.event,H)}});function $s(){dn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}j($s,dn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[le]},process:function(H){var Q=this.options,ue=H.pointers.length===Q.pointers,Ae=H.distance<Q.threshold,Ne=H.deltaTime<Q.time;if(this.reset(),H.eventType&un&&this.count===0)return this.failTimeout();if(Ae&&Ne&&ue){if(H.eventType!=qt)return this.failTimeout();var ot=this.pTime?H.timeStamp-this.pTime<Q.interval:!0,Bt=!this.pCenter||Ei(this.pCenter,H.center)<Q.posThreshold;this.pTime=H.timeStamp,this.pCenter=H.center,!Bt||!ot?this.count=1:this.count+=1,this._input=H;var En=this.count%Q.taps;if(En===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=At,this.tryEmit()},Q.interval,this),dt):At}return Vt},failTimeout:function(){return this._timer=I(function(){this.state=Vt},this.options.interval,this),Vt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==At&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Or(H,Q){return Q=Q||{},Q.recognizers=pe(Q.recognizers,Or.defaults.preset),new ta(H,Q)}Or.VERSION="2.0.7",Or.defaults={domEvents:!1,touchAction:me,enable:!0,inputTarget:null,inputClass:null,preset:[[Ko,{enable:!1}],[_o,{enable:!1},["rotate"]],[Jo,{direction:di}],[Xt,{direction:di},["swipe"]],[$s],[$s,{event:"doubletap",taps:2},["tap"]],[yo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Qo=1,ea=2;function ta(H,Q){this.options=K({},Or.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||H,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=H,this.input=rs(this),this.touchAction=new rt(this,this.options.touchAction),Za(this,!0),B(this.options.recognizers,function(ue){var Ae=this.add(new ue[0](ue[1]));ue[2]&&Ae.recognizeWith(ue[2]),ue[3]&&Ae.requireFailure(ue[3])},this)}ta.prototype={set:function(H){return K(this.options,H),H.touchAction&&this.touchAction.update(),H.inputTarget&&(this.input.destroy(),this.input.target=H.inputTarget,this.input.init()),this},stop:function(H){this.session.stopped=H?ea:Qo},recognize:function(H){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults(H);var ue,Ae=this.recognizers,Ne=Q.curRecognizer;(!Ne||Ne&&Ne.state&At)&&(Ne=Q.curRecognizer=null);for(var ot=0;ot<Ae.length;)ue=Ae[ot],Q.stopped!==ea&&(!Ne||ue==Ne||ue.canRecognizeWith(Ne))?ue.recognize(H):ue.reset(),!Ne&&ue.state&(dt|Rt|vt)&&(Ne=Q.curRecognizer=ue),ot++}},get:function(H){if(H instanceof dn)return H;for(var Q=this.recognizers,ue=0;ue<Q.length;ue++)if(Q[ue].options.event==H)return Q[ue];return null},add:function(H){if(P(H,"add",this))return this;var Q=this.get(H.options.event);return Q&&this.remove(Q),this.recognizers.push(H),H.manager=this,this.touchAction.update(),H},remove:function(H){if(P(H,"remove",this))return this;if(H=this.get(H),H){var Q=this.recognizers,ue=pt(Q,H);ue!==-1&&(Q.splice(ue,1),this.touchAction.update())}return this},on:function(H,Q){if(H!==s&&Q!==s){var ue=this.handlers;return B(je(H),function(Ae){ue[Ae]=ue[Ae]||[],ue[Ae].push(Q)}),this}},off:function(H,Q){if(H!==s){var ue=this.handlers;return B(je(H),function(Ae){Q?ue[Ae]&&ue[Ae].splice(pt(ue[Ae],Q),1):delete ue[Ae]}),this}},emit:function(H,Q){this.options.domEvents&&Yl(H,Q);var ue=this.handlers[H]&&this.handlers[H].slice();if(!(!ue||!ue.length)){Q.type=H,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var Ae=0;Ae<ue.length;)ue[Ae](Q),Ae++}},destroy:function(){this.element&&Za(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Za(H,Q){var ue=H.element;if(ue.style){var Ae;B(H.options.cssProps,function(Ne,ot){Ae=kt(ue.style,ot),Q?(H.oldCssProps[Ae]=ue.style[Ae],ue.style[Ae]=Ne):ue.style[Ae]=H.oldCssProps[Ae]||""}),Q||(H.oldCssProps={})}}function Yl(H,Q){var ue=n.createEvent("Event");ue.initEvent(H,!0,!0),ue.gesture=Q,Q.target.dispatchEvent(ue)}K(Or,{INPUT_START:un,INPUT_MOVE:wi,INPUT_END:qt,INPUT_CANCEL:Dn,STATE_POSSIBLE:gt,STATE_BEGAN:dt,STATE_CHANGED:Rt,STATE_ENDED:vt,STATE_RECOGNIZED:At,STATE_CANCELLED:Ft,STATE_FAILED:Vt,DIRECTION_NONE:is,DIRECTION_LEFT:Li,DIRECTION_RIGHT:Yn,DIRECTION_UP:Lr,DIRECTION_DOWN:ji,DIRECTION_HORIZONTAL:di,DIRECTION_VERTICAL:Gi,DIRECTION_ALL:Vs,Manager:ta,Input:On,TouchAction:rt,TouchInput:br,MouseInput:Mt,PointerEventInput:rr,TouchMouseInput:ee,SingleTouchInput:si,Recognizer:dn,AttrRecognizer:fi,Tap:$s,Pan:Xt,Swipe:Jo,Pinch:_o,Rotate:Ko,Press:yo,on:be,off:Re,each:B,merge:Z,extend:de,assign:K,inherit:j,bindFn:q,prefixed:kt});var Es=typeof e<"u"?e:typeof self<"u"?self:{};Es.Hammer=Or,typeof s=="function"&&s.amd?s(function(){return Or}):t.exports?t.exports=Or:e[i]=Or})(window,document,"Hammer")})(hP);var Vd=hP.exports;const _5=Om(Vd),ro=DI({__proto__:null,default:_5},[Vd]),dP=1,fP=2,z0=4,y5={mousedown:dP,mousemove:fP,mouseup:z0};function v5(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function x5(t){const e=t.prototype.handler;t.prototype.handler=function(i){const s=this.store;i.button>0&&i.type==="pointerdown"&&(v5(s,c=>c.pointerId===i.pointerId)||s.push(i)),e.call(this,i)}}function b5(t){t.prototype.handler=function(n){let i=y5[n.type];i&dP&&n.button>=0&&(this.pressed=!0),i&fP&&n.which===0&&(i=z0),this.pressed&&(i&z0&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}x5(Vd.PointerEventInput);b5(Vd.MouseInput);const w5=Vd.Manager;class ig{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const E5=ro?[[ro.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ro.Rotate,{enable:!1}],[ro.Pinch,{enable:!1}],[ro.Swipe,{enable:!1}],[ro.Pan,{threshold:0,enable:!1}],[ro.Press,{enable:!1}],[ro.Tap,{event:"doubletap",taps:2,enable:!1}],[ro.Tap,{event:"anytap",enable:!1}],[ro.Tap,{enable:!1}]]:null,NE={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},T5={doubletap:["tap"]},S5={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},mx={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},A5={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},UE={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},P5=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Wc=typeof window<"u"?window:global;let D0=!1;try{const t={get passive(){return D0=!0,!0}};Wc.addEventListener("test",null,t),Wc.removeEventListener("test",null)}catch{D0=!1}const C5=P5.indexOf("firefox")!==-1,{WHEEL_EVENTS:I5}=mx,VE="wheel",jE=4.000244140625,M5=40,L5=.25;class k5 extends ig{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{if(!this.options.enable)return;let c=s.deltaY;Wc.WheelEvent&&(C5&&s.deltaMode===Wc.WheelEvent.DOM_DELTA_PIXEL&&(c/=Wc.devicePixelRatio),s.deltaMode===Wc.WheelEvent.DOM_DELTA_LINE&&(c*=M5)),c!==0&&c%jE===0&&(c=Math.floor(c/jE)),s.shiftKey&&c&&(c=c*L5),this.callback({type:VE,center:{x:s.clientX,y:s.clientY},delta:-c,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(I5),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,D0?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===VE&&(this.options.enable=n)}}const{MOUSE_EVENTS:R5}=mx,GE="pointermove",WE="pointerover",HE="pointerout",$E="pointerenter",qE="pointerleave";class z5 extends ig{constructor(e,n,i){super(e,n,i),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(R5),this.events.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===GE&&(this.enableMoveEvent=n),e===WE&&(this.enableOverEvent=n),e===HE&&(this.enableOutEvent=n),e===$E&&(this.enableEnterEvent=n),e===qE&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(WE,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(HE,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit($E,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(qE,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(GE,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:D5}=mx,ZE="keydown",XE="keyup";class O5 extends ig{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{const c=s.target||s.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:ZE,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:XE,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(D5),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===ZE&&(this.enableDownEvent=n),e===XE&&(this.enableUpEvent=n)}}const YE="contextmenu";class F5 extends ig{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:YE,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===YE&&(this.options.enable=n)}}const O0=1,Lm=2,F0=4,B5={pointerdown:O0,pointermove:Lm,pointerup:F0,mousedown:O0,mousemove:Lm,mouseup:F0},N5=1,U5=2,V5=3,j5=0,G5=1,W5=2,H5=1,$5=2,q5=4;function Z5(t){const e=B5[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:s}=t.srcEvent;let c=!1,d=!1,l=!1;return e===F0||e===Lm&&!Number.isFinite(n)?(c=s===N5,d=s===U5,l=s===V5):e===Lm?(c=!!(n&H5),d=!!(n&q5),l=!!(n&$5)):e===O0&&(c=i===j5,d=i===G5,l=i===W5),{leftButton:c,middleButton:d,rightButton:l}}function X5(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,c=i.height/e.offsetHeight||1,d={x:(n.x-i.left-e.clientLeft)/s,y:(n.y-i.top-e.clientTop)/c};return{center:n,offsetCenter:d}}const dy={srcElement:"root",priority:0};class Y5{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,s=!1,c=!1){const{handlers:d,handlersByElement:l}=this;let y=dy;typeof i=="string"||i&&i.addEventListener?y={...dy,srcElement:i}:i&&(y={...dy,...i});let w=l.get(y.srcElement);w||(w=[],l.set(y.srcElement,w));const S={type:e,handler:n,srcElement:y.srcElement,priority:y.priority};s&&(S.once=!0),c&&(S.passive=!0),d.push(S),this._active=this._active||!S.passive;let I=w.length-1;for(;I>=0&&!(w[I].priority>=S.priority);)I--;w.splice(I+1,0,S)}remove(e,n){const{handlers:i,handlersByElement:s}=this;for(let c=i.length-1;c>=0;c--){const d=i[c];if(d.type===e&&d.handler===n){i.splice(c,1);const l=s.get(d.srcElement);l.splice(l.indexOf(d),1),l.length===0&&s.delete(d.srcElement)}}this._active=i.some(c=>!c.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let s=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,s=!0},l=[];for(let y=0;y<i.length;y++){const{type:w,handler:S,once:I}=i[y];if(S({...e,type:w,stopPropagation:c,stopImmediatePropagation:d}),I&&l.push(i[y]),s)break}for(let y=0;y<l.length;y++){const{type:w,handler:S}=l[y];this.remove(w,S)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...Z5(e),...X5(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const K5={events:null,recognizers:null,recognizerOptions:{},Manager:w5,touchAction:"none",tabIndex:0};class J5{constructor(e=null,n){this._onBasicInput=s=>{const{srcEvent:c}=s,d=S5[c.type];d&&this.manager.emit(d,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...K5,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||E5}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(NE).forEach(s=>{const c=this.manager.get(s);c&&NE[s].forEach(d=>{c.recognizeWith(d)})});for(const s in n.recognizerOptions){const c=this.manager.get(s);if(c){const d=n.recognizerOptions[s];delete d.enable,c.set(d)}}this.wheelInput=new k5(e,this._onOtherEvent,{enable:!1}),this.moveInput=new z5(e,this._onOtherEvent,{enable:!1}),this.keyInput=new O5(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new F5(e,this._onOtherEvent,{enable:!1});for(const[s,c]of this.events)c.isEmpty()||(this._toggleRecognizer(c.recognizerName,!0),this.manager.on(s,c.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const s=i.get(e);if(s&&s.options.enable!==n){s.set({enable:n});const c=T5[e];c&&!this.options.recognizers&&c.forEach(d=>{const l=i.get(d);n?(l.requireFailure(e),s.dropRequireFailure(d)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,s,c){if(typeof e!="string"){i=n;for(const S in e)this._addEventHandler(S,e[S],i,s,c);return}const{manager:d,events:l}=this,y=UE[e]||e;let w=l.get(y);w||(w=new Y5(this),l.set(y,w),w.recognizerName=A5[y]||y,d&&d.on(y,w.handleEvent)),w.add(e,n,i,s,c),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const d in e)this._removeEventHandler(d,e[d]);return}const{events:i}=this,s=UE[e]||e,c=i.get(s);if(c&&(c.remove(e,n),c.isEmpty())){const{recognizerName:d}=c;let l=!1;for(const y of i.values())if(y.recognizerName===d&&!y.isEmpty()){l=!0;break}l||this._toggleRecognizer(d,!1)}}}function wl(){}const Q5=({isDragging:t})=>t?"grabbing":"grab",pP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:wl,onResize:wl,onViewStateChange:wl,onInteractionStateChange:wl,onBeforeRender:wl,onAfterRender:wl,onLoad:wl,onError:t=>Zt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Q5,getTooltip:null,debug:!1,drawPickingColors:!1};class rg{constructor(e){U(this,"props",void 0),U(this,"width",0),U(this,"height",0),U(this,"userData",{}),U(this,"canvas",null),U(this,"viewManager",null),U(this,"layerManager",null),U(this,"effectManager",null),U(this,"deckRenderer",null),U(this,"deckPicker",null),U(this,"eventManager",null),U(this,"tooltip",null),U(this,"metrics",void 0),U(this,"animationLoop",void 0),U(this,"stats",void 0),U(this,"viewState",void 0),U(this,"cursorState",void 0),U(this,"_needsRedraw",void 0),U(this,"_pickRequest",void 0),U(this,"_lastPointerDownInfo",null),U(this,"_metricsCounter",void 0),U(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),U(this,"_onEvent",n=>{const i=Dw[n.type],s=n.offsetCenter;if(!i||!s||!this.layerManager)return;const c=this.layerManager.getLayers(),d=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:c,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=d,y=l&&(l[i.handler]||l.props[i.handler]),w=this.props[i.handler];let S=!1;y&&(S=y.call(l,d,n)),!S&&w&&w(d,n)}),U(this,"_onPointerDown",n=>{const i=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...pP,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Zt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),JS()==="IE"&&Zt.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Hv({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&gu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,s,c,d,l,y;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(c=this.deckRenderer)===null||c===void 0||c.finalize(),this.deckRenderer=null,(d=this.deckPicker)===null||d===void 0||d.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(y=this.tooltip)===null||y===void 0||y.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var w;(w=this.canvas.parentElement)===null||w===void 0||w.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Zt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Zt.removed("onLayerClick","onClick")(),e.initialViewState&&!uo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return n=n||i||s||c||d,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ii(this.viewManager),this.viewManager.views}getViewports(e){return Ii(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Ii(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(n).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(n).timeEnd(),c}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ii(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const c=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=c}if(i||i===0){var s;const c=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((s=e.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=c}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const s=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,c=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(s!==this.width||c!==this.height){var d,l;this.width=s,this.height=c,(d=this.viewManager)===null||d===void 0||d.setProps({width:s,height:c}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:c})}}_createAnimationLoop(e){const{width:n,height:i,gl:s,glOptions:c,debug:d,onError:l,onBeforeRender:y,onAfterRender:w,useDevicePixels:S}=e;return new BO({width:n,height:i,useDevicePixels:S,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,gl:s,onCreateContext:I=>_A({...c,...I,canvas:this.canvas,debug:d,onContextLost:()=>this._onContextLost()}),onInitialize:I=>this._setGLContext(I.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:y,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new lP({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let c=s,d=!1;for(const l of i){var n;c=l,d=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||d}if(!d&&this.props.onHover&&this.props.onHover(c,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(c);this.tooltip.setTooltip(l,c.x,c.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,ex(e,{enable:!0,copyState:!0})),this.tooltip=new g5(this.canvas),Ho(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new qA;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new J5(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in Dw)this.eventManager.on(s,this._onEvent);this.viewManager=new GN({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new jN(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new s5,this.deckRenderer=new l5(e),this.deckPicker=new p5(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Ho(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Zt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Il.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}U(rg,"defaultProps",pP);U(rg,"VERSION",GR);class fy{constructor(e,n){U(this,"opts",void 0),U(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:s}=n;let c=i;if(i&&i.length!==s){c=new Float32Array(s);const d=n.elementOffset||0;for(let l=0;l<s;++l)c[l]=i[d+l]}return c}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function e6(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Vp(t){return t.stride||t.size*t.bytesPerElement}function mP(t,e){e.offset&&Zt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Vp(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,c=i*n+s*t.bytesPerElement+(t.offset||0);return{...e,offset:c,stride:n}}function t6(t,e){const n=mP(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class n6{constructor(e,n,i){U(this,"gl",void 0),U(this,"id",void 0),U(this,"size",void 0),U(this,"settings",void 0),U(this,"value",void 0),U(this,"doublePrecision",void 0),U(this,"_buffer",void 0),U(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const s=n.logicalType||n.type,c=s===5130;let{defaultValue:d}=n;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let l;c?l=5126:!s&&n.isIndexed?l=e&&pD(e,In.ELEMENT_INDEX_UINT32)?5125:5123:l=s||5126;let y=e6(s||l||5126);this.doublePrecision=c,c&&n.fp64===!1&&(y=Float32Array),this.value=null,this.settings={...n,defaultType:y,defaultValue:d,logicalType:s,type:l,size:this.size,bytesPerElement:y.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new yn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Vp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),gu.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},s=this.value instanceof Float64Array,c=t6(this.getAccessor(),n||{});return i[e]=new fy(this,c.high),i["".concat(e,"64Low")]=s?new fy(this,c.low):new Float32Array(this.size),i}if(n){const i=mP(this.getAccessor(),n);return{[e]:new fy(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:s}=this,c=i*s;if(n&&c&&n.length>=c){const d=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let y=0;y<c;)for(let w=0;w<s;w++){const S=n[y++];S<d[w]&&(d[w]=S),S>l[w]&&(l[w]=S)}e=[d,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof yn?i={buffer:e}:i=e;const s={...this.settings,...i};if(n.bufferAccessor=s,n.bounds=null,i.constant){let c=i.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!n.constant||!this._areValuesEqual(c,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=c}else if(i.buffer){const c=i.buffer;n.externalBuffer=c,n.constant=!1,this.value=i.value||null;const d=i.value instanceof Float64Array;s.type=i.type||c.accessor.type,s.bytesPerElement=c.accessor.BYTES_PER_ELEMENT*(d?2:1),s.stride=Vp(s)}else if(i.value){this._checkExternalBuffer(i);let c=i.value;n.externalBuffer=null,n.constant=!1,this.value=c,s.bytesPerElement=c.BYTES_PER_ELEMENT,s.stride=Vp(s);const{buffer:d,byteOffset:l}=this;this.doublePrecision&&c instanceof Float64Array&&(c=cy(c,s));const y=c.byteLength+l+s.stride*2;d.byteLength<y&&d.reallocate(y),d.setAccessor(null),d.subData({data:c,offset:l}),s.type=i.type||d.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?cy(n,{size:this.size,startIndex:i,endIndex:s}):n.subarray(i,s),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,s=i.allocatedValue,c=gu.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=c;const{buffer:d,byteOffset:l}=this;return d.byteLength<c.byteLength+l&&(d.reallocate(c.byteLength+l),n&&s&&d.subData({data:s instanceof Float64Array?cy(s,this):s,offset:l})),i.allocatedValue=c,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=n.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Zt.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:s,size:c}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let d=c;for(;--d>=0;)n[i+d]=s[d];return n}switch(c){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let d=c;for(;--d>=0;)n[i+d]=Number.isFinite(e[d])?e[d]:s[d]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==n[s])return!1;return!0}}const KE=[],JE=[];function sg(t,e=0,n=1/0){let i=KE;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(JE.length=t.length,i=JE):i=KE,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),s.index=e-1),{iterable:i,objectInfo:s}}function gP(t){return t&&t[Symbol.asyncIterator]}function _P(t,e){const{size:n,stride:i,offset:s,startIndices:c,nested:d}=e,l=t.BYTES_PER_ELEMENT,y=i?i/l:n,w=s?s/l:0,S=Math.floor((t.length-w)/y);return(I,{index:P,target:B})=>{if(!c){const Z=P*y+w;for(let j=0;j<n;j++)B[j]=t[Z+j];return B}const G=c[P],K=c[P+1]||S;let de;if(d){de=new Array(K-G);for(let Z=G;Z<K;Z++){const j=Z*y+w;B=new Array(n);for(let q=0;q<n;q++)B[q]=t[j+q];de[Z-G]=B}}else if(y===n)de=t.subarray(G*n+w,K*n+w);else{de=new t.constructor((K-G)*n);let Z=0;for(let j=G;j<K;j++){const q=j*y+w;for(let se=0;se<n;se++)de[Z++]=t[q+se]}}return de}}const i6=[],jp=[[0,1/0]];function r6(t,e){if(t===jp||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let s=0;for(let c=0;c<i;c++){const d=t[c];d[1]<e[0]?(n.push(d),s=c+1):d[0]>e[1]?n.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return n.splice(s,0,e),n}function py(t){const{source:e,target:n,start:i=0,size:s,getData:c}=t,d=t.end||n.length,l=e.length,y=d-i;if(l>y){n.set(e.subarray(0,y),i);return}if(n.set(e,i),!c)return;let w=l;for(;w<y;){const S=c(w,e);for(let I=0;I<s;I++)n[i+w]=S[I]||0,w++}}function s6({source:t,target:e,size:n,getData:i,sourceStartIndices:s,targetStartIndices:c}){if(!Array.isArray(c))return py({source:t,target:e,size:n,getData:i}),e;let d=0,l=0;const y=i&&((S,I)=>i(S+l,I)),w=Math.min(s.length,c.length);for(let S=1;S<w;S++){const I=s[S]*n,P=c[S]*n;py({source:t.subarray(d,I),target:e,start:l,end:P,size:n,getData:y}),d=I,l=P}return l<e.length&&py({source:[],target:e,start:l,size:n,getData:y}),e}const o6={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function yP(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...o6[n],...e,...t,type:n}}function vP(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function xP(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function bP(t){t.push(t.shift())}function gx(t,e){const{doublePrecision:n,settings:i,value:s,size:c}=t,d=n&&s instanceof Float64Array?2:1;return(i.noAlloc?s.length:e*c)*d}function wP({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:s,getData:c=d=>d}){const d=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*d,y=n.byteOffset,w=n.startIndices,S=s&&w,I=gx(n,e),P=n.isConstant;if(!S&&i>=I)return;const B=P?n.value:n.getBuffer().getData({srcByteOffset:y});if(n.settings.normalized&&!P){const Z=c;c=(j,q)=>n.normalizeConstant(Z(j,q))}const G=P?(Z,j)=>c(B,j):(Z,j)=>c(B.subarray(Z,Z+l),j),K=t.getData({length:i}),de=new Float32Array(I);s6({source:K,target:de,sourceStartIndices:s,targetStartIndices:w,size:l,getData:G}),t.byteLength<de.byteLength+y&&t.reallocate(de.byteLength+y),t.subData({data:de,offset:y})}class _x extends n6{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:jp}),U(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,s=Array.isArray(n)?e[n.find(c=>e[c])]:e[n];return yP(s,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:s=1/0}=n;this.state.updateRanges=r6(this.state.updateRanges,[i,s])}else this.state.updateRanges=jp}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=i6}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==jp),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:l}}=this;let y=!0;if(d){for(const[w,S]of c)d.call(s,this,{data:n,startRow:w,endRow:S,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,S]of c){const I=Number.isFinite(w)?this.getVertexOffset(w):0,P=Number.isFinite(S)?this.getVertexOffset(S):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:I,endOffset:P})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;Ii(ArrayBuffer.isView(d.value),"invalid ".concat(s.accessor));const l=!!d.size&&d.size!==this.size;return i.binaryAccessor=_P(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:s,props:c,numInstances:d}){if(e.constant)return;const{settings:l,state:y,value:w,size:S,startIndices:I}=e,{accessor:P,transform:B}=l,G=y.binaryAccessor||(typeof P=="function"?P:c[P]);Ii(typeof G=="function",'accessor "'.concat(P,'" is not a function'));let K=e.getVertexOffset(i);const{iterable:de,objectInfo:Z}=sg(n,i,s);for(const j of de){Z.index++;let q=G(j,Z);if(B&&(q=B.call(this,q)),I){const se=(Z.index<I.length-1?I[Z.index+1]:d)-I[Z.index];if(q&&Array.isArray(q[0])){let pe=K;for(const be of q)e._normalizeValue(be,w,pe),pe+=S}else q&&q.length>S?w.set(q,K):(e._normalizeValue(q,Z.target,0),RN({target:w,source:Z.target,start:K,count:se}));K+=se*S}else e._normalizeValue(q,w,K),K+=S}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class a6{constructor({gl:e,attribute:n,timeline:i}){U(this,"gl",void 0),U(this,"type","interpolation"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.transition=new Ud(i),this.attribute=n,this.attributeInTransition=new _x(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=c6(e,n);const s={byteLength:0,usage:35050};this.buffers=[new yn(e,s),new yn(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:s,attribute:c}=this;bP(s);const d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of s)wP({buffer:l,...d});this.currentStartIndices=c.startIndices,this.currentLength=gx(c,n),this.attributeInTransition.setData({buffer:s[1],value:c.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aFrom:s[0],aTo:vP(i,c)},feedbackBuffers:{vCurrent:s[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:s}=this.transition;let c=s/n;i&&(c=i(c)),this.transform.run({uniforms:{time:c}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const l6=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function c6(t,e){const n=xP(e.size);return new lx(t,{vs:l6,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class u6{constructor({gl:e,attribute:n,timeline:i}){U(this,"gl",void 0),U(this,"type","spring"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"texture",void 0),U(this,"framebuffer",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Ud(i),this.attribute=n,this.attributeInTransition=new _x(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=d6(e),this.framebuffer=f6(e,this.texture),this.transform=h6(e,n,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new yn(e,s),new yn(e,s),new yn(e,s)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:s,attribute:c}=this,d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of s)wP({buffer:l,...d});this.settings=e,this.currentStartIndices=c.startIndices,this.currentLength=gx(c,n),this.attributeInTransition.setData({buffer:s[1],value:c.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aTo:vP(i,c)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:s}=this;if(!s.update())return!1;const d=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:d.stiffness,damping:d.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),bP(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),ng(i)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function h6(t,e,n){const i=xP(e.size);return new lx(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function d6(t){return new es(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function f6(t,e){return new vi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const p6={interpolation:a6,spring:u6};class m6{constructor(e,{id:n,timeline:i}){U(this,"id",void 0),U(this,"isSupported",void 0),U(this,"gl",void 0),U(this,"timeline",void 0),U(this,"transitions",void 0),U(this,"needsRedraw",void 0),U(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=lx.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const s in e){const c=e[s],d=c.getTransitionSetting(n);d&&this._updateAttribute(s,c,d)}for(const s in this.transitions){const c=e[s];(!c||!c.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const s=this.transitions[e];let c=!s||s.type!==i.type;if(c){if(!this.isSupported){Zt.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}s&&this._removeTransition(e);const d=p6[i.type];d?this.transitions[e]=new d({attribute:n,timeline:this.timeline,gl:this.gl}):(Zt.error("unsupported transition type '".concat(i.type,"'"))(),c=!1)}(c||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const QE="attributeManager.invalidate",g6="attributeManager.updateStart",_6="attributeManager.updateEnd",y6="attribute.updateStart",v6="attribute.allocate",x6="attribute.updateEnd";class b6{constructor(e,{id:n="attribute-manager",stats:i,timeline:s}={}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"attributes",void 0),U(this,"updateTriggers",void 0),U(this,"needsRedraw",void 0),U(this,"userData",void 0),U(this,"stats",void 0),U(this,"attributeTransitionManager",void 0),U(this,"mergeBoundsMemoized",Fd(sN)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new m6(e,{id:"".concat(n,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Qi(QE,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Qi(QE,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:s,props:c={},buffers:d={},context:l={}}){let y=!1;Qi(g6,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const S=this.attributes[w],I=S.settings.accessor;S.startIndices=i,S.numInstances=n,c[w]&&Zt.removed("props.".concat(w),"data.attributes.".concat(w))(),S.setExternalBuffer(d[w])||S.setBinaryValue(typeof I=="string"?d[I]:void 0,e.startIndices)||typeof I=="string"&&!d[I]&&S.setConstantValue(c[I])||S.needsUpdate()&&(y=!0,this._updateAttribute({attribute:S,numInstances:n,data:e,props:c,context:l})),this.needsRedraw=this.needsRedraw||S.needsRedraw()}y&&Qi(_6,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var s;return(s=this.attributes[i])===null||s===void 0?void 0:s.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const c in n){const d=n[c];d.needsRedraw(e)&&!i.hasAttribute(c)&&(s[c]=d)}return s}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const s in e)n[s]||Object.assign(i,e[s].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const s=e[i];this.attributes[i]=this._createAttribute(i,s,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const s={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new _x(this.gl,s)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:s}=this,c=s[e];return c&&c.forEach(d=>{const l=i[d];l&&l.setNeedsUpdate(l.id,n)}),c}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Qi(y6,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Qi(v6,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Qi(x6,n,i))}}class w6 extends Ud{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:s,easing:c}}=this,d=c(e/s);this._value=Em(n,i,d)}}const eT=1e-5;function tT(t,e,n,i,s){const c=e-t,l=(n-e)*s,y=-c*i;return l+y+c+e}function E6(t,e,n,i,s){if(Array.isArray(n)){const c=[];for(let d=0;d<n.length;d++)c[d]=tT(t[d],e[d],n[d],i,s);return c}return tT(t,e,n,i,s)}function nT(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const s=t[i]-e[i];n+=s*s}return Math.sqrt(n)}return Math.abs(t-e)}class T6 extends Ud{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:s}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let l=E6(c,d,n,i,s);const y=nT(l,n),w=nT(l,d);y<eT&&w<eT&&(l=n,this.end()),this._prevValue=d,this._currValue=l}}const S6={interpolation:w6,spring:T6};class A6{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,s){const{transitions:c}=this;if(c.has(e)){const y=c.get(e),{value:w=y.settings.fromValue}=y;n=w,this.remove(e)}if(s=yP(s),!s)return;const d=S6[s.type];if(!d){Zt.error("unsupported transition type '".concat(s.type,"'"))();return}const l=new d(this.timeline);l.start({...s,fromValue:n,toValue:i}),c.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function P6(t){const e=t[Va];for(const n in e){const i=e[n],{validate:s}=i;if(s&&!s(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function C6(t,e){const n=EP({newProps:t,oldProps:e,propTypes:t[Va],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=M6(t,e);let s=!1;return i||(s=L6(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:s,extensionsChanged:k6(t,e),transitionsChanged:I6(t,e)}}function I6(t,e){if(!t.transitions)return!1;const n={},i=t[Va];let s=!1;for(const c in t.transitions){const d=i[c],l=d&&d.type;(l==="number"||l==="color"||l==="array")&&B0(t[c],e[c],d)&&(n[c]=!0,s=!0)}return s?n:!1}function EP({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(s," changed shallowly");for(const c of Object.keys(t))if(!(c in n)){if(!(c in e))return"".concat(s,".").concat(c," added");const d=B0(t[c],e[c],i[c]);if(d)return"".concat(s,".").concat(c," ").concat(d)}for(const c of Object.keys(e))if(!(c in n)){if(!(c in t))return"".concat(s,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const d=B0(t[c],e[c],i[c]);if(d)return"".concat(s,".").concat(c," ").concat(d)}}return!1}function B0(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function M6(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:s}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&s&&(n=s(t.data,e.data)||n),n}function L6(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&iT(t,e,"all"))return{all:!0};const n={};let i=!1;for(const s in t.updateTriggers)s!=="all"&&iT(t,e,s)&&(n[s]=!0,i=!0);return i?n:!1}function k6(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(n[s]))return!0;return!1}function iT(t,e,n){let i=t.updateTriggers[n];i=i??{};let s=e.updateTriggers[n];return s=s??{},EP({oldProps:s,newProps:i,triggerName:n})}const R6="count(): argument not an object",z6="count(): argument not a container";function D6(t){if(!F6(t))throw new Error(R6);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(O6(t))return Object.keys(t).length;throw new Error(z6)}function O6(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function F6(t){return t!==null&&typeof t=="object"}function B6(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(s=>s.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];n.inject=i}return n}const N6={10241:9987,10240:9729,10242:33071,10243:33071},N0={};function U6(t,e,n,i){if(n instanceof es)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let s=null;n.compressed&&(s={10241:n.data.length>1?9985:9729});const c=new es(e,{...n,parameters:{...N6,...s,...i}});return N0[c.id]=t,c}function V6(t,e){!e||!(e instanceof es)||N0[e.id]===t&&(e.delete(),delete N0[e.id])}const j6={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||U0(t)&&(t.length===3||t.length===4)},equal(t,e,n){return uo(t,e,1)}},accessor:{validate(t,e){const n=km(t);return n==="function"||n===km(e.value)},equal(t,e,n){return typeof e=="function"?!0:uo(t,e,1)}},array:{validate(t,e){return e.optional&&!t||U0(t)},equal(t,e,n){const{compare:i}=n,s=Number.isInteger(i)?i:i?1:0;return i?uo(t,e,s):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,s=Number.isInteger(i)?i:i?1:0;return i?uo(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:U6(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{V6(n.id,t)}}};function G6(t){const e={},n={},i={};for(const[s,c]of Object.entries(t)){const d=c==null?void 0:c.deprecatedFor;if(d)i[s]=Array.isArray(d)?d:[d];else{const l=W6(s,c);e[s]=l,n[s]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function W6(t,e){switch(km(e)){case"object":return Ch(t,e);case"array":return Ch(t,{type:"array",value:e,compare:!1});case"boolean":return Ch(t,{type:"boolean",value:e});case"number":return Ch(t,{type:"number",value:e});case"function":return Ch(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ch(t,e){return"type"in e?{name:t,...j6[e.type],...e}:"value"in e?{name:t,type:km(e.value),...e}:{name:t,type:"object",value:e}}function U0(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function km(t){return U0(t)?"array":t===null?"null":typeof t}function H6(t,e){let n;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(n=d.extensions)}const i=V0(t.constructor,n),s=Object.create(i);s[Mm]=t,s[jl]={},s[Ma]={};for(let c=0;c<e.length;++c){const d=e[c];for(const l in d)s[l]=d[l]}return Object.freeze(s),s}const $6="_mergedDefaultProps";function V0(t,e){let n=$6;if(e)for(const s of e){const c=s.constructor;c&&(n+=":".concat(c.extensionName||c.name))}const i=TP(t,n);return i||(t[n]=q6(t,e||[]))}function q6(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),s=V0(i),c=TP(t,"defaultProps")||{},d=G6(c),l=Object.assign(Object.create(null),s,d.defaultProps),y=Object.assign(Object.create(null),s==null?void 0:s[Va],d.propTypes),w=Object.assign(Object.create(null),s==null?void 0:s[hy],d.deprecatedProps);for(const S of e){const I=V0(S.constructor);I&&(Object.assign(l,I),Object.assign(y,I[Va]),Object.assign(w,I[hy]))}return Z6(l,t),Y6(l,y),X6(l,w),l[Va]=y,l[hy]=w,e.length===0&&!yx(t,"_propTypes")&&(t._propTypes=y),l}function Z6(t,e){const n=J6(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function X6(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const s="".concat(this.id,": ").concat(n);for(const c of e[n])yx(this,c)||(this[c]=i);Zt.deprecated(s,e[n].join("/"))()}})}function Y6(t,e){const n={},i={};for(const s in e){const c=e[s],{name:d,value:l}=c;c.async&&(n[d]=l,i[d]=K6(d))}t[Qc]=n,t[jl]={},Object.defineProperties(t,i)}function K6(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||gP(e)?this[jl][t]=e:this[Ma][t]=e},get(){if(this[Ma]){if(t in this[Ma])return this[Ma][t]||this[Qc][t];if(t in this[jl]){const e=this[Mm]&&this[Mm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Qc][t]}}return this[Qc][t]}}}function yx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function TP(t,e){return yx(t,e)&&t[e]}function J6(t){const e=t.componentName;return e||Zt.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let Q6=0;class vx{constructor(...e){U(this,"id",void 0),U(this,"props",void 0),U(this,"count",void 0),this.props=H6(this,e),this.id=this.props.id,this.count=Q6++}clone(e){const{props:n}=this,i={};for(const s in n[Qc])s in n[Ma]?i[s]=n[Ma][s]:s in n[jl]&&(i[s]=n[jl][s]);return new this.constructor({...n,...i,...e})}}U(vx,"componentName","Component");U(vx,"defaultProps",{});const eU=Object.freeze({});class tU{constructor(e){U(this,"component",void 0),U(this,"onAsyncPropUpdated",void 0),U(this,"asyncProps",void 0),U(this,"oldProps",void 0),U(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||eU}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Mm]||this.component;const n=e[Ma]||{},i=e[jl]||e,s=e[Qc]||{};for(const c in n){const d=n[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,d),n[c]=this.getAsyncProp(c)}for(const c in i){const d=i[c];this._createAsyncPropData(c,s[c]),this._updateAsyncProp(c,d)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(gP(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=n,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;n.then(c=>{this.component&&(c=this._postProcessValue(i,c),this._setAsyncPropValue(e,c,s),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let c=[],d=0;for await(const l of n){if(!this.component)return;const{dataTransform:y}=this.component.props;y?c=y(l,c):c=c.concat(l),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,s)}this._onResolve(e,c)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Va];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class nU extends tU{constructor({attributeManager:e,layer:n}){super(n),U(this,"attributeManager",void 0),U(this,"needsRedraw",void 0),U(this,"needsUpdate",void 0),U(this,"subLayers",void 0),U(this,"usesPickingColorCache",void 0),U(this,"hasPickingBuffer",void 0),U(this,"changeFlags",void 0),U(this,"viewport",void 0),U(this,"uniformTransitions",void 0),U(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const iU="layer.changeFlag",rU="layer.initialize",sU="layer.update",oU="layer.finalize",aU="layer.matched",rT=2**24-1,lU=Object.freeze([]),cU=Fd(({oldViewport:t,viewport:e})=>t.equals(e));let so=new Uint8ClampedArray(0);const uU={data:{type:"data",value:lU,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:s,signal:c})=>{const{resourceManager:d}=n.context;if(s=s||n.getLoadOptions(),i=i||n.props.loaders,c){var l;s={...s,fetch:{...(l=s)===null||l===void 0?void 0:l.fetch,signal:c}}}let y=d.contains(t);return!y&&!s&&(d.add({resourceId:t,data:xm(t,i),persistent:!1}),y=!0),y?d.subscribe({resourceId:t,onChange:w=>{var S;return(S=n.internalState)===null||S===void 0?void 0:S.reloadAsyncProp(e,w)},consumerId:n.id,requestId:e}):xm(t,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:cn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Yo extends vx{constructor(...e){super(...e),U(this,"internalState",null),U(this,"lifecycle",Mc.NO_STATE),U(this,"context",void 0),U(this,"state",void 0),U(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ii(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=rP(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,c,d]=iP(i,n.pixelProjectionMatrix);return e.length===2?[s,c]:[s,c,d]}unproject(e){return Ii(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ii(this.internalState);const i=this.internalState.viewport||this.context.viewport;return hN(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===cn.DEFAULT||e===cn.LNGLAT||e===cn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ii(e instanceof Uint8Array);const[n,i,s]=e;return n+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:D6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=B6(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const s of i)n.invalidateAll(s);else n.invalidateAll();if(n){const{props:s}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:l,instancePickingColors:y}=n.attributes,w=l||y;w&&(d&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!d&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,n){var i,s;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(s=this.props).onError)!==null&&i!==void 0&&i.call(s,e))){var c,d;(c=this.context)===null||c===void 0||(d=c.onError)===null||d===void 0||d.call(c,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!cU({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:s,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const s in n)Object.defineProperty(i,s,{value:n[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(so.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>rT&&Zt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),so=gu.allocate(so,n,{size:3,copy:!0,maxCount:Math.max(n,rT)});const s=Math.floor(so.length/3),c=[];for(let d=i;d<s;d++)this.encodePickingColor(d,c),so[d*3+0]=c[0],so[d*3+1]=c[1],so[d*3+2]=c[2]}e.value=so.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),s=e.userData.excludeAttributes||{},c=i.getShaderAttributes(n,s);e.setAttributes(c)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,c=i||s,d=c&&n.attributes&&n.attributes[c.id];if(d&&d.value){const l=d.value,y=this.encodePickingColor(e);for(let w=0;w<n.length;w++){const S=c.getVertexOffset(w);l[S]===y[0]&&l[S+1]===y[1]&&l[S+2]===y[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i;if(!s)return;const c=s.getVertexOffset(e),d=s.getVertexOffset(e+1);s.buffer.subData({data:new Uint8Array(d-c),offset:c})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==so.buffer&&(i.value=so.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ii(!this.internalState),Ii(Number.isFinite(this.props.coordinateSystem)),Qi(rU,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new nU({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Zt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new A6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Qi(aU,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Qi(sU,this,e),!e)return;const n=this.props,i=this.context,s=this.internalState,c=i.viewport,d=this._updateUniformTransition();s.propsInTransition=d,i.viewport=s.viewport||c,this.props=d;try{const l=this._getUpdateParams(),y=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const S of this.props.extensions)S.updateState.call(this,l,S);const w=this.getModels()[0]!==y[0];this._postUpdate(l,w)}finally{i.viewport=c,this.props=n,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Qi(oU,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,c=this.context;this.props=this.internalState.propsInTransition||s;const d=this.props.opacity;n.opacity=Math.pow(d,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,y=l&&l(n)||[0,0];Ho(c.gl,{polygonOffset:y}),Ns(c.gl,i,()=>{const w={moduleParameters:e,uniforms:n,parameters:i,context:c};for(const S of this.props.extensions)S.draw.call(this,w,S);this.draw(w)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const s in e)if(e[s]){let c=!1;switch(s){case"dataChanged":const d=e[s],l=n[s];d&&Array.isArray(l)&&(n.dataChanged=Array.isArray(d)?l.concat(d):d,c=!0);default:n[s]||(n[s]=e[s],c=!0)}c&&Qi(iU,this,s,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=C6(e,n);if(i.updateTriggersChanged)for(const c in i.updateTriggersChanged)i.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(i.transitionsChanged)for(const c in i.transitionsChanged){var s;this.internalState.uniformTransitions.add(c,n[c],e[c],(s=e.transitions)===null||s===void 0?void 0:s[c])}return this.setChangeFlags(i)}validateProps(){P6(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new b6(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:c}=this.state;c==null||c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:l,highlightColor:y}=i;if(n||s.autoHighlight!==d||s.highlightedObjectIndex!==l||s.highlightColor!==y){const w={};d||(w.pickingSelectedColor=null),Array.isArray(y)&&(w.pickingHighlightColor=y),(n||l!==s.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(n=n||s,n)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}U(Yo,"defaultProps",uU);U(Yo,"layerName","Layer");const hU="compositeLayer.renderLayers";class xx extends Yo{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,s)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:s,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:w,highlightColor:S,coordinateSystem:I,coordinateOrigin:P,wrapLongitude:B,positionFormat:G,modelMatrix:K,extensions:de,fetch:Z,operation:j,_subLayerProps:q}=this.props,se={id:"",updateTriggers:{},opacity:i,pickable:s,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:w,highlightColor:S,coordinateSystem:I,coordinateOrigin:P,wrapLongitude:B,positionFormat:G,modelMatrix:K,extensions:de,fetch:Z,operation:j},pe=q&&e.id&&q[e.id],be=pe&&pe.updateTriggers,Re=e.id||"sublayer";if(pe){const Fe=this.props[Va],Ve=e.type?e.type._propTypes:{};for(const je in pe){const pt=Ve[je]||Fe[je];pt&&pt.type==="accessor"&&(pe[je]=this.getSubLayerAccessor(pe[je]))}}Object.assign(se,e,pe),se.id="".concat(this.props.id,"-").concat(Re),se.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...be};for(const Fe of de){const Ve=Fe.getSubLayerProps.call(this,Fe);Ve&&Object.assign(se,Ve,{updateTriggers:Object.assign(se.updateTriggers,Ve.updateTriggers)})}return se}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const c=this.renderLayers();i=px(c,Boolean),this.internalState.subLayers=i}Qi(hU,this,s,i);for(const c of i)c.parent=this}}U(xx,"layerName","CompositeLayer");class SP{constructor(e){U(this,"opts",void 0),U(this,"typedArrayManager",void 0),U(this,"indexStarts",[0]),U(this,"vertexStarts",[0]),U(this,"vertexCount",0),U(this,"instanceCount",0),U(this,"attributes",void 0),U(this,"_attributeDefs",void 0),U(this,"data",void 0),U(this,"getGeometry",void 0),U(this,"geometryBuffer",void 0),U(this,"buffers",void 0),U(this,"positionSize",void 0),U(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=gu,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:s,geometryBuffer:c,positionFormat:d,dataChanged:l,normalize:y=!0}=this.opts;if(this.data=n,this.getGeometry=s,this.positionSize=c&&c.size||(d==="XY"?2:3),this.buffers=i,this.normalize=y,c&&(Ii(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),y||(i.positions=c)),this.geometryBuffer=i.positions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?_P(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:s,_attributeDefs:c,typedArrayManager:d}=this;for(const l in c)if(l in s)d.release(i[l]),i[l]=null;else{const y=c[l];y.copy=n,i[l]=d.allocate(i[l],e,y)}}_forEachGeometry(e,n,i){const{data:s,getGeometry:c}=this,{iterable:d,objectInfo:l}=sg(s,n,i);for(const y of d){l.index++;const w=c?c(y,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:s}=this;const{data:c,geometryBuffer:d}=this,{startRow:l=0,endRow:y=1/0}=e||{},w={};if(e||(n=[0],i=[0]),this.normalize||!d)this._forEachGeometry((I,P)=>{const B=I&&this.normalizeGeometry(I);w[P]=B,i[P+1]=i[P]+(B?this.getGeometrySize(B):0)},l,y),s=i[i.length-1];else if(i=c.startIndices,s=i[c.length]||0,ArrayBuffer.isView(d))s=s||d.length/this.positionSize;else if(d instanceof yn){const I=d.accessor.stride||this.positionSize*4;s=s||d.byteLength/I}else if(d.buffer){const I=d.stride||this.positionSize*4;s=s||d.buffer.byteLength/I}else if(d.value){const I=d.value,P=d.stride/I.BYTES_PER_ELEMENT||this.positionSize;s=s||I.length/P}this._allocate(s,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=s;const S={};this._forEachGeometry((I,P)=>{const B=w[P]||I;S.vertexStart=i[P],S.indexStart=n[P];const G=P<i.length-1?i[P+1]:s;S.geometrySize=G-i[P],S.geometryIndex=P,this.updateGeometryAttributes(B,S)},l,y),this.vertexCount=n[n.length-1]}}const dU=typeof window<"u"?at.useLayoutEffect:at.useEffect,fU=dU;function Rm(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const pU={position:"absolute",zIndex:-1};function AP(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>AP(n,e));if(og(t)){if(mU(t))return e.style=pU,at.cloneElement(t,e);if(gU(t))return at.cloneElement(t,e)}return t}function og(t){return t&&typeof t=="object"&&"type"in t||!1}function mU(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function gU(t){const e=t.type;return e&&e.deckGLViewProps}function j0(t){if(typeof t=="function")return at.createElement(yu,{},t);if(Array.isArray(t))return t.map(j0);if(og(t)){if(t.type===at.Fragment)return j0(t.props.children);if(Rm(t.type,yu))return t}return t}function _U({children:t,layers:e=[],views:n=null}){const i=[],s=[],c={};return at.Children.forEach(j0(t),d=>{if(og(d)){const l=d.type;if(Rm(l,Yo)){const y=yU(l,d.props);s.push(y)}else i.push(d);if(Rm(l,yu)&&l!==yu&&d.props.id){const y=new l(d.props);c[y.id]=y}}else d&&i.push(d)}),Object.keys(c).length>0&&(Array.isArray(n)?n.forEach(d=>{c[d.id]=d}):n&&(c[n.id]=n),n=Object.values(c)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:n}}function yU(t,e){const n={},i=t.defaultProps||{};for(const s in e)i[s]!==e[s]&&(n[s]=e[s]);return new t(n)}function vU({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},c=i.views[0].id;for(const d of t){let l=c,y=d;og(d)&&Rm(d.type,yu)&&(l=d.props.id||c,y=d.props.children);const w=i.getViewport(l),S=i.getViewState(l);if(w){S.padding=w.padding;const{x:I,y:P,width:B,height:G}=w;y=AP(y,{x:I,y:P,width:B,height:G,viewport:w,viewState:S}),s[l]||(s[l]={viewport:w,children:[]}),s[l].children.push(y)}}return Object.keys(s).map(d=>{const{viewport:l,children:y}=s[d],{x:w,y:S,width:I,height:P}=l,B={position:"absolute",left:w,top:S,width:I,height:P},G="view-".concat(d),K=at.createElement("div",{key:G,id:G,style:B},...y);if(n){const de={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:Z=>{Z.viewId=d,e._onViewStateChange(Z)}};return at.createElement(n,{key:G,value:de},K)}return K})}const xU={mixBlendMode:null};function bU({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},s={left:0,top:0};if(n)for(const c in n)c in xU?s[c]=n[c]:i[c]=n[c];return{containerStyle:i,canvasStyle:s}}function wU(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function PP(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function EU(t,e,n){const i=new e({...n,_customRender:s=>{t.redrawReason=s;const c=i.getViewports();t.lastRenderedViewports!==c?t.forceUpdate():PP(t)}});return i}const CP=at.forwardRef((t,e)=>{const[n,i]=at.useState(0),c=at.useRef({control:null,version:n,forceUpdate:()=>i(pe=>pe+1)}).current,d=at.useRef(null),l=at.useRef(null),y=at.useMemo(()=>_U(t),[t.layers,t.views,t.children]);let w=!0;const S=pe=>{var be;return w&&t.viewState?(c.viewStateUpdateRequested=pe,null):(c.viewStateUpdateRequested=null,(be=t.onViewStateChange)===null||be===void 0?void 0:be.call(t,pe))},I=pe=>{if(w)c.interactionStateUpdateRequested=pe;else{var be;c.interactionStateUpdateRequested=null,(be=t.onInteractionStateChange)===null||be===void 0||be.call(t,pe)}},P=at.useMemo(()=>{const pe={...t,style:null,width:"100%",height:"100%",parent:d.current,canvas:l.current,layers:y.layers,views:y.views,onViewStateChange:S,onInteractionStateChange:I};return delete pe._customRender,c.deck&&c.deck.setProps(pe),pe},[t]);at.useEffect(()=>{const pe=t.Deck||rg;return c.deck=EU(c,pe,{...P,parent:d.current,canvas:l.current}),()=>{var be;return(be=c.deck)===null||be===void 0?void 0:be.finalize()}},[]),fU(()=>{PP(c);const{viewStateUpdateRequested:pe,interactionStateUpdateRequested:be}=c;pe&&S(pe),be&&I(be)}),at.useImperativeHandle(e,()=>wU(c),[]);const B=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:G,width:K,height:de,id:Z,style:j}=t,{containerStyle:q,canvasStyle:se}=at.useMemo(()=>bU({width:K,height:de,style:j}),[K,de,j]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===B||c.version!==n){c.lastRenderedViewports=B,c.version=n;const pe=vU({children:y.children,deck:c.deck,ContextProvider:G}),be=at.createElement("canvas",{key:"canvas",id:Z||"deckgl-overlay",ref:l,style:se});c.control=at.createElement("div",{id:"".concat(Z||"deckgl","-wrapper"),ref:d,style:q},[be,pe])}return w=!1,c.control});CP.defaultProps=rg.defaultProps;const TU=CP,SU=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,AU=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,PU=1024,CU=4,sT=()=>{},oT={10241:9987,10240:9729,10242:33071,10243:33071};function IU(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function MU(t,e,n,i){const s=Math.min(n/e.width,i/e.height),c=Math.floor(e.width*s),d=Math.floor(e.height*s);return s===1?{data:e,width:c,height:d}:(t.canvas.height=d,t.canvas.width=c,t.clearRect(0,0,c,d),t.drawImage(e,0,0,e.width,e.height,0,0,c,d),{data:t.canvas,width:c,height:d})}function yd(t){return t&&(t.id||t.url)}function LU(t,e,n,i){const s=t.width,c=t.height,d=new es(t.gl,{width:e,height:n,parameters:i});return uD(t,d,{targetY:0,width:s,height:c}),t.delete(),d}function aT(t,e,n){for(let i=0;i<e.length;i++){const{icon:s,xOffset:c}=e[i],d=yd(s);t[d]={...s,x:c,y:n}}}function kU({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:s=0,rowHeight:c=0,canvasWidth:d}){let l=[];for(let y=0;y<t.length;y++){const w=t[y],S=yd(w);if(!n[S]){const{height:I,width:P}=w;i+P+e>d&&(aT(n,l,s),i=0,s=c+s+e,c=0,l=[]),l.push({icon:w,xOffset:i}),i=i+P+e,c=Math.max(c,I)}}return l.length>0&&aT(n,l,s),{mapping:n,rowHeight:c,xOffset:i,yOffset:s,canvasWidth:d,canvasHeight:IU(c+s+e)}}function RU(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:s,objectInfo:c}=sg(t);for(const d of s){c.index++;const l=e(d,c),y=yd(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!i[y]&&(!n[y]||l.url!==n[y].url)&&(i[y]={...l,source:d,sourceIndex:c.index})}return i}class zU{constructor(e,{onUpdate:n=sT,onError:i=sT}){U(this,"gl",void 0),U(this,"onUpdate",void 0),U(this,"onError",void 0),U(this,"_loadOptions",null),U(this,"_texture",null),U(this,"_externalTexture",null),U(this,"_mapping",{}),U(this,"_textureParameters",null),U(this,"_pendingCount",0),U(this,"_autoPacking",!1),U(this,"_xOffset",0),U(this,"_yOffset",0),U(this,"_rowHeight",0),U(this,"_buffer",CU),U(this,"_canvasWidth",PU),U(this,"_canvasHeight",0),U(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?yd(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:s,textureParameters:c}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),s&&(this._mapping=s),i){var d;(d=this._texture)===null||d===void 0||d.delete(),this._texture=null,this._externalTexture=i}c&&(this._textureParameters=c)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(RU(e,n,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:c,yOffset:d,rowHeight:l,canvasHeight:y}=kU({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=s,this._xOffset=c,this._yOffset=d,this._canvasHeight=y,this._texture||(this._texture=new es(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||oT})),this._texture.height!==this._canvasHeight&&(this._texture=LU(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||oT)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,xm(i.url,this._loadOptions).then(s=>{const c=yd(i),d=this._mapping[c],{x:l,y,width:w,height:S}=d,{data:I,width:P,height:B}=MU(n,s,w,S);this._texture.setSubImageData({data:I,x:l+(w-P)/2,y:y+(S-B)/2,width:P,height:B}),d.width=P,d.height=B,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const IP=[0,0,0,255],DU={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:IP},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class ag extends Yo{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:SU,fs:AU,modules:[Bd,Nd]})}initializeState(){this.state={iconManager:new zU(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:IP},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:s}=e,c=this.getAttributeManager(),{iconAtlas:d,iconMapping:l,data:y,getIcon:w,textureParameters:S}=n,{iconManager:I}=this.state,P=d||this.internalState.isAsyncPropLoading("iconAtlas");if(I.setProps({loadOptions:n.loadOptions,autoPacking:!P,iconAtlas:d,iconMapping:P?l:null,textureParameters:S}),P?i.iconMapping!==n.iconMapping&&c.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&I.packIcons(y,w),s.extensionsChanged){var B;const{gl:G}=this.context;(B=this.state.model)===null||B===void 0||B.delete(),this.state.model=this._getModel(G),c.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:c,billboard:d,alphaCutoff:l}=this.props,{iconManager:y}=this.state,w=y.getTexture();w&&this.state.model.setUniforms(e).setUniforms({iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:Bl[c],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:s,billboard:d,alphaCutoff:l}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Ul(e,{...this.getShaders(),id:this.props.id,geometry:new Od({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):Zt.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:s=n/2,anchorY:c=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-s,i/2-c]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:s,height:c}=this.state.iconManager.getIconMapping(e);return[n,i,s,c]}}U(ag,"defaultProps",DU);U(ag,"layerName","IconLayer");const OU=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,FU=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,lT=[0,0,0,255],BU={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:lT},getLineColor:{type:"accessor",value:lT},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class bx extends Yo{getShaders(){return super.getShaders({vs:OU,fs:FU,modules:[Bd,Nd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:c,stroked:d,filled:l,billboard:y,antialiasing:w,lineWidthUnits:S,lineWidthScale:I,lineWidthMinPixels:P,lineWidthMaxPixels:B}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:d?1:0,filled:l,billboard:y,antialiasing:w,radiusUnits:Bl[n],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:c,lineWidthUnits:Bl[S],lineWidthScale:I,lineWidthMinPixels:P,lineWidthMaxPixels:B}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Ul(e,{...this.getShaders(),id:this.props.id,geometry:new Od({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}U(bx,"defaultProps",BU);U(bx,"layerName","ScatterplotLayer");const MP={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function LP(t,e,n={}){return NU(t,n)!==e?(VU(t,n),!0):!1}function NU(t,e={}){return Math.sign(UU(t,e))}function UU(t,e={}){const{start:n=0,end:i=t.length}=e,s=e.size||2;let c=0;for(let d=n,l=i-s;d<i;d+=s)c+=(t[d]-t[l])*(t[d+1]+t[l+1]),l=d;return c/2}function VU(t,e){const{start:n=0,end:i=t.length,size:s=2}=e,c=(i-n)/s,d=Math.floor(c/2);for(let l=0;l<d;++l){const y=n+l*s,w=n+(c-1-l)*s;for(let S=0;S<s;++S){const I=t[y+S];t[y+S]=t[w+S],t[w+S]=I}}}function Os(t,e){const n=e.length,i=t.length;if(i>0){let s=!0;for(let c=0;c<n;c++)if(t[i-n+c]!==e[c]){s=!1;break}if(s)return!1}for(let s=0;s<n;s++)t[i+s]=e[s];return!0}function G0(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function vd(t,e,n,i,s=[]){const c=i+e*n;for(let d=0;d<n;d++)s[d]=t[c+d];return s}function W0(t,e,n,i,s=[]){let c,d;if(n&8)c=(i[3]-t[1])/(e[1]-t[1]),d=3;else if(n&4)c=(i[1]-t[1])/(e[1]-t[1]),d=1;else if(n&2)c=(i[2]-t[0])/(e[0]-t[0]),d=2;else if(n&1)c=(i[0]-t[0])/(e[0]-t[0]),d=0;else return null;for(let l=0;l<t.length;l++)s[l]=(d&1)===l?i[d]:c*(e[l]-t[l])+t[l];return s}function Gp(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function kP(t,e){const{size:n=2,broken:i=!1,gridResolution:s=10,gridOffset:c=[0,0],startIndex:d=0,endIndex:l=t.length}=e||{},y=(l-d)/n;let w=[];const S=[w],I=vd(t,0,n,d);let P,B;const G=zP(I,s,c,[]),K=[];Os(w,I);for(let de=1;de<y;de++){for(P=vd(t,de,n,d,P),B=Gp(P,G);B;){W0(I,P,B,G,K);const Z=Gp(K,G);Z&&(W0(I,K,Z,G,K),B=Z),Os(w,K),G0(I,K),GU(G,s,B),i&&w.length>n&&(w=[],S.push(w),Os(w,I)),B=Gp(P,G)}Os(w,P),G0(I,P)}return i?S:S[0]}const cT=0,jU=1;function yp(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function RP(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:c=[0,0],edgeTypes:d=!1}=n||{},l=[],y=[{pos:t,types:d?new Array(t.length/i).fill(jU):null,holes:e||[]}],w=[[],[]];let S=[];for(;y.length;){const{pos:I,types:P,holes:B}=y.shift();WU(I,i,B[0]||I.length,w),S=zP(w[0],s,c,S);const G=Gp(w[1],S);if(G){let K=uT(I,P,i,0,B[0]||I.length,S,G);const de={pos:K[0].pos,types:K[0].types,holes:[]},Z={pos:K[1].pos,types:K[1].types,holes:[]};y.push(de,Z);for(let j=0;j<B.length;j++)K=uT(I,P,i,B[j],B[j+1]||I.length,S,G),K[0]&&(de.holes.push(de.pos.length),de.pos=yp(de.pos,K[0].pos),d&&(de.types=yp(de.types,K[0].types))),K[1]&&(Z.holes.push(Z.pos.length),Z.pos=yp(Z.pos,K[1].pos),d&&(Z.types=yp(Z.types,K[1].types)))}else{const K={positions:I};d&&(K.edgeTypes=P),B.length&&(K.holeIndices=B),l.push(K)}}return l}function uT(t,e,n,i,s,c,d){const l=(s-i)/n,y=[],w=[],S=[],I=[],P=[];let B,G,K;const de=vd(t,l-1,n,i);let Z=Math.sign(d&8?de[1]-c[3]:de[0]-c[2]),j=e&&e[l-1],q=0,se=0;for(let pe=0;pe<l;pe++)B=vd(t,pe,n,i,B),G=Math.sign(d&8?B[1]-c[3]:B[0]-c[2]),K=e&&e[i/n+pe],G&&Z&&Z!==G&&(W0(de,B,d,c,P),Os(y,P)&&S.push(j),Os(w,P)&&I.push(j)),G<=0?(Os(y,B)&&S.push(K),q-=G):S.length&&(S[S.length-1]=cT),G>=0?(Os(w,B)&&I.push(K),se+=G):I.length&&(I[I.length-1]=cT),G0(de,B),Z=G,j=K;return[q?{pos:y,types:e&&S}:null,se?{pos:w,types:e&&I}:null]}function zP(t,e,n,i){const s=Math.floor((t[0]-n[0])/e)*e+n[0],c=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=s,i[1]=c,i[2]=s+e,i[3]=c+e,i}function GU(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function WU(t,e,n,i){let s=1/0,c=-1/0,d=1/0,l=-1/0;for(let y=0;y<n;y+=e){const w=t[y],S=t[y+1];s=w<s?w:s,c=w>c?w:c,d=S<d?S:d,l=S>l?S:l}return i[0][0]=s,i[0][1]=d,i[1][0]=c,i[1][1]=l,i}const HU=85.051129;function $U(t,e){const{size:n=2,startIndex:i=0,endIndex:s=t.length,normalize:c=!0}=e||{},d=t.slice(i,s);DP(d,n,0,s-i);const l=kP(d,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c)for(const y of l)OP(y,n);return l}function qU(t,e=null,n){const{size:i=2,normalize:s=!0,edgeTypes:c=!1}=n||{};e=e||[];const d=[],l=[];let y=0,w=0;for(let I=0;I<=e.length;I++){const P=e[I]||t.length,B=w,G=ZU(t,i,y,P);for(let K=G;K<P;K++)d[w++]=t[K];for(let K=y;K<G;K++)d[w++]=t[K];DP(d,i,B,w),XU(d,i,B,w,n==null?void 0:n.maxLatitude),y=P,l[I]=w}l.pop();const S=RP(d,l,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(s)for(const I of S)OP(I.positions,i);return S}function ZU(t,e,n,i){let s=-1,c=-1;for(let d=n+1;d<i;d+=e){const l=Math.abs(t[d]);l>s&&(s=l,c=d-1)}return c}function XU(t,e,n,i,s=HU){const c=t[n],d=t[i-e];if(Math.abs(c-d)>180){const l=vd(t,0,e,n);l[0]+=Math.round((d-c)/360)*360,Os(t,l),l[1]=Math.sign(l[1])*s,Os(t,l),l[0]=c,Os(t,l)}}function DP(t,e,n,i){let s=t[0],c;for(let d=n;d<i;d+=e){c=t[d];const l=c-s;(l>180||l<-180)&&(c-=Math.round(l/360)*360),t[d]=s=c}}function OP(t,e){let n;const i=t.length/e;for(let c=0;c<i&&(n=t[c*e],(n+180)%360===0);c++);const s=-Math.round(n/360)*360;if(s!==0)for(let c=0;c<i;c++)t[c*e]+=s}function YU(t,e,n,i){let s;if(Array.isArray(t[0])){const c=t.length*e;s=new Array(c);for(let d=0;d<t.length;d++)for(let l=0;l<e;l++)s[d*e+l]=t[d][l]||0}else s=t;return n?kP(s,{size:e,gridResolution:n}):i?$U(s,{size:e}):s}const KU=1,JU=2,my=4;class QU extends SP{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?YU(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(hT(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&hT(e))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:c,geometrySize:d}=n;i.fill(0,c,c+d),s?(i[c]=my,i[c+d-2]=my):(i[c]+=KU,i[c+d-2]+=JU),i[c+d-1]=my}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:c}=n,d=new Array(3);for(let l=s,y=0;y<c;l++,y++)this.getPointOnPath(e,y,d),i[l*3]=d[0],i[l*3+1]=d[1],i[l*3+2]=d[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:s}=this;n*s>=e.length&&(n+=1-e.length/s);const c=n*s;return i[0]=e[c],i[1]=e[c+1],i[2]=s===3&&e[c+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function hT(t){return Array.isArray(t[0])}const eV=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tV=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,FP=[0,0,0,255],nV={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:FP},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},gy={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class wx extends Yo{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:eV,fs:tV,modules:[Bd,Nd]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:gy,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:gy,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:gy,defaultValue:FP},instancePickingColors:{size:3,type:5121,accessor:(i,{index:s,target:c})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,c)}}),this.setState({pathTesselator:new QU({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,y=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:y.getPath,buffers:y,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||s.invalidateAll()}if(i.extensionsChanged){var d;const{gl:l}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(l),s.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:s,miterLimit:c,widthUnits:d,widthScale:l,widthMinPixels:y,widthMaxPixels:w}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:s,widthUnits:Bl[d],widthScale:l,miterLimit:c,widthMinPixels:y,widthMaxPixels:w}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Ul(e,{...this.getShaders(),id:this.props.id,geometry:new Od({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}U(wx,"defaultProps",nV);U(wx,"layerName","PathLayer");var Ex={exports:{}};Ex.exports=lg;Ex.exports.default=lg;function lg(t,e,n){n=n||2;var i=e&&e.length,s=i?e[0]*n:t.length,c=BP(t,0,s,n,!0),d=[];if(!c||c.next===c.prev)return d;var l,y,w,S,I,P,B;if(i&&(c=aV(t,e,c,n)),t.length>80*n){l=w=t[0],y=S=t[1];for(var G=n;G<s;G+=n)I=t[G],P=t[G+1],I<l&&(l=I),P<y&&(y=P),I>w&&(w=I),P>S&&(S=P);B=Math.max(w-l,S-y),B=B!==0?32767/B:0}return xd(c,d,n,l,y,B,0),d}function BP(t,e,n,i,s){var c,d;if(s===q0(t,e,n,i)>0)for(c=e;c<n;c+=i)d=dT(c,t[c],t[c+1],d);else for(c=n-i;c>=e;c-=i)d=dT(c,t[c],t[c+1],d);return d&&cg(d,d.next)&&(wd(d),d=d.next),d}function Gl(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(cg(n,n.next)||Un(n.prev,n,n.next)===0)){if(wd(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function xd(t,e,n,i,s,c,d){if(t){!d&&c&&dV(t,i,s,c);for(var l=t,y,w;t.prev!==t.next;){if(y=t.prev,w=t.next,c?rV(t,i,s,c):iV(t)){e.push(y.i/n|0),e.push(t.i/n|0),e.push(w.i/n|0),wd(t),t=w.next,l=w.next;continue}if(t=w,t===l){d?d===1?(t=sV(Gl(t),e,n),xd(t,e,n,i,s,c,2)):d===2&&oV(t,e,n,i,s,c):xd(Gl(t),e,n,i,s,c,1);break}}}}function iV(t){var e=t.prev,n=t,i=t.next;if(Un(e,n,i)>=0)return!1;for(var s=e.x,c=n.x,d=i.x,l=e.y,y=n.y,w=i.y,S=s<c?s<d?s:d:c<d?c:d,I=l<y?l<w?l:w:y<w?y:w,P=s>c?s>d?s:d:c>d?c:d,B=l>y?l>w?l:w:y>w?y:w,G=i.next;G!==e;){if(G.x>=S&&G.x<=P&&G.y>=I&&G.y<=B&&Hc(s,l,c,y,d,w,G.x,G.y)&&Un(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function rV(t,e,n,i){var s=t.prev,c=t,d=t.next;if(Un(s,c,d)>=0)return!1;for(var l=s.x,y=c.x,w=d.x,S=s.y,I=c.y,P=d.y,B=l<y?l<w?l:w:y<w?y:w,G=S<I?S<P?S:P:I<P?I:P,K=l>y?l>w?l:w:y>w?y:w,de=S>I?S>P?S:P:I>P?I:P,Z=H0(B,G,e,n,i),j=H0(K,de,e,n,i),q=t.prevZ,se=t.nextZ;q&&q.z>=Z&&se&&se.z<=j;){if(q.x>=B&&q.x<=K&&q.y>=G&&q.y<=de&&q!==s&&q!==d&&Hc(l,S,y,I,w,P,q.x,q.y)&&Un(q.prev,q,q.next)>=0||(q=q.prevZ,se.x>=B&&se.x<=K&&se.y>=G&&se.y<=de&&se!==s&&se!==d&&Hc(l,S,y,I,w,P,se.x,se.y)&&Un(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;q&&q.z>=Z;){if(q.x>=B&&q.x<=K&&q.y>=G&&q.y<=de&&q!==s&&q!==d&&Hc(l,S,y,I,w,P,q.x,q.y)&&Un(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;se&&se.z<=j;){if(se.x>=B&&se.x<=K&&se.y>=G&&se.y<=de&&se!==s&&se!==d&&Hc(l,S,y,I,w,P,se.x,se.y)&&Un(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function sV(t,e,n){var i=t;do{var s=i.prev,c=i.next.next;!cg(s,c)&&NP(s,i,i.next,c)&&bd(s,c)&&bd(c,s)&&(e.push(s.i/n|0),e.push(i.i/n|0),e.push(c.i/n|0),wd(i),wd(i.next),i=t=c),i=i.next}while(i!==t);return Gl(i)}function oV(t,e,n,i,s,c){var d=t;do{for(var l=d.next.next;l!==d.prev;){if(d.i!==l.i&&mV(d,l)){var y=UP(d,l);d=Gl(d,d.next),y=Gl(y,y.next),xd(d,e,n,i,s,c,0),xd(y,e,n,i,s,c,0);return}l=l.next}d=d.next}while(d!==t)}function aV(t,e,n,i){var s=[],c,d,l,y,w;for(c=0,d=e.length;c<d;c++)l=e[c]*i,y=c<d-1?e[c+1]*i:t.length,w=BP(t,l,y,i,!1),w===w.next&&(w.steiner=!0),s.push(pV(w));for(s.sort(lV),c=0;c<s.length;c++)n=cV(s[c],n);return n}function lV(t,e){return t.x-e.x}function cV(t,e){var n=uV(t,e);if(!n)return e;var i=UP(n,t);return Gl(i,i.next),Gl(n,n.next)}function uV(t,e){var n=e,i=t.x,s=t.y,c=-1/0,d;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var l=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(l<=i&&l>c&&(c=l,d=n.x<n.next.x?n:n.next,l===i))return d}n=n.next}while(n!==e);if(!d)return null;var y=d,w=d.x,S=d.y,I=1/0,P;n=d;do i>=n.x&&n.x>=w&&i!==n.x&&Hc(s<S?i:c,s,w,S,s<S?c:i,s,n.x,n.y)&&(P=Math.abs(s-n.y)/(i-n.x),bd(n,t)&&(P<I||P===I&&(n.x>d.x||n.x===d.x&&hV(d,n)))&&(d=n,I=P)),n=n.next;while(n!==y);return d}function hV(t,e){return Un(t.prev,t,e.prev)<0&&Un(e.next,t,t.next)<0}function dV(t,e,n,i){var s=t;do s.z===0&&(s.z=H0(s.x,s.y,e,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,fV(s)}function fV(t){var e,n,i,s,c,d,l,y,w=1;do{for(n=t,t=null,c=null,d=0;n;){for(d++,i=n,l=0,e=0;e<w&&(l++,i=i.nextZ,!!i);e++);for(y=w;l>0||y>0&&i;)l!==0&&(y===0||!i||n.z<=i.z)?(s=n,n=n.nextZ,l--):(s=i,i=i.nextZ,y--),c?c.nextZ=s:t=s,s.prevZ=c,c=s;n=i}c.nextZ=null,w*=2}while(d>1);return t}function H0(t,e,n,i,s){return t=(t-n)*s|0,e=(e-i)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function pV(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Hc(t,e,n,i,s,c,d,l){return(s-d)*(e-l)>=(t-d)*(c-l)&&(t-d)*(i-l)>=(n-d)*(e-l)&&(n-d)*(c-l)>=(s-d)*(i-l)}function mV(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!gV(t,e)&&(bd(t,e)&&bd(e,t)&&_V(t,e)&&(Un(t.prev,t,e.prev)||Un(t,e.prev,e))||cg(t,e)&&Un(t.prev,t,t.next)>0&&Un(e.prev,e,e.next)>0)}function Un(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function cg(t,e){return t.x===e.x&&t.y===e.y}function NP(t,e,n,i){var s=xp(Un(t,e,n)),c=xp(Un(t,e,i)),d=xp(Un(n,i,t)),l=xp(Un(n,i,e));return!!(s!==c&&d!==l||s===0&&vp(t,n,e)||c===0&&vp(t,i,e)||d===0&&vp(n,t,i)||l===0&&vp(n,e,i))}function vp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function xp(t){return t>0?1:t<0?-1:0}function gV(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&NP(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function bd(t,e){return Un(t.prev,t,t.next)<0?Un(t,e,t.next)>=0&&Un(t,t.prev,e)>=0:Un(t,e,t.prev)<0||Un(t,t.next,e)<0}function _V(t,e){var n=t,i=!1,s=(t.x+e.x)/2,c=(t.y+e.y)/2;do n.y>c!=n.next.y>c&&n.next.y!==n.y&&s<(n.next.x-n.x)*(c-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function UP(t,e){var n=new $0(t.i,t.x,t.y),i=new $0(e.i,e.x,e.y),s=t.next,c=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,c.next=i,i.prev=c,i}function dT(t,e,n,i){var s=new $0(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function wd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $0(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}lg.deviation=function(t,e,n,i){var s=e&&e.length,c=s?e[0]*n:t.length,d=Math.abs(q0(t,0,c,n));if(s)for(var l=0,y=e.length;l<y;l++){var w=e[l]*n,S=l<y-1?e[l+1]*n:t.length;d-=Math.abs(q0(t,w,S,n))}var I=0;for(l=0;l<i.length;l+=3){var P=i[l]*n,B=i[l+1]*n,G=i[l+2]*n;I+=Math.abs((t[P]-t[G])*(t[B+1]-t[P+1])-(t[P]-t[B])*(t[G+1]-t[P+1]))}return d===0&&I===0?0:Math.abs((I-d)/d)};function q0(t,e,n,i){for(var s=0,c=e,d=n-i;c<n;c+=i)s+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return s}lg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var c=0;c<t[s].length;c++)for(var d=0;d<e;d++)n.vertices.push(t[s][c][d]);s>0&&(i+=t[s-1].length,n.holes.push(i))}return n};var yV=Ex.exports;const vV=Om(yV),bp=MP.CLOCKWISE,fT=MP.COUNTER_CLOCKWISE,La={isClosed:!0};function xV(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Oh(t){return"positions"in t?t.positions:t}function Wp(t){return"holeIndices"in t?t.holeIndices:null}function bV(t){return Array.isArray(t[0])}function wV(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function EV(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function TV(t,e,n,i){for(let s=0;s<e;s++)if(t[n+s]!==t[i-e+s])return!1;return!0}function pT(t,e,n,i,s){let c=e;const d=n.length;for(let l=0;l<d;l++)for(let y=0;y<i;y++)t[c++]=n[l][y]||0;if(!EV(n))for(let l=0;l<i;l++)t[c++]=n[0][l]||0;return La.start=e,La.end=c,La.size=i,LP(t,s,La),c}function mT(t,e,n,i,s=0,c,d){c=c||n.length;const l=c-s;if(l<=0)return e;let y=e;for(let w=0;w<l;w++)t[y++]=n[s+w];if(!TV(n,i,s,c))for(let w=0;w<i;w++)t[y++]=n[s+w];return La.start=e,La.end=y,La.size=i,LP(t,d,La),y}function SV(t,e){xV(t);const n=[],i=[];if("positions"in t){const{positions:s,holeIndices:c}=t;if(c){let d=0;for(let l=0;l<=c.length;l++)d=mT(n,d,s,e,c[l-1],c[l],l===0?bp:fT),i.push(d);return i.pop(),{positions:n,holeIndices:i}}t=s}if(!bV(t))return mT(n,0,t,e,0,n.length,bp),n;if(!wV(t)){let s=0;for(const[c,d]of t.entries())s=pT(n,s,d,e,c===0?bp:fT),i.push(s);return i.pop(),{positions:n,holeIndices:i}}return pT(n,0,t,e,bp),n}function _y(t,e,n){const i=t.length/3;let s=0;for(let c=0;c<i;c++){const d=(c+1)%i;s+=t[c*3+e]*t[d*3+n],s-=t[d*3+e]*t[c*3+n]}return Math.abs(s/2)}function gT(t,e,n,i){const s=t.length/3;for(let c=0;c<s;c++){const d=c*3,l=t[d+0],y=t[d+1],w=t[d+2];t[d+e]=l,t[d+n]=y,t[d+i]=w}}function AV(t,e,n,i){let s=Wp(t);s&&(s=s.map(l=>l/e));let c=Oh(t);const d=i&&e===3;if(n){const l=c.length;c=c.slice();const y=[];for(let w=0;w<l;w+=e){y[0]=c[w],y[1]=c[w+1],d&&(y[2]=c[w+2]);const S=n(y);c[w]=S[0],c[w+1]=S[1],d&&(c[w+2]=S[2])}}if(d){const l=_y(c,0,1),y=_y(c,0,2),w=_y(c,1,2);if(!l&&!y&&!w)return[];l>y&&l>w||(y>w?(n||(c=c.slice()),gT(c,0,2,1)):(n||(c=c.slice()),gT(c,2,0,1)))}return vV(c,s,e)}class PV extends SP{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=SV(e,this.positionSize);return this.opts.resolution?RP(Oh(n),Wp(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?qU(Oh(n),Wp(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(_T(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return Oh(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&_T(e))for(const i of e){const s=this.getGeometrySize(i);n.geometrySize=s,this.updateGeometryAttributes(i,n),n.vertexStart+=s,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:s}){const{attributes:c,indexStarts:d,typedArrayManager:l}=this;let y=c.indices;if(!y||!e)return;let w=s;const S=AV(e,this.positionSize,this.opts.preproject,this.opts.full3d);y=l.allocate(y,s+S.length,{copy:!0});for(let I=0;I<S.length;I++)y[w++]=S[I]+i;d[n+1]=s+S.length,c.indices=y}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:s},positionSize:c}=this;if(!s||!e)return;const d=Oh(e);for(let l=n,y=0;y<i;l++,y++){const w=d[y*c],S=d[y*c+1],I=c>2?d[y*c+2]:0;s[l*3]=w,s[l*3+1]=S,s[l*3+2]=I}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:s}=this,c=this.attributes.vertexValid,d=e&&Wp(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,n):c.fill(1,n,n+i),d)for(let l=0;l<d.length;l++)c[n+d[l]/s-1]=0;c[n+i-1]=0}}function _T(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const VP=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,CV=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(VP,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),IV=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(VP,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),MV=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,zm=[0,0,0,255],LV={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:zm},getLineColor:{type:"accessor",value:zm},material:!0},wp={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Tx extends Yo{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?CV:IV,fs:MV,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Bd,z4,Nd]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:s}=this.props;n.isGeospatial&&i===cn.DEFAULT&&(i=cn.LNGLAT);let c;i===cn.LNGLAT&&(s?c=n.projectPosition.bind(n):c=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new PV({preproject:c,fp64:this.use64bitPositions(),IndexType:!e||ix(e,In.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const d=this.getAttributeManager(),l=!0;d.remove(["instancePickingColors"]),d.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:wp,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:wp,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:wp,accessor:"getFillColor",defaultValue:zm,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:wp,accessor:"getLineColor",defaultValue:zm,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(y,{index:w,target:S})=>this.encodePickingColor(y&&y.__source?y.__source.index:w,S),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:s}=this.props;return s[0]&&s[0].__source&&(n.object=s.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:s,elevationScale:c}=this.props,{topModel:d,sideModel:l,polygonTesselator:y}=this.state,w={...e,extruded:!!n,elevationScale:c};l&&(l.setInstanceCount(y.instanceCount-1),l.setUniforms(w),s&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),i&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),d&&(d.setVertexCount(y.vertexCount),d.setUniforms(w).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:s}=e,c=this.getAttributeManager();if(s.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var l;(l=this.state.models)===null||l===void 0||l.forEach(y=>y.delete()),this.setState(this._getModels(this.context.gl)),c.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,d=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:d.getPolygon,buffers:d,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:s}=this.props;let c,d;if(i){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,c=new Ul(e,{...l,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return s&&(d=new Ul(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Od({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),d.userData.excludeAttributes={indices:!0}),{models:[d,c].filter(Boolean),topModel:c,sideModel:d}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}U(Tx,"defaultProps",LV);U(Tx,"layerName","SolidPolygonLayer");function kV({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:s=0,endRow:c=1/0}=n,d=t.length;let l=d,y=d;for(let P=0;P<d;P++){const B=e(t[P]);if(l>P&&B>=s&&(l=P),B>=c){y=P;break}}let w=l;const I=y-l!==i.length?t.slice(y):void 0;for(let P=0;P<i.length;P++)t[w++]=i[P];if(I){for(let P=0;P<I.length;P++)t[w++]=I[P];t.length=w}return{startRow:l,endRow:l+i.length}}function RV(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?zV(t,i,n):null}function zV(t,e,n){const i={properties:{...t.properties[e]}};for(const s in t.numericProps)i.properties[s]=t.numericProps[s].value[n];return i}function DV(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const s=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(s.length*3);const c=[];for(let d=0;d<s.length;d++)e(s[d],c),n[i][d*3+0]=c[0],n[i][d*3+1]=c[1],n[i][d*3+2]=c[2]}return n}const OV=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,yy=192/256,yT=[],FV={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Sx extends ag{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:OV}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:s}=n;s!==i.outlineColor&&(s=s.map(c=>c/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!n.sdf&&n.outlineWidth&&Zt.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:s}=this.props,{outlineColor:c}=this.state,d=s?Math.max(i,yy*(1-s)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:yy,outlineBuffer:d,gamma:i,sdf:!!n,outlineColor:c},super.draw(e),n&&s){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:yy}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):yT}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):yT}}U(Sx,"defaultProps",FV);U(Sx,"layerName","MultiIconLayer");const Xh=1e20;class BV{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:l="normal"}={}){this.buffer=n,this.cutoff=s,this.radius=i;const y=this.size=e+n*4,w=this._createCanvas(y),S=this.ctx=w.getContext("2d",{willReadFrequently:!0});S.font=`${l} ${d} ${e}px ${c}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(e),l=Math.ceil(i),y=0,w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),S=Math.min(this.size-this.buffer,l+Math.ceil(s)),I=w+2*this.buffer,P=S+2*this.buffer,B=Math.max(I*P,0),G=new Uint8ClampedArray(B),K={data:G,width:I,height:P,glyphWidth:w,glyphHeight:S,glyphTop:l,glyphLeft:y,glyphAdvance:n};if(w===0||S===0)return K;const{ctx:de,buffer:Z,gridInner:j,gridOuter:q}=this;de.clearRect(Z,Z,w,S),de.fillText(e,Z,Z+l);const se=de.getImageData(Z,Z,w,S);q.fill(Xh,0,B),j.fill(0,0,B);for(let pe=0;pe<S;pe++)for(let be=0;be<w;be++){const Re=se.data[4*(pe*w+be)+3]/255;if(Re===0)continue;const Fe=(pe+Z)*I+be+Z;if(Re===1)q[Fe]=0,j[Fe]=Xh;else{const Ve=.5-Re;q[Fe]=Ve>0?Ve*Ve:0,j[Fe]=Ve<0?Ve*Ve:0}}vT(q,0,0,I,P,I,this.f,this.v,this.z),vT(j,Z,Z,w,S,I,this.f,this.v,this.z);for(let pe=0;pe<B;pe++){const be=Math.sqrt(q[pe])-Math.sqrt(j[pe]);G[pe]=Math.round(255-255*(be/this.radius+this.cutoff))}return K}}function vT(t,e,n,i,s,c,d,l,y){for(let w=e;w<e+i;w++)xT(t,n*c+w,c,s,d,l,y);for(let w=n;w<n+s;w++)xT(t,w*c+e,1,i,d,l,y)}function xT(t,e,n,i,s,c,d){c[0]=0,d[0]=-Xh,d[1]=Xh,s[0]=t[e];for(let l=1,y=0,w=0;l<i;l++){s[l]=t[e+l*n];const S=l*l;do{const I=c[y];w=(s[l]-s[I]+S-I*I)/(l-I)/2}while(w<=d[y]&&--y>-1);y++,c[y]=l,d[y]=w,d[y+1]=Xh}for(let l=0,y=0;l<i;l++){for(;d[y+1]<l;)y++;const w=c[y],S=l-w;t[e+l*n]=s[w]+S*S}}const NV=32,UV=[];function VV(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function jV({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:s,mapping:c={},xOffset:d=0,yOffset:l=0}){let y=0,w=d;const S=n+i*2;for(const I of t)if(!c[I]){const P=e(I);w+P+i*2>s&&(w=0,y++),c[I]={x:w+i,y:l+y*S+i,width:P,height:S,layoutWidth:P,layoutHeight:n},w+=P+i*2}return{mapping:c,xOffset:w,yOffset:l+y*S,canvasHeight:VV(l+(y+1)*S)}}function jP(t,e,n,i){let s=0;for(let d=e;d<n;d++){var c;const l=t[d];s+=((c=i[l])===null||c===void 0?void 0:c.layoutWidth)||0}return s}function GP(t,e,n,i,s,c){let d=e,l=0;for(let y=e;y<n;y++){const w=jP(t,y,y+1,s);l+w>i&&(d<y&&c.push(y),d=y,l=0),l+=w}return l}function GV(t,e,n,i,s,c){let d=e,l=e,y=e,w=0;for(let S=e;S<n;S++)if((t[S]===" "||t[S+1]===" "||S+1===n)&&(y=S+1),y>l){let I=jP(t,l,y,s);w+I>i&&(d<l&&(c.push(l),d=l,w=0),I>i&&(I=GP(t,l,y,i,s,c),d=c[c.length-1])),l=y,w+=I}return w}function WV(t,e,n,i,s=0,c){c===void 0&&(c=t.length);const d=[];return e==="break-all"?GP(t,s,c,n,i,d):GV(t,s,c,n,i,d),d}function HV(t,e,n,i,s,c){let d=0,l=0;for(let y=e;y<n;y++){const w=t[y],S=i[w];S?(l||(l=S.layoutHeight),s[y]=d+S.layoutWidth/2,d+=S.layoutWidth):(Zt.warn("Missing character: ".concat(w," (").concat(w.codePointAt(0),")"))(),s[y]=d,d+=NV)}c[0]=d,c[1]=l}function $V(t,e,n,i,s){const c=Array.from(t),d=c.length,l=new Array(d),y=new Array(d),w=new Array(d),S=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,I=[0,0],P=[0,0];let B=0,G=0,K=0;for(let Z=0;Z<=d;Z++){const j=c[Z];if((j===`
`||Z===d)&&(K=Z),K>G){const q=S?WV(c,n,i,s,G,K):UV;for(let se=0;se<=q.length;se++){const pe=se===0?G:q[se-1],be=se<q.length?q[se]:K;HV(c,pe,be,s,l,P);for(let Re=pe;Re<be;Re++){var de;const Fe=c[Re],Ve=((de=s[Fe])===null||de===void 0?void 0:de.layoutOffsetY)||0;y[Re]=B+P[1]/2+Ve,w[Re]=P[0]}B=B+P[1]*e,I[0]=Math.max(I[0],P[0])}G=K}j===`
`&&(l[G]=0,y[G]=0,w[G]=0,G++)}return I[1]=B,{x:l,y,rowWidth:w,size:I}}function qV({value:t,length:e,stride:n,offset:i,startIndices:s,characterSet:c}){const d=t.BYTES_PER_ELEMENT,l=n?n/d:1,y=i?i/d:0,w=s[e]||Math.ceil((t.length-y)/l),S=c&&new Set,I=new Array(e);let P=t;if(l>1||y>0){const B=t.constructor;P=new B(w);for(let G=0;G<w;G++)P[G]=t[G*l+y]}for(let B=0;B<e;B++){const G=s[B],K=s[B+1]||w,de=P.subarray(G,K);I[B]=String.fromCodePoint.apply(null,de),S&&de.forEach(S.add,S)}if(S)for(const B of S)c.add(String.fromCodePoint(B));return{texts:I,characterCount:w}}class WP{constructor(e=5){U(this,"limit",void 0),U(this,"_cache",{}),U(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function ZV(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const eu={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:ZV(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},bT=1024,wT=.9,ET=1.2,HP=3;let Dm=new WP(HP);function XV(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Dm.get(t);if(!i)return n;for(const s in i.mapping)n.has(s)&&n.delete(s);return n}function YV(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function TT(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function KV(t){Zt.assert(Number.isFinite(t)&&t>=HP,"Invalid cache limit"),Dm=new WP(t)}class JV{constructor(){U(this,"props",{...eu}),U(this,"_key",void 0),U(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*ET+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=XV(this._key,this.props.characterSet),i=Dm.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(n,i);this._atlas=s,Dm.set(this._key,s)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:s,fontSize:c,buffer:d,sdf:l,radius:y,cutoff:w}=this.props;let S=n&&n.data;S||(S=document.createElement("canvas"),S.width=bT);const I=S.getContext("2d",{willReadFrequently:!0});TT(I,i,c,s);const{mapping:P,canvasHeight:B,xOffset:G,yOffset:K}=jV({getFontWidth:de=>I.measureText(de).width,fontHeight:c*ET,buffer:d,characterSet:e,maxCanvasWidth:bT,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(S.height!==B){const de=I.getImageData(0,0,S.width,S.height);S.height=B,I.putImageData(de,0,0)}if(TT(I,i,c,s),l){const de=new BV({fontSize:c,buffer:d,radius:y,cutoff:w,fontFamily:i,fontWeight:"".concat(s)});for(const Z of e){const{data:j,width:q,height:se,glyphTop:pe}=de.draw(Z);P[Z].width=q,P[Z].layoutOffsetY=c*wT-pe;const be=I.createImageData(q,se);YV(j,be),I.putImageData(be,P[Z].x,P[Z].y)}}else for(const de of e)I.fillText(de,P[de].x,P[de].y+d+c*wT);return{xOffset:G,yOffset:K,mapping:P,data:S,width:S.width,height:S.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:s,sdf:c,radius:d,cutoff:l}=this.props;return c?"".concat(e," ").concat(n," ").concat(i," ").concat(s," ").concat(d," ").concat(l):"".concat(e," ").concat(n," ").concat(i," ").concat(s)}}const QV=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,e8=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,t8={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Ax extends Yo{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:QV,fs:e8,modules:[Bd,Nd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:s}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:s,sizeMinPixels:c,sizeMaxPixels:d,getLineWidth:l}=this.props;let{padding:y}=this.props;y.length<4&&(y=[y[0],y[1],y[0],y[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!l,padding:y,sizeUnits:Bl[s],sizeScale:i,sizeMinPixels:c,sizeMaxPixels:d}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Ul(e,{...this.getShaders(),id:this.props.id,geometry:new Od({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}U(Ax,"defaultProps",t8);U(Ax,"layerName","TextBackgroundLayer");const ST={start:1,middle:0,end:-1},AT={top:1,center:0,bottom:-1},vy=[0,0,0,255],n8=1,i8={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:vy},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:eu.characterSet},fontFamily:eu.fontFamily,fontWeight:eu.fontWeight,lineHeight:n8,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:vy},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:vy},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Px extends xx{constructor(...e){super(...e),U(this,"state",void 0),U(this,"getBoundingRect",(n,i)=>{let{size:[s,c]}=this.transformParagraph(n,i);const{fontSize:d}=this.state.fontAtlasManager.props;s/=d,c/=d;const{getTextAnchor:l,getAlignmentBaseline:y}=this.props,w=ST[typeof l=="function"?l(n,i):l],S=AT[typeof y=="function"?y(n,i):y];return[(w-1)*s/2,(S-1)*c/2,s,c]}),U(this,"getIconOffsets",(n,i)=>{const{getTextAnchor:s,getAlignmentBaseline:c}=this.props,{x:d,y:l,rowWidth:y,size:[w,S]}=this.transformParagraph(n,i),I=ST[typeof s=="function"?s(n,i):s],P=AT[typeof c=="function"?c(n,i):c],B=d.length,G=new Array(B*2);let K=0;for(let de=0;de<B;de++){const Z=(1-I)*(w-y[de])/2;G[K++]=(I-1)*w/2+Z+d[de],G[K++]=(P-1)*S/2+l[de]}return G})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new JV},this.props.maxWidth>0&&Zt.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:c}=this.state,d={...e,characterSet:c,fontFamily:n,fontWeight:i};if(!s.mapping)return s.setProps(d),!0;for(const l in d)if(d[l]!==s.props[l])return s.setProps(d),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,s=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:c}=this.props,d=n.startIndices,l;const y=i==="auto"&&new Set;if(s&&d){const{texts:w,characterCount:S}=qV({...ArrayBuffer.isView(s)?{value:s}:s,length:n.length,startIndices:d,characterSet:y});l=S,c=(I,{index:P})=>w[P]}else{const{iterable:w,objectInfo:S}=sg(n);d=[0],l=0;for(const I of w){S.index++;const P=Array.from(c(I,S)||"");y&&P.forEach(y.add,y),l+=P.length,d.push(l)}}this.setState({getText:c,startIndices:d,numInstances:l,characterSet:y||i})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,s=i.mapping,c=this.state.getText,{wordBreak:d,lineHeight:l,maxWidth:y}=this.props,w=c(e,n)||"";return $V(w,l,d,y*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:s,texture:c,mapping:d},styleVersion:l}=this.state,{data:y,_dataDiff:w,getPosition:S,getColor:I,getSize:P,getAngle:B,getPixelOffset:G,getBackgroundColor:K,getBorderColor:de,getBorderWidth:Z,backgroundPadding:j,background:q,billboard:se,fontSettings:pe,outlineWidth:be,outlineColor:Re,sizeScale:Fe,sizeUnits:Ve,sizeMinPixels:je,sizeMaxPixels:pt,transitions:bt,updateTriggers:St}=this.props,kt=this.getSubLayerClass("characters",Sx),Gn=this.getSubLayerClass("background",Ax);return[q&&new Gn({getFillColor:K,getLineColor:de,getLineWidth:Z,padding:j,getPosition:S,getSize:P,getAngle:B,getPixelOffset:G,billboard:se,sizeScale:Fe,sizeUnits:Ve,sizeMinPixels:je,sizeMaxPixels:pt,transitions:bt&&{getPosition:bt.getPosition,getAngle:bt.getAngle,getSize:bt.getSize,getFillColor:bt.getBackgroundColor,getLineColor:bt.getBorderColor,getLineWidth:bt.getBorderWidth,getPixelOffset:bt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:St.getPosition,getAngle:St.getAngle,getSize:St.getSize,getFillColor:St.getBackgroundColor,getLineColor:St.getBorderColor,getLineWidth:St.getBorderWidth,getPixelOffset:St.getPixelOffset,getBoundingRect:{getText:St.getText,getTextAnchor:St.getTextAnchor,getAlignmentBaseline:St.getAlignmentBaseline,styleVersion:l}}}),{data:y.attributes&&y.attributes.background?{length:y.length,attributes:y.attributes.background}:y,_dataDiff:w,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new kt({sdf:pe.sdf,smoothing:Number.isFinite(pe.smoothing)?pe.smoothing:eu.smoothing,outlineWidth:be/(pe.radius||eu.radius),outlineColor:Re,iconAtlas:c,iconMapping:d,getPosition:S,getColor:I,getSize:P,getAngle:B,getPixelOffset:G,billboard:se,sizeScale:Fe*s,sizeUnits:Ve,sizeMinPixels:je*s,sizeMaxPixels:pt*s,transitions:bt&&{getPosition:bt.getPosition,getAngle:bt.getAngle,getColor:bt.getColor,getSize:bt.getSize,getPixelOffset:bt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:St.getText,getPosition:St.getPosition,getAngle:St.getAngle,getColor:St.getColor,getSize:St.getSize,getPixelOffset:St.getPixelOffset,getIconOffsets:{getTextAnchor:St.getTextAnchor,getAlignmentBaseline:St.getAlignmentBaseline,styleVersion:l}}}),{data:y,_dataDiff:w,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){KV(e)}}U(Px,"defaultProps",i8);U(Px,"layerName","TextLayer");const Hp={circle:{type:bx,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:ag,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Px,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},$p={type:wx,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Z0={type:Tx,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ih({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function xy(t,e){const{transitions:n,updateTriggers:i}=t.props,s={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const c in e){const d=e[c];let l=t.props[c];c.startsWith("get")&&(l=t.getSubLayerAccessor(l),s.updateTriggers[d]=i[c],n&&(s.transitions[d]=n[c])),s[d]=l}return s}function r8(t){if(Array.isArray(t))return t;switch(Zt.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Zt.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function PT(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:c=t.length}=n;for(let d=s;d<c;d++){const l=t[d],{geometry:y}=l;if(y)if(y.type==="GeometryCollection"){Zt.assert(Array.isArray(y.geometries),"GeoJSON does not have geometries array");const{geometries:w}=y;for(let S=0;S<w.length;S++){const I=w[S];CT(I,i,e,l,d)}}else CT(y,i,e,l,d)}return i}function CT(t,e,n,i,s){const{type:c,coordinates:d}=t,{pointFeatures:l,lineFeatures:y,polygonFeatures:w,polygonOutlineFeatures:S}=e;if(!o8(c,d)){Zt.warn("".concat(c," coordinates are malformed"))();return}switch(c){case"Point":l.push(n({geometry:t},i,s));break;case"MultiPoint":d.forEach(I=>{l.push(n({geometry:{type:"Point",coordinates:I}},i,s))});break;case"LineString":y.push(n({geometry:t},i,s));break;case"MultiLineString":d.forEach(I=>{y.push(n({geometry:{type:"LineString",coordinates:I}},i,s))});break;case"Polygon":w.push(n({geometry:t},i,s)),d.forEach(I=>{S.push(n({geometry:{type:"LineString",coordinates:I}},i,s))});break;case"MultiPolygon":d.forEach(I=>{w.push(n({geometry:{type:"Polygon",coordinates:I}},i,s)),I.forEach(P=>{S.push(n({geometry:{type:"LineString",coordinates:P}},i,s))})});break}}const s8={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function o8(t,e){let n=s8[t];for(Zt.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function $P(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Ep(t){return t.geometry.coordinates}function a8(t,e){const n=$P(),{pointFeatures:i,lineFeatures:s,polygonFeatures:c,polygonOutlineFeatures:d}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=Ep,n.lines.data=s,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=Ep,n.polygons.data=c,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=Ep,n.polygonsOutline.data=d,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=Ep,n}function l8(t,e){const n=$P(),{points:i,lines:s,polygons:c}=t,d=DV(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:d.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:d.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.lines._pathType="open",n.polygons.data={length:c.polygonIndices.value.length-1,startIndices:c.polygonIndices.value,attributes:{...c.attributes,getPolygon:c.positions,pickingColors:{size:3,value:d.polygons}},properties:c.properties,numericProps:c.numericProps,featureIds:c.featureIds},n.polygons._normalize=!1,c.triangles&&(n.polygons.data.attributes.indices=c.triangles.value),n.polygonsOutline.data={length:c.primitivePolygonIndices.value.length-1,startIndices:c.primitivePolygonIndices.value,attributes:{...c.attributes,getPath:c.positions,instancePickingColors:{size:3,value:d.polygons}},properties:c.properties,numericProps:c.numericProps,featureIds:c.featureIds},n.polygonsOutline._pathType="open",n}const c8=["points","linestrings","polygons"],u8={...Ih(Hp.circle),...Ih(Hp.icon),...Ih(Hp.text),...Ih($p),...Ih(Z0),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Cx extends xx{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=l8(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=r8(e.data),s=this.getSubLayerRow.bind(this);let c={};const d={};if(Array.isArray(n.dataChanged)){const y=this.state.features;for(const w in y)c[w]=y[w].slice(),d[w]=[];for(const w of n.dataChanged){const S=PT(i,s,w);for(const I in y)d[I].push(kV({data:c[I],getIndex:P=>P.__source.index,dataRange:w,replace:S[I]}))}}else c=PT(i,s);const l=a8(c,d);this.setState({features:c,featuresDiff:d,layerProps:l})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:s}=n;return n.featureType=c8.find(c=>s.id.startsWith("".concat(this.id,"-").concat(c,"-"))),i>=0&&s.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(n)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,s="polygons-fill",c=this.shouldRenderSubLayer(s,i.polygons.data)&&this.getSubLayerClass(s,Z0.type);if(c){const d=xy(this,Z0.props),l=e&&n;return l||delete d.getLineColor,d.updateTriggers.lineColors=l,new c(d,this.getSubLayerProps({id:s,updateTriggers:d.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,s="polygons-stroke",c="linestrings",d=!e&&n&&this.shouldRenderSubLayer(s,i.polygonsOutline.data)&&this.getSubLayerClass(s,$p.type),l=this.shouldRenderSubLayer(c,i.lines.data)&&this.getSubLayerClass(c,$p.type);if(d||l){const y=xy(this,$p.props);return[d&&new d(y,this.getSubLayerProps({id:s,updateTriggers:y.updateTriggers}),i.polygonsOutline),l&&new l(y,this.getSubLayerProps({id:c,updateTriggers:y.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=n.points.data.findIndex(l=>l.__source.index===s));const c=new Set(e.split("+")),d=[];for(const l of c){const y="points-".concat(l),w=Hp[l],S=w&&this.shouldRenderSubLayer(y,n.points.data)&&this.getSubLayerClass(y,w.type);if(S){const I=xy(this,w.props);let P=n.points;if(l==="text"&&i){const{instancePickingColors:B,...G}=P.data.attributes;P={...P,data:{...P.data,attributes:G}}}d.push(new S(I,this.getSubLayerProps({id:y,updateTriggers:I.updateTriggers,highlightedObjectIndex:s}),P))}}return d}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&n,i,s,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:c,index:d}=s,l=RV(c,d);return e(l,s)}}}U(Cx,"layerName","GeoJsonLayer");U(Cx,"defaultProps",u8);const h8="/dev-site/aix/height_aix2.json",d8=[[0,255,0],[64,255,0],[90,160,90],[31,217,3],[42,102,42],[11,109,11],[121,206,85],[113,249,54]],f8=[3,7,9,13,17,21];function p8(t,e){if(!Array.isArray(e)||e.length<1)throw"Unvalid domain";let n=e.length;if(n<2)return 0;let i=n-1,s,c;for(;n-- >0;)c=e[n]-t,(!s||c>=0&&c<s)&&(s=c,i=n);return i}function m8(t){const e=p8(t.properties.height,f8);return d8[e]}const g8={latitude:43.52749,longitude:5.44802,zoom:14,maxZoom:18,pitch:45,bearing:0},_8="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",y8=new ZA({color:[255,255,255],intensity:1}),v8=new MN({timestamp:Date.UTC(2019,7,1,22),color:[255,255,255],intensity:1,_shadow:!0});function x8([t,e]){return"<li>"+t+": "+e+"</li>"}function b8({object:t}){return t&&{html:`<h3>Property Value</h3>
<ol>${Object.entries(t.properties).map(x8).join("")}</ol>
`}}function w8({data:t=h8,mapStyle:e=_8}){const[n]=at.useState(()=>{const s=new fx({ambientLight:y8,dirLight:v8});return s.shadowColor=[0,0,0,.5],[s]}),i=[new Cx({id:"geojson",data:t,opacity:1,stroked:!1,pointType:"circle",getRadius:s=>s.properties.winRadius,filled:!0,extruded:!0,wireframe:!0,elevationScale:100,getElevation:s=>s.properties.height*10,getFillColor:m8,getLineColor:[255,255,255],pickable:!0})];return by.createElement(TU,{layers:i,effects:n,initialViewState:g8,controller:!0,getTooltip:b8},by.createElement(Pk,{reuseMaps:!0,mapLib:Ik,mapStyle:e,preventStyleDiffing:!0}))}function E8(t){US(t).render(by.createElement(w8,null))}E8(document.getElementById("app"));
